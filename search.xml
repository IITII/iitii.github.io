<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ES 6/7 数据备份恢复</title>
      <link href="/2024/11/01/1/"/>
      <url>/2024/11/01/1/</url>
      
        <content type="html"><![CDATA[<h2 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VsYXN0aWNzZWFyY2gtZHVtcA==">https://github.com/elasticsearch-dump<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL2VsYXN0aWNkdW1wL2VsYXN0aWNzZWFyY2gtZHVtcA==">https://hub.docker.com/r/elasticdump/elasticsearch-dump<i class="fa fa-external-link-alt"></i></span></p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><blockquote><p>更多请参考: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VsYXN0aWNzZWFyY2gtZHVtcC9lbGFzdGljc2VhcmNoLWR1bXA/dGFiPXJlYWRtZS1vdi1maWxlI29wdGlvbnM=">https://github.com/elasticsearch-dump/elasticsearch-dump?tab=readme-ov-file#options<i class="fa fa-external-link-alt"></i></span></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--parallel 并发度</span><br><span class="line">--direction load: 恢复, dump: 导出(默认)</span><br><span class="line">--input 数据来源</span><br><span class="line">--match 正则匹配需要导出的索引</span><br><span class="line">--includeType= 导出类型, 支持六种: data,mapping,analyzer,alias,settings,template</span><br><span class="line">--output 数据输出</span><br></pre></td></tr></table></figure><h2 id="环境假设"><a href="#环境假设" class="headerlink" title="环境假设"></a>环境假设</h2><blockquote><p>如果因为分词插件等造成同步失败, 请自行解决  </p></blockquote><ul><li>es6: <span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMTo5MjAwLw==">http://127.0.0.1:9200<i class="fa fa-external-link-alt"></i></span></li><li>es7 <span class="exturl" data-url="aHR0cDovLzEyNy4wLjAuMToxOTIwMC8=">http://127.0.0.1:19200<i class="fa fa-external-link-alt"></i></span></li><li>esdump6 存储 es6 导出的数据</li><li>esdump7 存储 es7 导出的数据</li><li>需要备份的索引为 <code>test_backup.*</code></li></ul><h2 id="es6-数据导出恢复"><a href="#es6-数据导出恢复" class="headerlink" title="es6 数据导出恢复"></a>es6 数据导出恢复</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v `pwd`/esdump6:/esdump --rm -ti --entrypoint multielasticdump elasticdump/elasticsearch-dump \</span><br><span class="line">  --direction=dump \</span><br><span class="line">  --match=&#x27;^test_backup.*$&#x27;\</span><br><span class="line">  --input=http://127.0.0.1:9200 \</span><br><span class="line">  --includeType=&#x27;settings,mapping,analyzer,alias,data&#x27; \</span><br><span class="line">  --output=/esdump &gt;es_dump.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v `pwd`/esdump6:/esdump --rm -ti --entrypoint multielasticdump elasticdump/elasticsearch-dump \</span><br><span class="line">  --parallel=4 \</span><br><span class="line">  --direction=load \</span><br><span class="line">  --input=/esdump \</span><br><span class="line">  --includeType=&#x27;settings,mapping,analyzer,alias,data&#x27; \</span><br><span class="line">  --output=http://127.0.0.1:9200 &gt;es_load.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="es7-数据导出恢复"><a href="#es7-数据导出恢复" class="headerlink" title="es7 数据导出恢复"></a>es7 数据导出恢复</h2><h3 id="导出-1"><a href="#导出-1" class="headerlink" title="导出"></a>导出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v `pwd`/esdump6:/esdump --rm -ti --entrypoint multielasticdump elasticdump/elasticsearch-dump \</span><br><span class="line">  --direction=dump \</span><br><span class="line">  --match=&#x27;^test_backup.*$&#x27;\</span><br><span class="line">  --input=http://127.0.0.1:19200 \</span><br><span class="line">  --includeType=&#x27;settings,mapping,analyzer,alias,data&#x27; \</span><br><span class="line">  --output=/esdump &gt;es_dump.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="恢复-1"><a href="#恢复-1" class="headerlink" title="恢复"></a>恢复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v `pwd`/esdump7:/esdump --rm -ti --entrypoint multielasticdump elasticdump/elasticsearch-dump \</span><br><span class="line">  --parallel=4 \</span><br><span class="line">  --direction=load \</span><br><span class="line">  --input=/esdump \</span><br><span class="line">  --includeType=&#x27;settings,mapping,analyzer,alias,data&#x27; \</span><br><span class="line">  --output=http://127.0.0.1:19200 &gt;es_load.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="es-跨版本导出恢复"><a href="#es-跨版本导出恢复" class="headerlink" title="es 跨版本导出恢复"></a>es 跨版本导出恢复</h2><blockquote><p>没有 es7 向下恢复到 es6 的需求, 请自行尝试  </p></blockquote><ul><li><p>因为 es6 和 es7 数据结构上不太一致, 所以需要先预处理数据</p><h3 id="es6-数据导出后恢复到-es7"><a href="#es6-数据导出后恢复到-es7" class="headerlink" title="es6 数据导出后恢复到 es7"></a>es6 数据导出后恢复到 es7</h3><h4 id="预处理数据"><a href="#预处理数据" class="headerlink" title="预处理数据"></a>预处理数据</h4></li><li><p>这里主要是这三个文件有问题: ‘analyzer.json’, ‘settings.json’, ‘mapping.json’</p></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * es6 -&gt; es7 数据处理脚本</span></span><br><span class="line"><span class="comment"> * nodejs v12.22.12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>),</span><br><span class="line">  path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>),</span><br><span class="line">  dir = <span class="string">&#x27;./esdump7&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// analyzer, settings</span></span><br><span class="line">fs.<span class="title function_">readdirSync</span>(dir, &#123;<span class="attr">withFileTypes</span>: <span class="literal">true</span>&#125;).<span class="title function_">filter</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="title function_">isFile</span>())</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="property">name</span>).<span class="title function_">filter</span>(<span class="function"><span class="params">_</span> =&gt;</span> [<span class="string">&#x27;analyzer.json&#x27;</span>, <span class="string">&#x27;settings.json&#x27;</span>].<span class="title function_">some</span>(<span class="function"><span class="params">__</span> =&gt;</span> _.<span class="title function_">includes</span>(__)))</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function"><span class="params">_</span> =&gt;</span> path.<span class="title function_">resolve</span>(__dirname, dir, _))</span><br><span class="line">  .<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// fs.writeFileSync(&#x27;/tmp/1.json&#x27;, JSON.stringify(JSON.stringify(JSON.parse(JSON.parse(b)))))</span></span><br><span class="line">    <span class="keyword">let</span> raw = fs.<span class="title function_">readFileSync</span>(f, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(raw))</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> json) &#123;</span><br><span class="line">      json[k].<span class="property">settings</span>.<span class="property">index</span>.<span class="property">max_ngram_diff</span> = <span class="number">50</span></span><br><span class="line">    &#125;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(f, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json)))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapping</span></span><br><span class="line">fs.<span class="title function_">readdirSync</span>(dir, &#123;<span class="attr">withFileTypes</span>: <span class="literal">true</span>&#125;).<span class="title function_">filter</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="title function_">isFile</span>())</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="property">name</span>).<span class="title function_">filter</span>(<span class="function"><span class="params">_</span> =&gt;</span> [<span class="string">&#x27;mapping.json&#x27;</span>].<span class="title function_">some</span>(<span class="function"><span class="params">__</span> =&gt;</span> _.<span class="title function_">includes</span>(__)))</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function"><span class="params">_</span> =&gt;</span> path.<span class="title function_">resolve</span>(__dirname, dir, _))</span><br><span class="line">  .<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// fs.writeFileSync(&#x27;/tmp/1.json&#x27;, JSON.stringify(JSON.stringify(JSON.parse(JSON.parse(b)))))</span></span><br><span class="line">    <span class="keyword">let</span> raw = fs.<span class="title function_">readFileSync</span>(f, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(raw)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> json) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> j <span class="keyword">in</span> json[k].<span class="property">mappings</span>) &#123;</span><br><span class="line">        json[k].<span class="property">mappings</span> = json[k].<span class="property">mappings</span>[j]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(f, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json))</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h3 id="恢复-2"><a href="#恢复-2" class="headerlink" title="恢复"></a>恢复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -v `pwd`/esdump7:/esdump --rm -ti --entrypoint multielasticdump elasticdump/elasticsearch-dump \</span><br><span class="line">  --parallel=4 \</span><br><span class="line">  --direction=load \</span><br><span class="line">  --input=/esdump \</span><br><span class="line">  --includeType=&#x27;settings,mapping,analyzer,alias,data&#x27; \</span><br><span class="line">  --output=http://127.0.0.1:19200 &gt;es_load.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> es </category>
          
          <category> backup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es </tag>
            
            <tag> data </tag>
            
            <tag> backup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark create function 逻辑</title>
      <link href="/2023/10/24/1/"/>
      <url>/2023/10/24/1/</url>
      
        <content type="html"><![CDATA[<h2 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h2><p>函数注册成功, 但是在调用的时候提示无法加载对应的类.</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul><li>spark 创建函数的时候并不会直接去加载对应的资源/类, 只有在使用时才会加载对应的资源和类, 因此创建成功并不能代表能正常使用</li><li>hive 创建函数的时候会去加载对应的类, 所以创建成功即代表可用</li></ul><h2 id="spark-sql-测试"><a href="#spark-sql-测试" class="headerlink" title="spark-sql 测试"></a>spark-sql 测试</h2><p><img src="/images/spark/function/1.png" alt="Untitled"></p><h2 id="create-temp-func-和-create-func-的区别"><a href="#create-temp-func-和-create-func-的区别" class="headerlink" title="create temp func 和 create func 的区别"></a>create temp func 和 create func 的区别</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">OR</span> REPLACE ] [ TEMPORARY ] <span class="keyword">FUNCTION</span> [ IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ]</span><br><span class="line">    function_name <span class="keyword">AS</span> class_name [ resource_locations ]</span><br></pre></td></tr></table></figure><ul><li>从语法上都是, 创建一个自定义函数, 只是前者注册的是临时函数, 只在当前 Session 有效. 后者注册的函数是永久函数, 一直生效.</li></ul><p>查看对应的代码: org.apache.spark.sql.execution.command.CreateFunctionCommand#run</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyay9ibG9iLzgwN2UwYTQ4NGQxZGU3NjdkMWYwMmJkOGE2MjJkYTY0NTBiZGY5NDAvc3FsL2NvcmUvc3JjL21haW4vc2NhbGEvb3JnL2FwYWNoZS9zcGFyay9zcWwvZXhlY3V0aW9uL2NvbW1hbmQvZnVuY3Rpb25zLnNjYWxhI0w3NS1MOTU=">https://github.com/apache/spark/blob/807e0a484d1de767d1f02bd8a622da6450bdf940/sql/core/src/main/scala/org/apache/spark/sql/execution/command/functions.scala#L75-L95<i class="fa fa-external-link-alt"></i></span></p><ul><li>从代码里面可以看到 create tmp func 是通过 loadResource 加载对应 class 后, 直接注册到当前 Session 的 functionRegistry 里面. 而 create func 是直接在 catelog 里面创建对应的函数, 并不加载资源.</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(sparkSession: <span class="type">SparkSession</span>): <span class="type">Seq</span>[<span class="type">Row</span>] = &#123;</span><br><span class="line">    <span class="keyword">val</span> catalog = sparkSession.sessionState.catalog</span><br><span class="line">    <span class="keyword">val</span> func = <span class="type">CatalogFunction</span>(<span class="type">FunctionIdentifier</span>(functionName, databaseName), className, resources)</span><br><span class="line">    <span class="keyword">if</span> (isTemp) &#123;</span><br><span class="line">      <span class="comment">// We first load resources and then put the builder in the function registry.</span></span><br><span class="line">      catalog.loadFunctionResources(resources)</span><br><span class="line">      catalog.registerFunction(func, overrideIfExists = replace)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Handles `CREATE OR REPLACE FUNCTION AS ... USING ...`</span></span><br><span class="line">      <span class="keyword">if</span> (replace &amp;&amp; catalog.functionExists(func.identifier)) &#123;</span><br><span class="line">        <span class="comment">// alter the function in the metastore</span></span><br><span class="line">        catalog.alterFunction(func)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// For a permanent, we will store the metadata into underlying external catalog.</span></span><br><span class="line">        <span class="comment">// This function will be loaded into the FunctionRegistry when a query uses it.</span></span><br><span class="line">        <span class="comment">// We do not load it into FunctionRegistry right now.</span></span><br><span class="line">        catalog.createFunction(func, ignoreIfExists)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Seq</span>.empty[<span class="type">Row</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>再结合这几个 issues 的 Conversation 和最新的 spark 代码, 我们可以知道 “创建自定义函数时加载对应类” 这个概念是没有问题的. 当类不存在的时候, 在 Hive 通过这两种方式创建函数, 都是会失败的. 之所以 Spark 兼容 create func, 是因为考虑到 多 Spark 集群/多租户 共用 Catalog, 其他的 SparkSession 可能没有权限访问所有的资源或 UDF class.</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyay9wdWxsLzI5NTAyI2lzc3VlY29tbWVudC02ODk2MTU4MDY=">https://github.com/apache/spark/pull/29502#issuecomment-689615806<i class="fa fa-external-link-alt"></i></span></p><p><img src="/images/spark/function/2.png" alt="Untitled"></p><blockquote><p>那么这两种方式创建的自定义函数在加载资源方面有什么不用呢?</p></blockquote><blockquote><p>为什么 Hive 测试都会失败呢?</p></blockquote><h2 id="loadResource-时间点"><a href="#loadResource-时间点" class="headerlink" title="loadResource 时间点"></a>loadResource 时间点</h2><ul><li>从上面已经知道, create tmp func 在创建的时候资源加载已经完成了. create func 的资源加载发生在执行的时候.</li><li>这里加载注册, 走的是统一的外部 Catalog 自定义函数加载逻辑</li><li>SQL Text → QueryPlan → ResolveFunction → HiveCatalog  → SessionCatalog → functionRegistry.lookupFunction → ExternalCataLog → LoadResource → functionRegistry.registerFunction</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyay9ibG9iLzgwN2UwYTQ4NGQxZGU3NjdkMWYwMmJkOGE2MjJkYTY0NTBiZGY5NDAvc3FsL2NhdGFseXN0L3NyYy9tYWluL3NjYWxhL29yZy9hcGFjaGUvc3Bhcmsvc3FsL2NhdGFseXN0L2NhdGFsb2cvU2Vzc2lvbkNhdGFsb2cuc2NhbGEjTDEyNzA=">https://github.com/apache/spark/blob/807e0a484d1de767d1f02bd8a622da6450bdf940/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/catalog/SessionCatalog.scala#L1270-L1310<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lookupFunction</span></span>(</span><br><span class="line">      name: <span class="type">FunctionIdentifier</span>,</span><br><span class="line">      children: <span class="type">Seq</span>[<span class="type">Expression</span>]): <span class="type">Expression</span> = synchronized &#123;</span><br><span class="line">    <span class="comment">// Note: the implementation of this function is a little bit convoluted.</span></span><br><span class="line">    <span class="comment">// We probably shouldn&#x27;t use a single FunctionRegistry to register all three kinds of functions</span></span><br><span class="line">    <span class="comment">// (built-in, temp, and external).</span></span><br><span class="line">    <span class="keyword">if</span> (name.database.isEmpty &amp;&amp; functionRegistry.functionExists(name)) &#123;</span><br><span class="line">      <span class="comment">// This function has been already loaded into the function registry.</span></span><br><span class="line">      <span class="keyword">return</span> functionRegistry.lookupFunction(name, children)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the name itself is not qualified, add the current database to it.</span></span><br><span class="line">    <span class="keyword">val</span> database = formatDatabaseName(name.database.getOrElse(getCurrentDatabase))</span><br><span class="line">    <span class="keyword">val</span> qualifiedName = name.copy(database = <span class="type">Some</span>(database))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (functionRegistry.functionExists(qualifiedName)) &#123;</span><br><span class="line">      <span class="comment">// This function has been already loaded into the function registry.</span></span><br><span class="line">      <span class="comment">// Unlike the above block, we find this function by using the qualified name.</span></span><br><span class="line">      <span class="keyword">return</span> functionRegistry.lookupFunction(qualifiedName, children)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The function has not been loaded to the function registry, which means</span></span><br><span class="line">    <span class="comment">// that the function is a permanent function (if it actually has been registered</span></span><br><span class="line">    <span class="comment">// in the metastore). We need to first put the function in the FunctionRegistry.</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> why not just check whether the function exists first?</span></span><br><span class="line">    <span class="keyword">val</span> catalogFunction = <span class="keyword">try</span> &#123;</span><br><span class="line">      externalCatalog.getFunction(database, name.funcName)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">AnalysisException</span> =&gt; failFunctionLookup(name)</span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">NoSuchPermanentFunctionException</span> =&gt; failFunctionLookup(name)</span><br><span class="line">    &#125;</span><br><span class="line">    loadFunctionResources(catalogFunction.resources)</span><br><span class="line">    <span class="comment">// Please note that qualifiedName is provided by the user. However,</span></span><br><span class="line">    <span class="comment">// catalogFunction.identifier.unquotedString is returned by the underlying</span></span><br><span class="line">    <span class="comment">// catalog. So, it is possible that qualifiedName is not exactly the same as</span></span><br><span class="line">    <span class="comment">// catalogFunction.identifier.unquotedString (difference is on case-sensitivity).</span></span><br><span class="line">    <span class="comment">// At here, we preserve the input from the user.</span></span><br><span class="line">    registerFunction(catalogFunction.copy(identifier = qualifiedName), overrideIfExists = <span class="literal">false</span>)</span><br><span class="line">    <span class="comment">// Now, we need to create the Expression.</span></span><br><span class="line">    functionRegistry.lookupFunction(qualifiedName, children)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="hive-create-func-逻辑"><a href="#hive-create-func-逻辑" class="headerlink" title="hive create func 逻辑"></a>hive create func 逻辑</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> [db_name.]function_name <span class="keyword">AS</span> class_name</span><br><span class="line">  [<span class="keyword">USING</span> JAR<span class="operator">|</span>FILE<span class="operator">|</span>ARCHIVE <span class="string">&#x27;file_uri&#x27;</span> [, JAR<span class="operator">|</span>FILE<span class="operator">|</span>ARCHIVE <span class="string">&#x27;file_uri&#x27;</span>] ];</span><br></pre></td></tr></table></figure><ul><li>流程: SQL 解析(AST) → FunctionTask → FunctionRegistry → Registry.createPermanentFunction → Registry.registerToSessionRegistry → FunctionTask.addFunctionResources → SessionState.getRegistryForWrite().registerFunction</li></ul><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyAddUDF实现了简单的加法</span></span><br><span class="line">create function testadd as <span class="string">&#x27;com.test.udf.MyAddUDF&#x27;</span></span><br><span class="line">using</span><br><span class="line">jar <span class="string">&#x27;hdfs://localhost:9000/udf/MyTestUDF-1.0.jar&#x27;</span>, </span><br><span class="line">jar <span class="string">&#x27;hdfs://localhost:9000/udf/UDFDep-1.0.jar&#x27;</span>;           <span class="comment">// MyTestUDF的依赖</span></span><br></pre></td></tr></table></figure><h3 id="SQL-解析-AST"><a href="#SQL-解析-AST" class="headerlink" title="SQL 解析(AST)"></a>SQL 解析(AST)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TOK_CREATEFUNCTION</span><br><span class="line">   testadd</span><br><span class="line">   <span class="string">&#x27;com.test.udf.MyAddUDF&#x27;</span></span><br><span class="line">   TOK_RESOURCE_LIST</span><br><span class="line">      TOK_RESOURCE_URI</span><br><span class="line">         TOK_JAR</span><br><span class="line">         <span class="string">&#x27;hdfs://localhost:9000/udf/MyTestUDF-1.0.jar&#x27;</span></span><br><span class="line">      TOK_RESOURCE_URI</span><br><span class="line">         TOK_JAR</span><br><span class="line">         <span class="string">&#x27;hdfs://localhost:9000/udf/UDFDep-1.0.jar&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="FunctionRegistry"><a href="#FunctionRegistry" class="headerlink" title="FunctionRegistry"></a>FunctionRegistry</h3><p>这里注意checkLocalFunctionResources：当metastore是local模式时，resource uri才可以使用本地文件系统，否则只能使用如hdfs等文件系统。接下来是两个重要的步骤：</p><ol><li>注册UDF：FunctionRegistry.registerPermanentFunction。这里有两个关键点：</li><li>将根据resource URL将jar包UDF下载到本地，并将本地jar包URL加入当前Session的UDFClassLoader的classpath；</li><li>FunctionRegistry的静态常量Registry system里注册UDF信息。</li><li>UDF信息写入metastore</li></ol><p>FunctionRegistry调用Registry system的registerPermanentFunction函数，Registry system是静态常量，里面保存了所有UDF的信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from FunctionRegistry</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> FunctionInfo <span class="title function_">registerPermanentFunction</span><span class="params">(String functionName,</span></span><br><span class="line"><span class="params">      String className, <span class="type">boolean</span> registerToSession, FunctionResource[] resources)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> system.registerPermanentFunction(functionName, className, registerToSession, resources);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h3><p>Registry的registerPermanentFunction函数首先执行会registerToSessionRegistry。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from Registry  </span></span><br><span class="line">  <span class="keyword">public</span> FunctionInfo <span class="title function_">registerPermanentFunction</span><span class="params">(String functionName,</span></span><br><span class="line"><span class="params">      String className, <span class="type">boolean</span> registerToSession, FunctionResource... resources)</span> &#123;</span><br><span class="line">    <span class="type">FunctionInfo</span> <span class="variable">function</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FunctionInfo</span>(functionName, className, resources);</span><br><span class="line">    <span class="comment">// register to session first for backward compatibility</span></span><br><span class="line">    <span class="keyword">if</span> (registerToSession) &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">qualifiedName</span> <span class="operator">=</span> FunctionUtils.qualifyFunctionName(</span><br><span class="line">          functionName, SessionState.get().getCurrentDatabase().toLowerCase());</span><br><span class="line">      <span class="keyword">if</span> (registerToSessionRegistry(qualifiedName, function) != <span class="literal">null</span>) &#123;</span><br><span class="line">        addFunction(functionName, function);</span><br><span class="line">        <span class="keyword">return</span> function;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        addFunction(functionName, function);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>registerToSessionRegistry有两个主要功能：</p><ol><li>执行FunctionTask.addFunctionResources(resources)，作用是下载resources所指的jar包到本地目录，同时将本地的jar包路径的classpath加入ClassLoader中。</li><li>addFunctionResources主要调用SessionState的add_resources</li><li>执行SessionState.getRegistryForWrite().registerFunction，作用是将UDF信息加入当前Session的Registry system（注意区别FunctionRegistry的Registry system）。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from Registry  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// should be called after session registry is checked</span></span><br><span class="line"><span class="keyword">private</span> FunctionInfo <span class="title function_">registerToSessionRegistry</span><span class="params">(String qualifiedName, FunctionInfo function)</span> &#123;</span><br><span class="line">  <span class="type">FunctionInfo</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// 或许当前Session的ClassLoader</span></span><br><span class="line">  <span class="type">ClassLoader</span> <span class="variable">prev</span> <span class="operator">=</span> Utilities.getSessionSpecifiedClassLoader();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Found UDF in metastore - now add it to the function registry</span></span><br><span class="line">    <span class="comment">// At this point we should add any relevant jars that would be needed for the UDf.</span></span><br><span class="line">    FunctionResource[] resources = function.getResources();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      FunctionTask.addFunctionResources(resources);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      LOG.error(<span class="string">&quot;Unable to load resources for &quot;</span> + qualifiedName + <span class="string">&quot;:&quot;</span> + e, e);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> Utilities.getSessionSpecifiedClassLoader();</span><br><span class="line">    Class&lt;?&gt; udfClass = Class.forName(function.getClassName(), <span class="literal">true</span>, loader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make sure the FunctionInfo is listed as PERSISTENT (rather than TEMPORARY)</span></span><br><span class="line">    <span class="comment">// when it is registered to the system registry.</span></span><br><span class="line">    ret = SessionState.getRegistryForWrite().registerFunction(</span><br><span class="line">        qualifiedName, FunctionType.PERSISTENT, udfClass, resources);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="literal">null</span>) &#123;</span><br><span class="line">      LOG.error(function.getClassName() + <span class="string">&quot; is not a valid UDF class and was not registered.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (SessionState.get().isHiveServerQuery()) &#123;</span><br><span class="line">      SessionState.getRegistryForWrite().addToUDFLoaders(loader);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    <span class="comment">// Lookup of UDf class failed</span></span><br><span class="line">    LOG.error(<span class="string">&quot;Unable to load UDF class: &quot;</span> + e);</span><br><span class="line">    Utilities.restoreSessionSpecifiedClassLoader(prev);</span><br><span class="line">  &#125;</span><br><span class="line">  function.shareStateWith(ret);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SessionState"><a href="#SessionState" class="headerlink" title="SessionState"></a>SessionState</h3><p>SessionState的add_resources两个要点：</p><ol><li>resolveAndDownload下载UDF jar包到本地，目录由hive.downloaded.resources.dir指定，默认是/tmp/${session_id}_resources。</li><li>将本地UDFjar包路径加入ClassLoader的classpath，这一点比较隐蔽，是调用t.preHook函数实现。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From SessionState</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">add_resources</span><span class="params">(ResourceType t, Collection&lt;String&gt; values)</span></span><br><span class="line">    <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">  <span class="comment">// By default don&#x27;t convert to unix</span></span><br><span class="line">  <span class="keyword">return</span> add_resources(t, values, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">add_resources</span><span class="params">(ResourceType t, Collection&lt;String&gt; values, <span class="type">boolean</span> convertToUnix)</span></span><br><span class="line">    <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">  Set&lt;String&gt; resourceSet = resourceMaps.getResourceSet(t);</span><br><span class="line">  Map&lt;String, Set&lt;String&gt;&gt; resourcePathMap = resourceMaps.getResourcePathMap(t);</span><br><span class="line">  Map&lt;String, Set&lt;String&gt;&gt; reverseResourcePathMap = resourceMaps.getReverseResourcePathMap(t);</span><br><span class="line">  List&lt;String&gt; localized = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">      String key;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//get the local path of downloaded jars. 下载jar包</span></span><br><span class="line">      List&lt;URI&gt; downloadedURLs = resolveAndDownload(value, convertToUnix);</span><br><span class="line">....</span><br><span class="line">      Set&lt;String&gt; downloadedValues = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (URI uri : downloadedURLs) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">resourceValue</span> <span class="operator">=</span> uri.toString();</span><br><span class="line">...</span><br><span class="line">      &#125;</span><br><span class="line">      resourcePathMap.put(key, downloadedValues);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">// !!!这里很重要，通过调用这个preHook将UDF jar包本地路径加入ClassLoader。</span></span><br><span class="line">    t.preHook(resourceSet, localized);</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyay9wdWxsLzI5NTAy">https://github.com/apache/spark/pull/29502<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyay9wdWxsLzI5NzEz">https://github.com/apache/spark/pull/29713<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwYWNoZS9zcGFyaw==">https://github.com/apache/spark<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80MDUxODkxNTQ=">https://zhuanlan.zhihu.com/p/405189154<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9jd2lraS5hcGFjaGUub3JnL2NvbmZsdWVuY2UvZGlzcGxheS9IaXZlL0xhbmd1YWdlTWFudWFsK0RETCNMYW5ndWFnZU1hbnVhbERETC1DcmVhdGUvRHJvcC9SZWxvYWRGdW5jdGlvbg==">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-Create/Drop/ReloadFunction<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> spark </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hdfs 实时 Decommissioned 节点</title>
      <link href="/2023/09/09/1/"/>
      <url>/2023/09/09/1/</url>
      
        <content type="html"><![CDATA[<h2 id="前置工作"><a href="#前置工作" class="headerlink" title="前置工作"></a>前置工作</h2><ul><li>在<code>hfds-site.xml</code> 中确保 <code>dfs.hosts</code>, <code>dfs.hosts.exclude</code> 都存在.<ul><li>假设为 <code>/tmp/includes</code> ,<code>/tmp/excludes</code></li></ul></li></ul><blockquote><p>上下线节点只需要修改 Namenode 的 <code>/tmp/includes</code> ,<code>/tmp/excludes</code> 文件, 也可以同步修改所有NN, DN节点</p></blockquote><h2 id="下线节点"><a href="#下线节点" class="headerlink" title="下线节点"></a>下线节点</h2><ul><li>假设要移除的节点为 dn1, dn1 需要同时存在于 <code>/tmp/includes</code> ,<code>/tmp/excludes</code></li><li>执行 <code>hdfs dfsadmin -refreshNodes</code> 即可不重启 hdfs, 将 DN节点下线</li><li>检查 hdfs web ui, 即可看到节点变为 <code>Decomission</code> 或者 <code>Decomissioning</code> 状态</li></ul><h2 id="重新上线节点"><a href="#重新上线节点" class="headerlink" title="重新上线节点"></a>重新上线节点</h2><ul><li>将 dn1 从 <code>/tmp/excludes</code> 中移除</li><li>执行 <code>hdfs dfsadmin -refreshNodes</code> 即可不重启 hdfs, 将 DN节点上线</li><li>检查 hdfs web ui, 即可看到节点变为 <code>In Service</code> 状态</li></ul>]]></content>
      
      
      <categories>
          
          <category> hdfs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hadoop </tag>
            
            <tag> hdfs </tag>
            
            <tag> Decommissioned </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>黑苹果 AMD GPU 功耗一直很高</title>
      <link href="/2023/08/31/1/"/>
      <url>/2023/08/31/1/</url>
      
        <content type="html"><![CDATA[<ul><li>通过注入 DeviceProperties 实现</li></ul><h2 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h2><ul><li>不需要 Whatevergreen</li><li>而且当机型为 <code>iMacPro1,1</code> 或 <code>MacPro7,1</code> 时, <code>DRM</code> 也可以正常工作</li><li>备份现有 OC 配置文件</li></ul><h2 id="查找-PCIe-路径"><a href="#查找-PCIe-路径" class="headerlink" title="查找 PCIe 路径"></a>查找 PCIe 路径</h2><ol><li>打开 Hackintool</li><li>点击 PCIe 页</li><li>找到显卡对应的 PCIe 路径, 复制(也可以直接在 OCC 里面手动选择对应的路径)</li></ol><h2 id="编辑-plist"><a href="#编辑-plist" class="headerlink" title="编辑 plist"></a>编辑 plist</h2><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9kb3J0YW5pYS5naXRodWIuaW8vR1BVLUJ1eWVycy1HdWlkZS9tb2Rlcm4tZ3B1cy9hbWQtZ3B1Lmh0bWwjbmF0aXZlLWFtZC1ncHVz">Navi 架构的卡<i class="fa fa-external-link-alt"></i></span>还需要添加 <code>SSDT-NAVI.aml</code> 到 <code>EFI/OC/ACPI</code> 和 plist 中  </p></blockquote><blockquote><p>修改 model 的值, 可以给显卡改名称  </p></blockquote><ul><li>禁用 <code>Whatevergreen.kext</code></li><li>删除 boot-arg <code>agdpmod=pikera</code></li><li>DeviceProperties -&gt; 显卡 PCIe 路径 -&gt; 添加 -&gt; <code>@0,name</code> 字符类型</li><li>因为我这个是 RX580 2048sp 刷的 RX570, 所以直接填 <code>ATY,Orinoco</code> 即可</li></ul><table><thead><tr><th align="center">显卡型号</th><th align="center">@0,name</th></tr></thead><tbody><tr><td align="center">RX6900</td><td align="center"><code>ATY,Carswell</code></td></tr><tr><td align="center">RX6800</td><td align="center"><code>ATY,Belknap</code></td></tr><tr><td align="center">RX6600/XT</td><td align="center"><code>ATY,Henbury</code></td></tr><tr><td align="center">Radeon 7</td><td align="center"><code>ATY,Donguil</code></td></tr><tr><td align="center">RX5700</td><td align="center"><code>ATY,Adder</code></td></tr><tr><td align="center">RX5500</td><td align="center"><code>ATY,Python</code></td></tr><tr><td align="center">RX570/580</td><td align="center"><code>ATY,Orinoco</code></td></tr></tbody></table><p><img src="/images/macos/bmac/watt/name.png" alt="IMG"></p><p><img src="/images/macos/bmac/watt/watt.png" alt="IMG"></p><ul><li>可以看到效果还是很明显的, 前面待机在 20~40w 跳动, 使用的时候才会上到 80w 左右</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zYW5lbHltYWMuY29tL2ZvcnVtL3RvcGljLzM1MTk2OS1wcmUtcmVsZWFzZS1tYWNvcy12ZW50dXJhL3BhZ2UvMzcvI2NvbW1lbnQtMjc4NjEyMg==">https://www.insanelymac.com/forum/topic/351969-pre-release-macos-ventura/page/37/#comment-2786122<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzVUMzNaMC9PQy1MaXR0bGUtVHJhbnNsYXRlZC90cmVlL21haW4vMTFfR3JhcGhpY3MvR1BVL0FNRF9SYWRlb25fVHdlYWtzI21ldGhvZC0yYS1zZWxlY3Rpbmctc3BlY2lmaWMtYW1kLWZyYW1lYnVmZmVycy12aWEtZGV2aWNlcHJvcGVydGllcw==">https://github.com/5T33Z0/OC-Little-Translated/tree/main/11_Graphics/GPU/AMD_Radeon_Tweaks#method-2a-selecting-specific-amd-framebuffers-via-deviceproperties<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> amd </category>
          
          <category> bmac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> amd </tag>
            
            <tag> bmac </tag>
            
            <tag> hackintosh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>蓝宝石 RX580 2048sp 刷 vbios 降级 RX570 记录</title>
      <link href="/2023/08/15/1/"/>
      <url>/2023/08/15/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>刷机有风险, 后果自行承担</p></blockquote><ul><li>因为这个卡黑苹果支持有问题, 所以需要降级为 RX570, 才能正常黑苹果. 要不然显存只有几兆或者十几兆</li><li>之所以选择刷 RX570 的 vBios, 是因为 RX580 2048sp 是 RX570 的马甲</li></ul><p><img src="/images/macos/bmac/rx580/Untitled.png" alt="Untitled"></p><h2 id="检查当前型号和显存编号"><a href="#检查当前型号和显存编号" class="headerlink" title="检查当前型号和显存编号"></a>检查当前型号和显存编号</h2><p><img src="/images/macos/bmac/rx580/GPUZ.gif" alt="GPUZ.gif"></p><p><img src="/images/macos/bmac/rx580/%E6%98%BE%E5%AD%98.gif" alt="显存.gif"></p><h2 id="备份-vBios"><a href="#备份-vBios" class="headerlink" title="备份 vBios"></a>备份 vBios</h2><ul><li>点击 BIOS Version 旁边的 箭头即可导出</li></ul><h2 id="查找-vBios"><a href="#查找-vBios" class="headerlink" title="查找 vBios"></a>查找 vBios</h2><ul><li>打开 Google，为了方便，直接输入以下信息检索</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“RX <span class="number">570</span>” “Sapphire” K4G80325FC +site:techpowerup.com</span><br></pre></td></tr></table></figure><p><img src="/images/macos/bmac/rx580/Untitled%201.png" alt="Untitled"></p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cudGVjaHBvd2VydXAuY29tL3ZnYWJpb3MvMjM1MDQ4L3NhcHBoaXJlLXJ4NTcwLTgxOTItMTkxMDMx">https://www.techpowerup.com/vgabios/235048/sapphire-rx570-8192-191031<i class="fa fa-external-link-alt"></i></span></p></blockquote><ul><li>寻找适合自己的 vBIOS，查看 vBIOS 的信息，确保显存大小和显存颗粒跟你显卡的信息一致</li><li>Limits 部分主要涉及功耗相关(OC 超频)的, 不用太过关注.</li></ul><h2 id="下载刷写工具"><a href="#下载刷写工具" class="headerlink" title="下载刷写工具"></a>下载刷写工具</h2><blockquote><p><a href="#%E5%88%B7%E9%BB%91%E5%8F%98%E7%A0%96%E8%BF%98%E5%8E%9F%E6%81%A2%E5%A4%8D">工具下载</a>  </p></blockquote><ul><li>打开 TECHPOWERUP 的 AMDVBFlash <span class="exturl" data-url="aHR0cHM6Ly93d3cudGVjaHBvd2VydXAuY29tL2Rvd25sb2FkL2F0aS1hdGlmbGFzaC8=">下载界面<i class="fa fa-external-link-alt"></i></span></li><li>检查需要的版本, 点击 <code>Show older versions</code> 即可下载历史版本</li></ul><h2 id="刷入-vbios"><a href="#刷入-vbios" class="headerlink" title="刷入 vbios"></a>刷入 vbios</h2><blockquote><p>下载低版本工具</p></blockquote><ul><li>这里可能会提示版本 <code>P/N not match</code>, 换低版本的工具即可, 测试 3.05 版本可用.</li></ul><ol><li>工具和要刷入的 rom 放到 <code>C:/amdvflash</code> (路径纯英文字符, 不含空格,标点 不会触发其他的问题</li><li>打开且只能打开 <code>CMD</code>, 管理员身份</li><li>双击 <code>AMDVFlashDriverInstaller.exe</code></li><li>输入 <code>I</code>, 安装 driver</li><li>解锁 rom: <code>amdvbflash.exe -unlockrom 0</code></li><li>刷入 rom: <code>amdvbflash -f -p 0 XXXX.rom</code></li></ol><blockquote><p>#XXXX替换成你要刷入的 rom 名称，比如 amdvbflash -f -p 0 RX570.rom</p></blockquote><ol><li>如果显示 <code>Restart System To Complete VBIOS Update</code> 就表示完成了</li><li>双击 <code>AMDVFlashDriverInstaller.exe</code>, 输入 <code>U</code>, 卸载 driver</li><li>重启电脑安装驱动，就能在 GPU-Z 里看到新的显卡型号了</li></ol><p><img src="/images/macos/bmac/rx580/unlock.png" alt="unlock.png"></p><p><img src="/images/macos/bmac/rx580/flash.png" alt="flash.png"></p><h2 id="刷黑变砖还原恢复"><a href="#刷黑变砖还原恢复" class="headerlink" title="刷黑变砖还原恢复"></a>刷黑变砖还原恢复</h2><p>最后附上低版本 AMDVFlash 工具和蓝宝石官方 RX580 2048SP ROM，给忘记备份又刷黑的朋友留个后悔药，以及跟我同型号的 RX 570 ROM，省去你检索踩坑的时间</p><ul><li><a href="/images/macos/bmac/rx580/amdvbflash_windows_3.04.zip">amdvbflash_windows_3.04.zip</a></li><li><a href="/images/macos/bmac/rx580/bios.rom">原版 ROM</a></li><li><a href="/images/macos/bmac/rx580/Sapphire.RX570.8192.191031.rom">Sapphire.RX570.8192.191031.rom</a></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cubXNwYWNlLmNjL2FyY2hpdmVzLzc1NQ==">https://www.mspace.cc/archives/755<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> bmac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> amd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka 配置基于 Kerberos 的 ACL 访问控制鉴权</title>
      <link href="/2023/08/01/1/"/>
      <url>/2023/08/01/1/</url>
      
        <content type="html"><![CDATA[<ul><li>由于acl信息存储在zookeeper中，所以在没有启用zookeeper权限体系的情况下，任何用户理论上都可以执行 kafka-acls.sh</li></ul><h2 id="服务端启用-ACL"><a href="#服务端启用-ACL" class="headerlink" title="服务端启用 ACL"></a>服务端启用 ACL</h2><h3 id="添加配置到-config-server-properties"><a href="#添加配置到-config-server-properties" class="headerlink" title="添加配置到 config/server.properties"></a>添加配置到 config/server.properties</h3><ul><li>因为之前创建用户的 kafka kerberos 认证的 principal 为 <code>kafka/ubuntu@EXAMPLE.COM</code>, 所以这里 User 部分直接取 kafka 即可. 配置成集群的 superuser, superuser不受 ACL 限制.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许自动创建 Topic</span></span><br><span class="line"><span class="comment"># auto.create.topics.enable=true</span></span><br><span class="line"><span class="comment">#acl相关，配置后才能启用acl</span></span><br><span class="line">authorizer.class.name=kafka.security.auth.SimpleAclAuthorizer</span><br><span class="line"><span class="comment"># 配置 superuser 为 kafka</span></span><br><span class="line">super.users=User:kafka</span><br><span class="line"><span class="comment"># 设置为true，ACL机制为黑名单机制，只有黑名单中的用户无法访问</span></span><br><span class="line"><span class="comment"># 默认为false，ACL机制为白名单机制，只有白名单中的用户可以访问</span></span><br><span class="line">allow.everyone.if.no.acl.found=<span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="检查已授权信息"><a href="#检查已授权信息" class="headerlink" title="检查已授权信息"></a>检查已授权信息</h2><ul><li>无返回即为无授权信息, 否则会显示所有 ACLs</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-acls.sh --authorizer-properties zookeeper.connect=localhost:2181 --list</span><br></pre></td></tr></table></figure><h2 id="添加-kerberos-用户"><a href="#添加-kerberos-用户" class="headerlink" title="添加 kerberos 用户"></a>添加 kerberos 用户</h2><ol><li>登陆 docker</li><li>添加 principal</li><li>创建 keytab 授权文件</li><li>验证授权是否成功</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it krb5 sh</span><br><span class="line">kadmin.local -q <span class="string">&#x27;addprinc -randkey acl/acl@EXAMPLE.COM&#x27;</span></span><br><span class="line">kadmin.local -q <span class="string">&quot;ktadd -k /etc/security/keytabs/acl_acl.keytab acl/acl@EXAMPLE.COM&quot;</span></span><br><span class="line">kinit -V -kt /home/ubuntu/docker-krb5-server/keytabs/acl.keytab  acl/acl@EXAMPLE.COM</span><br></pre></td></tr></table></figure><h2 id="创建客户端-jass-文件"><a href="#创建客户端-jass-文件" class="headerlink" title="创建客户端 jass 文件"></a>创建客户端 jass 文件</h2><ul><li><code>vim config/kafka_acl_jass.conf</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">KafkaClient &#123;</span><br><span class="line">    com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">    useTicketCache=<span class="literal">true</span></span><br><span class="line">    serviceName=kafka</span><br><span class="line">    useKeyTab=<span class="literal">true</span></span><br><span class="line">    storeKey=<span class="literal">true</span></span><br><span class="line">    keyTab=<span class="string">&quot;/home/ubuntu/docker-krb5-server/keytabs/acl_acl.keytab&quot;</span></span><br><span class="line">    principal=<span class="string">&quot;acl/acl@EXAMPLE.COM&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><ul><li>需指定 KAFKA_HOME, krb5.conf, jaas.conf 等配置的绝对路径</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KAFKA_HOME=/home/ubuntu/kafka</span><br><span class="line"><span class="built_in">export</span> KAFKA_OPTS=<span class="string">&quot; -Dzookeeper.sasl.client=false -Dsun.security.krb5.debug=true -Djava.security.krb5.conf=/home/ubuntu/kafka/config/krb5.conf -Djava.security.auth.login.config=/home/ubuntu/kafka/config/kafka_acl_jass.conf &quot;</span></span><br></pre></td></tr></table></figure><h2 id="授权-Topic及消费组-读权限"><a href="#授权-Topic及消费组-读权限" class="headerlink" title="授权 Topic及消费组 读权限"></a>授权 Topic及消费组 读权限</h2><ul><li>未授权之前, 除了 superuers  正常读写集群. 其他用户默认拒绝.</li></ul><blockquote><p>因为 kafka 鉴权是按消费组进行的, 所以授权之前需要明确 Consumer 的 group.id</p></blockquote><blockquote><p>以 config/comsumer.properties 里面的 test-consumer-group 为例</p></blockquote><ul><li>给 acl/<span class="exturl" data-url="bWFpbHRvOiYjeDYxOyYjeDYzOyYjeDZjOyYjNjQ7JiN4NDU7JiN4NTg7JiM2NTsmIzc3OyYjODA7JiM3NjsmI3g0NTsmIzQ2OyYjNjc7JiN4NGY7JiM3Nzs=">&#x61;&#x63;&#x6c;&#64;&#x45;&#x58;&#65;&#77;&#80;&#76;&#x45;&#46;&#67;&#x4f;&#77;<i class="fa fa-external-link-alt"></i></span> 用户, 授予对 Topic: <code>test_acl</code> 和消费组: <code>test-consumer-group</code> 的读权限</li></ul><blockquote><p>这里 acl/<span class="exturl" data-url="bWFpbHRvOiYjeDYxOyYjeDYzOyYjeDZjOyYjeDQwOyYjNjk7JiM4ODsmI3g0MTsmIzc3OyYjODA7JiN4NGM7JiM2OTsmI3gyZTsmI3g0MzsmI3g0ZjsmIzc3Ow==">&#x61;&#x63;&#x6c;&#x40;&#69;&#88;&#x41;&#77;&#80;&#x4c;&#69;&#x2e;&#x43;&#x4f;&#77;<i class="fa fa-external-link-alt"></i></span> 的 acl 可以简单理解成用户组之类的, 授权之后 acl/<span class="exturl" data-url="bWFpbHRvOiYjeDYxOyYjOTk7JiMxMDg7JiM5NTsmI3g2MTsmIzk5OyYjeDZjOyYjeDQwOyYjeDQ1OyYjeDU4OyYjeDQxOyYjNzc7JiM4MDsmI3g0YzsmIzY5OyYjeDJlOyYjeDQzOyYjNzk7JiN4NGQ7">&#x61;&#99;&#108;&#95;&#x61;&#99;&#x6c;&#x40;&#x45;&#x58;&#x41;&#77;&#80;&#x4c;&#69;&#x2e;&#x43;&#79;&#x4d;<i class="fa fa-external-link-alt"></i></span> 这个 principal 也享有同等权限. 所以如果想错开授权的话, 开头这个 acl 必须修改.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-acls.sh --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=localhost:2181 --add --allow-principal User:acl --operation Read --topic test_acl --group test-consumer-group</span><br><span class="line"><span class="comment"># 移除读权限 --add 改成 --remove 即可</span></span><br><span class="line"><span class="comment"># kafka-acls.sh --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=localhost:2181 --remove --allow-principal User:acl --operation Read --topic test_acl --group test-consumer-group</span></span><br></pre></td></tr></table></figure><h2 id="手动消费验证"><a href="#手动消费验证" class="headerlink" title="手动消费验证"></a>手动消费验证</h2><blockquote><p>至少需要两个 broker, 一个的话,大概率不能正常消费.</p></blockquote><blockquote><p>消费不到数据的时候, 先验证 kafka 是否配置完整, 所有节点是否都已启动</p></blockquote><blockquote><p>任何一步提示需要密码之类的报错, 大概率都是因为 kerberos 认证配置的问题, 如 jass 文件, 环境变量, 消费时未指定 comsumer.properties 等. <del>文件太多了很容易就忘记改了, 从而导致鉴权失败.</del></p></blockquote><p>日志: <code>$KAFKA_HOME/logs/server.log</code></p><h3 id="producer-properties"><a href="#producer-properties" class="headerlink" title="producer.properties"></a>producer.properties</h3><ul><li><code>export KAFKA_HOME KAFKA_OPTS</code> 配置, 追加以下内容到  config/producer.properties</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=GSSAPI</span><br><span class="line"><span class="comment"># service.name 同上</span></span><br><span class="line">sasl.kerberos.service.name=kafka</span><br></pre></td></tr></table></figure><ul><li>因为这里还未授权写权限所以会报错: <code>TopicAuthorizationException: Not authorized to access topics: [test_acl]</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-console-producer.sh --broker-list localhost:19092,localhost:19093 --producer.config config/producer.properties  --topic test_acl</span><br></pre></td></tr></table></figure><h3 id="consumer-properties"><a href="#consumer-properties" class="headerlink" title="consumer.properties"></a>consumer.properties</h3><ul><li><code>export KAFKA_HOME KAFKA_OPTS</code> 配置, 追加以下内容到  config/consumer.properties</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">group.id=test-consumer-group</span><br><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=GSSAPI</span><br><span class="line"><span class="comment"># service.name 同上</span></span><br><span class="line">sasl.kerberos.service.name=kafka</span><br></pre></td></tr></table></figure><ul><li>如果没有权限的话, Comsumer 会直接退出.</li><li>这里已经授权了读权限, 所以会正常进入监听模式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-console-consumer.sh --bootstrap-server localhost:19092,localhost:19093 --from-beginning --consumer.config config/consumer.properties --topic test_acl</span><br></pre></td></tr></table></figure><h2 id="授权-Topic-写权限"><a href="#授权-Topic-写权限" class="headerlink" title="授权 Topic 写权限"></a>授权 Topic 写权限</h2><ul><li>因为写入没有组的概念, 所以不需要对组进行授权.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/kafka-acls.sh --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=localhost:2181 --add --allow-principal User:acl --operation Write --topic test_acl</span><br><span class="line"><span class="comment"># 移除写权限</span></span><br><span class="line"><span class="comment"># kafka-acls.sh --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=localhost:2181 --remove --allow-principal User:acl --operation Write --topic test_acl</span></span><br></pre></td></tr></table></figure><h2 id="手动消费验证-1"><a href="#手动消费验证-1" class="headerlink" title="手动消费验证"></a>手动消费验证</h2><ul><li>在做一遍<a href="#%E6%89%8B%E5%8A%A8%E6%B6%88%E8%B4%B9%E9%AA%8C%E8%AF%81">之前的消费验证</a>, 这里可以看到 数据可以正常写入和消费.</li></ul><h2 id="启用授权后想无需授权访问-Topic"><a href="#启用授权后想无需授权访问-Topic" class="headerlink" title="启用授权后想无需授权访问 Topic?"></a>启用授权后想无需授权访问 Topic?</h2><ul><li>不能</li></ul>]]></content>
      
      
      <categories>
          
          <category> kafka </category>
          
          <category> Kerberos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
            <tag> Kerberos </tag>
            
            <tag> kdc </tag>
            
            <tag> ACL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka 集成 Kerberos 认证</title>
      <link href="/2023/07/15/1/"/>
      <url>/2023/07/15/1/</url>
      
        <content type="html"><![CDATA[<h2 id="Kerberos-搭建"><a href="#Kerberos-搭建" class="headerlink" title="Kerberos 搭建"></a>Kerberos 搭建</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNvbmZsdWVudC5pby9wbGF0Zm9ybS9jdXJyZW50L2thZmthL2F1dGhlbnRpY2F0aW9uX3Nhc2wvYXV0aGVudGljYXRpb25fc2FzbF9nc3NhcGkuaHRtbCNqYWFz">Configuring GSSAPI | Confluent Documentation<i class="fa fa-external-link-alt"></i></span></p><h3 id="创建-KDC"><a href="#创建-KDC" class="headerlink" title="创建 KDC"></a>创建 KDC</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2djYXZhbGNhbnRlODgwOC9kb2NrZXIta3JiNS1zZXJ2ZXIuZ2l0">https://github.com/gcavalcante8808/docker-krb5-server.git<i class="fa fa-external-link-alt"></i></span></p><ol><li><code>mkdir kdc &amp;&amp; cd kdc</code></li><li><code>vim docker-compose.yml</code></li><li>填入以下内容</li><li><code>docker-compose up -d</code></li></ol><ul><li>容器里面使用了 supervisor, 占用了 9001 端口, 可能会和 minio 产生冲突  推荐修改 supervisor 配置文件的端口. 共两处  docker cp krb5:/etc/supr*.conf .</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">kdc:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gcavalcante8808/krb5-server</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">krb5</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="comment"># 避免 hostname 解析, hosts 映射问题</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="comment"># networks:</span></span><br><span class="line">    <span class="comment">#   - kafka-kerbose</span></span><br><span class="line">    <span class="comment"># ports:</span></span><br><span class="line">    <span class="comment">#  - &quot;88:88&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;464:464&quot;</span></span><br><span class="line">    <span class="comment">#  - &quot;749:749&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KRB5_REALM:</span> <span class="string">EXAMPLE.COM</span></span><br><span class="line">      <span class="attr">KRB5_KDC:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./data:/var/lib/krb5kdc</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./keytabs:/etc/security/keytabs</span></span><br></pre></td></tr></table></figure><h3 id="添加-principal"><a href="#添加-principal" class="headerlink" title="添加 principal"></a>添加 principal</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kadmin.local -q <span class="string">&#x27;addprinc -randkey kafka/ubuntu@EXAMPLE.COM&#x27;</span></span><br><span class="line">kadmin.local -q <span class="string">&quot;ktadd -k /etc/security/keytabs/kafka.keytab kafka/ubuntu@EXAMPLE.COM&quot;</span></span><br></pre></td></tr></table></figure><h3 id="宿主机添加-krb5-conf"><a href="#宿主机添加-krb5-conf" class="headerlink" title="宿主机添加 krb5.conf"></a>宿主机添加 krb5.conf</h3><ul><li><code>yum install krb5-workstation</code></li><li><code>vim /etc/krb5.conf</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configuration snippets may be placed in this directory as well</span></span><br><span class="line"><span class="string">includedir</span> <span class="string">/etc/krb5.conf.d/</span></span><br><span class="line"></span><br><span class="line">[<span class="string">logging</span>]</span><br><span class="line"> <span class="string">default</span> <span class="string">=</span> <span class="string">FILE:/var/log/krb5libs.log</span></span><br><span class="line"> <span class="string">kdc</span> <span class="string">=</span> <span class="string">FILE:/var/log/krb5kdc.log</span></span><br><span class="line"> <span class="string">admin_server</span> <span class="string">=</span> <span class="string">FILE:/var/log/kadmind.log</span></span><br><span class="line"></span><br><span class="line">[<span class="string">libdefaults</span>]</span><br><span class="line"> <span class="string">dns_lookup_realm</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"> <span class="string">ticket_lifetime</span> <span class="string">=</span> <span class="string">24h</span></span><br><span class="line"> <span class="string">renew_lifetime</span> <span class="string">=</span> <span class="string">7d</span></span><br><span class="line"> <span class="string">forwardable</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"> <span class="string">rdns</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"> <span class="string">pkinit_anchors</span> <span class="string">=</span> <span class="string">FILE:/etc/pki/tls/certs/ca-bundle.crt</span></span><br><span class="line"> <span class="string">default_realm</span> <span class="string">=</span> <span class="string">EXAMPLE.COM</span></span><br><span class="line"> <span class="string">default_ccache_name</span> <span class="string">=</span> <span class="string">KEYRING:persistent:%&#123;uid&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主要修改 kdc, admin_server 地址</span></span><br><span class="line">[<span class="string">realms</span>]</span><br><span class="line">  <span class="string">EXAMPLE.COM</span> <span class="string">=</span> &#123;</span><br><span class="line">    <span class="string">kdc</span> <span class="string">=</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span><span class="string">:88</span></span><br><span class="line">    <span class="string">admin_server</span> <span class="string">=</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">[<span class="string">domain_realm</span>]</span><br><span class="line"><span class="comment"># .example.com = EXAMPLE.COM</span></span><br><span class="line"><span class="comment"># example.com = EXAMPLE.COM</span></span><br></pre></td></tr></table></figure><h3 id="验证-Kerberos-可用"><a href="#验证-Kerberos-可用" class="headerlink" title="验证 Kerberos 可用"></a>验证 Kerberos 可用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志: /var/log/k*</span></span><br><span class="line">kinit -V -kt /home/ubuntu/docker-krb5-server/keytabs/kafka.keytab  kafka/ubuntu@EXAMPLE.COM</span><br></pre></td></tr></table></figure><h2 id="Kafka-配置修改"><a href="#Kafka-配置修改" class="headerlink" title="Kafka 配置修改"></a>Kafka 配置修改</h2><h3 id="server-properties"><a href="#server-properties" class="headerlink" title="server.properties"></a>server.properties</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改为 SASL_PLAINTEXT 或者 SASL_SSL</span></span><br><span class="line"><span class="string">listeners=SASL_PLAINTEXT://:19092</span></span><br><span class="line"><span class="string">advertised.listeners=SASL_PLAINTEXT://:19092</span></span><br><span class="line"><span class="comment"># 同时启用需认证 19092 和无需认证 19093</span></span><br><span class="line"><span class="comment">#listeners=SASL_PLAINTEXT://:19092,PLAINTEXT://:19093</span></span><br><span class="line"><span class="comment">#advertised.listeners=SASL_PLAINTEXT://:19092,PLAINTEXT://:19093</span></span><br><span class="line"></span><br><span class="line"><span class="string">security.inter.broker.protocol=SASL_PLAINTEXT</span></span><br><span class="line"><span class="string">sasl.mechanism.inter.broker.protocol=GSSAPI</span></span><br><span class="line"><span class="string">sasl.enabled.mechanisms=GSSAPI</span></span><br><span class="line"><span class="comment"># 如果 principal=&quot;kafka2/kafka1.hostname.com@EXAMPLE.COM&quot;; 那么这里应该是 kafka2</span></span><br><span class="line"><span class="string">sasl.kerberos.service.name=kafka</span></span><br></pre></td></tr></table></figure><h3 id="kafka-server-jaas-conf"><a href="#kafka-server-jaas-conf" class="headerlink" title="kafka_server_jaas.conf"></a>kafka_server_jaas.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 替换路径</span><br><span class="line">KafkaServer &#123;</span><br><span class="line">    com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">    useKeyTab=<span class="literal">true</span></span><br><span class="line">    storeKey=<span class="literal">true</span></span><br><span class="line">    keyTab=<span class="string">&quot;/home/ubuntu/docker-krb5-server/keytabs/kafka.keytab&quot;</span></span><br><span class="line">    principal=<span class="string">&quot;kafka/ubuntu@EXAMPLE.COM&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">// 不启用 zk </span><br><span class="line">// Zookeeper client authentication</span><br><span class="line">// Client &#123;</span><br><span class="line">//     com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">//     useKeyTab=<span class="literal">true</span></span><br><span class="line">//     storeKey=<span class="literal">true</span></span><br><span class="line">//     keyTab=<span class="string">&quot;/home/ubuntu/docker-krb5-server/keytabs/kafka.keytab&quot;</span></span><br><span class="line">//     principal=<span class="string">&quot;kafka/ubuntu@EXAMPLE.COM&quot;</span>;</span><br><span class="line">// &#125;;</span><br><span class="line">KafkaClient &#123;</span><br><span class="line">    com.sun.security.auth.module.Krb5LoginModule required</span><br><span class="line">    useTicketCache=<span class="literal">true</span></span><br><span class="line">    serviceName=kafka</span><br><span class="line">    useKeyTab=<span class="literal">true</span></span><br><span class="line">    storeKey=<span class="literal">true</span></span><br><span class="line">    keyTab=<span class="string">&quot;/home/ubuntu/docker-krb5-server/keytabs/kafka.keytab&quot;</span></span><br><span class="line">    principal=<span class="string">&quot;kafka/ubuntu@EXAMPLE.COM&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="kafka-server-start-sh"><a href="#kafka-server-start-sh" class="headerlink" title="kafka-server-start.sh"></a>kafka-server-start.sh</h3><ul><li>测试的时候可以不加 <code>-dameon</code>, 日志直接输出到终端, 更直观</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KAFKA_HOME=/home/ubuntu/kafka</span><br><span class="line"><span class="comment"># 替换路径</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_OPTS=<span class="string">&quot; -Dzookeeper.sasl.client=false -Dsun.security.krb5.debug=true -Djava.security.krb5.conf=/home/ubuntu/kafka/config/krb5.conf -Djava.security.auth.login.config=/home/ubuntu/kafka/config/kafka_server_jaas.conf &quot;</span></span><br></pre></td></tr></table></figure><h2 id="Kafka-备节点"><a href="#Kafka-备节点" class="headerlink" title="Kafka 备节点"></a>Kafka 备节点</h2><ul><li>直接复制即可, 需要修改 broker id, KAFKA_HOME, server.properties 里面的 listeners 相关配置.</li><li>主备节点的 principal 可一致, 为了安全也可以替换为其他 principal</li></ul><h2 id="手动消费验证"><a href="#手动消费验证" class="headerlink" title="手动消费验证"></a>手动消费验证</h2><blockquote><p>至少需要两个 broker, 一个的话,大概率不能正常消费.</p></blockquote><blockquote><p>消费不到数据的时候, 先验证 kafka 是否配置完整, 所有节点是否都已启动</p></blockquote><blockquote><p>任何一步提示需要密码之类的报错, 大概率都是因为 kerberos 认证配置的问题, 如 jass 文件, 环境变量, 消费时未指定 comsumer.properties 等. <del>文件太多了很容易就忘记改了, 从而导致鉴权失败.</del></p></blockquote><p>日志: <code>$KAFKA_HOME/logs/server.log</code></p><h3 id="producer-properties"><a href="#producer-properties" class="headerlink" title="producer.properties"></a>producer.properties</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=GSSAPI</span><br><span class="line"><span class="comment"># service.name 同上</span></span><br><span class="line">sasl.kerberos.service.name=kafka</span><br></pre></td></tr></table></figure><ol><li><code>export KAFKA_HOME KAFKA_OPTS</code> 配置</li><li><code>./bin/kafka-console-producer.sh --broker-list 192.168.1.166:19092,192.168.1.166:19093 --topic test --producer.config config/producer.properties</code></li></ol><h3 id="consumer-properties"><a href="#consumer-properties" class="headerlink" title="consumer.properties"></a>consumer.properties</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br><span class="line">sasl.mechanism=GSSAPI</span><br><span class="line"><span class="comment"># service.name 同上</span></span><br><span class="line">sasl.kerberos.service.name=kafka</span><br></pre></td></tr></table></figure><ol><li><code>export KAFKA_HOME KAFKA_OPTS</code> 配置</li><li><code>./bin/kafka-console-consumer.sh --bootstrap-server 192.168.1.166:19092,192.168.1.166:19093 --consumer.config config/consumer.properties --topic test --from-beginning</code></li></ol><blockquote><p>启动后在 <code>kafka producer</code> 终端输入, 在 <code>consumer</code> 终端即可看到数据</p></blockquote><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><h3 id="容器-kdc-conf-参考"><a href="#容器-kdc-conf-参考" class="headerlink" title="容器 kdc.conf 参考"></a>容器 kdc.conf 参考</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[kdcdefaults]</span><br><span class="line">    kdc_listen = 88</span><br><span class="line">    kdc_tcp_listen = 88</span><br><span class="line">    </span><br><span class="line">[realms]</span><br><span class="line">    EXAMPLE.COM = &#123;</span><br><span class="line">        kadmin_port = 749</span><br><span class="line">        max_life = 12h 0m 0s</span><br><span class="line">        max_renewable_life = 7d 0h 0m 0s</span><br><span class="line">        master_key_type = aes256-cts</span><br><span class="line">        supported_enctypes = aes256-cts:normal aes128-cts:normal</span><br><span class="line">        default_principal_flags = +preauth</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">[logging]</span><br><span class="line">    kdc = FILE:/var/log/krb5kdc.<span class="built_in">log</span></span><br><span class="line">    admin_server = FILE:/var/log/kadmin.log</span><br><span class="line">    default = FILE:/var/log/krb5lib.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> kafka </category>
          
          <category> Kerberos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
            <tag> Kerberos </tag>
            
            <tag> kdc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>联通光猫HG8347R路由模式下无法正常端口映射/DMZ</title>
      <link href="/2023/07/01/1/"/>
      <url>/2023/07/01/1/</url>
      
        <content type="html"><![CDATA[<ul><li>实际上是因为光猫 iptables 的原因, 需手动操作</li></ul><h2 id="光猫版本"><a href="#光猫版本" class="headerlink" title="光猫版本"></a>光猫版本</h2><ul><li>光猫型号 HG8347R, 固件版本 R17, 按常规路线得降级固件才能进维护模式, 然后才能刷机降级</li><li>光猫改桥接, 直接打运营商电话即可, 运营商直接下发策略</li></ul><h2 id="光猫设置"><a href="#光猫设置" class="headerlink" title="光猫设置"></a>光猫设置</h2><blockquote><p>如果发现无法 telnet 可以先将防火墙改成禁用</p></blockquote><ul><li>因为 ipv4 规则太多了, 以 ipv6 规则为例</li></ul><ol><li>telnet 登陆</li><li>用户提权</li><li>修改 iptables</li></ol><p><img src="/images/openwrt/HG8347R/cat.png" alt="Untitled"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.1.1 root/admin</span><br></pre></td></tr></table></figure><p><img src="/images/openwrt/HG8347R/telnet.png" alt="Untitled"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看现有规则</span></span><br><span class="line">display firewall rule address-family inet</span><br><span class="line"><span class="comment">#以 ipv6 规则为例</span></span><br><span class="line">firewall rule delete chain FWD_WANUPDOWN index 1 address-family inet6</span><br><span class="line">firewall rule delete chain FWD_WANU index 1 address-family inet6</span><br><span class="line">firewall rule delete chain FWD_SIP_CHECK index 1 address-family inet6</span><br><span class="line">firewall rule delete chain FWD_SIP_CHECK index 1 address-family inet6</span><br><span class="line">firewall rule delete chain FWD_SIP_CHECK index 1 address-family inet6</span><br><span class="line">firewall rule delete chain FWD_SIP_CHECK index 1 address-family inet6</span><br><span class="line"><span class="comment">#查看现有规则</span></span><br><span class="line">display firewall rule address-family inet</span><br></pre></td></tr></table></figure><h2 id="ipv6-地址选择"><a href="#ipv6-地址选择" class="headerlink" title="ipv6 地址选择"></a>ipv6 地址选择</h2><ul><li>240x 开头的 temporary 地址</li></ul><h2 id="iperf-测速"><a href="#iperf-测速" class="headerlink" title="iperf 测速"></a>iperf 测速</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TCP</span></span><br><span class="line">iperf3 -p 58000 -b 1000M -c 2408:8207:18a0:5f30:7109:3215:1be6:e55f</span><br><span class="line">iperf3 -p 58000 -b 1000M -c 2408:8207:18a0:5f30:7109:3215:1be6:e55f -R</span><br><span class="line"><span class="comment"># UDP</span></span><br><span class="line">iperf3 -p 58000 -b 1000M -c 2408:8207:18a0:5f30:7109:3215:1be6:e55f -u</span><br><span class="line">iperf3 -p 58000 -b 1000M -c 2408:8207:18a0:5f30:7109:3215:1be6:e55f -u -R</span><br></pre></td></tr></table></figure><h2 id="光猫真的封了所有入站请求吗"><a href="#光猫真的封了所有入站请求吗" class="headerlink" title="光猫真的封了所有入站请求吗?"></a>光猫真的封了所有入站请求吗?</h2><ul><li>如封</li><li>实测: 光猫会禁止国内 IP 访问 高端口 http, 但是国外 IP 可以访问…<ul><li>桥接后正常</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 漏油器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 光猫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红米 AX3000/CR8806 刷入 Openwrt 记录</title>
      <link href="/2023/06/07/1/"/>
      <url>/2023/06/07/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>刷机有风险，没有需要就别刷了   </p></blockquote><ul><li>虽然刷完内存, 闪存都没剩多少, 但是够用. 稳定好几个月了  </li></ul><h2 id="成果展示"><a href="#成果展示" class="headerlink" title="成果展示"></a>成果展示</h2><p><img src="/images/openwrt/ax3000/Untitled.png" alt="Untitled"></p><p><img src="/images/openwrt/ax3000/66052d1439e6f51f0d83e98de6c6cc2.jpg" alt="66052d1439e6f51f0d83e98de6c6cc2.jpg"></p><p><img src="/images/openwrt/ax3000/cb21250d0d993aa765631924864d474.jpg" alt="cb21250d0d993aa765631924864d474.jpg"></p><h2 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h2><h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><ul><li>TTL 芯片，推荐 CH341</li><li>杜邦线若干</li><li>Windows 电脑（带RJ45）</li><li>网线</li></ul><blockquote><p>不一定需要的</p></blockquote><ul><li>曲别针</li><li>十字螺丝刀</li><li>电烙铁，松香，焊锡丝</li></ul><h3 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h3><ul><li>TFTP 客户端</li><li>MiFlashTool</li><li>串口软件</li><li>ssh client</li></ul><h2 id="TTL-位置"><a href="#TTL-位置" class="headerlink" title="TTL 位置"></a>TTL 位置</h2><blockquote><p>M81 的主板</p></blockquote><p><img src="/images/openwrt/ax3000/Untitled%201.png" alt="Untitled"></p><blockquote><p>M79 的主板</p></blockquote><p><img src="/images/openwrt/ax3000/Untitled%202.png" alt="Untitled"></p><p><img src="/images/openwrt/ax3000/Untitled%203.png" alt="Untitled"></p><ul><li>从这几张图里面可以看出 TTL 串口都是在路由器右上角的。如果不想拆机的话， 可以通过曲别针之类的，下面用手电筒照明，曲别针从上面捅进去。</li></ul><h2 id="TTL排线"><a href="#TTL排线" class="headerlink" title="TTL排线"></a>TTL排线</h2><h3 id="曲别针大法"><a href="#曲别针大法" class="headerlink" title="曲别针大法"></a>曲别针大法</h3><ol><li>找了个杜邦线，拆了3根线，剪到合适的长度，大概10cm；</li><li>找3个回形针，掰成上图形状，然后将杜邦线焊在上面；用3M电工胶带绑好；</li><li>TTL口在右上角，用手电筒在底下照着，上面通过散热孔将回形针插进去，里面四个孔（从左至右是VCC，RX，GND，TX），VCC不接，其余与TTL模块交叉线接好；</li></ol><p><img src="/images/openwrt/ax3000/Untitled%204.png" alt="Untitled"></p><p><img src="/images/openwrt/ax3000/214859jiyxiylypqi0m0mu.jpg" alt="214859jiyxiylypqi0m0mu.jpg"></p><p><img src="/images/openwrt/ax3000/214859faxau4uqu40qwr0z.jpg" alt="214859faxau4uqu40qwr0z.jpg"></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucmlnaHQuY29tLmNuL2ZvcnVtL3RocmVhZC04MjcyMzIxLTEtMS5odG1s">记CR8808不拆机刷集客AP过程，在8806固件下开启ssh-小米无线路由器以及小米无线相关的设备-恩山无线论坛 -  Powered by Discuz!<i class="fa fa-external-link-alt"></i></span></p><h3 id="拆机"><a href="#拆机" class="headerlink" title="拆机"></a>拆机</h3><ul><li>CR8806 只有背部两个螺丝， 前面板是用卡扣固定的。螺丝都在标签纸下面，可能会感觉到多个螺丝孔，但实际上只有两个孔是通的且有螺丝。</li><li>下方应该两个卡扣，没拍到。其他都弄开之后下面的影响不大。</li><li>使用杜邦线插在TTL的位置，连接模块即可。或者自己把TTL排针焊回去。</li></ul><p><img src="/images/openwrt/ax3000/Untitled%205.png" alt="Untitled"></p><h2 id="TTL-通讯"><a href="#TTL-通讯" class="headerlink" title="TTL 通讯"></a>TTL 通讯</h2><blockquote><p>一般重启的时候串口就会有日志输出</p></blockquote><ul><li>TTL 从左至右是VCC，RX，GND，TX</li><li>GND 连接GND， TX连接RX，RX连接TX</li><li>短接2，3针，进入TTL功能</li><li>插上串口模块，打开设备管理器，安装驱动</li><li>检查设备管理器实际通讯口名称，如 COM4</li><li>串口软件（Putty）连接串口，填实际通讯口名称，波特率 9600。 如果乱码，调整为 115200</li></ul><blockquote><p>驱动下载， 选择第一个 EXE 即可：<span class="exturl" data-url="aHR0cHM6Ly93d3cud2NoLmNuL2Rvd25sb2Fkcy9jYXRlZ29yeS82Ny5odG1sP2ZlYXR1cmU9VVNCJUU4JUJEJUFDJUU0JUI4JUIyJUU1JThGJUEzJnByb2R1Y3RfbmFtZT1DSDM0MQ==">https://www.wch.cn/downloads/category/67.html?feature=USB转串口&amp;product_name=CH341<i class="fa fa-external-link-alt"></i></span></p></blockquote><blockquote><p>我这里用的是 CH341A</p></blockquote><p><img src="/images/openwrt/ax3000/Untitled.jpeg" alt="Untitled"></p><h2 id="启用-UART"><a href="#启用-UART" class="headerlink" title="启用 UART"></a>启用 UART</h2><table><thead><tr><th>Device</th><th>URL</th></tr></thead><tbody><tr><td>Redmi AX3000</td><td><span class="exturl" data-url="aHR0cHM6Ly9jZG4uY25iajEuZmRzLmFwaS5taS1pbWcuY29tL3hpYW9xaWFuZy9yb20vcmE4MS9taXdpZmlfcmE4MV9maXJtd2FyZV8xZGQ2OWNfMS4wLjMzLmJpbg==">https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/ra81/miwifi_ra81_firmware_1dd69c_1.0.33.bin<i class="fa fa-external-link-alt"></i></span></td></tr><tr><td>Xiaomi CR8806</td><td><span class="exturl" data-url="aHR0cHM6Ly9jZG4uY25iajEuZmRzLmFwaS5taS1pbWcuY29tL3hpYW9xaWFuZy9yb20vY3I4ODA2L21pd2lmaV9jcjg4MDZfZmlybXdhcmVfZmU3MGJfNi4yLjE0LmJpbg==">https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/cr8806/miwifi_cr8806_firmware_fe70b_6.2.14.bin<i class="fa fa-external-link-alt"></i></span></td></tr><tr><td>Xiaomi CR8808</td><td><span class="exturl" data-url="aHR0cHM6Ly9jZG4uY25iajEuZmRzLmFwaS5taS1pbWcuY29tL3hpYW9xaWFuZy9yb20vY3I4ODA4L21pd2lmaV9jcjg4MDhfZmlybXdhcmVfOWQyMTZfNi4yLjExLmJpbg==">https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/cr8808/miwifi_cr8808_firmware_9d216_6.2.11.bin<i class="fa fa-external-link-alt"></i></span></td></tr><tr><td>Xiaomi CR8809</td><td><span class="exturl" data-url="aHR0cHM6Ly9jZG4uY25iajEuZmRzLmFwaS5taS1pbWcuY29tL3hpYW9xaWFuZy9yb20vY3I4ODA5L21pd2lmaV9jcjg4MDlfZmlybXdhcmVfYjgxNGFfNi4yLjEwMi5iaW4=">https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/cr8809/miwifi_cr8809_firmware_b814a_6.2.102.bin<i class="fa fa-external-link-alt"></i></span></td></tr></tbody></table><ol><li>连接网线到 LAN1口</li><li>接好TTL，正常通讯</li><li>下载对应版本 ROM 包</li><li>建议关闭杀毒软件后再打开小米路由器修复工具，选择本地上传刷机ROM包；</li><li>选择网卡：请选择与路由器LAN口相连的网卡；<br>（此步骤将使用管理员权限为用户更改网卡配置，以确保路由器和电脑处于同一局域网。关闭应用时会提醒并自动恢复网卡配置。）</li><li>网卡配置成功后，先断开路由器电源，然后按住Reset键再接通电源，直到橙灯闪烁松开Reset键；</li><li>等待大约3-5分钟，蓝灯闪烁表示刷机成功，需要断电重启路由器；如果红灯闪烁表示刷机失败，请检查以上的刷机过程并重新进行刷机操作。</li><li>监听串口日志，有输出时，立马按中断 U-boot</li><li>执行以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setenv boot_wait on</span><br><span class="line">setenv uart_en 1</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure><blockquote><p>正常保存则代表 UART 启用成功</p></blockquote><h2 id="刷入-Openwrt"><a href="#刷入-Openwrt" class="headerlink" title="刷入 Openwrt"></a>刷入 Openwrt</h2><ol><li>下载 <code>[openwrt-ipq50xx-arm-redmi_ax3000-squashfs-nand-factory.ubi](https://github.com/hzyitc/openwrt-redmi-ax3000/releases/latest/download/openwrt-ipq50xx-arm-redmi_ax3000-squashfs-nand-factory.ubi)</code> 并且放置于本机 TFTP 根目录</li><li>ipconfig 查看当前电脑IP，假设为 192.168.1.2， 执行以下命令以刷入</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This router ip</span></span><br><span class="line">setenv ipaddr 192.168.1.2</span><br><span class="line"><span class="comment"># TFTP server ip</span></span><br><span class="line">setenv serverip 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download the firmware to the RAM</span></span><br><span class="line">tftpboot openwrt-ipq50xx-arm-redmi_ax3000-squashfs-nand-factory.ubi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flash it as system 2</span></span><br><span class="line">flash rootfs_1</span><br><span class="line">setenv flag_try_sys2_failed 0</span><br><span class="line">setenv flag_boot_rootfs 1</span><br><span class="line">setenv flag_last_success 1</span><br><span class="line">saveenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flash it as system 1</span></span><br><span class="line"><span class="comment"># flash rootfs</span></span><br><span class="line"><span class="comment"># setenv flag_try_sys1_failed 0</span></span><br><span class="line"><span class="comment"># setenv flag_boot_rootfs 0</span></span><br><span class="line"><span class="comment"># setenv flag_last_success 0</span></span><br><span class="line"><span class="comment"># saveenv</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reboot</span></span><br><span class="line">reset</span><br></pre></td></tr></table></figure><ul><li>刷入完成后，打开网页即可看到熟悉的 Openwrt 界面</li><li>如果需要密码、忘记密码，可以直接在串口软件里面按几下回车，输入 passwd 重置密码</li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li>将 TTL 焊接出来，方便以后使用</li><li>自己编译固件，添加中文, wireguard, vnstat, upnp, frps, frpc 支持</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2h6eWl0Yy9vcGVud3J0LXJlZG1pLWF4MzAwMA==">https://github.com/hzyitc/openwrt-redmi-ax3000<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL29wZW53cnQtcmVkbWktYXgzMDAw">https://github.com/IITII/openwrt-redmi-ax3000<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA4MzU3NDcvYXJ0aWNsZS9kZXRhaWxzLzEyMjIxNDkxNQ==">openwrt开启upnp_openwrt upnp_锅锅是锅锅的博客-CSDN博客<i class="fa fa-external-link-alt"></i></span></p><p><img src="/images/openwrt/ax3000/Untitled%206.png" alt="Untitled"></p><h3 id="中文设置"><a href="#中文设置" class="headerlink" title="中文设置"></a>中文设置</h3><ul><li>.config 添加以下内容, 然后执行 <code>make menuconfig</code></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_LUCI_LANG_zh_Hans<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>base<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>opkg<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">#<span class="comment">----</span></span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>ddns<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>firewall<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>frpc<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>frps<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>m</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>mwan3<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>m</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>upnp<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br><span class="line">CONFIG_PACKAGE_luci<span class="operator">-</span>i18n<span class="operator">-</span>wireguard<span class="operator">-</span>zh<span class="operator">-</span>cn<span class="operator">=</span>y</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VnStat 数据备份恢复</title>
      <link href="/2023/05/15/1/"/>
      <url>/2023/05/15/1/</url>
      
        <content type="html"><![CDATA[<h2 id="必要条件"><a href="#必要条件" class="headerlink" title="必要条件"></a>必要条件</h2><ul><li>sqlite3</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install sqlite3 -y</span><br></pre></td></tr></table></figure><h2 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h2><ul><li>将生成的 <code>vnstat_db.sql</code> 保存好</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">systemctl stop vnstat.service</span><br><span class="line">cd /var/lib/vnstat</span><br><span class="line">sqlite3 vnstat.db .dump &gt;vnstat_db.sql</span><br></pre></td></tr></table></figure><h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><ul><li>如果迁移前后的接口名称不一致, 可以修改 <code>vnstat_db.sql</code> 第 21 行的接口名称.</li><li>导入后通过 <code>vnstat</code> 命令验证数据的完整性</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">systemctl stop vnstat.service</span><br><span class="line">cd /var/lib/vnstat</span><br><span class="line">rm vnstat.db</span><br><span class="line">cat vnstat_db.sql | sqlite3 vnstat.db</span><br><span class="line">chown vnstat:vnstat vnstat.db</span><br><span class="line">systemctl start vnstat.service</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> backup </tag>
            
            <tag> vnstat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Openwrt ssh key 和 password 均正确但是无法登陆</title>
      <link href="/2023/05/01/1/"/>
      <url>/2023/05/01/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>User &#39;root&#39; has invalid shell, rejected</code></p></blockquote><blockquote><p><code>zsh: applet not found</code></p></blockquote><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul><li>openwrt 无法登陆, 正确配置 ssh key 和 password, 均无法登陆, 一直提示重新输入密码.</li><li>openwrt 网页可以正常打开, 登陆</li><li>openwrt 使用 dropbear 代替 openssh-server 进行 ssh 管理</li></ul><h2 id="解决步骤"><a href="#解决步骤" class="headerlink" title="解决步骤"></a>解决步骤</h2><ol><li>登陆网页, 打开系统日志</li><li>尝试 ssh 登陆</li><li>ssh 登陆失败后刷新系统日志页面, 并检查最新日志</li><li>日志里面显示 <code>User &#39;root&#39; has invalid shell, rejected</code></li><li>系统 → 软件包 → 搜索安装 Custom command(这个限制挺多的, 不支持管道, 执行结果不显示, 一直 loading)</li><li>打开 F12, 添加执行 <code>cat /etc/passwd</code>, F12 里面最新的 cfg 开头的 XHR 请求即为命令执行的结果.</li><li><code>/etc/passwd</code> 里面 root 的 shell 是 /usr/bin/zsh (也可以自己再测试下文件是否存在)</li><li>系统 → 软件包 → 搜索安装  zsh</li><li>尝试 ssh 登陆, 如果成功即结束</li><li>ssh 日志提示 <code>zsh: applet not found</code>, <code>Error relocating /usr/bin/zsh: xxx: symbol not found</code></li><li>将 <code>/etc/passwd</code> 的内容在外部编辑, 将 root shell 编写为 <code>/bin/ash</code>, 然后通过 <code>Custom command</code> 使用 wget -O 进行文件覆盖(最好提前备份)</li><li>在 <span class="exturl" data-url="aHR0cHM6Ly9idXN5Ym94Lm5ldC9kb3dubG9hZHMvYmluYXJpZXMv">https://busybox.net/downloads/binaries/<i class="fa fa-external-link-alt"></i></span> 根据 CPU 版本下载对应版本 busybox, 然后通过 <code>Custom command</code> 使用 wget -O 进行文件覆盖 <code>/bin/busybox</code> (最好提前备份)</li></ol><blockquote><p>如 状态页面显示 CPU 架构为: <code>ARMv7 Processor rev 0 (v7l)</code>, 则下载 <code>busybox-armv7l</code> 即可</p></blockquote><ol><li>通过 <code>Custom command</code> 执行 <code>chmod +x /bin/busybox</code></li><li>重新尝试登陆, 登陆成功</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> openwrt </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac 下快速查找/删除命中关键词的 Maven 依赖</title>
      <link href="/2023/04/15/1/"/>
      <url>/2023/04/15/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>仅限于 MacOS, linux 下面路径不太一样, 自行调整  </p></blockquote><h2 id="shell-函数"><a href="#shell-函数" class="headerlink" title="shell 函数"></a>shell 函数</h2><ul><li>添加到 <code>~/.zshrc</code> 或者 <code>~/.bashrc</code> 即可</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">findJars</span></span>() &#123;</span><br><span class="line">  jar_name=<span class="variable">$1</span></span><br><span class="line">  rmJar=<span class="variable">$2</span></span><br><span class="line">  <span class="built_in">set</span> -x</span><br><span class="line">  <span class="keyword">if</span> [[ -z <span class="variable">$jar_name</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> jar_name rm&quot;</span></span><br><span class="line">    <span class="built_in">set</span> +x</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    array=(<span class="string">&quot;<span class="variable">$HOME</span>/.m2/repository&quot;</span> <span class="string">&quot;<span class="variable">$HOME</span>/.ivy2/cache&quot;</span> <span class="string">&quot;<span class="variable">$HOME</span>/Library/Caches/Coursier&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">if</span> [[ -z <span class="variable">$rmJar</span> ]]; <span class="keyword">then</span></span><br><span class="line">        find <span class="variable">$i</span> -name <span class="string">&quot;<span class="variable">$jar_name</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        find <span class="variable">$i</span> -name <span class="string">&quot;<span class="variable">$jar_name</span>&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">set</span> +x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查找-hive-相关-jar-包"><a href="#查找-hive-相关-jar-包" class="headerlink" title="查找 hive 相关 jar 包"></a>查找 hive 相关 jar 包</h2><ul><li><code>findJars &quot;*hive-exec*&quot;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">❯ findJars &quot;*hive-exec*&quot;</span><br><span class="line">+findJars:4&gt; [[ -z &#x27;*hive-exec*&#x27; ]]</span><br><span class="line">+findJars:9&gt; array=( /Users/iitii/.m2/repository /Users/iitii/.ivy2/cache /Users/iitii/Library/Caches/Coursier )</span><br><span class="line">+findJars:10&gt; i=/Users/iitii/.m2/repository</span><br><span class="line">+findJars:11&gt; [[ -z &#x27;&#x27; ]]</span><br><span class="line">+findJars:12&gt; find /Users/iitii/.m2/repository -name &#x27;*hive-exec*&#x27;</span><br><span class="line">+findJars:10&gt; i=/Users/iitii/.ivy2/cache</span><br><span class="line">+findJars:11&gt; [[ -z &#x27;&#x27; ]]</span><br><span class="line">+findJars:12&gt; find /Users/iitii/.ivy2/cache -name &#x27;*hive-exec*&#x27;</span><br><span class="line">+findJars:10&gt; i=/Users/iitii/Library/Caches/Coursier</span><br><span class="line">+findJars:11&gt; [[ -z &#x27;&#x27; ]]</span><br><span class="line">+findJars:12&gt; find /Users/iitii/Library/Caches/Coursier -name &#x27;*hive-exec*&#x27;</span><br><span class="line">/Users/iitii/Library/Caches/Coursier/v1/https/maven.aliyun.com/nexus/content/groups/public/org/apache/hive/hive-exec</span><br><span class="line">/Users/iitii/Library/Caches/Coursier/v1/https/maven.aliyun.com/nexus/content/groups/public/org/apache/hive/hive-exec/2.3.9/.hive-exec-2.3.9.pom.sha1.checked</span><br><span class="line">/Users/iitii/Library/Caches/Coursier/v1/https/maven.aliyun.com/nexus/content/groups/public/org/apache/hive/hive-exec/2.3.9/hive-exec-2.3.9.jar</span><br><span class="line">+findJars:18&gt; set +x</span><br></pre></td></tr></table></figure><h2 id="删除-hive-相关-jar-包"><a href="#删除-hive-相关-jar-包" class="headerlink" title="删除 hive 相关 jar 包"></a>删除 hive 相关 jar 包</h2><ul><li><code>findJars &quot;*hive-exec*&quot; d</code></li></ul><blockquote><p>最后这个 d 其实填什么都可以, 只要填了, 就会删除. 慎用…</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop手动切换Namenode</title>
      <link href="/2023/04/01/1/"/>
      <url>/2023/04/01/1/</url>
      
        <content type="html"><![CDATA[<ul><li>NN 名称定义于 hdfs-site.xml 中</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep dfs.ha.namenodes.hdcluster <span class="variable">$&#123;HADOOP&#125;</span>/etc/hadoop/hdfs-site.xml</span><br></pre></td></tr></table></figure><h2 id="查询-NN-节点"><a href="#查询-NN-节点" class="headerlink" title="查询 NN 节点"></a>查询 NN 节点</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs getconf -namenodes</span><br></pre></td></tr></table></figure><h2 id="查询-NN-状态"><a href="#查询-NN-状态" class="headerlink" title="查询 NN 状态"></a>查询 NN 状态</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hdfs haadmin -getServiceState namenode1</span><br><span class="line">hdfs haadmin -getServiceState namenode2</span><br></pre></td></tr></table></figure><h2 id="手动切换"><a href="#手动切换" class="headerlink" title="手动切换"></a>手动切换</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs haadmin -failover -forcefence -forceactive namenode2 namenode1</span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs haadmin -transitionToActive namenode2</span><br></pre></td></tr></table></figure><h2 id="HA-集群手动切换"><a href="#HA-集群手动切换" class="headerlink" title="HA 集群手动切换"></a>HA 集群手动切换</h2><blockquote><p>存在脑裂的可能性, 推荐在目前 Active 的 Namenode 上执行</p></blockquote><ul><li>执行前确认 fsimage 以及 edits 文件数量及大小</li><li>执行后同时监听 zkfc 以及 所有 NN 的日志, 确保正常切换</li></ul>]]></content>
      
      
      <categories>
          
          <category> hadoop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将 powershell 脚本添加为开机启动项</title>
      <link href="/2023/03/14/1/"/>
      <url>/2023/03/14/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本质上是将 powershell 脚本添加为 windows 服务, windows 服务即可设置为开机启动并支持其他管理操作.  </p></blockquote><ul><li>一般有两种方式, <span class="exturl" data-url="aHR0cHM6Ly9uc3NtLmNjLw==">nssm<i class="fa fa-external-link-alt"></i></span> 和 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dpbnN3L3dpbnN3">WinSW<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>假设 powershell 脚本绝对路径为 <code>C:\1.ps1</code></p></blockquote><blockquote><p>假设服务名称为 <code>PicBack</code></p></blockquote><h2 id="Nssm"><a href="#Nssm" class="headerlink" title="Nssm"></a>Nssm</h2><ol><li>powershell 执行: <code>nssm install PicBack</code></li><li>在弹出的页面填写 <code>Path</code>, <code>StartUp directory</code>, <code>Arguments</code>, <code>Service Name</code><ul><li>Path 部分必须填: <code>powershell</code></li><li>Nssm 安装的服务默认是开机启动</li></ul></li><li>点击 Install Service 即可</li><li>任务管理器 → 服务, 搜索即可看到刚刚安装的服务.</li><li>服务异常日志可在 <code>Windows 事件管理器</code>中查看</li></ol><p><img src="/images/windows/pwsh/nssm.png" alt="nssm"></p><h2 id="WinSW"><a href="#WinSW" class="headerlink" title="WinSW"></a>WinSW</h2><ul><li>编写 .xml 文件, 假设路径为: <code>C:\1.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>PicBack<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>PicBack<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>PicOnline Backend.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>powershell C:\1.ps1<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 默认延迟启动 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">delayedAutoStart</span>&gt;</span>true<span class="tag">&lt;/<span class="name">delayedAutoStart</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log</span> <span class="attr">mode</span>=<span class="string">&quot;roll&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>执行<code>winsw install C:\1.xml</code> 即可安装服务</li><li>任务管理器 → 服务, 搜索即可看到刚刚安装的服务.</li><li>服务异常日志可在 <code>xml 文件目录下查看</code> 或者 <code>启动位置和服务同名的 log 文件中查看</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> pwsh </category>
          
      </categories>
      
      
        <tags>
            
            <tag> powerhshell </tag>
            
            <tag> windows </tag>
            
            <tag> nssm </tag>
            
            <tag> winsw </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scala报错: scala.runtime.NonLocalReturnControl</title>
      <link href="/2023/02/15/1/"/>
      <url>/2023/02/15/1/</url>
      
        <content type="html"><![CDATA[<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul><li>多层嵌套 + return 关键字导致 scalac 无法判断这个 return 关键字的作用域, 随后抛出 <code>scala.runtime.NonLocalReturnControl</code></li></ul><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><ul><li>因为这个错和 npe 差不多, 反正都看不到堆栈, 没法直接定位位置.</li><li>想定位的话, 得结合日志和 return 关键字对代码进行仔细观察, 多验证, 总会找到的…</li></ul><h2 id="复现代码"><a href="#复现代码" class="headerlink" title="复现代码"></a>复现代码</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">NonLocalReturnControl</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">val</span> r = <span class="type">Math</span>.random() * <span class="number">1000</span></span><br><span class="line">      r <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> r1 <span class="keyword">if</span> r &gt; <span class="number">0.5</span> =&gt;</span><br><span class="line">          asyncHandler &#123; r =&gt;</span><br><span class="line">            <span class="comment">// 正确写法</span></span><br><span class="line">            <span class="comment">// 1</span></span><br><span class="line">            <span class="comment">// 错误写法</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        <span class="comment">// case r2 =&gt; return 433</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">Throwable</span> =&gt;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">asyncHandler</span></span>(func: <span class="type">Double</span> =&gt; <span class="type">Double</span>): <span class="type">Double</span> = &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      func(<span class="type">Math</span>.random())</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">Throwable</span> =&gt;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> scala </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scala </tag>
            
            <tag> bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mvn报错: MVN Malformed &#92;uxxxx encoding.</title>
      <link href="/2023/02/04/1/"/>
      <url>/2023/02/04/1/</url>
      
        <content type="html"><![CDATA[<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul><li>从仓库下载到本地的文件损坏了, 删除重新下载即可</li></ul><h2 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h2><ol><li>使用 <code>mvn compile -X</code> 找到详细位置</li><li>添加断点, 通过 IDEA DEBUG 模式运行 <code>mvn compile</code></li><li>寻找 <code>TrackingFileManager</code> 栈</li><li>该栈的 file 变量即为有问题的文件</li><li>ls 该文件父目录, 即可看到一个 <code>maven-m\u0000\u0000???</code> 非常奇怪的文件</li><li>连带父目录一起删除, 重新执行即可</li></ol>]]></content>
      
      
      <categories>
          
          <category> env </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mvn </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java try-with-resouce原理及Scala实现</title>
      <link href="/2023/02/03/1/"/>
      <url>/2023/02/03/1/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>众所周知，所有被打开的系统资源，比如流、文件或者Socket连接等，都需要被开发者手动关闭，否则随着程序的不断运行，资源泄露将会累积成重大的生产事故。</p><p>在JDK7之前，只能通过 <code>try-finally</code> 手动判空并且手动关闭资源。JDK7之后，Java多了个新的语法：<code>try-with-resources</code>语句，对所有实现 <strong><code>java.lang.AutoCloseable</code></strong> 都可以自动关闭。极大的简化了代码。</p><h2 id="术词表"><a href="#术词表" class="headerlink" title="术词表"></a>术词表</h2><table><thead><tr><th>简写</th><th>全拼</th><th>中文释义</th></tr></thead><tbody><tr><td>ARM/arm</td><td>Automatic Resource Management</td><td>自动资源管理</td></tr><tr><td>Java</td><td>Java</td><td>默认代表 Java 8</td></tr><tr><td>Scala</td><td>Scala</td><td>默认代表 Scala 2.13</td></tr></tbody></table><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><ul><li>基于 Java8</li><li>多个声明使用分号隔开，代码块终止时，无论是正常还是异常，将按照此顺序自动调用对象的 <code>close</code> 方法。 注意，资源的 <code>close</code> 方法与他们创建相反的顺序调用。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单资源</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">readFirstLineFromFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span></span><br><span class="line">                   <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path))) &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 多资源</span></span><br><span class="line"><span class="keyword">try</span> (</span><br><span class="line">     java.util.zip.<span class="type">ZipFile</span> <span class="variable">zf</span> <span class="operator">=</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">java</span>.util.zip.ZipFile(zipFileName);</span><br><span class="line">     java.io.<span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span></span><br><span class="line">        java.nio.file.Files.newBufferedWriter(outputFilePath, charset)</span><br><span class="line"> ) &#123;</span><br><span class="line">     <span class="comment">// Enumerate each entry</span></span><br><span class="line">     <span class="keyword">for</span> (java.util.<span class="type">Enumeration</span> <span class="variable">entries</span> <span class="operator">=</span></span><br><span class="line">         zf.entries(); entries.hasMoreElements(); ) &#123;</span><br><span class="line">        <span class="comment">// Get the entry name and write it to the output file</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">newLine</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;line.separator&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">zipEntryName</span> <span class="operator">=</span></span><br><span class="line">             ((java.util.zip.ZipEntry) entries.nextElement()).getName() +</span><br><span class="line">                     newLine;</span><br><span class="line">            writer.write(zipEntryName, <span class="number">0</span>, zipEntryName.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h3><ul><li>需要 <code>Scala 2.13</code>，旧版 Scala 无 <code>scala.util.&#123;Try, Using&#125;</code></li><li>虽然 Scala 和 Java 写法不太一样，但是多个资源关闭的规律相同，即：资源的 <code>close</code> 方法与他们创建相反的顺序调用。</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">BufferedReader</span>, <span class="type">FileReader</span>&#125;</span><br><span class="line"><span class="keyword">import</span> scala.util.&#123;<span class="type">Try</span>, <span class="type">Using</span>&#125;</span><br><span class="line"><span class="comment">// 单资源, 如果文件不存在异常会被抑制, 返回的是一个 Try[A] 类型的对象</span></span><br><span class="line"><span class="keyword">val</span> lines: <span class="type">Try</span>[<span class="type">Seq</span>[<span class="type">String</span>]] =</span><br><span class="line">  <span class="type">Using</span>(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file.txt&quot;</span>))) &#123; reader =&gt;</span><br><span class="line">    <span class="type">Iterator</span>.continually(reader.readLine()).takeWhile(_ != <span class="literal">null</span>).toSeq</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 单资源，抛出所有异常</span></span><br><span class="line"><span class="keyword">val</span> lines: <span class="type">Seq</span>[<span class="type">String</span>] =</span><br><span class="line">   <span class="type">Using</span>.resource(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file.txt&quot;</span>))) &#123; reader =&gt;</span><br><span class="line">     <span class="type">Iterator</span>.continually(reader.readLine()).takeWhile(_ != <span class="literal">null</span>).toSeq</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">// 多资源</span></span><br><span class="line"><span class="keyword">val</span> lines: <span class="type">Try</span>[<span class="type">Seq</span>[<span class="type">String</span>]] = <span class="type">Using</span>.<span class="type">Manager</span> &#123; use =&gt;</span><br><span class="line">   <span class="keyword">val</span> r1 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file1.txt&quot;</span>)))</span><br><span class="line">   <span class="keyword">val</span> r2 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file2.txt&quot;</span>)))</span><br><span class="line">   <span class="keyword">val</span> r3 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file3.txt&quot;</span>)))</span><br><span class="line">   <span class="keyword">val</span> r4 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;file4.txt&quot;</span>)))</span><br><span class="line"></span><br><span class="line">   <span class="comment">// use your resources here</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">lines</span></span>(reader: <span class="type">BufferedReader</span>): <span class="type">Iterator</span>[<span class="type">String</span>] =</span><br><span class="line">     <span class="type">Iterator</span>.continually(reader.readLine()).takeWhile(_ != <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">   (lines(r1) ++ lines(r2) ++ lines(r3) ++ lines(r4)).toList</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="异常抑制机制"><a href="#异常抑制机制" class="headerlink" title="异常抑制机制"></a>异常抑制机制</h2><h3 id="Scala-1"><a href="#Scala-1" class="headerlink" title="Scala"></a>Scala</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">==Suppression Behavior==</span><br><span class="line"> </span><br><span class="line"> If two exceptions are thrown (e.g., by an operation and closing a resource),</span><br><span class="line"> one of them is re-thrown, and the other is</span><br><span class="line"> [[java.lang.Throwable#addSuppressed added to it as a suppressed exception]].</span><br><span class="line"> If the two exceptions are of different &#x27;severities&#x27; (see below), the one of a higher</span><br><span class="line"> severity is re-thrown, and the one of a lower severity is added to it as a suppressed</span><br><span class="line"> exception. If the two exceptions are of the same severity, the one thrown first is</span><br><span class="line"> re-thrown, and the one thrown second is added to it as a suppressed exception.</span><br><span class="line"> If an exception is a [[scala.util.control.ControlThrowable <span class="code">`ControlThrowable`</span>]], or</span><br><span class="line"> if it does not support suppression (see</span><br><span class="line"> [[java.lang.Throwable <span class="code">`Throwable`</span>&#x27;s constructor with an <span class="code">`enableSuppression`</span> parameter]]),</span><br><span class="line"> an exception that would have been suppressed is instead discarded.</span><br><span class="line"> </span><br><span class="line"> Exceptions are ranked from highest to lowest severity as follows:</span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.VirtualMachineError`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.LinkageError`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.InterruptedException`</span> and <span class="code">`java.lang.ThreadDeath`</span></span><br><span class="line"><span class="bullet">   -</span> [[scala.util.control.NonFatal fatal exceptions]], excluding <span class="code">`scala.util.control.ControlThrowable`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`scala.util.control.ControlThrowable`</span></span><br><span class="line"><span class="bullet">   -</span> all other exceptions</span><br><span class="line"> </span><br><span class="line"> When more than two exceptions are thrown, the first two are combined and</span><br><span class="line"> re-thrown as described above, and each successive exception thrown is combined</span><br><span class="line"> as it is thrown.</span><br></pre></td></tr></table></figure><ul><li>以上是 <code>Using</code> 的 Scala doc, 简单翻译如下</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">如果有两个异常被抛出，最后只会有一个异常被重新抛出，另外的异常将会通过 java.lang.Throwable#addSuppressed 被作为一个抑制异常添加到重新抛出的异常里面。</span><br><span class="line">如果异常不是属于同一严重性级别，严重性更高的异常将被抛出，严重性较低的作为抑制异常。</span><br><span class="line">如果异常属于同一严重性级别，按先来先抛出来决定抛出哪个异常。如果一个异常不支持被抑制，则将会被忽略（具体看 java.lang.Throwable <span class="code">`Throwable`</span> 构造函数里面的 <span class="code">`enableSuppression`</span> 参数）</span><br><span class="line"></span><br><span class="line">异常严重性，从高到低排列如下：</span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.VirtualMachineError`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.LinkageError`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`java.lang.InterruptedException`</span>、<span class="code">`java.lang.ThreadDeath`</span></span><br><span class="line"><span class="bullet">   -</span> [[scala.util.control.NonFatal fatal exceptions]], 不包括 <span class="code">`scala.util.control.ControlThrowable`</span></span><br><span class="line"><span class="bullet">   -</span> <span class="code">`scala.util.control.ControlThrowable`</span></span><br><span class="line"><span class="bullet">   -</span> 其他异常</span><br><span class="line">多个异常合并时，按FIFO两两处理，然后抛出最后合并过的异常。</span><br></pre></td></tr></table></figure><h3 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvZ3VpZGVzL2xhbmd1YWdlL3RyeS13aXRoLXJlc291cmNlcy5odG1s">https://docs.oracle.com/javase/8/docs/technotes/guides/language/try-with-resources.html<i class="fa fa-external-link-alt"></i></span></li></ul><ol><li>如果 readLine 和 close 同时抛出异常，那么 finally 块里面的异常将会被抛出，其他异常将会被抑制</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">However, in this example, if the methods readLine and close both throw exceptions,</span></span><br><span class="line"><span class="comment">then the method readFirstLineFromFileWithFinallyBlock throws the exception thrown</span></span><br><span class="line"><span class="comment">from the finally block; the exception thrown from the try block is suppressed.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">readFirstLineFromFileWithFinallyBlock</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path));</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> br.readLine();</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (br != <span class="literal">null</span>) br.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>如果 try 和 try-with-res 块都抛出异常，那么 try 里面的异常将会被抛出，其他异常将会被抑制</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">In contrast, in the example readFirstLineFromFile, if exceptions are thrown from</span></span><br><span class="line"><span class="comment">both the try block and the try-with-resources statement, then the method</span></span><br><span class="line"><span class="comment">readFirstLineFromFile throws the exception thrown from the try block; the exception</span></span><br><span class="line"><span class="comment">thrown from the try-with-resources block is suppressed. In Java SE 7 and later,</span></span><br><span class="line"><span class="comment">you can retrieve suppressed exceptions; see the section Suppressed Exceptions</span></span><br><span class="line"><span class="comment">for more information.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">readFirstLineFromFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path))) &#123;</span><br><span class="line">    <span class="keyword">return</span> br.readLine();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// decompile</span></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">readFirstLineFromFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path));</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    String var3;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        var3 = br.readLine();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var12) &#123;</span><br><span class="line">        var2 = var12;</span><br><span class="line">        <span class="keyword">throw</span> var12;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (br != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (var2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    br.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var11) &#123;</span><br><span class="line">                    var2.addSuppressed(var11);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                br.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> var3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>任何和 try-with-res 关联的代码块都有可能抛出异常。以 <code>writeToFileZipFileContents</code> 为例，try 里面可以抛出一个异常，在关闭 ZipFile 和 BufferedWriter 时最多可以抛出两个异常。如果有多个异常同时抛出，try 代码块里面的为最终抛出的异常，try-with-res 的异常将会被抑制。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An exception can be thrown from the block of code associated with the try-with-resources statement. In the</span></span><br><span class="line"><span class="comment"> * example writeToFileZipFileContents, an exception can be thrown from the try block, and up to two exceptions</span></span><br><span class="line"><span class="comment"> * can be thrown from the try-with-resources statement when it tries to close the ZipFile and BufferedWriter objects.</span></span><br><span class="line"><span class="comment"> * &lt;br/&gt;</span></span><br><span class="line"><span class="comment"> * If an exception is thrown from the try block and one or more exceptions are thrown from the try-with-resources</span></span><br><span class="line"><span class="comment"> * statement, then those exceptions thrown from the try-with-resources statement are suppressed, and the exception</span></span><br><span class="line"><span class="comment"> * thrown by the block is the one that is thrown by the writeToFileZipFileContents method. You can retrieve these</span></span><br><span class="line"><span class="comment"> * suppressed exceptions by calling the Throwable.getSuppressed method from the exception thrown by the try block.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeToFileZipFileContents</span><span class="params">(String zipFileName, String outputFileName)</span> <span class="keyword">throws</span> java.io.IOException &#123;</span><br><span class="line">    java.nio.charset.<span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> java.nio.charset.StandardCharsets.US_ASCII;</span><br><span class="line">    java.nio.file.<span class="type">Path</span> <span class="variable">outputFilePath</span> <span class="operator">=</span> java.nio.file.Paths.get(outputFileName);</span><br><span class="line">    <span class="comment">// Open zip file and create output file with try-with-resources statement</span></span><br><span class="line">    <span class="keyword">try</span> (java.util.zip.<span class="type">ZipFile</span> <span class="variable">zf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.util.zip.ZipFile(zipFileName); java.io.<span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> java.nio.file.Files.newBufferedWriter(outputFilePath, charset)) &#123;</span><br><span class="line">        <span class="comment">// Enumerate each entry</span></span><br><span class="line">        <span class="keyword">for</span> (java.util.<span class="type">Enumeration</span> <span class="variable">entries</span> <span class="operator">=</span> zf.entries(); entries.hasMoreElements(); ) &#123;</span><br><span class="line">            <span class="comment">// Get the entry name and write it to the output file</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newLine</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;line.separator&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">zipEntryName</span> <span class="operator">=</span> ((java.util.zip.ZipEntry) entries.nextElement()).getName() + newLine;</span><br><span class="line">            writer.write(zipEntryName, <span class="number">0</span>, zipEntryName.length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// decompile</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeToFileZipFileContents</span><span class="params">(String zipFileName, String outputFileName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Charset</span> <span class="variable">charset</span> <span class="operator">=</span> StandardCharsets.US_ASCII;</span><br><span class="line">    <span class="type">Path</span> <span class="variable">outputFilePath</span> <span class="operator">=</span> Paths.get(outputFileName);</span><br><span class="line">    <span class="type">ZipFile</span> <span class="variable">zf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipFile</span>(zipFileName);</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">var5</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">writer</span> <span class="operator">=</span> Files.newBufferedWriter(outputFilePath, charset);</span><br><span class="line">        <span class="type">Throwable</span> <span class="variable">var7</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Enumeration</span> <span class="variable">entries</span> <span class="operator">=</span> zf.entries();</span><br><span class="line">            <span class="keyword">while</span>(entries.hasMoreElements()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">newLine</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;line.separator&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">zipEntryName</span> <span class="operator">=</span> ((ZipEntry)entries.nextElement()).getName() + newLine;</span><br><span class="line">                writer.write(zipEntryName, <span class="number">0</span>, zipEntryName.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var32) &#123;</span><br><span class="line">            var7 = var32;</span><br><span class="line">            <span class="keyword">throw</span> var32;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (writer != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (var7 != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        writer.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable var31) &#123;</span><br><span class="line">                        var7.addSuppressed(var31);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    writer.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var34) &#123;</span><br><span class="line">        var5 = var34;</span><br><span class="line">        <span class="keyword">throw</span> var34;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (zf != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (var5 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    zf.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var30) &#123;</span><br><span class="line">                    var5.addSuppressed(var30);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                zf.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="抑制后的异常会输出什么？"><a href="#抑制后的异常会输出什么？" class="headerlink" title="抑制后的异常会输出什么？"></a>抑制后的异常会输出什么？</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Exception</span> <span class="variable">exception</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;Top Level Exception&quot;</span>);</span><br><span class="line">exception.printStackTrace();</span><br><span class="line">System.out.println(exception);</span><br><span class="line">System.out.println(exception.getMessage());</span><br><span class="line">System.out.println(<span class="string">&quot;????&quot;</span>);</span><br><span class="line">System.err.println(<span class="string">&quot;????&quot;</span>);</span><br><span class="line">exception.addSuppressed(<span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;suppress&quot;</span>));</span><br><span class="line">exception.printStackTrace();</span><br><span class="line">System.out.println(exception);</span><br><span class="line">System.out.println(exception.getMessage());</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们正常使用 printStackTrace() 的时候默认是输出到System.err中去的，而普通的输出都是放入System.out,</span></span><br><span class="line"><span class="comment"> * 这两者都是对上层封装的输出流，在默认情况下两者是指向Console的文本流。所以两者可能会出现同步问题。</span></span><br><span class="line"><span class="comment"> * 可以在printStackTrace()的时候指定输出流为System.out,通过回避System.err来实现Console中文本流的顺序问题。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exception.printStackTrace(System.out);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">java.lang.Exception: Top Level Exception</span></span><br><span class="line"><span class="comment">at ExceptionT.main(ExceptionT.java:7)</span></span><br><span class="line"><span class="comment">java.lang.Exception: Top Level Exception</span></span><br><span class="line"><span class="comment">at ExceptionT.main(ExceptionT.java:7)</span></span><br><span class="line"><span class="comment">Suppressed: java.lang.Exception: suppress</span></span><br><span class="line"><span class="comment">at ExceptionT.main(ExceptionT.java:12)</span></span><br><span class="line"><span class="comment">java.lang.Exception: Top Level Exception</span></span><br><span class="line"><span class="comment">Top Level Exception</span></span><br><span class="line"><span class="comment">????</span></span><br><span class="line"><span class="comment">java.lang.Exception: Top Level Exception</span></span><br><span class="line"><span class="comment">Top Level Exception</span></span><br><span class="line"><span class="comment">java.lang.Exception: Top Level Exception</span></span><br><span class="line"><span class="comment">at ExceptionT.main(ExceptionT.java:7)</span></span><br><span class="line"><span class="comment">Suppressed: java.lang.Exception: suppress</span></span><br><span class="line"><span class="comment">at ExceptionT.main(ExceptionT.java:12)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="Scala-2-11-实现-try-with-res"><a href="#Scala-2-11-实现-try-with-res" class="headerlink" title="Scala 2.11 实现 try-with-res"></a>Scala 2.11 实现 try-with-res</h2><blockquote><p>Scala 2.12 和 2.11 差别不大, 实现上是一样的  </p></blockquote><ul><li>通过前面的了解，我们已经初步熟悉了 try-with-res 的语法和机制，初步实现一下 Scala Using1</li><li>需要注意的点</li><li><input checked="" disabled="" type="checkbox"> 多异常处理</li><li><input checked="" disabled="" type="checkbox"> 单个资源关闭</li><li><input checked="" disabled="" type="checkbox"> 多个资源关闭</li><li><input checked="" disabled="" type="checkbox"> Scalaify ？</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">FileInputStream</span>, <span class="type">FileReader</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.control.<span class="type">NonFatal</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对单个资源进行管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">UsingUtils</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Inspire by java try-with-res decode code and Scala 2.13 Using.apply</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">withResourcesNoException</span></span>[<span class="type">T</span> &lt;: <span class="type">AutoCloseable</span>, <span class="type">V</span>](r: =&gt; <span class="type">T</span>)(f: <span class="type">T</span> =&gt; <span class="type">V</span>): <span class="type">V</span> = &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      withResources[<span class="type">T</span>,<span class="type">V</span>](r)(f)</span><br><span class="line">    &#125;<span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e:<span class="type">Throwable</span> =&gt;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">        <span class="literal">null</span>.asInstanceOf[<span class="type">V</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">withResources</span></span>[<span class="type">T</span> &lt;: <span class="type">AutoCloseable</span>, <span class="type">V</span>](r: =&gt; <span class="type">T</span>)(f: <span class="type">T</span> =&gt; <span class="type">V</span>): <span class="type">V</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> resource: <span class="type">T</span> = r</span><br><span class="line">    require(resource != <span class="literal">null</span>, <span class="string">&quot;resource is null&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> exception: <span class="type">Throwable</span> = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      f(resource)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">NonFatal</span>(e) =&gt;</span><br><span class="line">        exception = e</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      closeAndAddSuppressed(exception, resource)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">closeAndAddSuppressed</span></span>(e: <span class="type">Throwable</span>,</span><br><span class="line">                                    resource: <span class="type">AutoCloseable</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        resource.close()</span><br><span class="line">      &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">NonFatal</span>(suppressed) =&gt;</span><br><span class="line">          e.addSuppressed(suppressed)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resource.close()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 若文件不存在，会直接报错</span></span><br><span class="line">    <span class="type">UsingUtils</span>.withResources(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/1&quot;</span>))(s =&gt; println(s.ready()))</span><br><span class="line">    <span class="type">UsingUtils</span>.withResourcesNoException(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/2&quot;</span>))(s =&gt; println(s.ready()))</span><br><span class="line">    <span class="type">UsingUtils</span>.withResources(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/2&quot;</span>))(s =&gt; println(s.ready()))</span><br><span class="line">    <span class="type">UsingUtils</span>.withResources(<span class="literal">null</span>: <span class="type">FileInputStream</span>)(s =&gt; println(s.available()))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">BufferedReader</span>, <span class="type">FileReader</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.control.&#123;<span class="type">ControlThrowable</span>, <span class="type">NonFatal</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对多个资源进行管理</span></span><br><span class="line"><span class="comment"> * @date 2022/02/09</span></span><br><span class="line"><span class="comment"> * @note [[Using.Manager.apply]] is not same as Scala 2.13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Using</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** A resource manager.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * Resources can be registered with the manager by calling [[acquire `acquire`]];</span></span><br><span class="line"><span class="comment">   * such resources will be released in reverse order of their acquisition</span></span><br><span class="line"><span class="comment">   * when the manager is closed, regardless of any exceptions thrown</span></span><br><span class="line"><span class="comment">   * during use.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * $suppressionBehavior</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @note It is recommended for API designers to require an implicit `Manager`</span></span><br><span class="line"><span class="comment">   *       for the creation of custom resources, and to call `acquire` during those</span></span><br><span class="line"><span class="comment">   *       resources&#x27; construction. Doing so guarantees that the resource &#x27;&#x27;must&#x27;&#x27; be</span></span><br><span class="line"><span class="comment">   *       automatically managed, and makes it impossible to forget to do so.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *       Example:</span></span><br><span class="line"><span class="comment">   * &#123;&#123;&#123;</span></span><br><span class="line"><span class="comment">   *       class SafeFileReader(file: File)(implicit manager: Using.Manager)</span></span><br><span class="line"><span class="comment">   *         extends BufferedReader(new FileReader(file)) &#123;</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *         def this(fileName: String)(implicit manager: Using.Manager) = this(new File(fileName))</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   *         manager.acquire(this)</span></span><br><span class="line"><span class="comment">   *       &#125;</span></span><br><span class="line"><span class="comment">   * &#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="title">private</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> <span class="type">Manager</span>._</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> closed = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> resources: <span class="type">List</span>[<span class="type">Resource</span>[_]] = <span class="type">Nil</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Registers the specified resource with this manager, so that</span></span><br><span class="line"><span class="comment">     * the resource is released when the manager is closed, and then</span></span><br><span class="line"><span class="comment">     * returns the (unmodified) resource.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">R</span>: <span class="type">Releasable</span>](resource: <span class="type">R</span>): <span class="type">R</span> = &#123;</span><br><span class="line">      acquire(resource)</span><br><span class="line">      resource</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Registers the specified resource with this manager, so that</span></span><br><span class="line"><span class="comment">     * the resource is released when the manager is closed.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">acquire</span></span>[<span class="type">R</span>: <span class="type">Releasable</span>](resource: <span class="type">R</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="keyword">if</span> (resource == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">NullPointerException</span>(<span class="string">&quot;null resource&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span> (closed) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalStateException</span>(<span class="string">&quot;Manager has already been closed&quot;</span>)</span><br><span class="line">      resources = <span class="keyword">new</span> <span class="type">Resource</span>(resource) :: resources</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">manage</span></span>[<span class="type">A</span>](op: <span class="type">Manager</span> =&gt; <span class="type">A</span>): <span class="type">A</span> = &#123;</span><br><span class="line">      <span class="keyword">var</span> toThrow: <span class="type">Throwable</span> = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        op(<span class="keyword">this</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> t: <span class="type">Throwable</span> =&gt;</span><br><span class="line">          toThrow = t</span><br><span class="line">          <span class="literal">null</span>.asInstanceOf[<span class="type">A</span>] <span class="comment">// compiler doesn&#x27;t know `finally` will throw</span></span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        closed = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">var</span> rs: <span class="type">List</span>[<span class="type">Resource</span>[_]] = resources</span><br><span class="line">        resources = <span class="literal">null</span> <span class="comment">// allow GC, in case something is holding a reference to `this`</span></span><br><span class="line">        <span class="keyword">while</span> (rs.nonEmpty) &#123;</span><br><span class="line">          <span class="keyword">val</span> resource: <span class="type">Resource</span>[_] = rs.head</span><br><span class="line">          rs = rs.tail</span><br><span class="line">          <span class="keyword">try</span> resource.release()</span><br><span class="line">          <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> t: <span class="type">Throwable</span> =&gt;</span><br><span class="line">              <span class="keyword">if</span> (toThrow == <span class="literal">null</span>) toThrow = t</span><br><span class="line">              <span class="keyword">else</span> toThrow = preferentiallySuppress(toThrow, t)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (toThrow != <span class="literal">null</span>) <span class="keyword">throw</span> toThrow</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">Manager</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** Performs an operation using a `Manager`, then closes the `Manager`,</span></span><br><span class="line"><span class="comment">     * releasing its resources (in reverse order of acquisition).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Example:</span></span><br><span class="line"><span class="comment">     * &#123;&#123;&#123;</span></span><br><span class="line"><span class="comment">     * val lines = Using.Manager &#123; use =&gt;</span></span><br><span class="line"><span class="comment">     *   use(new BufferedReader(new FileReader(&quot;file.txt&quot;))).lines()</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If using resources which require an implicit `Manager` as a parameter,</span></span><br><span class="line"><span class="comment">     * this method should be invoked with an `implicit` modifier before the function</span></span><br><span class="line"><span class="comment">     * parameter:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Example:</span></span><br><span class="line"><span class="comment">     * &#123;&#123;&#123;</span></span><br><span class="line"><span class="comment">     * val lines = Using.Manager &#123; implicit use =&gt;</span></span><br><span class="line"><span class="comment">     *   new SafeFileReader(&quot;file.txt&quot;).lines()</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * &#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * See the main doc for [[Using `Using`]] for full details of suppression behavior.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param op the operation to perform using the manager</span></span><br><span class="line"><span class="comment">     * @tparam A the return type of the operation</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return a [[Try]] containing an exception if one or more were thrown,</span></span><br><span class="line"><span class="comment">     *         or the result of the operation if no exceptions were thrown</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">A</span>](op: <span class="type">Manager</span> =&gt; <span class="type">A</span>): <span class="type">A</span> = <span class="keyword">try</span> &#123;</span><br><span class="line">      (<span class="keyword">new</span> <span class="type">Manager</span>).manage(op)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">Throwable</span> =&gt;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">        <span class="literal">null</span>.asInstanceOf[<span class="type">A</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Resource</span>[<span class="type">R</span>](<span class="params">resource: <span class="type">R</span></span>)(<span class="params">implicit releasable: <span class="type">Releasable</span>[<span class="type">R</span>]</span>) </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">release</span></span>(): <span class="type">Unit</span> = releasable.release(resource)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">preferentiallySuppress</span></span>(primary: <span class="type">Throwable</span>, secondary: <span class="type">Throwable</span>): <span class="type">Throwable</span> = &#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">score</span></span>(t: <span class="type">Throwable</span>): <span class="type">Int</span> = t <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> _: <span class="type">VirtualMachineError</span> =&gt; <span class="number">4</span></span><br><span class="line">        <span class="keyword">case</span> _: <span class="type">LinkageError</span> =&gt; <span class="number">3</span></span><br><span class="line">        <span class="keyword">case</span> _: <span class="type">InterruptedException</span> | _: <span class="type">ThreadDeath</span> =&gt; <span class="number">2</span></span><br><span class="line">        <span class="keyword">case</span> _: <span class="type">ControlThrowable</span> =&gt; <span class="number">0</span></span><br><span class="line">        <span class="keyword">case</span> e <span class="keyword">if</span> !<span class="type">NonFatal</span>(e) =&gt; <span class="number">1</span> <span class="comment">// in case this method gets out of sync with NonFatal</span></span><br><span class="line">        <span class="keyword">case</span> _ =&gt; <span class="number">-1</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@inline</span> <span class="function"><span class="keyword">def</span> <span class="title">suppress</span></span>(t: <span class="type">Throwable</span>, suppressed: <span class="type">Throwable</span>): <span class="type">Throwable</span> = &#123;</span><br><span class="line">        t.addSuppressed(suppressed);</span><br><span class="line">        t</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (score(secondary) &gt; score(primary)) suppress(secondary, primary)</span><br><span class="line">      <span class="keyword">else</span> suppress(primary, secondary)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** A type class describing how to release a particular type of resource.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * A resource is anything which needs to be released, closed, or otherwise cleaned up</span></span><br><span class="line"><span class="comment">   * in some way after it is finished being used, and for which waiting for the object&#x27;s</span></span><br><span class="line"><span class="comment">   * garbage collection to be cleaned up would be unacceptable. For example, an instance of</span></span><br><span class="line"><span class="comment">   * [[java.io.OutputStream]] would be considered a resource, because it is important to close</span></span><br><span class="line"><span class="comment">   * the stream after it is finished being used.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * An instance of `Releasable` is needed in order to automatically manage a resource</span></span><br><span class="line"><span class="comment">   * with [[Using `Using`]]. An implicit instance is provided for all types extending</span></span><br><span class="line"><span class="comment">   * [[java.lang.AutoCloseable]].</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @tparam R the type of the resource</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="class"><span class="keyword">trait</span> <span class="title">Releasable</span>[-<span class="type">R</span>] </span>&#123;</span><br><span class="line">    <span class="comment">/** Releases the specified resource. */</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">release</span></span>(resource: <span class="type">R</span>): <span class="type">Unit</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">Releasable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** An implicit `Releasable` for [[java.lang.AutoCloseable `AutoCloseable`s]]. */</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="class"><span class="keyword">object</span> <span class="title">AutoCloseableIsReleasable</span> <span class="keyword">extends</span> <span class="title">Releasable</span>[<span class="type">AutoCloseable</span>] </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">release</span></span>(resource: <span class="type">AutoCloseable</span>): <span class="type">Unit</span> = resource.close()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> lines: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">Using</span>.<span class="type">Manager</span>.apply &#123; use =&gt;</span><br><span class="line">      <span class="keyword">val</span> r1 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/file1.txt&quot;</span>)))</span><br><span class="line">      <span class="keyword">val</span> r2 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/file2.txt&quot;</span>)))</span><br><span class="line">      <span class="keyword">val</span> r3 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/file3.txt&quot;</span>)))</span><br><span class="line">      <span class="keyword">val</span> r4 = use(<span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">FileReader</span>(<span class="string">&quot;/tmp/file4.txt&quot;</span>)))</span><br><span class="line"></span><br><span class="line">      <span class="comment">// use your resources here</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">lines</span></span>(reader: <span class="type">BufferedReader</span>): <span class="type">Iterator</span>[<span class="type">String</span>] =</span><br><span class="line">        <span class="type">Iterator</span>.continually(reader.readLine()).takeWhile(_ != <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">      (lines(r1) ++ lines(r2) ++ lines(r3) ++ lines(r4)).toList</span><br><span class="line">    &#125;</span><br><span class="line">    println(lines)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="开源实现"><a href="#开源实现" class="headerlink" title="开源实现"></a>开源实现</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMv">https://github.com/pathikrit/better-files/<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pzdWVyZXRoL3NjYWxhLWFybS8=">https://github.com/jsuereth/scala-arm/<i class="fa fa-external-link-alt"></i></span></li></ul><table><thead><tr><th>名称</th><th><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pzdWVyZXRoL3NjYWxhLWFybQ==">https://github.com/jsuereth/scala-arm<i class="fa fa-external-link-alt"></i></span></th><th><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXM=">https://github.com/pathikrit/better-files<i class="fa fa-external-link-alt"></i></span></th></tr></thead><tbody><tr><td>链接</td><td><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pzdWVyZXRoL3NjYWxhLWFybS8=">https://github.com/jsuereth/scala-arm/<i class="fa fa-external-link-alt"></i></span></td><td><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXM=">https://github.com/pathikrit/better-files<i class="fa fa-external-link-alt"></i></span></td></tr><tr><td>数据采集时间</td><td>2022.2.10</td><td>2022.2.10</td></tr><tr><td>Star</td><td>553</td><td>1400+</td></tr><tr><td>Commits</td><td>194</td><td>978</td></tr><tr><td>Last Commit</td><td>2020.10.26</td><td>2021.4.24</td></tr><tr><td>Total Issues</td><td>41</td><td>197</td></tr><tr><td>Total PR</td><td>76</td><td>348</td></tr><tr><td>Supports</td><td>ARM</td><td>ARM, I/O, Resource APIs, Streams, File Monitoring…</td></tr></tbody></table><h3 id="scala-arm"><a href="#scala-arm" class="headerlink" title="scala-arm"></a>scala-arm</h3><ul><li>Only a simple example</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> resource._</span><br><span class="line"><span class="comment">// Copy input into output.</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  input &lt;- managed(<span class="keyword">new</span> java.io.<span class="type">FileInputStream</span>(<span class="string">&quot;test.txt&quot;</span>))</span><br><span class="line">  output &lt;- managed(<span class="keyword">new</span> java.io.<span class="type">FileOutputStream</span>(<span class="string">&quot;test2.txt&quot;</span>))</span><br><span class="line">&#125; &#123;</span><br><span class="line">  <span class="keyword">val</span> buffer = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">512</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read</span></span>(): <span class="type">Unit</span> = input.read(buffer) <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">-1</span> =&gt; ()</span><br><span class="line">    <span class="keyword">case</span>  n =&gt;</span><br><span class="line">      output.write(buffer,<span class="number">0</span>,n)</span><br><span class="line">      read()</span><br><span class="line">  &#125;</span><br><span class="line">  read()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Better-Files"><a href="#Better-Files" class="headerlink" title="Better Files"></a>Better Files</h3><ol><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZmlsZS1yZWFkd3JpdGU=">Simple I/O<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjcmVzb3VyY2UtYXBpcw==">Resource APIs<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjc3RyZWFtcw==">Streams<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZW5jb2Rpbmdz">Encodings<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjamF2YS1zZXJpYWxpemF0aW9uLXV0aWxz">Java serialization utils<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjamF2YS1pbnRlcm9wZXJhYmlsaXR5">Java compatibility<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZ2xvYmJpbmc=">Globbing<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZmlsZS1zeXN0ZW0tb3BlcmF0aW9ucw==">File system operations<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjY2hlY2tzdW1z">Checksums<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjdGVtcG9yYXJ5LWZpbGVz">Temporary files<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjdW5peC1kc2w=">UNIX DSL<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZmlsZS1hdHRyaWJ1dGVz">File attributes<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZmlsZS1jb21wYXJpc29u">File comparison<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjemlwLWFwaXM=">Zip/GZip<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjbGlnaHR3ZWlnaHQtYXJt">Automatic Resource Management<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjc2Nhbm5lcg==">Scanner<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjZmlsZS1tb25pdG9yaW5n">File Monitoring<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdGhpa3JpdC9iZXR0ZXItZmlsZXMjYWtrYS1maWxlLXdhdGNoZXI=">Reactive File Watcher<i class="fa fa-external-link-alt"></i></span></li></ol><h2 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h2><p>既然你都看到这里了, 那我留个问题吧:</p><ul><li>比如带 AutoClose 的文件资源，我可以仅调用但不进行 close 操作吗？它会自动关闭吗？</li></ul><!-- 答：不行。如果不使用 ARM，资源并不会自动关闭。说到底 `try-with-resources`语句仅仅也只是一个语法糖而已，结合编译后的代码我们可以很容易理清楚其间的逻辑。它只是将 close 这一块的代码自动处理了，但是资源还是关闭了，所以继承 `AutoClose` 的资源并不是使用完就可以不管了，还是得手动处理或者使用 ARM -->]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS 运行来自身份不明开发者的应用</title>
      <link href="/2023/02/02/1/"/>
      <url>/2023/02/02/1/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>实现这个目标大概有两种方法, 分为禁用和不禁用 SIP. 从安全性讲不禁用 SIP 好点.</li></ul><blockquote><p>System Integrity Protection (SIP)是Mac系统的一种安全功能，它限制了root用户账户的权限，防止恶意软件修改或覆盖系统文件或应用。SIP在OS X El Capitan或更高版本中默认开启。如果要关闭或开启SIP，需要进入恢复模式并使用终端命令**<code>csrutil disable</code><strong>或</strong><code>csrutil enable</code>**。但是关闭SIP可能会导致系统不稳定或受到攻击，所以一般不建议普通用户这样做。</p></blockquote><h2 id="禁用系统完整性保护-SIP"><a href="#禁用系统完整性保护-SIP" class="headerlink" title="禁用系统完整性保护(SIP)"></a>禁用系统完整性保护(SIP)</h2><ul><li>禁用之后可以运行来着任意来源的应用, 包括 <code>来自身份不明开发者的应用</code></li></ul><h3 id="第一种-直接在主系统执行"><a href="#第一种-直接在主系统执行" class="headerlink" title="第一种: 直接在主系统执行"></a>第一种: 直接在主系统执行</h3><ul><li><code>sudo spctl --master-disable</code></li><li>重启电脑, 即可在 设置→安全性隐私→启用任意来源</li></ul><h3 id="第二种-在-RecoveryOS-执行"><a href="#第二种-在-RecoveryOS-执行" class="headerlink" title="第二种: 在 RecoveryOS 执行"></a>第二种: 在 RecoveryOS 执行</h3><ul><li>重启, 按住 <code>⌘+R</code> 进入 RecoveryOS</li><li>打开终端执行: <code>csrutil disable</code></li><li>重启电脑, 即可在 设置→安全性隐私→启用任意来源</li></ul><h2 id="不禁用-SIP-手动解除-quarantine-限制"><a href="#不禁用-SIP-手动解除-quarantine-限制" class="headerlink" title="不禁用 SIP, 手动解除 quarantine 限制"></a>不禁用 SIP, 手动解除 quarantine 限制</h2><blockquote><p>macOS quarantine是一种安全机制，用于防止从互联网下载的应用程序或文件包含恶意软件或病毒。当你尝试打开一个被quarantine的应用程序时，macOS会检查它是否有已知的恶意软件，并且开发者的签名证书是否有效1。如果没有问题，你可以继续打开应用程序。如果有问题，macOS会警告你并建议你删除应用程序。</p></blockquote><ol><li>打开终端应用程序。</li><li>输入或粘贴以下命令：<code>sudo xattr -r -d com.apple.quarantine</code></li><li>在命令后面加上一个空格。</li><li>把下载的应用程序或文件拖到终端窗口中, 如: <code>sudo xattr -r -d com.apple.quarantine /Applications/Sensci.app</code></li><li>按回车键执行命令。</li><li>输入你的登录密码（输入时不会显示任何字符）并按回车键确认。</li></ol><p>这样就可以移除quarantine属性了。请注意，这样做可能会降低你的系统安全性，所以请确保你下载的来源是可信赖的，并且在移除quarantine属性之前扫描一下是否有恶意软件或病毒。</p>]]></content>
      
      
      <categories>
          
          <category> macos </category>
          
          <category> hack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> hack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VisualGC 提示 “Not Supported for this JVM”</title>
      <link href="/2023/02/01/1/"/>
      <url>/2023/02/01/1/</url>
      
        <content type="html"><![CDATA[<ul><li>远程服务上面编辑 <code>vim /tmp/tools.policy</code>并添加</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant codebase <span class="string">&quot;file:<span class="variable">$&#123;java.home&#125;</span>/../lib/tools.jar&quot;</span> &#123;</span><br><span class="line">   permission java.security.AllPermission;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>启动 <code>jstatsd</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstatd -J-Djava.rmi.server.hostname=<span class="string">&quot;实际监听地址&quot;</span> -J-Djava.security.policy=/tmp/tools.policy</span><br></pre></td></tr></table></figure><ul><li>打开 <code>visualvm</code> 添加 <code>jstatsd</code> 链接即可</li></ul><p><img src="/images/jvm/visualvm/1.png" style="    width: 60%;    min-width: 420px;    max-width: 800px;"></p>]]></content>
      
      
      <categories>
          
          <category> jvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Telegarf 通过代理访问 TG API 的几种方式</title>
      <link href="/2022/12/31/1/"/>
      <url>/2022/12/31/1/</url>
      
        <content type="html"><![CDATA[<ul><li>主要分为客户端代理和服务端代理, 一般情况下只需一个就可以了</li></ul><h2 id="客户端代理"><a href="#客户端代理" class="headerlink" title="客户端代理"></a>客户端代理</h2><h3 id="clash-增强模式-clash-tun-模式"><a href="#clash-增强模式-clash-tun-模式" class="headerlink" title="clash 增强模式 / clash tun 模式"></a>clash 增强模式 / clash tun 模式</h3><ul><li>这种情况下 clash 已经接管了所有流量, 直接启动就可以了, 不需要额外设置<h3 id="http-agent"><a href="#http-agent" class="headerlink" title="http agent"></a>http agent</h3></li><li>需要有一个可以访问的 http 代理, 比如 clash 默认启动的本地 http 代理</li></ul><blockquote><p>如果是手动写的 v2 配置文件, 可以参考 <a href="https://iitii.github.io/2020/02/04/1/">在 v2ray 中同时开启 socks 和 http 代理</a> 来手动开启 http 代理服务  </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Telegraf = require(&#x27;telegraf&#x27;)</span><br><span class="line">const HttpsProxyAgent = require(&#x27;https-proxy-agent&#x27;)</span><br><span class="line"></span><br><span class="line">const bot = new Telegraf(&#x27;bot_token&#x27;, &#123;</span><br><span class="line">  telegram: &#123;</span><br><span class="line">    agent: new HttpsProxyAgent(&#x27;proxy url&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="socks-agent"><a href="#socks-agent" class="headerlink" title="socks agent"></a>socks agent</h3><ul><li>同上, 只不过 agent 变成了 <span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc29ja3MtcHJveHktYWdlbnQ=">SocksAgent<i class="fa fa-external-link-alt"></i></span></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Telegraf = require(&#x27;telegraf&#x27;);</span><br><span class="line">const SocksAgent = require(&#x27;socks5-https-client/lib/Agent&#x27;);</span><br><span class="line">const socksAgent = new SocksAgent(&#123;</span><br><span class="line">  socksHost: config.proxy.host,</span><br><span class="line">  socksPort: config.proxy.port,</span><br><span class="line">  socksUsername: config.proxy.login,</span><br><span class="line">  socksPassword: config.proxy.psswd,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const app = new Telegraf(token, &#123;</span><br><span class="line">  telegram: &#123; agent: socksAgent &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="服务端代理"><a href="#服务端代理" class="headerlink" title="服务端代理"></a>服务端代理</h2><ul><li>代理地址参见: <a href="https://iitii.github.io/2022/12/30/1/">反代Telegram Bot API</a></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const app = new Telegraf(token, &#123;</span><br><span class="line">  telegram: &#123;</span><br><span class="line">    // proxy for https://api.telegram.org</span><br><span class="line">    apiRoot: &#x27;https://tg-api-proxy-on-my-domain&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RlbGVncmFmL3RlbGVncmFmL2lzc3Vlcy82Mw==">https://github.com/telegraf/telegraf/issues/63<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> tg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tg </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>反代Telegram Bot API</title>
      <link href="/2022/12/30/1/"/>
      <url>/2022/12/30/1/</url>
      
        <content type="html"><![CDATA[<h2 id="必备条件"><a href="#必备条件" class="headerlink" title="必备条件"></a>必备条件</h2><ul><li>一台能正常访问 TG API 的机器</li><li>NGINX</li><li>https</li></ul><blockquote><p>因为请求 TG API 走的是 HTTPS, 所以这里必须要 HTTPS 反代  </p></blockquote><h2 id="核心配置"><a href="#核心配置" class="headerlink" title="核心配置"></a>核心配置</h2><ul><li>可以自由的把这段 location 添加到已有的 nginx ssl 配置中, 用于实现反代<blockquote><p>不熟悉的 NGINX 的, 加错了自己修  </p></blockquote></li><li>配置检查, 重载: <code>nginx -t &amp;&amp; nginx -s reload</code></li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* ^/bot</span> &#123;</span><br><span class="line">     <span class="comment">## dns必须写，不然会报502错误</span></span><br><span class="line">     <span class="attribute">resolver</span> <span class="number">8.8.8.8</span>;</span><br><span class="line">     <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">     <span class="attribute">proxy_pass</span>  https://api.telegram.org<span class="variable">$request_uri</span>;</span><br><span class="line">     <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">     <span class="comment"># 不能设置 proxy header 否则无返回</span></span><br><span class="line">     <span class="comment"># proxy_set_header Host $host;</span></span><br><span class="line">     <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">     <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul><li>如果 502 先看看 有没有设置 dns, 检查 dns 可用性</li><li>然后再看看 nginx 日志, 根据配置文件排查看看是哪里不对劲</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">❯ curl https://api.telegram.org/bot</span><br><span class="line">&#123;<span class="string">&quot;ok&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;error_code&quot;</span>:404,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;Not Found&quot;</span>&#125;<span class="comment">#                       </span></span><br><span class="line">❯ curl https://tyn3.xxx.xxx/bot</span><br><span class="line">&#123;<span class="string">&quot;ok&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;error_code&quot;</span>:404,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;Not Found&quot;</span>&#125;<span class="comment">#       </span></span><br></pre></td></tr></table></figure><h3 id="完整配置"><a href="#完整配置" class="headerlink" title="完整配置"></a>完整配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">upstream iitii &#123;</span><br><span class="line">    server openwrt.iitii.me:443;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;  </span><br><span class="line">    rewrite ^(.*) https://$host<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name china.iitii.me;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/china.iitii.me/pem.pem;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/china.iitii.me/key.key;</span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">    location ~* ^/bot &#123;</span><br><span class="line">     <span class="comment">## dns必须写，不然会报502错误</span></span><br><span class="line">     resolver 8.8.8.8;</span><br><span class="line">     proxy_buffering off;</span><br><span class="line">     proxy_pass  https://api.telegram.org<span class="variable">$request_uri</span>;</span><br><span class="line">     proxy_http_version 1.1;</span><br><span class="line">     <span class="comment"># 不能设置 proxy header 否则无返回</span></span><br><span class="line">     <span class="comment"># proxy_set_header Host $host;</span></span><br><span class="line">     proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">     proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass https://iitii;</span><br><span class="line">        proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Real_IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header User-Agent <span class="variable">$http_user_agent</span>;</span><br><span class="line">        proxy_set_header Accept-Encoding <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        proxy_buffering off;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><ul><li><a href="https://iitii.github.io/2019/04/06/1/">WebServer 基本配置文件</a></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnBhbnBpbGkuY29tLzIwMjIvY2xvdWQvcmV2ZXJzZS1wcm94eS1mb3ItdGctYm90Lw==">https://blog.panpili.com/2022/cloud/reverse-proxy-for-tg-bot/<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> proxy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tg </tag>
            
            <tag> proxy </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 局域网广播主机名</title>
      <link href="/2022/12/25/1/"/>
      <url>/2022/12/25/1/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul><li>比如下面的样子, 只显示匿名主机, 不像 windows 一样显示主机名</li></ul><p><img src="/images/Linux/mdns/1.png" alt="alt"></p><h2 id="修复步骤"><a href="#修复步骤" class="headerlink" title="修复步骤"></a>修复步骤</h2><blockquote><p>因为 smaba 使用的是 netbios 进行发现, 所以就往这方向弄了  </p></blockquote><ol><li>修改 hostname 为 .local, 比如 dev.local. <code>hostnamectl set-hostname dev.local</code></li><li>修改需广播的主机 hosts 文件, 添加: <code>127.0.0.1 dev.local</code> 之类的映射</li><li>安装 netbios 软件: <code>apt install nbtscan</code></li><li>扫描内网: <code>nbtscan 192.168.0.1/16</code></li><li>路由器更新这个列表可能比较慢, 可以过段时间再回来检查</li></ol><blockquote><p>扫描的时候可能会造成网络波动,  需注意…  </p></blockquote><p><img src="/images/Linux/mdns/2.png" alt="alt"></p><blockquote><p>看到其他的也有说用 mdns 的方式, 安装 avahi 进行多播, 未验证, 详见 <a href="#ref">Ref</a>  </p></blockquote><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9ub3Rlcy5sZWNvbmlvdC5jb20vbWRucy5odG1s">https://notes.leconiot.com/mdns.html<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cudjJleC5jb20vdC83OTE3MTE=">https://www.v2ex.com/t/791711<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> netbios </tag>
            
            <tag> mdns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenCore 引导完美升级</title>
      <link href="/2022/11/17/1/"/>
      <url>/2022/11/17/1/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/macos/bmac/oc/oc.png" alt="oc"></p><ol><li>备份原有 OC (做好回滚的准备</li><li>下载新版 OpenCore <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FjaWRhbnRoZXJhL09wZW5Db3JlUGtnL3JlbGVhc2Vz">https://github.com/acidanthera/OpenCorePkg/releases<i class="fa fa-external-link-alt"></i></span></li><li>将 1, 3, 4 里面的文件使用新版进行替换<ol><li>4 里面的文件严格来说并不需要, 只是留着方便使用</li><li>不追求完美到这就可以收工了</li></ol></li><li>将 OC 复制到 U 盘 EFI<ol><li>U 盘格式化可以使用: <code>diskutil list &amp;&amp; diskutil eraseDisk HFS+ usbefi /dev/$&#123;identifier&#125;</code></li><li>U 盘 EFI 挂载可以使用 OOC &gt; 工具 &gt; 挂载 EFI</li></ol></li></ol><p><img src="/images/macos/bmac/oc/ooc_efi.png" alt="oc"></p><ol start="5"><li>扫描配置文件, 使用 OOC 打开 U 盘 EFI 里面的配置文件</li><li>升级 ACPI, Drivers, Tools<ol><li><code>ACPI 设置</code>, 下载/更新, 选中需要更新的文件, 右侧选择 U 盘 EFI 分区, 点击下载</li><li><code>Misc &gt; Boot &gt; Tools-添加附加工具</code>, 下载/更新, 选中需要更新的文件, 右侧选择 U 盘 EFI 分区, 点击下载</li><li><code>UEFI &gt; UEFI 驱动</code>, 下载/更新, 选中需要更新的文件, 右侧选择 U 盘 EFI 分区, 点击下载</li><li>hfsplus.efi 找不到的话, 可以从之前的 OC 里面拷贝过来</li></ol></li></ol><p><img src="/images/macos/bmac/oc/ooc.png" alt="oc"></p><ol><li>遍历所有配置, 将 <code>未启用, 样例残留</code> 的配置进行删除(可选备份</li><li>对 kexts 进行升级(可选<ol><li><code>Kernel 设置</code>, 下载更新, 选中需要更新的文件, 左上角选择 U 盘 EFI 分区, 点击下载</li><li>可以使用 4 里面的 <code>acdtinfo</code> 来查看当前<code>部分安装的 kexts 的版本</code></li><li>如果 Kexts 文件夹或者其他地方, 有详细的 kexts 版本以及下载地址, 可以直接手动下载, 并替换</li><li>对于一些经过定义后的 kexts, 如: USBMap.kext, 触摸板相关. 保留原有的就可以了, 否则需要重新进行定制</li></ol></li><li>校验配置文件, <code>OOC &gt; 工具 &gt; Config 配置健全性检查</code>, 选择对应版本, 按输出信息对配置进行微调</li><li>开启日志输出到文件, <code>Misc &gt; Debug &gt; Target &gt; 启用记录到文件</code>, 验证后可以去掉勾选<ol><li>日志文件会输出到启动 OC 所在 EFI 分区根目录下</li><li>如果加载了<code>CrScreenshotDxe.efi</code> 驱动的话, 按 <code>**F10**</code> 会截屏保存到 EFI 分区根目录下</li></ol></li><li>重启加载新 OC, 一切正常即升级成功</li></ol><p><img src="/images/macos/bmac/oc/kexts.png" alt="oc"></p><h3 id="从-OC-Debug-版本切换到-Release"><a href="#从-OC-Debug-版本切换到-Release" class="headerlink" title="从 OC Debug 版本切换到 Release"></a>从 OC Debug 版本切换到 Release</h3><ul><li>下载对应版本的 Debug/Release  OC 文件</li><li>替换 1, 3 即可</li></ul><p><img src="/images/macos/bmac/oc/oc.png" alt="oc"></p>]]></content>
      
      
      <categories>
          
          <category> hack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenCore </tag>
            
            <tag> OC </tag>
            
            <tag> 0.8.6 </tag>
            
            <tag> 升级 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TG 获取Channel ID</title>
      <link href="/2022/09/28/1/"/>
      <url>/2022/09/28/1/</url>
      
        <content type="html"><![CDATA[<h2 id="直接使用-Channel-name"><a href="#直接使用-Channel-name" class="headerlink" title="直接使用 Channel name"></a>直接使用 Channel name</h2><blockquote><p>仅限于 public channel</p></blockquote><ol><li>假设该 public channel的邀请链接为: <code>t.me/public_chh</code></li><li><code>@public_chh</code>即为该 public channel 的 name</li><li>调用 sendMessage 之类的方法时, 将 <code>@public_chh</code> 作为 chat_id/uid 传入即可</li></ol><h2 id="从-TG-Web-URL-获取"><a href="#从-TG-Web-URL-获取" class="headerlink" title="从 TG Web URL 获取"></a>从 TG Web URL 获取</h2><ol><li>登陆 <span class="exturl" data-url="aHR0cHM6Ly93ZWIudGVsZWdyYW0ub3JnLw==">https://web.telegram.org<i class="fa fa-external-link-alt"></i></span></li><li>打开对应的 Channel, 如 <span class="exturl" data-url="aHR0cHM6Ly93ZWIudGVsZWdyYW0ub3JnLyMvaW0/cD1jMTA1NTU4NzExNl8xMTA1MjIyNDQwMjU0MTkxMDI1Nw==">https://web.telegram.org/#/im?p=c1055587116_11052224402541910257<i class="fa fa-external-link-alt"></i></span></li><li>其中 p 对应的值包含了 Channel ID, 加上 <code>-100</code>就是 Channel ID</li><li><code>c1055587116_11052224402541910257</code> ⇒ <code>1055587116</code> ⇒ <code>-1001055587116</code></li><li><code>-1001055587116</code> 即为该频道对应的 Channel ID</li></ol><h2 id="使用现成机器人获取"><a href="#使用现成机器人获取" class="headerlink" title="使用现成机器人获取"></a>使用现成机器人获取</h2><blockquote><p>可能会夹带私货, 需谨慎</p></blockquote><ol><li>邀请如 @get_id_bot 机器人进入对应群组, 自动发送 Channel ID</li><li>移除机器人</li><li>如果没有自动发送, 手动发送 <code>/my_id@get_id_bot</code> 获取ID</li></ol><h2 id="调用-TG-API"><a href="#调用-TG-API" class="headerlink" title="调用 TG API"></a>调用 TG API</h2><ol><li>新建机器人, 获取 token</li><li>邀请机器人进入对应 Channel</li><li>调用<code>https://api.telegram.org/bot[BOT_TOKEN]/sendMessage?chat_id=[channel_name]&amp;text=[MESSAGE_TEXT]</code>即可,具体内容需自行替换</li><li>如: <code>bot_token</code> 为 <code>123:AAAA</code>, <code>channel_name</code> 为<code>public_chh</code>,<code>MESSAGE_TEXT</code>为 <code>test</code> 实际应该请求: <code>https://api.telegram.org/bot123:AAAA/sendMessage?chat_id=@public_chh&amp;text=test</code></li><li>正常的话, 取返回值的 <code>result.chat.id</code> 或者 <code>result.sender_chat.id</code> 即可, 都是Channel ID的值</li></ol>]]></content>
      
      
      <categories>
          
          <category> TG </category>
          
          <category> BOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TG </tag>
            
            <tag> BOT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多显卡 Mac IDEA 2022.2 闪退</title>
      <link href="/2022/09/19/1/"/>
      <url>/2022/09/19/1/</url>
      
        <content type="html"><![CDATA[<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p><code>Help → Edit Custom VM Options…</code> 添加以下参数到文件尾部:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dsun.java2d.metal=false</span><br></pre></td></tr></table></figure><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>实际上这个问题已经出现很久了, 但是一直没有得到解决. 从错误堆栈可以看出问题在于 AMD 的 Metal 驱动. Metal 驱动是由 Apple 提供的, 随 MacOS 版本更新而更新, 而且一般不会体现在系统更新的提示中. 所以如果同时更新系统和 IDEA, 可能会觉得锅在 MacOS 上面, 等待新版更新或者回滚 IDEA.</p><p>最后在 jetbrain 问题中心找到了答案, <span class="exturl" data-url="aHR0cHM6Ly95b3V0cmFjay5qZXRicmFpbnMuY29tL2lzc3VlL0pCUi00NTMxL0pCUjE3LW1hY09TLVNJR1NFR1YtYXQtbGliYXd0bHdhd3RkeWxpYjB4OWQ5NTEtTVRMVmVydGV4Q2FjaGVGbHVzaEdseXBoVmVydGV4Q2FjaGU=">JBR-4531<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># A fatal error has been detected by the Java Runtime Environment:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  SIGABRT (0x6) at pc=0x00007ff80645900e, pid=40889, tid=61707</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># JRE version: OpenJDK Runtime Environment JBR-17.0.4+7-469.53-jcef (17.0.4+7) (build 17.0.4+7-b469.53)</span></span><br><span class="line"><span class="comment"># Java VM: OpenJDK 64-Bit Server VM JBR-17.0.4+7-469.53-jcef (17.0.4+7-b469.53, mixed mode, tiered, compressed oops, compressed class ptrs, g1 gc, bsd-amd64)</span></span><br><span class="line"><span class="comment"># Problematic frame:</span></span><br><span class="line"><span class="comment"># C  [libsystem_kernel.dylib+0x800e]  __pthread_kill+0xa</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># No core dump will be written. Core dumps have been disabled. To enable core dumping, try &quot;ulimit -c unlimited&quot; before starting Java again</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you would like to submit a bug report, please visit:</span></span><br><span class="line"><span class="comment">#   https://youtrack.jetbrains.com/issues/JBR</span></span><br><span class="line"><span class="comment"># The crash happened outside the Java Virtual Machine in native code.</span></span><br><span class="line"><span class="comment"># See problematic frame for where to report the bug.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">---------------  S U M M A R Y ------------</span><br><span class="line"></span><br><span class="line">Command Line: -Xms128m -Xmx750m -XX:ReservedCodeCacheSize=512m -XX:+UseG1GC -XX:SoftRefLRUPolicyMSPerMB=50 -XX:CICompilerCount=2 -XX:+HeapDumpOnOutOfMemoryError -XX:-OmitStackTraceInFastThrow -XX:+IgnoreUnrecognizedVMOptions -XX:CompileCommand=exclude,com/intellij/openapi/vfs/impl/FilePartNodeRoot,trieDescend -ea -Dsun.io.useCanonCaches=<span class="literal">false</span> -Dsun.java2d.metal=<span class="literal">true</span> -Djbr.catch.SIGABRT=<span class="literal">true</span> -Djdk.http.auth.tunneling.disabledSchemes=<span class="string">&quot;&quot;</span> -Djdk.attach.allowAttachSelf=<span class="literal">true</span> -Djdk.module.illegalAccess.silent=<span class="literal">true</span> -Dkotlinx.coroutines.debug=off -XX:ErrorFile=/Users/iitii/java_error_in_idea_%p.log -XX:HeapDumpPath=/Users/iitii/java_error_in_idea.hprof -Xmx4096m -Dide.no.platform.update=<span class="literal">true</span> -Dtoolbox.notification.token=hJl9isz3k7VuUyXPtj2VDWaNOWByb7IVHU4D5nKhmw4= -Dtoolbox.notification.portFile=/Users/iitii/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/222.4167.29/IntelliJ IDEA.app.vmoptions.port -Didea.plugins.path=/Users/iitii/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/222.4167.29/IntelliJ IDEA.app.plugins -Djb.vmOptionsFile=/Users/iitii/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/222.4167.29/IntelliJ IDEA.app.vmoptions --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens=java.base/java.nio.charset=ALL-UNNAMED --add-opens=java.base/java.text=ALL-UNNAMED --add-opens=java.base/java.time=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.base/java.util.concurrent.atomic=ALL-UNNAMED --add-opens=java.base/jdk.internal.vm=ALL-UNNAMED --add-opens=java.base/sun.nio.ch=ALL-UNNAMED --add-opens=java.base/sun.security.ssl=ALL-UNNAMED --add-opens=java.base/sun.security.util=ALL-UNNAMED --add-opens=java.desktop/com.apple.eawt=ALL-UNNAMED --add-opens=java.desktop/com.apple.eawt.event=ALL-UNNAMED --add-opens=java.desktop/com.apple.laf=ALL-UNNAMED --add-opens=java.desktop/java.awt=ALL-UNNAMED --add-opens=java.desktop/java.awt.dnd.peer=ALL-UNNAMED --add-opens=java.desktop/java.awt.event=ALL-UNNAMED --add-opens=java.desktop/java.awt.image=ALL-UNNAMED --add-opens=java.desktop/java.awt.peer=ALL-UNNAMED --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.desktop/javax.swing.plaf.basic=ALL-UNNAMED --add-opens=java.desktop/javax.swing.text.html=ALL-UNNAMED --add-opens=java.desktop/sun.awt.datatransfer=ALL-UNNAMED --add-opens=java.desktop/sun.awt.image=ALL-UNNAMED --add-opens=java.desktop/sun.awt=ALL-UNNAMED --add-opens=java.desktop/sun.font=ALL-UNNAMED --add-opens=java.desktop/sun.java2d=ALL-UNNAMED --add-opens=java.desktop/sun.lwawt=ALL-UNNAMED --add-opens=java.desktop/sun.lwawt.macosx=ALL-UNNAMED --add-opens=java.desktop/sun.swing=ALL-UNNAMED --add-opens=jdk.attach/sun.tools.attach=ALL-UNNAMED --add-opens=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED --add-opens=jdk.internal.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED --add-opens=jdk.jdi/com.sun.tools.jdi=ALL-UNNAMED -Dsplash=<span class="literal">true</span> -Didea.strict.classpath=<span class="literal">true</span> -Didea.jre.check=<span class="literal">true</span> -Didea.executable=idea -Didea.home.path=/Users/iitii/Library/Application Support/JetBrains/Toolbox/apps/IDEA-U/ch-0/222.4167.29/IntelliJ IDEA.app/Contents -Djava.system.class.loader=com.intellij.util.lang.PathClassLoader -Didea.paths.selector=IntelliJIdea2022.2 -Didea.vendor.name=JetBrains </span><br><span class="line"></span><br><span class="line">Host: <span class="string">&quot;iMac20,1&quot;</span> x86_64 4100 MHz, 12 cores, 32G, Darwin 21.6.0, macOS 12.5.1 (21G83)</span><br><span class="line">Time: Mon Sep 19 10:40:02 2022 CST elapsed time: 151.082012 seconds (0d 0h 2m 31s)</span><br><span class="line"></span><br><span class="line">---------------  T H R E A D  ---------------</span><br><span class="line"></span><br><span class="line">Current thread (0x00007fa6f18db000):  JavaThread <span class="string">&quot;Java2D Queue Flusher&quot;</span> daemon [_thread_in_native, <span class="built_in">id</span>=61707, stack(0x000070000c6a0000,0x000070000c7a0000)]</span><br><span class="line"></span><br><span class="line">Stack: [0x000070000c6a0000,0x000070000c7a0000],  sp=0x000070000c79f3d8,  free space=1020k</span><br><span class="line">Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)</span><br><span class="line">C  [libsystem_kernel.dylib+0x800e]  __pthread_kill+0xa</span><br><span class="line">C  [libsystem_c.dylib+0x81d24]  abort+0x7b</span><br><span class="line">C  [libsystem_c.dylib+0x810cb]  err+0x0</span><br><span class="line">C  [AMDMTLBronzeDriver+0x199a8a]  _Z28amdMtlBronzeCmdBufUpdateRsrcP19BronzeCmdBufInfoRecP18MTLIOAccelResourcejj.cold.1+0x23</span><br><span class="line">C  [AMDMTLBronzeDriver+0x7f3bd]  _Z33amdMtlBronzeCmdBufAddIndirectRsrcP19BronzeCmdBufInfoRecP18MTLIOAccelResourcejb+0x0</span><br><span class="line">C  [AMDMTLBronzeDriver+0x96a78]  _ZL21amdMtl_HWL_SetTextureIL15AMDMtl_SqttMode0EEvP32BronzeRenderCmdEncoderMembersRecjPU21objcproto10MTLTexture11objc_objectjj+0x4b</span><br><span class="line">C  [libawt_lwawt.dylib+0xa1544]  MTLVertexCache_AddGlyphQuad+0x84</span><br><span class="line">C  [libawt_lwawt.dylib+0x9dcaf]  MTLTR_DrawGlyphList+0x90f</span><br><span class="line">C  [libawt_lwawt.dylib+0x99150]  Java_sun_java2d_metal_MTLRenderQueue_flushBuffer+0x1020</span><br><span class="line">J 21692  sun.java2d.metal.MTLRenderQueue.flushBuffer(JI)V java.desktop (0 bytes) @ 0x0000000123c5d955 [0x0000000123c5d8a0+0x00000000000000b5]</span><br></pre></td></tr></table></figure><h2 id="Refers"><a href="#Refers" class="headerlink" title="Refers"></a>Refers</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly95b3V0cmFjay5qZXRicmFpbnMuY29tL2lzc3VlL0pCUi00NTMxL0pCUjE3LW1hY09TLVNJR1NFR1YtYXQtbGliYXd0bHdhd3RkeWxpYjB4OWQ5NTEtTVRMVmVydGV4Q2FjaGVGbHVzaEdseXBoVmVydGV4Q2FjaGU=">JBR-4531<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> IDEA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
            <tag> Java2D Queue Flusher </tag>
            
            <tag> AMDMTLBronzeDriver </tag>
            
            <tag> MTLVertexCache </tag>
            
            <tag> libawt_lwawt.dylib </tag>
            
            <tag> JBR 17 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K40 刷入 MIUI EU 并本地化</title>
      <link href="/2022/07/21/1/"/>
      <url>/2022/07/21/1/</url>
      
        <content type="html"><![CDATA[<div class="note warning">            <ul><li>刷机10分钟，恢复两三天</li></ul>          </div><h1 id="K40-刷入-MIUI-EU-并本地化"><a href="#K40-刷入-MIUI-EU-并本地化" class="headerlink" title="K40 刷入 MIUI EU 并本地化"></a>K40 刷入 MIUI EU 并本地化</h1><h2 id="解锁BL"><a href="#解锁BL" class="headerlink" title="解锁BL"></a>解锁BL</h2><blockquote><p>见 <a href="https://iitii.github.io/2022/07/13/1/">红米K40 国际版刷机</a></p></blockquote><h2 id="支持的设备"><a href="#支持的设备" class="headerlink" title="支持的设备"></a>支持的设备</h2><p><img src="https://provider.xiaomi.eu/img/devices_stable_22071721.png" alt="https://provider.xiaomi.eu/img/devices_stable_22071721.png"></p><h2 id="下载工具以及镜像"><a href="#下载工具以及镜像" class="headerlink" title="下载工具以及镜像"></a>下载工具以及镜像</h2><ul><li>platform-tools(adb): <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL3JlbGVhc2VzL3BsYXRmb3JtLXRvb2xz">https://developer.android.com/studio/releases/platform-tools<i class="fa fa-external-link-alt"></i></span><ul><li>mac: <code>brew install --cask android-platform-tools</code></li><li>如果不能在 <code>cli</code> 里面访问到 <code>adb</code> 之类的命令，请自行添加<strong>环境变量</strong></li></ul></li><li>MIUI解锁工具: <span class="exturl" data-url="aHR0cDovL3d3dy5taXVpLmNvbS91bmxvY2svaW5kZXguaHRtbA==">miui.com/unlock/<i class="fa fa-external-link-alt"></i></span></li><li>TWRP: <span class="exturl" data-url="aHR0cHM6Ly90d3JwLm1lL3hpYW9taS94aWFvbWlwb2NvZjMuaHRtbA==">https://twrp.me/xiaomi/xiaomipocof3.html<i class="fa fa-external-link-alt"></i></span><ul><li>美国镜像站：<span class="exturl" data-url="aHR0cHM6Ly9kbC50d3JwLm1lL2FsaW90aC8=">https://dl.twrp.me/alioth/<i class="fa fa-external-link-alt"></i></span></li><li>欧洲镜像站：<span class="exturl" data-url="aHR0cHM6Ly9ldS5kbC50d3JwLm1lL2FsaW90aC8=">https://eu.dl.twrp.me/alioth/<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Magisk:<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvcGpvaG53dS9NYWdpc2svcmVsZWFzZXM=">https://github.com/topjohnwu/Magisk/releases<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>欧洲版MIUI包(eu)：<span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz93PWZpbGVzJmZsaWQ9MzMxNTAy">https://androidfilehost.com/?w=files&amp;flid=331502<i class="fa fa-external-link-alt"></i></span><ul><li>打开搜索 K40, POCO_F3</li><li><span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz9maWQ9MTU2NjQyNDg1NjUxOTcxODAyMDY=">https://androidfilehost.com/?fid=15664248565197180206<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Magisk模块<ul><li>SafetyNet(网飞检测)：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tkcmFnMG4vc2FmZXR5bmV0LWZpeA==">https://github.com/kdrag0n/safetynet-fix<i class="fa fa-external-link-alt"></i></span></li><li>Zygisk：无需额外下载</li></ul></li></ul><blockquote><p>国际版没有通话录音、来电拦截、短信拦截之类的功能，没法用。EU版用的是小米自带的拨号和联系人，支持通话录音</p></blockquote><h2 id="刷入"><a href="#刷入" class="headerlink" title="刷入"></a>刷入</h2><blockquote><p>刷机10分钟，恢复两三天</p></blockquote><ol><li>解压 fastboot 刷机包</li><li>手机重启到 fastboot：<code>adb reboot fastboot</code></li><li>因为这次是从国际版刷机包EU版，所以备份数据+双清稳一点<ol><li>不保留数据：<code>windows_fastboot_first_install_with_data_format.bat</code> </li><li>保留数据：<code>windows_fastboot_update_rom.bat</code></li></ol></li><li>等待命令跑完，刷机完成</li><li>初始化+备份恢复</li></ol><h2 id="必要操作"><a href="#必要操作" class="headerlink" title="必要操作"></a>必要操作</h2><h3 id="隐藏应用列表"><a href="#隐藏应用列表" class="headerlink" title="隐藏应用列表"></a>隐藏应用列表</h3><blockquote><p>这次没整反正也没用</p></blockquote><h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><blockquote><p>eu 版用的 MIUI 的拨号和联系人，可以正常恢复。再加 Ti备份之类的就更靠谱了</p></blockquote><ol><li>系统设置 里面直接搜索 备份，就能找到备份与恢复 app</li><li>将之前备份的文件拷贝回手机</li><li>恢复</li></ol><blockquote><p>下面操作和之前是一样的</p></blockquote><h3 id="Magisk"><a href="#Magisk" class="headerlink" title="Magisk"></a>Magisk</h3><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly90b3Bqb2hud3UuZ2l0aHViLmlvL01hZ2lzay9pbnN0YWxsLmh0bWw=">https://topjohnwu.github.io/Magisk/install.html<i class="fa fa-external-link-alt"></i></span></p></blockquote><ol><li>adb install Magisk App 或者拷贝后手动安装</li><li>打开卡刷包，找 boot.img，拷贝到手机</li><li>Magisk App点击Magisk，手动选择刚刚拷贝的 boot.img，运行完成后应该会生成一个 patch.img 文件</li><li>拷贝patch.img 文件到电脑</li><li>进 bootloader</li><li>先尝试使用 patch.img 文件是否可以正常启动</li><li>可以正常启动后将 patch.img 文件刷入 boot 分区</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 magisk apk</span></span><br><span class="line"><span class="comment">#从线刷包里面找到 boot.img</span></span><br><span class="line"><span class="comment">#进magisk app生成 patch img</span></span><br><span class="line"><span class="comment">#adb shell 修改patch文件名称</span></span><br><span class="line"><span class="comment">#拷贝到电脑</span></span><br><span class="line">adb pull sdcard/Download/magisk_patched.img</span><br><span class="line"><span class="comment"># https://sspai.com/post/67932</span></span><br><span class="line">adb reboot bootloader</span><br><span class="line">fastboot boot magisk_patched.img</span><br><span class="line">fastboot flash boot magisk_patched.img</span><br></pre></td></tr></table></figure><h3 id="安装-Zygisk"><a href="#安装-Zygisk" class="headerlink" title="安装 Zygisk"></a>安装 Zygisk</h3><ol><li>Magisk App点击设置</li><li>勾选在 Zygisk 里面运行 Magisk</li><li>自动下载，安装</li><li>重启</li></ol><h3 id="SafetyNet"><a href="#SafetyNet" class="headerlink" title="SafetyNet"></a>SafetyNet</h3><ol><li>下载 zip 包到手机</li><li>Magisk里面选择安装，重启</li><li>基本检测通过大概率没啥问题</li></ol><h3 id="Magisk-Root-隐藏"><a href="#Magisk-Root-隐藏" class="headerlink" title="Magisk/Root 隐藏"></a>Magisk/Root 隐藏</h3><ol><li>Magisk App点击设置</li><li>不勾选”遵守排除列表“</li><li>点击 ”配置排除列表“</li><li>搜索需要隐藏的软件（大部分时候是银行App和金融App</li></ol><blockquote><p>一个App有很多项进程，都需要勾上，点击即可展开，再点击勾选即可全选。</p></blockquote><h2 id="MIUI-本地化"><a href="#MIUI-本地化" class="headerlink" title="MIUI 本地化"></a>MIUI 本地化</h2><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy8xODQ=">MIUI EU 欧洲版 本地化 Magisk 模块 - Koizumi’s Blog<i class="fa fa-external-link-alt"></i></span></p><ul><li>下载 V13 开头的那个 700M+ 的zip包</li><li>magisk 选择安装这个zip</li><li>使用音量键进行选择选项</li><li>刷入重启</li></ul><p><img src="/images/flash/alioth/0.png" alt="img"></p><h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9uaWNlYm93bC5mdW4vMzg=">https://nicebowl.fun/38<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy8xODQ=">https://blog.minamigo.moe/archives/184<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly94aWFvbWkuZXUvY29tbXVuaXR5L3RocmVhZHMvbWl1aS0xMy1zdGFibGUtcmVsZWFzZS42NDQ0MS8=">https://xiaomi.eu/community/threads/miui-13-stable-release.64441/<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> 刷机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 刷机 </tag>
            
            <tag> alioth </tag>
            
            <tag> MIUI EU </tag>
            
            <tag> 本地化 </tag>
            
            <tag> 欧洲版 </tag>
            
            <tag> xiaomi.eu </tag>
            
            <tag> magisk </tag>
            
            <tag> zygisk </tag>
            
            <tag> root隐藏 </tag>
            
            <tag> magisk隐藏 </tag>
            
            <tag> SafetyNet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedMi Note8 刷入 EU 版并解锁分区</title>
      <link href="/2022/07/18/1/"/>
      <url>/2022/07/18/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>个人刷机记录，方便查阅</p></blockquote><blockquote><p>一开始想的是直接按照K40的刷入方法直接照搬就行，结果一堆坑，浪费一天时间。</p></blockquote><h2 id="检查设备环境"><a href="#检查设备环境" class="headerlink" title="检查设备环境"></a>检查设备环境</h2><h3 id="现有"><a href="#现有" class="headerlink" title="现有"></a>现有</h3><ul><li>RedMi Note8</li><li>国内版：MIUI 12.5.4</li><li>Android 11</li></ul><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ul><li>EU版：MIUI 12.5.x</li><li>magisk</li><li>lsposed</li><li>root</li><li>Android 11</li></ul><h2 id="检查-xiaomi-eu-看看设备是否支持"><a href="#检查-xiaomi-eu-看看设备是否支持" class="headerlink" title="检查 xiaomi.eu 看看设备是否支持"></a>检查 <span class="exturl" data-url="aHR0cDovL3hpYW9taS5ldS8=">xiaomi.eu<i class="fa fa-external-link-alt"></i></span> 看看设备是否支持</h2><blockquote><p>查看设备代码</p></blockquote><ul><li>打开 USB 调试</li><li>输入 adb shell</li><li>如下 <code>ginkgo</code> 即为设备编号</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">ginkgo:/ $</span><br></pre></td></tr></table></figure><blockquote><p>检查目标版本是否支持该设备</p></blockquote><ul><li>打开 xiaomi.eu：<span class="exturl" data-url="aHR0cHM6Ly94aWFvbWkuZXUvY29tbXVuaXR5L3RocmVhZHMvbWl1aS0xMi0wLTEyLTEtMTItMi0xMi01LXN0YWJsZS1yZWxlYXNlLjU2MTkxLw==">https://xiaomi.eu/community/threads/miui-12-0-12-1-12-2-12-5-stable-release.56191/<i class="fa fa-external-link-alt"></i></span></li><li>如下图：支持该设备以 <code>Recovery</code> 方式刷入</li></ul><p><img src="/images/flash/ginkgo/0.png" alt="img"></p><h2 id="解锁BL"><a href="#解锁BL" class="headerlink" title="解锁BL"></a>解锁BL</h2><ul><li>不管刷不刷，有没有想好，申请解锁就行了。</li><li>因为有资格之后需要用 MIUI unlock 去手动解锁，才会清除数据。<ul><li>手机登陆MIUI账号</li><li>打开开发者设置，搜索设备解锁状态，点击绑定</li><li>绑定7天后即可进入下一步解锁</li></ul></li></ul><blockquote><p>注意：重复绑定、退出MIUI账号或者拔掉手机卡，时间会重新计算。</p></blockquote><h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><ul><li>使用自带的备份与恢复对手机进行备份</li><li>使用TI备份之类的对手机进行备份</li><li>将手机里面的重要数据手动传输到其他设备，如电脑。</li></ul><h3 id="解锁"><a href="#解锁" class="headerlink" title="解锁"></a>解锁</h3><ol><li>手机充满电</li><li>访问 <span class="exturl" data-url="aHR0cDovL3d3dy5taXVpLmNvbS91bmxvY2svaW5kZXguaHRtbA==">miui.com/unlock/<i class="fa fa-external-link-alt"></i></span></li><li>下载解锁工具（Windows Only）</li><li>解压启动解锁工具</li><li>更新解锁工具</li><li>点击工具设置，检测\安装 USB 驱动</li><li>登陆小米账号，进入解锁页面</li><li>手机打开adb调试，<code>adb reboot fastboot</code> 进入 fastboot（你也可以用手按</li><li>如果解锁工具显示未检测到手机，拔插多试试就行</li><li>解锁后手机第一次启动时间可能比较久，正常情况</li></ol><h2 id="下载工具以及镜像"><a href="#下载工具以及镜像" class="headerlink" title="下载工具以及镜像"></a>下载工具以及镜像</h2><ul><li>platform-tools(adb): <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL3JlbGVhc2VzL3BsYXRmb3JtLXRvb2xz">https://developer.android.com/studio/releases/platform-tools<i class="fa fa-external-link-alt"></i></span><ul><li>mac: <code>brew install --cask android-platform-tools</code></li><li>如果不能在 <code>cli</code> 里面访问到 <code>adb</code> 之类的命令，请自行添加<strong>环境变量</strong></li></ul></li><li>MIUI解锁工具: <span class="exturl" data-url="aHR0cDovL3d3dy5taXVpLmNvbS91bmxvY2svaW5kZXguaHRtbA==">miui.com/unlock/<i class="fa fa-external-link-alt"></i></span></li><li>Twrp<ul><li><span class="exturl" data-url="aHR0cHM6Ly9kbC50d3JwLm1lL2dpbmtnby90d3JwLTMuNS4yXzEwLTItZ2lua2dvLmltZy5odG1s">https://dl.twrp.me/ginkgo/twrp-3.5.2_10-2-ginkgo.img.html<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>安卓版本必须对应，否则卡启动。这个 Twrp 可用于 android 11</p></blockquote><ul><li><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS54ZGEtZGV2ZWxvcGVycy5jb20vdC9yZWNvdmVyeS1vZmZpY2lhbC10ZWFtd2luLXJlY292ZXJ5LXJlZG1pLW5vdGUtOC40MzAxMzkzLw==">https://forum.xda-developers.com/t/recovery-official-teamwin-recovery-redmi-note-8.4301393/<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><p><img src="/images/flash/ginkgo/1.png" alt="img"></p><ul><li>Recovery<ul><li><span class="exturl" data-url="aHR0cHM6Ly9vcmFuZ2Vmb3guZG93bmxvYWQvemgtQ04vZGV2aWNlL2dpbmtnbw==">https://orangefox.download/zh-CN/device/ginkgo<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Magisk<ul><li><strong>必须下载 Magisk 23.0</strong></li><li><span class="exturl" data-url="aHR0cHM6Ly9tYWdpc2thcHAuY29tL3ppcC8=">https://magiskapp.com/zip/<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>下载分区解密工具<ul><li><span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz9maWQ9MjE4ODgxODkxOTY5Mzc4NTg5OQ==">Disable_Dm-Verity_ForceEncrypt_20210320.zip<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><blockquote><p>是个支持的官方线刷包就行</p></blockquote><ul><li>MIUI 国际版fastboot包：<span class="exturl" data-url="aHR0cHM6Ly94aWFvbWlyb20uY29tL3JvbS9yZWRtaS1ub3RlLTgtZ2lua2dvLWV1cm9wZS1mYXN0Ym9vdC1yZWNvdmVyeS1yb20vIyVFNCVCOCU4QiVFOCVCRCVCRC0lRTclQkElQTIlRTclQjElQjMtbm90ZS04LSVFNyVBOCVCMyVFNSVBRSU5QSVFNyU4OSU4OC1mYXN0Ym9vdC0lRTclQkElQkYlRTUlODglQjclRTUlOEMlODU=">https://xiaomirom.com/rom/redmi-note-8-ginkgo-europe-fastboot-recovery-rom/#下载-红米-note-8-稳定版-fastboot-线刷包<i class="fa fa-external-link-alt"></i></span></li><li>Note8 EU包：<span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz93PWZpbGVzJmZsaWQ9MzIxMzMx">https://androidfilehost.com/?w=files&amp;flid=321331<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>注意 Note8 和 Note8T 的区别</p></blockquote><p><img src="/images/flash/ginkgo/2.png" alt="img"></p><h2 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h2><ul><li>请再次确认一遍，必要数据已经完全备份了</li></ul><h3 id="修改-fastboot-脚本"><a href="#修改-fastboot-脚本" class="headerlink" title="修改 fastboot 脚本"></a>修改 fastboot 脚本</h3><ul><li>解压国际版 MIUI 12.5.x fastboot 包</li><li>解压上面下载的 <code>orangefox recovery</code>，使用该 <code>recovery.img</code> <strong>替换</strong> fastboot 刷机包 <code>images</code> 文件里面 <code>recovery.img</code></li><li>修改 <code>flash_all.bat</code>, 将 <code>fastboot %* reboot</code> 命令移到 <code>pause</code> 后面并添加提示信息</li></ul><p><img src="/images/flash/ginkgo/3.png" alt="img"></p><h3 id="重启进-fastboot-模式进行刷入"><a href="#重启进-fastboot-模式进行刷入" class="headerlink" title="重启进 fastboot 模式进行刷入"></a>重启进 fastboot 模式进行刷入</h3><ul><li><code>adb reboot fastboot</code></li><li>双击 <code>flash_all.bat</code> 进行刷入</li><li>刷入完成后手动按下 <code>电源键+音量上键</code> <strong>强制重启</strong>进 <code>recovery</code></li></ul><h3 id="分区解密"><a href="#分区解密" class="headerlink" title="分区解密"></a>分区解密</h3><ol><li>重启进 recovery 后，找到 Format data，直接格式化数据分区</li><li>再一次重启进入 recovery</li><li>插上数据线，将之前下载的 magisk.zip 和 Disable_Dm-Verity_ForceEncrypt_20210320.zip 拷贝进手机</li><li>顺序刷入 Magisk 和 Disable_Dm-Verity_ForceEncrypt_20210320.zip</li><li>重启进系统完成安装</li></ol><blockquote><p>注意，完成安装时 <code>务必设置锁屏密码</code></p></blockquote><h3 id="Recovery-模式刷入-EU-版-MIUI"><a href="#Recovery-模式刷入-EU-版-MIUI" class="headerlink" title="Recovery 模式刷入 EU 版 MIUI"></a>Recovery 模式刷入 EU 版 MIUI</h3><ol><li>重启进 Recovery</li><li>双清（清除data分区</li><li>再一次重启进入 recovery</li><li>拷贝 EU 版系统进手机并刷入</li><li>再一次重启进入 recovery</li><li>找到 Format data，直接格式化数据分区</li><li>插上数据线，将之前下载的 magisk.zip 和 Disable_Dm-Verity_ForceEncrypt_20210320.zip 拷贝进手机</li></ol><ul><li>顺序刷入 Magisk 和 Disable_Dm-Verity_ForceEncrypt_20210320.zip</li><li>重启进系统完成安装</li></ul><blockquote><p>注意，完成安装时 <code>务必设置锁屏密码</code>。刷机后的 <code>SafetyNet</code> 之类的操作参考 <a href="https://iitii.github.io/2022/07/13/1/">K40 刷机后的操作</a>。</p></blockquote><blockquote><p>认准 <code>MIUI by xiaomi.eu</code></p></blockquote><blockquote><p>其实按理来说可以在分区解密的第三步拷入 EU 版 MIUI 包，直接跳到 <code>Recovery 模式刷入 EU 版 MIUI</code>。但是这个我并没有尝试，勇士可以冲一波~</p></blockquote><img src="/images/flash/ginkgo/4.png" alt="img" style="width:400px;min-width:300px;margin-left: auto;"><h2 id="一些吐槽"><a href="#一些吐槽" class="headerlink" title="一些吐槽"></a>一些吐槽</h2><ul><li>内置的Recovery是个垃圾，什么功能都没有。只有双清，重启</li><li>小米手机助手也是垃圾，只能刷官方包，算了吧。屌用没有</li><li>EU版虽然是第三方民间团队在维护。但是根据个人体验，比国际版和国内版这些臭鱼烂虾要好多了. 比如默认开启 USB 调试，桌面布局默认可调整至 7x7，MIUI自带的拨号和短信带拦截功能体验比Google的好，就留下来了…</li><li>国际版的 GetApps 是个什么玩意，包名 com.xiaomi.packs 默认还把 <span class="exturl" data-url="aHR0cDovL2NvbS54aWFvbWkubWFya2V0Lw==">com.xiaomi.market<i class="fa fa-external-link-alt"></i></span> 这个包名给占用了，无法直接安装国内版应用商店。应该是小米故意用来恶心刷国际版用户的。</li></ul><div class="note warning">            <p>还是那句话：问就是别用，买就是别买</p>          </div><h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9tYWdpc2thcHAuY29tL3ppcC8=">https://magiskapp.com/zip/<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9vcmFuZ2Vmb3guZG93bmxvYWQvemgtQ04vZGV2aWNlL2dpbmtnbw==">https://orangefox.download/zh-CN/device/ginkgo<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS54ZGEtZGV2ZWxvcGVycy5jb20vdC9yZWNvdmVyeS1vZmZpY2lhbC10ZWFtd2luLXJlY292ZXJ5LXJlZG1pLW5vdGUtOC40MzAxMzkzLw==">https://forum.xda-developers.com/t/recovery-official-teamwin-recovery-redmi-note-8.4301393/<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS54ZGEtZGV2ZWxvcGVycy5jb20vdC9yb20tb2ZmaWNpYWwtZ2lua2dvLXdpbGxvdy1waXhlbC1leHBlcmllbmNlLTExLTAuNDI0NzQzNS9wYWdlLTI1I3Bvc3QtODUyNzEyMDE=">https://forum.xda-developers.com/t/rom-official-ginkgo-willow-pixel-experience-11-0.4247435/page-25#post-85271201<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> 刷机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 刷机 </tag>
            
            <tag> Note8 </tag>
            
            <tag> ginkgo </tag>
            
            <tag> xda </tag>
            
            <tag> orangefox recovery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OhShape 导入自定义歌曲</title>
      <link href="/2022/07/15/1/"/>
      <url>/2022/07/15/1/</url>
      
        <content type="html"><![CDATA[<p>一开始其实我对这个问题，是感觉比较疑惑的??? 多看了几个帖子才知道其实主要问题并不是在于歌曲怎么放到指定的目录，而是放进去没反应，看不到。。。</p><p>其实玩过切方块，节奏光剑，维京战鼓等音游的老玩家可能都知道，这些里面的歌曲导入是有曲包的，并不是随随便便下载个 MP3 之类的音频文件丢到对应目录就能直接开玩的。</p><p>那除了下载的曲包，我可以自己制作吗？当然是可以的。</p><h1 id="入门版"><a href="#入门版" class="headerlink" title="入门版"></a>入门版</h1><blockquote><p>总的做法的话分以下几步</p></blockquote><ol><li>下载曲包</li><li>解压曲包</li><li>准备好一体机</li><li>拷贝解压后文件到指定歌曲目录</li><li>打开游戏</li><li>结束</li></ol><h2 id="曲包下载方式"><a href="#曲包下载方式" class="headerlink" title="曲包下载方式"></a>曲包下载方式</h2><blockquote><p><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS8=">http://ohshapes.com/<i class="fa fa-external-link-alt"></i></span></p></blockquote><ul><li>推荐去这个网站自己下载想要的歌曲，点击 preview 即可预览，如果介绍里面有 Mapping preview 的话，大概率是有体验视频的，可以先看看大神们怎么玩。</li><li>这里的话直接点击<code>Download</code>就可以把曲包下载下来了</li></ul><p><img src="/images/vr/ohshape/import/0.png" alt="img"></p><p><img src="/images/vr/ohshape/import/1.png" alt="img"></p><h2 id="一些推荐的歌曲"><a href="#一些推荐的歌曲" class="headerlink" title="一些推荐的歌曲"></a>一些推荐的歌曲</h2><blockquote><p>节奏感比较强，按需导入哦</p></blockquote><ul><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzI3Zg==">EVERYBODY! EVERYBODY!<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzIxZg==">Here With Me - Marshmello<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzI2">Rockefellerstreet<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><ul><li>下载下来的文件都在 zip 包，直接双击就可以解压了，或者用其他的解压缩软件都行</li></ul><p><img src="/images/vr/ohshape/import/2.png" alt="img"></p><h3 id="一体机准备"><a href="#一体机准备" class="headerlink" title="一体机准备"></a>一体机准备</h3><ul><li>一体机开机</li><li>设置安全区</li><li>“进入VR世界”</li><li>将一体机的充电线的 USB 口插到电脑上</li></ul><blockquote><p>期间可能需要多次尝试，直到电脑上面可以看到文件列表，就可以开始导入了</p></blockquote><h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><ul><li>将上面解压重命名的文件复制到一体机的 OhShape/Songs 文件夹下面即可</li></ul><blockquote><p>提示：不清楚路径的可以看看截图的标题栏</p></blockquote><ul><li>一体机打开OhShape</li><li>点击定制歌曲即可看到导入的歌曲</li><li>再点进去就可以选择进行游戏了</li></ul><p><img src="/images/vr/ohshape/import/3.png" alt="img"></p><p><img src="/images/vr/ohshape/import/4.png" alt="img"></p><p><img src="/images/vr/ohshape/import/0.jpeg" alt="img"></p><h1 id="进阶版"><a href="#进阶版" class="headerlink" title="进阶版"></a>进阶版</h1><blockquote><p>进阶版部分的一些链接可能打不开，问题不大</p></blockquote><blockquote><p>这里假设你已经完全看完入门版部分了</p></blockquote><h2 id="曲包下载方式-1"><a href="#曲包下载方式-1" class="headerlink" title="曲包下载方式"></a>曲包下载方式</h2><blockquote><p><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS8=">http://ohshapes.com/<i class="fa fa-external-link-alt"></i></span></p></blockquote><ul><li>同上</li></ul><h2 id="一些推荐的歌曲-1"><a href="#一些推荐的歌曲-1" class="headerlink" title="一些推荐的歌曲"></a>一些推荐的歌曲</h2><blockquote><p>这里补充一下预览链接</p></blockquote><ul><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzI3Zg==">EVERYBODY! EVERYBODY!<i class="fa fa-external-link-alt"></i></span><ul><li>preview: <span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9OZmFGT3A1T3FiSQ==">https://youtu.be/NfaFOp5OqbI<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzIxZg==">Here With Me - Marshmello<i class="fa fa-external-link-alt"></i></span><ul><li>preview: <span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9xbTd2YmJUWDNqRQ==">https://youtu.be/qm7vbbTX3jE<i class="fa fa-external-link-alt"></i></span></li></ul></li><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS9iZWF0bWFwLzI2">Rockefellerstreet<i class="fa fa-external-link-alt"></i></span><ul><li>preview: <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1RRzRZSjVtS0Nvaw==">https://www.youtube.com/watch?v=QG4YJ5mKCok<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><h2 id="歌曲导入"><a href="#歌曲导入" class="headerlink" title="歌曲导入"></a>歌曲导入</h2><blockquote><p>主要方式和上面一致，但是你可能已经发现了，导入的歌曲会有随机字符开头和括号.</p></blockquote><blockquote><p>这些东西对可能会影响歌曲名的展示，因为游戏内侧栏的宽度是固定的，所以我们可以对其进行重命名</p></blockquote><p><img src="/images/vr/ohshape/import/5.png" alt="img"></p><blockquote><p>这块直接手动重命名，或者写点代码弄个脚本都可以，不过度展开</p></blockquote><ul><li>以 NodeJS 为例（需要<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvcmV5YnV0bGVyL252bS13aW5kb3dz">预安装Node<i class="fa fa-external-link-alt"></i></span></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>),</span><br><span class="line">path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readdirSync</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">.<span class="title function_">filter</span>(<span class="function"><span class="params">_</span> =&gt;</span> fs.<span class="title function_">statSync</span>(_).<span class="title function_">isDirectory</span>())</span><br><span class="line">.<span class="title function_">forEach</span>(<span class="function"><span class="params">f</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> newF = f.<span class="title function_">replace</span>(<span class="regexp">/[\s\S]*\(/g</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/\)[\s\S]*/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;f&#125;</span> =&gt; <span class="subst">$&#123;newF&#125;</span>`</span>);</span><br><span class="line">    fs.<span class="title function_">renameSync</span>(f, newF)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>重命名之后</li></ul><p><img src="/images/vr/ohshape/import/6.png" alt="img"></p><h3 id="一体机准备-1"><a href="#一体机准备-1" class="headerlink" title="一体机准备"></a>一体机准备</h3><ul><li>同上</li></ul><h3 id="从MAC电脑导入"><a href="#从MAC电脑导入" class="headerlink" title="从MAC电脑导入"></a>从MAC电脑导入</h3><blockquote><p>Mac的话由于不能直接读取安卓文件所以需要先安装额外工具<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5kcm9pZC5jb20vZmlsZXRyYW5zZmVyLw==">Android File Transfer<i class="fa fa-external-link-alt"></i></span></p></blockquote><p><img src="/images/vr/ohshape/import/7.png" alt="img"></p><ul><li>下载安装 <span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5kcm9pZC5jb20vZmlsZXRyYW5zZmVyLw==">Android File Transfer<i class="fa fa-external-link-alt"></i></span></li><li>打开 <span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5kcm9pZC5jb20vZmlsZXRyYW5zZmVyLw==">Android File Transfer<i class="fa fa-external-link-alt"></i></span></li><li>将一体机的充电线的 USB 口插到电脑上</li></ul><p><img src="/images/vr/ohshape/import/8.png" alt="img"></p><h3 id="导入-1"><a href="#导入-1" class="headerlink" title="导入"></a>导入</h3><ul><li>将上面解压重命名的文件复制到一体机的 OhShape/Songs 文件夹下面即可</li></ul><blockquote><p>提示：不清楚路径的可以看看截图的标题栏</p></blockquote><ul><li>一体机打开OhShape</li><li>点击定制歌曲即可看到导入的歌曲</li><li>再点进去就可以选择进行游戏了</li></ul><p><img src="/images/vr/ohshape/import/9.png" alt="img"></p><h2 id="曲包制作"><a href="#曲包制作" class="headerlink" title="曲包制作"></a>曲包制作</h2><ul><li>需要先下载 OhShape Editor这个软件</li><li>下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL09kZGVyc0xhYi9PaFNoYXBlRWRpdG9yL3JlbGVhc2VzL2Rvd25sb2FkL3YuMS4wLjUvT2hTaGFwZUVkaXRvclYxLjAuNS56aXA=">OhShapeEditorV1.0.5<i class="fa fa-external-link-alt"></i></span></li><li>使用说明：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL09kZGVyc0xhYi9PaFNoYXBlRWRpdG9y">https://github.com/OddersLab/OhShapeEditor<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>这个软件应该是 <strong>仅支持Windows</strong> 的，歌曲源文件的话，可以随意去网上下载一些喜欢的歌</p></blockquote><blockquote><p>Mac用户<strong>实在不行</strong>也可以安装个Windows虚拟机</p></blockquote><ul><li>官方教程<ul><li>基本部分：<span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9HSUhyYmNYWm5hNA==">https://youtu.be/GIHrbcXZna4<i class="fa fa-external-link-alt"></i></span></li><li>高级部分：<span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9KTUNTSFU3WVY1VQ==">https://youtu.be/JMCSHU7YV5U<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><p><img src="/images/vr/ohshape/import/10.png" alt="img"></p><blockquote><p>这里也有之前别人写过的帖子可以参考一下：<span class="exturl" data-url="aHR0cHM6Ly9iYnMucGljb3ZyLmNvbS9wb3N0LzQwMzY5">https://bbs.picovr.com/post/40369<i class="fa fa-external-link-alt"></i></span></p></blockquote><h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><blockquote><p>收集于  <span class="exturl" data-url="aHR0cHM6Ly9iYnMucGljb3ZyLmNvbS9wb3N0LzcwOTA1Njc3NzU5MDczNDg1MTE=">OhShape 导入自定义歌曲<i class="fa fa-external-link-alt"></i></span> 评论区</p></blockquote><p>Q: 有没有中文歌曲的分享网站？有没有国内的分享社区?</p><p>A: 这个就不清楚了，国内这块目前还是算是小众吧。b站之前有看见自己编曲的，但是也没有分享</p><p>Q: 云盘、网盘下载完文件，直接导入是不是更简单？</p><p>A: 其实操作是一样的，，，只不过是别人帮你下好了曲包…</p><p>Q: 有一些链接打不开为什么还要放出来？</p><p>A: 1. 就算打不开也影响不大 2. 其实相对于其他游戏，VR 这块还是比较小众，放出原链接也是想让大神们受到更多关注，更有动力，还有这么多人一起关注VR. </p><p>Q: 这样导入就可以自行选择难度了？之前下载的曲包都是固定难度没法调</p><p>A: 不是哦，这个得看曲包里面有什么。有些有多个难度有些只有一个。比如说帖子里面第一张图，每个左下角都有 <code>easy</code> <code>medium</code> <code>hard</code> <code>expert</code>中的一个或多个，有几个就代表有几种难度</p><p>Q: 没电脑有办法吗?</p><p>A: =.= 额，pico 有自带浏览器，你在一体机里面操作也不是不行。直接下载、解压、拷贝、启动游戏就可以了（好不好操作另说</p><p>Q: 有没有视频教学版？</p><p>A: 目前可能没有时间弄这个，而且也略微麻烦点。Windows和Mac倒还好弄点，一体机就比较麻烦了，是不是还得把从开机到设置好插上电脑加导入才算完？</p><p>Q: 有更多的音乐资源分享吗?</p><p>A: 目前也仅知道 <span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS8=">http://ohshapes.com/<i class="fa fa-external-link-alt"></i></span> 这一个网站</p><p>Q: 我随便下载个 MP3 音频文件丢到对应目录能直接玩吗？</p><p>A: 不行的，详见文章开头</p><h1 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h1><ul><li><span class="exturl" data-url="aHR0cHM6Ly9vaHNoYXBldnIuY29tLw==">OhShape 官网<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL29oc2hhcGVzLmNvbS8=">OhShapes 曲包下载网站<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9BbjBSN21xVk96bw==">宅家玩游戏还能塑造身材 ! 《OhShape》墙来了 VR游戏指南<i class="fa fa-external-link-alt"></i></span></li></ul><iframe width="560" height="315" src="https://www.youtube.com/embed/An0R7mqVOzo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
      
      
      <categories>
          
          <category> game </category>
          
          <category> vr </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 导入自定义歌曲 </tag>
            
            <tag> ohshape </tag>
            
            <tag> vr </tag>
            
            <tag> game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker+Prometheus+Grafana监控VPS运行状态</title>
      <link href="/2022/07/14/1/"/>
      <url>/2022/07/14/1/</url>
      
        <content type="html"><![CDATA[<p>Prometheus是一个灵活的时间序列数据库和监控系统，有多个监控组件可用。Grafana是用于展示数据的平台。一起使用即可全方位监控VPS主机运行状态。</p><p>prometheus和grafana为简化安装步骤，这里直接使用docker.</p><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/images/prom/monitor.png" alt="img"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol><li>首先你要安装docker/docker-compose：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt -y update</span><br><span class="line">apt -y install curl</span><br><span class="line">curl -sSL https://get.docker.com/ | sh</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.25.4/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><ol start="2"><li>grafana.ini 从 <span class="exturl" data-url="aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2dyYWZhbmEvZ3JhZmFuYS9tYWluL2NvbmYvc2FtcGxlLmluaQ==">https://raw.githubusercontent.com/grafana/grafana/main/conf/sample.ini<i class="fa fa-external-link-alt"></i></span> 下载</li><li>然后使用项目目录下的 <code>docker-compose.yml</code></li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.5&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9090</span><span class="string">:9090</span></span><br><span class="line">    <span class="comment">#root</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus-data:/prometheus</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./web.yml:/etc/prometheus/web.yml</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.config.file=/etc/prometheus/web.yml&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.enable-admin-api&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.enable-lifecycle&#x27;</span></span><br><span class="line">    <span class="comment"># network_mode: host</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:3000</span></span><br><span class="line">    <span class="comment">#root</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana.ini:/etc/grafana/grafana.ini</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./grafana-data:/var/lib/grafana</span></span><br><span class="line">    <span class="comment"># network_mode: host</span></span><br></pre></td></tr></table></figure><ol start="3"><li>新建或修改 <code>hosts.txt</code>, 添加机器名</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tya1.baidu.tech</span><br><span class="line">tya2.baidu.tech</span><br><span class="line">tyn1.baidu.tech</span><br><span class="line">tyn2.baidu.tech</span><br><span class="line">hkn1.baidu.tech</span><br><span class="line">sgn1.baidu.tech</span><br><span class="line">krn3.baidu.tech</span><br></pre></td></tr></table></figure><ol start="4"><li>修改 node_exporter.sh 并在每一个节点上执行<blockquote><p>看自己情况是否需要添加防火墙例外和修改默认 basic auth 密码, 默认为: <code>2003GB</code><br><span class="exturl" data-url="aHR0cHM6Ly9wcm9tZXRoZXVzLmlvL2RvY3MvZ3VpZGVzL2Jhc2ljLWF1dGgv">https://prometheus.io/docs/guides/basic-auth/<i class="fa fa-external-link-alt"></i></span>  </p></blockquote></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line"></span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=9100/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">tar_path=<span class="string">&quot;/tmp/1.tar.gz&quot;</span></span><br><span class="line">node_exporter_url=<span class="string">&quot;https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-amd64.tar.gz&quot;</span></span><br><span class="line"><span class="comment"># node_exporter_url=&quot;https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-arm64.tar.gz&quot;</span></span><br><span class="line">wget -O <span class="variable">$tar_path</span> -q <span class="variable">$node_exporter_url</span></span><br><span class="line">untar_dir=<span class="string">&quot;/opt&quot;</span></span><br><span class="line">stand_node_exp_dir=<span class="string">&quot;<span class="variable">$&#123;untar_dir&#125;</span>/node_exporter&quot;</span></span><br><span class="line">stand_node_exp_conf=<span class="string">&quot;<span class="variable">$&#123;stand_node_exp_dir&#125;</span>/config.yml&quot;</span></span><br><span class="line"><span class="comment"># 2003GB</span></span><br><span class="line">stand_prom_pass=<span class="string">&quot;\$2y\$10\$/cO6/ZV2L89x4a/D/KSV8ONXY36hD0.wFGi8XXqCO.gFY3jSIxf7S&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$untar_dir</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> <span class="variable">$untar_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$untar_dir</span></span><br><span class="line">tar -xvf <span class="variable">$tar_path</span></span><br><span class="line">node_exporter_verion_dir=$(<span class="built_in">ls</span> | grep node_ex | <span class="built_in">head</span> -n 1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -e <span class="variable">$stand_node_exp_dir</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">ln</span> -s <span class="variable">$node_exporter_verion_dir</span> <span class="variable">$stand_node_exp_dir</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e \</span><br><span class="line">    <span class="string">&quot;basic_auth_users:</span></span><br><span class="line"><span class="string">  node: <span class="variable">$stand_prom_pass</span></span></span><br><span class="line"><span class="string">&quot;</span> &gt;<span class="variable">$stand_node_exp_conf</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e \</span><br><span class="line">    <span class="string">&quot;[Unit]</span></span><br><span class="line"><span class="string">Description=Node Exporter</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string">StartLimitIntervalSec=500</span></span><br><span class="line"><span class="string">StartLimitBurst=5</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">Group=root</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">Restart=on-failure</span></span><br><span class="line"><span class="string">RestartSec=5s</span></span><br><span class="line"><span class="string">ExecStart=<span class="variable">$&#123;stand_node_exp_dir&#125;</span>/node_exporter --web.config=<span class="variable">$stand_node_exp_conf</span></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">&quot;</span> &gt;/etc/systemd/system/node_exporter.service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> node_exporter</span><br><span class="line">systemctl restart node_exporter</span><br></pre></td></tr></table></figure><ol start="5"><li>修改 prom.sh 并在promethus节点上执行<blockquote><p>看自己情况是否需要添加防火墙例外和修改默认 basic auth 密码, 默认为: <code>2003GB</code><br><span class="exturl" data-url="aHR0cHM6Ly9wcm9tZXRoZXVzLmlvL2RvY3MvZ3VpZGVzL2Jhc2ljLWF1dGgv">https://prometheus.io/docs/guides/basic-auth/<i class="fa fa-external-link-alt"></i></span>  </p></blockquote></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/env bash</span></span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=9090/tcp</span><br><span class="line"><span class="comment"># sudo firewall-cmd --zone=public --permanent --remove-port=9090/tcp</span></span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=9000/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">prom_job_name=<span class="string">&quot;NodeStatus&quot;</span></span><br><span class="line">prom_stand_yml=<span class="string">&quot;./prometheus.yml&quot;</span></span><br><span class="line">prom_stand_web_yml=<span class="string">&quot;./web.yml&quot;</span></span><br><span class="line"><span class="comment"># 2003GB</span></span><br><span class="line">stand_prom_pass=<span class="string">&quot;\$2y\$10\$/cO6/ZV2L89x4a/D/KSV8ONXY36hD0.wFGi8XXqCO.gFY3jSIxf7S&quot;</span></span><br><span class="line">hosts=<span class="string">&quot;hosts.txt&quot;</span></span><br><span class="line">prometheus_host=$(<span class="built_in">head</span> -n 1 <span class="variable">$hosts</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">basic_auth_users:</span></span><br><span class="line"><span class="string">    node: <span class="variable">$stand_prom_pass</span>&quot;</span> &gt;<span class="variable">$prom_stand_web_yml</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e \</span><br><span class="line">    <span class="string">&quot;</span></span><br><span class="line"><span class="string">global:</span></span><br><span class="line"><span class="string">    scrape_interval: 5s</span></span><br><span class="line"><span class="string">    external_labels:</span></span><br><span class="line"><span class="string">        monitor: &#x27;imlala&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">scrape_configs:</span></span><br><span class="line"><span class="string">    - job_name: &#x27;prometheus&#x27;</span></span><br><span class="line"><span class="string">      static_configs:</span></span><br><span class="line"><span class="string">          - targets:</span></span><br><span class="line"><span class="string">                - &#x27;<span class="variable">$prometheus_host</span>:9090&#x27;</span></span><br><span class="line"><span class="string">            labels:</span></span><br><span class="line"><span class="string">                instance: prometheus </span></span><br><span class="line"><span class="string">      basic_auth:</span></span><br><span class="line"><span class="string">        username: &#x27;node&#x27;</span></span><br><span class="line"><span class="string">        password: &#x27;2003GB&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - job_name: &#x27;<span class="variable">$prom_job_name</span>&#x27;</span></span><br><span class="line"><span class="string">      basic_auth:</span></span><br><span class="line"><span class="string">        username: &#x27;node&#x27;</span></span><br><span class="line"><span class="string">        password: &#x27;2003GB&#x27;</span></span><br><span class="line"><span class="string">      static_configs:&quot;</span> &gt;<span class="variable">$prom_stand_yml</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">cat</span> <span class="variable">$hosts</span>); <span class="keyword">do</span></span><br><span class="line">    label=$(<span class="built_in">echo</span> <span class="variable">$i</span> | awk -F. <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;label: <span class="variable">$label</span> -&gt; target: <span class="variable">$i</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e \</span><br><span class="line">        <span class="string">&quot;          - targets:</span></span><br><span class="line"><span class="string">                - &#x27;<span class="variable">$i</span>:9100&#x27;</span></span><br><span class="line"><span class="string">            labels:</span></span><br><span class="line"><span class="string">                instance: <span class="variable">$label</span></span></span><br><span class="line"><span class="string">&quot;</span> &gt;&gt;<span class="variable">$prom_stand_yml</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span></span><br></pre></td></tr></table></figure><ol start="6"><li>确认无误后up起来即可：<code>docker-compose up -d</code></li><li>如果后续你更改了prometheus.yml配置文件内容，可以直接执行下面的命令让prometheus热加载配置，不用重启prometheus容器：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST <span class="string">&#x27;localhost:9090/-/reload&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Basic bm9kZToyMDAzR0I=&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ul><li><p>访问你的机器ip:3000应该能看到grafana的WEBUI，默认的管理员账号密码都是admin。登录进去之后，需要添加数据源。<br><img src="https://lala.im/wp-content/uploads/2020/03/lala.im_2020-03-22_20-59-06.png" alt="img"><br><img src="https://lala.im/wp-content/uploads/2020/03/lala.im_2020-03-22_21-00-40.png" alt="img"></p></li><li><p>新建或者导入模板, 一些模板 id: 8919，12159</p><blockquote><p>感兴趣的自己去找<br><span class="exturl" data-url="aHR0cHM6Ly9ncmFmYW5hLmNvbS9ncmFmYW5hL2Rhc2hib2FyZHMv">https://grafana.com/grafana/dashboards/<i class="fa fa-external-link-alt"></i></span>  </p></blockquote></li></ul><h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9sYWxhLmltLzY3NjQuaHRtbA==">Docker+Prometheus+Grafana监控VPS运行状态<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Prometheus basic auth </tag>
            
            <tag> Grafana basic auth </tag>
            
            <tag> basic auth </tag>
            
            <tag> 密码验证 </tag>
            
            <tag> Prometheus密码验证 </tag>
            
            <tag> Grafana SSL </tag>
            
            <tag> Docker </tag>
            
            <tag> Prometheus </tag>
            
            <tag> Grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>红米K40 国际版刷机</title>
      <link href="/2022/07/13/1/"/>
      <url>/2022/07/13/1/</url>
      
        <content type="html"><![CDATA[<h2 id="解锁BL"><a href="#解锁BL" class="headerlink" title="解锁BL"></a>解锁BL</h2><ul><li>不管刷不刷，有没有想好，申请解锁就行了。</li><li>因为有资格之后需要用 MIUI unlock 去手动解锁，才会清除数据。<ul><li>手机登陆MIUI账号</li><li>打开开发者设置，搜索设备解锁状态，点击绑定</li><li>绑定7天后即可进入下一步解锁</li></ul></li></ul><blockquote><p>注意：重复绑定、退出MIUI账号或者拔掉手机卡，时间会重新计算。</p></blockquote><h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><ul><li>使用自带的备份与恢复对手机进行备份</li><li>使用TI备份之类的对手机进行备份</li><li>将手机里面的重要数据手动传输到其他设备，如电脑。</li></ul><h3 id="解锁"><a href="#解锁" class="headerlink" title="解锁"></a>解锁</h3><ol><li>手机充满电</li><li>访问 <span class="exturl" data-url="aHR0cDovL3d3dy5taXVpLmNvbS91bmxvY2svaW5kZXguaHRtbA==">miui.com/unlock/<i class="fa fa-external-link-alt"></i></span></li><li>下载解锁工具（Windows Only）</li><li>解压启动解锁工具</li><li>更新解锁工具</li><li>点击工具设置，检测\安装 USB 驱动</li><li>登陆小米账号，进入解锁页面</li><li>手机打开adb调试，<code>adb reboot fastboot</code> 进入 fastboot（你也可以用手按</li><li>如果解锁工具显示未检测到手机，拔插多试试就行</li><li>解锁后手机第一次启动时间可能比较久，正常情况</li></ol><h2 id="下载工具以及镜像"><a href="#下载工具以及镜像" class="headerlink" title="下载工具以及镜像"></a>下载工具以及镜像</h2><ul><li>platform-tools(adb): <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL3JlbGVhc2VzL3BsYXRmb3JtLXRvb2xz">https://developer.android.com/studio/releases/platform-tools<i class="fa fa-external-link-alt"></i></span><ul><li>mac: <code>brew install --cask android-platform-tools</code></li><li>如果不能在 <code>cli</code> 里面访问到 <code>adb</code> 之类的命令，请自行添加<strong>环境变量</strong></li></ul></li><li>MIUI解锁工具: <span class="exturl" data-url="aHR0cDovL3d3dy5taXVpLmNvbS91bmxvY2svaW5kZXguaHRtbA==">miui.com/unlock/<i class="fa fa-external-link-alt"></i></span></li><li>TWRP: <span class="exturl" data-url="aHR0cHM6Ly90d3JwLm1lL3hpYW9taS94aWFvbWlwb2NvZjMuaHRtbA==">https://twrp.me/xiaomi/xiaomipocof3.html<i class="fa fa-external-link-alt"></i></span><ul><li>美国镜像站：<span class="exturl" data-url="aHR0cHM6Ly9kbC50d3JwLm1lL2FsaW90aC8=">https://dl.twrp.me/alioth/<i class="fa fa-external-link-alt"></i></span></li><li>欧洲镜像站：<span class="exturl" data-url="aHR0cHM6Ly9ldS5kbC50d3JwLm1lL2FsaW90aC8=">https://eu.dl.twrp.me/alioth/<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Magisk:<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvcGpvaG53dS9NYWdpc2svcmVsZWFzZXM=">https://github.com/topjohnwu/Magisk/releases<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>国际版欧洲MIUI包(eea)：<ul><li>卡刷包: <span class="exturl" data-url="aHR0cHM6Ly94aWFvbWlyb20uY29tL3JvbS9yZWRtaS1rNDAtbWktMTF4LXBvY28tZjMtYWxpb3RoLWV1cm9wZS1mYXN0Ym9vdC1yZWNvdmVyeS1yb20vIyVFNCVCOCU4QiVFOCVCRCVCRC0lRTclQkElQTIlRTclQjElQjMtazQwLS1wb2NvLWYzLSVFNyVBOCVCMyVFNSVBRSU5QSVFNyU4OSU4OC1yZWNvdmVyeS0lRTUlOEQlQTElRTUlODglQjclRTUlOEMlODU=">https://xiaomirom.com/rom/redmi-k40-mi-11x-poco-f3-alioth-europe-fastboot-recovery-rom/#下载-红米-k40–poco-f3-稳定版-recovery-卡刷包<i class="fa fa-external-link-alt"></i></span></li><li>线刷包：<span class="exturl" data-url="aHR0cHM6Ly94aWFvbWlyb20uY29tL3JvbS9yZWRtaS1rNDAtbWktMTF4LXBvY28tZjMtYWxpb3RoLWV1cm9wZS1mYXN0Ym9vdC1yZWNvdmVyeS1yb20vIyVFNCVCOCU4QiVFOCVCRCVCRC0lRTclQkElQTIlRTclQjElQjMtazQwLS1wb2NvLWYzLSVFNyVBOCVCMyVFNSVBRSU5QSVFNyU4OSU4OC1mYXN0Ym9vdC0lRTclQkElQkYlRTUlODglQjclRTUlOEMlODU=">https://xiaomirom.com/rom/redmi-k40-mi-11x-poco-f3-alioth-europe-fastboot-recovery-rom/#下载-红米-k40–poco-f3-稳定版-fastboot-线刷包<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>欧洲版MIUI包(eu)：<span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz93PWZpbGVzJmZsaWQ9MzMxNTAy">https://androidfilehost.com/?w=files&amp;flid=331502<i class="fa fa-external-link-alt"></i></span><ul><li>打开搜索 K40, POCO_F3</li><li><span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz9maWQ9MTU2NjQyNDg1NjUxOTcxODAyMDY=">https://androidfilehost.com/?fid=15664248565197180206<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Magisk模块<ul><li>SafetyNet(网飞检测)：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tkcmFnMG4vc2FmZXR5bmV0LWZpeA==">https://github.com/kdrag0n/safetynet-fix<i class="fa fa-external-link-alt"></i></span></li><li>Zygisk：无需额外下载</li></ul></li></ul><blockquote><p><strong>MIUI Global EEA和MIUI EU翻译过来都为欧洲版，但是两个系统完全不一样，请注意辨别！</strong></p></blockquote><h2 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h2><blockquote><p>好吧，这里一开始没有分清楚 eea 和 eu 版的区别，装的 eea 版，弄错了<br>区别：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy83OTc=">https://blog.minamigo.moe/archives/797<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>所有命令涉及到的文件路径，请自行替换成对应的绝对路径</li></ul><h2 id="刷入-EEA-版"><a href="#刷入-EEA-版" class="headerlink" title="刷入 EEA 版"></a>刷入 EEA 版</h2><h3 id="Twrp"><a href="#Twrp" class="headerlink" title="Twrp"></a>Twrp</h3><ul><li>K40 国行系统默认没有 Recovery 分区，刷入会报错，直接通过 twrp 启动即可</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line"><span class="comment"># fastboot.exe flash recovery E:\tmp\twrp\twrp-3.6.1_11-0-alioth.img</span></span><br><span class="line"><span class="comment"># FAILED (remote: &#x27;(recovery_a) No such partition&#x27;)</span></span><br><span class="line">fastboot.exe boot  E:\tmp\twrp\twrp-3.6.1_11-0-alioth.img</span><br></pre></td></tr></table></figure><h3 id="ADB-Sideload"><a href="#ADB-Sideload" class="headerlink" title="ADB Sideload"></a>ADB Sideload</h3><ol><li>Twrp 启动后</li><li>进 Advance 里面对 cache 和 data 分区进行格式化</li><li>进 Advance 里面打开 adb sideload</li><li>然后电脑端使用 <strong>卡刷包(miui 开头)</strong> 进行 sideload</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># side load 前先进行双清</span></span><br><span class="line">adb sideload E:\tmp\img\miui_ALIOTHEEAGlobal_V13.0.6.0.SKHEUXM_c393876947_12.0.zip</span><br></pre></td></tr></table></figure><h2 id="刷入-EU-版"><a href="#刷入-EU-版" class="headerlink" title="刷入 EU 版"></a>刷入 EU 版</h2><blockquote><p>用了 eea 两三周了，重刷得双清，懒得搞了，贴下官方步骤</p></blockquote><blockquote><p>EU版，有本地化插件，不习惯的可以整一下: <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy8xODQ=">https://blog.minamigo.moe/archives/184<i class="fa fa-external-link-alt"></i></span></p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Xiaomi devices on Android 11:</span><br><span class="line">Unlock your first bootloader here http://en.miui.com/unlock/</span><br><span class="line">Install TWRP via Fastboot mode, then install our ROM</span><br><span class="line">Code:</span><br><span class="line">fastboot flash recovery twrp.img</span><br><span class="line">fastboot boot twrp.img</span><br><span class="line">TWRP Recovery TWRP or TWRP.ME</span><br><span class="line">FORMAT /data partition (NEVER wipe System or Persist!)</span><br><span class="line">Copy our ROM to the internal storage</span><br><span class="line">Install our ROM</span><br><span class="line">Reboot</span><br><span class="line">done</span><br><span class="line">Installation via TWRP:</span><br><span class="line"><span class="bullet">-</span> Download zip to internal storage</span><br><span class="line"><span class="bullet">-</span> Updater - Menu (...) - Reboot to Recovery</span><br><span class="line"><span class="bullet">-</span> Install - Select zip</span><br><span class="line"><span class="bullet">-</span> Reboot</span><br><span class="line"><span class="bullet">-</span> Done</span><br><span class="line"></span><br><span class="line">Xiaomi devices on Android 12 via Fastboot only:</span><br><span class="line"><span class="bullet">-</span> Download our ROM zip file</span><br><span class="line"><span class="bullet">-</span> Unpack downloaded zip file in the PC using WinRAR</span><br><span class="line"><span class="bullet">-</span> Reboot your device to fastboot mode (press volume down + power)</span><br><span class="line"><span class="bullet">-</span> Connect to PC via USB cable</span><br><span class="line"><span class="bullet">-</span> Run fastboot installation script from unpacked zip according your PC operating system:</span><br><span class="line">--- For Windows OS - windows_fastboot_update_rom.bat</span><br><span class="line">--- For Linux - linux_fastboot_update_rom.sh</span><br><span class="line">--- For MacOS - macos_fastboot_update_rom.sh</span><br></pre></td></tr></table></figure><h2 id="必要操作"><a href="#必要操作" class="headerlink" title="必要操作"></a>必要操作</h2><h3 id="Magisk"><a href="#Magisk" class="headerlink" title="Magisk"></a>Magisk</h3><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly90b3Bqb2hud3UuZ2l0aHViLmlvL01hZ2lzay9pbnN0YWxsLmh0bWw=">https://topjohnwu.github.io/Magisk/install.html<i class="fa fa-external-link-alt"></i></span></p></blockquote><ol><li>adb install Magisk App 或者拷贝后手动安装</li><li>打开卡刷包，找 boot.img，拷贝到手机</li><li>Magisk App点击Magisk，手动选择刚刚拷贝的 boot.img，运行完成后应该会生成一个 patch.img 文件</li><li>拷贝patch.img 文件到电脑</li><li>进 bootloader</li><li>先尝试使用 patch.img 文件是否可以正常启动</li><li>可以正常启动后将 patch.img 文件刷入 boot 分区</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装 magisk apk</span></span><br><span class="line"><span class="comment">#从线刷包里面找到 boot.img</span></span><br><span class="line"><span class="comment">#进magisk app生成 patch img</span></span><br><span class="line"><span class="comment">#adb shell 修改patch文件名称</span></span><br><span class="line"><span class="comment">#拷贝到电脑</span></span><br><span class="line">adb pull sdcard/Download/magisk_patched.img</span><br><span class="line"><span class="comment"># https://sspai.com/post/67932</span></span><br><span class="line">adb reboot bootloader</span><br><span class="line">fastboot boot magisk_patched.img</span><br><span class="line">fastboot flash boot magisk_patched.img</span><br></pre></td></tr></table></figure><h3 id="安装-Zygisk"><a href="#安装-Zygisk" class="headerlink" title="安装 Zygisk"></a>安装 Zygisk</h3><ol><li>Magisk App点击设置</li><li>勾选在 Zygisk 里面运行 Magisk</li><li>自动下载，安装</li><li>重启</li></ol><h3 id="SafetyNet"><a href="#SafetyNet" class="headerlink" title="SafetyNet"></a>SafetyNet</h3><ol><li>下载 zip 包到手机</li><li>Magisk里面选择安装，重启</li><li>基本检测通过大概率没啥问题</li></ol><h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><blockquote><p>实测自带的备份与恢复 app没啥用，eea 版恢复 国内的备份包大概率会寄。还是 Ti备份之类的靠谱点</p></blockquote><ol><li>系统设置 里面直接搜索 备份，就能找到备份与恢复 app</li><li>将之前备份的文件拷贝回手机</li></ol><h3 id="Magisk-Root-隐藏"><a href="#Magisk-Root-隐藏" class="headerlink" title="Magisk/Root 隐藏"></a>Magisk/Root 隐藏</h3><ol><li>Magisk App点击设置</li><li>不勾选”遵守排除列表“</li><li>点击 ”配置排除列表“</li><li>搜索需要隐藏的软件（大部分时候是银行App和金融App</li></ol><blockquote><p>一个App有很多项进程，都需要勾上，点击即可展开，再点击勾选即可全选。</p></blockquote><h3 id="隐藏应用列表"><a href="#隐藏应用列表" class="headerlink" title="隐藏应用列表"></a>隐藏应用列表</h3><blockquote><p>如果出现隐藏失败，闪退，可以尝试把隐藏方式清空（重试没用就重启</p></blockquote><ul><li>这个一般用不到，MIUI13没看见过拦截次数大于0</li><li>需要安装的，自己去 Google Play下载</li><li>参考：<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC81MDYyMDMwNzg=">https://zhuanlan.zhihu.com/p/506203078<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy8zMjM=">MIUI EU 刷机指南 - Koizumi’s Blog<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly90d3JwLm1lL3hpYW9taS94aWFvbWlwb2NvZjMuaHRtbA==">twrp<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy83OTc=">MIUI 各版本区别及下载地址 - Koizumi’s Blog<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9hbmRyb2lkZmlsZWhvc3QuY29tLz93PWZpbGVzJmZsaWQ9MzMxNTAy">K40 刷机包<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvcGpvaG53dS9NYWdpc2svcmVsZWFzZXM=">https://github.com/topjohnwu/Magisk/releases<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly94aWFvbWlyb20uY29tL2Rvd25sb2FkL3JlZG1pLWs0MC1taS0xMXgtcG9jby1mMy1hbGlvdGgtc3RhYmxlLVYxMy4wLjYuMC5TS0hFVVhNLyNldXJvcGUtcmVjb3Zlcnk=">https://xiaomirom.com/download/redmi-k40-mi-11x-poco-f3-alioth-stable-V13.0.6.0.SKHEUXM/#europe-recovery<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC81MDYyMDMwNzg=">https://zhuanlan.zhihu.com/p/506203078<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLm1pbmFtaWdvLm1vZS9hcmNoaXZlcy8xODQ=">MIUI EU 欧洲版 本地化 Magisk 模块 - Koizumi’s Blog<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> 刷机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 刷机 </tag>
            
            <tag> alioth </tag>
            
            <tag> xiaomi.eu </tag>
            
            <tag> magisk </tag>
            
            <tag> zygisk </tag>
            
            <tag> root隐藏 </tag>
            
            <tag> magisk隐藏 </tag>
            
            <tag> SafetyNet </tag>
            
            <tag> K40 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用ADB免ROOT抓取手机APK</title>
      <link href="/2022/07/12/1/"/>
      <url>/2022/07/12/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>国际版系统对比国内版缺失了不少东西，有些可以自己从系统里面提取</p></blockquote><ul><li>推荐使用 mac 或者 linux 运行命令</li></ul><blockquote><p>Windows 建议自力更生</p></blockquote><ul><li>默认提取到 <code>/tmp/apk</code>，该文件夹需要提前创建</li></ul><h2 id="提取所有APK包"><a href="#提取所有APK包" class="headerlink" title="提取所有APK包"></a>提取所有APK包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="提取xiaomi包"><a href="#提取xiaomi包" class="headerlink" title="提取xiaomi包"></a>提取xiaomi包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 小米包</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | grep xiaomi | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="提取miui包"><a href="#提取miui包" class="headerlink" title="提取miui包"></a>提取miui包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># miui 包</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | grep miui | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="提取短信包"><a href="#提取短信包" class="headerlink" title="提取短信包"></a>提取短信包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 短信</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | grep mms | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="提取主题商店包"><a href="#提取主题商店包" class="headerlink" title="提取主题商店包"></a>提取主题商店包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主题商店</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | grep theme | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="提取电话、联系人"><a href="#提取电话、联系人" class="headerlink" title="提取电话、联系人"></a>提取电话、联系人</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 电话、联系人</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(adb shell pm list packages | grep contacts | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">apk_path=`adb shell pm path <span class="variable">$&#123;i&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">tmp_path=/tmp/apk/<span class="variable">$i</span>.apk</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;adb pull <span class="variable">$apk_path</span> -&gt; <span class="variable">$tmp_path</span>&quot;</span></span><br><span class="line">adb pull <span class="variable">$apk_path</span> <span class="variable">$tmp_path</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 刷机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 刷机 </tag>
            
            <tag> adb </tag>
            
            <tag> 免root </tag>
            
            <tag> 安装包提取 </tag>
            
            <tag> miui </tag>
            
            <tag> 应用商店 </tag>
            
            <tag> 联系人 </tag>
            
            <tag> 短信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V2ray HTTP/2+TLS+WEB 一键部署</title>
      <link href="/2022/03/02/1/"/>
      <url>/2022/03/02/1/</url>
      
        <content type="html"><![CDATA[<div class="note info">            <ul><li>TLS+NGINX+WEB 的 v2ray 一键脚本: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL0F1dG9WMnJheQ==">https://github.com/IITII/AutoV2ray<i class="fa fa-external-link-alt"></i></span></li><li>V2ray 不完全测速(想选择协议的可以看看)：<a href="https://iitii.github.io/2022/03/01/1/">https://iitii.github.io/2022/03/01/1/</a></li></ul>          </div><h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ol><li>有一个域名</li><li>一台干净的 Linux 服务器</li><li>会一些 Linux 的基本操作</li></ol><h2 id="服务器基本信息"><a href="#服务器基本信息" class="headerlink" title="服务器基本信息"></a>服务器基本信息</h2><blockquote><p>以 Ubuntu20.04 为例  </p></blockquote><ol><li>可以访问 “网络”</li><li>防火墙已开启 22, 80, 443</li></ol><h2 id="安装基本工具"><a href="#安装基本工具" class="headerlink" title="安装基本工具"></a>安装基本工具</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update -y &amp;&amp; sudo apt install git -y</span><br></pre></td></tr></table></figure><h2 id="Clone-项目"><a href="#Clone-项目" class="headerlink" title="Clone 项目"></a>Clone 项目</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/IITII/AutoV2ray2.git &amp;&amp; cd AutoV2ray2</span><br></pre></td></tr></table></figure><h2 id="注册域名"><a href="#注册域名" class="headerlink" title="注册域名"></a>注册域名</h2><ul><li>自行解决</li></ul><h2 id="更新-DNS-记录"><a href="#更新-DNS-记录" class="headerlink" title="更新 DNS 记录"></a>更新 DNS 记录</h2><h3 id="手动填写"><a href="#手动填写" class="headerlink" title="手动填写"></a>手动填写</h3><ul><li>打开域名管理页面，填写具体的 IP 后，等待DNS广播即可</li></ul><h3 id="DDNS"><a href="#DDNS" class="headerlink" title="DDNS"></a>DDNS</h3><blockquote><p>脚本目前仅支持 dns.he.net, 其他平台的请手动更新  </p></blockquote><ol><li>登录 <span class="exturl" data-url="aHR0cDovL2Rucy5oZS5uZXQv">dns.he.net<i class="fa fa-external-link-alt"></i></span> 并且进入到域名管理界面</li><li>点击添加 <em><strong><code>A</code></strong></em> 记录</li><li>填写要开启 <code>DDNS</code> 的域名</li><li>勾选 <strong><code>Enable entry for dynamic dns</code></strong> 并点击 <code>submit</code></li><li>在域名列表里面找到添加的域名，在右边 <code>DDNS</code> 这一栏应该有一个箭头，点击箭头</li><li>点击生成 <code>DDNS key</code> 或者自己填一遍</li><li>将 <code>DDNS key</code> 复制出来，然后点击提交即可</li></ol><p><img src="/images/Linux/v2ray/tls.png" alt="alt"><br><img src="/images/Linux/v2ray/tls1.png" alt="alt"></p><h2 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h2><blockquote><p>请自行将假设中的值修改为实际的值  </p></blockquote><ul><li>一些假设<ul><li>域名：v2.google.com</li><li>-</li></ul></li><li>执行 <code>./v2ray -w v2.google.com</code> 即可</li></ul><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><blockquote><p>目前仅测试了 Clash 的配置文件<br>其他方式不保证一定能用，可能配置格式不一样，可以尝试手动填写  </p></blockquote><ul><li>一般出现以下内容就是搭建成功了, 可以在本地自己验证分享出去了</li><li>脚本会将 v2ray info, v2ray 链接和用于 Clash 的配置文件保存一份到 <code>/root/v2ray_link</code></li></ul><ul><li>More -&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL0F1dG9WMnJheTI=">https://github.com/IITII/AutoV2ray2<i class="fa fa-external-link-alt"></i></span></li></ul><p><img src="/images/v2ray/autov2ray2/1.png" alt="img"></p><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><blockquote><p>以下问题均已修复  </p></blockquote><ul><li><p><code>invalid user: VMessAEAD is enforced and a non VMessAEAD connection is received.</code></p><blockquote><ol><li>升级客户端版本  </li><li>或客户端设置 <code>alterId: 0</code>   </li><li>或服务端添加 V2ray 启动环境变量:  <code>Environment=&quot;V2RAY_VMESS_AEAD_FORCED=false&quot;</code>   </li></ol></blockquote></li><li><p>ClashX 配置文件在 <code>1.90.0</code> 有一次较大的修改。</p></li><li><p>本项目的配置文件基于新版的 ClashX，提问之前先确认自己 Clash 版本。</p></li></ul><h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><ul><li>查看 Caddy 和 V2ray 状态：<code>systemctl status v2ray caddy</code></li><li>查看 Caddy 和 V2ray 配置文件：<code>cat /etc/caddy/Caddyfile; cat /usr/local/etc/v2ray/config.json</code></li><li>直接 curl 看看，是不是防火墙的问题: <code>curl https://&lt;网站域名&gt;</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> v2ray </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> v2ray </tag>
            
            <tag> http2 </tag>
            
            <tag> caddy </tag>
            
            <tag> caddy2 </tag>
            
            <tag> tls </tag>
            
            <tag> let&#39;s encrypt </tag>
            
            <tag> v2ray一键部署 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V2ray 不完全测速</title>
      <link href="/2022/03/01/1/"/>
      <url>/2022/03/01/1/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近看到 v2fly 上面多了蛮多新玩法。综合个人隐蔽性需求，将对以下搭配使用 iperf, speedtest mini, v2ray, clash premium 和 speedtest-cli 进行测速。</p><blockquote><p>测速方式来自：<span class="exturl" data-url="aHR0cHM6Ly9zdGVlbWl0LmNvbS9jbi9AdjJyYXkvM2NqaXV4">https://steemit.com/cn/@v2ray/3cjiux<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><blockquote><p>只考虑这两种隐蔽性强和兼容相对广泛的搭配。  </p></blockquote><blockquote><p>比如 VLESS+WEB 通过分流器的操作，识别起来比较方便，WireShark就可以很简单的区分，故不考虑。  </p></blockquote><table><thead><tr><th>HTTP 协议</th><th>TLS</th><th>v2ray inbound协议</th><th>加密</th></tr></thead><tbody><tr><td>HTTP/2</td><td>YES</td><td>H2C</td><td>none</td></tr><tr><td>HTTP/2</td><td>YES</td><td>H2C</td><td>AES-128-GCM</td></tr><tr><td>HTTP 1.x</td><td>YES</td><td>WS</td><td>none</td></tr><tr><td>HTTP 1.x</td><td>YES</td><td>WS</td><td>AES-128-GCM</td></tr></tbody></table><h2 id="本次测试的目的"><a href="#本次测试的目的" class="headerlink" title="本次测试的目的"></a><strong>本次测试的目的</strong></h2><p>测试 VMess 基于 HTTP 隐藏的各种加密方式，在常规传输过程中的参考速度。</p><h2 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a><strong>测试方法</strong></h2><ul><li>在两台 2c4h16g 4Gbps 的 Oracle VM.Standard.E4.Flex 虚拟机上面分别搭建 基于 HTTP 1.x 和 HTTP/2 v2ray 服务端以及 speedtest mini服务端，并在一台2c4h16g 4Gbps 的 Oracle VM.Standard3.Flex 虚拟机搭建服务端，使用 speedtest-cli 通过代理进行测速。</li><li>如何判断真的走了代理？查看服务端和客户端的 网卡流量信息 和 v2ray 日志信息</li></ul><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><blockquote><p>V2Ray Core 版本 v4.44.0</p></blockquote><blockquote><p>Clash 版本：<code>Clash 2022.01.27 linux amd64 with go1.18beta1 Thu Jan 27 13:02:53 UTC 2022</code></p></blockquote><blockquote><p>speedtest-cli <code>2.1.2 Python 3.8.10 (default, Nov 26 2021, 20:14:08) [GCC 9.3.0]</code></p></blockquote><blockquote><p>系统均使用 Ubuntu 20.04，并开启 BBR</p></blockquote><blockquote><p>VM 都设置为 CPU 可突发，突发基线为 50%</p></blockquote><ul><li>2 x Oracle VM.Standard.E4.Flex  2c4h16g 4Gbps</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Architecture:                    x86_64</span><br><span class="line">CPU op-mode(s):                  32-bit, 64-bit</span><br><span class="line">Byte Order:                      Little Endian</span><br><span class="line">Address sizes:                   40 bits physical, 48 bits virtual</span><br><span class="line">CPU(s):                          4</span><br><span class="line">On-line CPU(s) list:             0-3</span><br><span class="line">Thread(s) per core:              2</span><br><span class="line">Core(s) per socket:              2</span><br><span class="line">Socket(s):                       1</span><br><span class="line">NUMA node(s):                    1</span><br><span class="line">Vendor ID:                       AuthenticAMD</span><br><span class="line">CPU family:                      25</span><br><span class="line">Model:                           1</span><br><span class="line">Model name:                      AMD EPYC 7J13 64-Core Processor</span><br><span class="line">Stepping:                        1</span><br><span class="line">CPU MHz:                         2445.406</span><br><span class="line">BogoMIPS:                        4890.81</span><br><span class="line">Virtualization:                  AMD-V</span><br><span class="line">Hypervisor vendor:               KVM</span><br><span class="line">Virtualization type:             full</span><br><span class="line">L1d cache:                       128 KiB</span><br><span class="line">L1i cache:                       128 KiB</span><br><span class="line">L2 cache:                        1 MiB</span><br><span class="line">L3 cache:                        16 MiB</span><br><span class="line">NUMA node0 CPU(s):               0-3</span><br><span class="line">Vulnerability Itlb multihit:     Not affected</span><br><span class="line">Vulnerability L1tf:              Not affected</span><br><span class="line">Vulnerability Mds:               Not affected</span><br><span class="line">Vulnerability Meltdown:          Not affected</span><br><span class="line">Vulnerability Spec store bypass: Mitigation; Speculative Store Bypass disabled via prctl and seccomp</span><br><span class="line">Vulnerability Spectre v1:        Mitigation; usercopy/swapgs barriers and __user pointer sanitization</span><br><span class="line">Vulnerability Spectre v2:        Mitigation; Full AMD retpoline, IBPB conditional, IBRS_FW, STIBP conditional, RSB filli</span><br><span class="line">                                 ng</span><br><span class="line">Vulnerability Srbds:             Not affected</span><br><span class="line">Vulnerability Tsx async abort:   Not affected</span><br></pre></td></tr></table></figure><ul><li>1 x Oracle VM.Standard3.Flex 2c4h16g 4Gbps</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Architecture:                    x86_64</span><br><span class="line">CPU op-mode(s):                  32-bit, 64-bit</span><br><span class="line">Byte Order:                      Little Endian</span><br><span class="line">Address sizes:                   40 bits physical, 57 bits virtual</span><br><span class="line">CPU(s):                          4</span><br><span class="line">On-line CPU(s) list:             0-3</span><br><span class="line">Thread(s) per core:              2</span><br><span class="line">Core(s) per socket:              2</span><br><span class="line">Socket(s):                       1</span><br><span class="line">NUMA node(s):                    1</span><br><span class="line">Vendor ID:                       GenuineIntel</span><br><span class="line">CPU family:                      6</span><br><span class="line">Model:                           106</span><br><span class="line">Model name:                      Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GHz</span><br><span class="line">Stepping:                        6</span><br><span class="line">CPU MHz:                         2593.966</span><br><span class="line">BogoMIPS:                        5187.93</span><br><span class="line">Virtualization:                  VT-x</span><br><span class="line">Hypervisor vendor:               KVM</span><br><span class="line">Virtualization type:             full</span><br><span class="line">L1d cache:                       64 KiB</span><br><span class="line">L1i cache:                       64 KiB</span><br><span class="line">L2 cache:                        8 MiB</span><br><span class="line">L3 cache:                        16 MiB</span><br><span class="line">NUMA node0 CPU(s):               0-3</span><br><span class="line">Vulnerability Itlb multihit:     Not affected</span><br><span class="line">Vulnerability L1tf:              Not affected</span><br><span class="line">Vulnerability Mds:               Not affected</span><br><span class="line">Vulnerability Meltdown:          Not affected</span><br><span class="line">Vulnerability Spec store bypass: Mitigation; Speculative Store Bypass disabled via prctl and seccomp</span><br><span class="line">Vulnerability Spectre v1:        Mitigation; usercopy/swapgs barriers and __user pointer sanitization</span><br><span class="line">Vulnerability Spectre v2:        Mitigation; Enhanced IBRS, IBPB conditional, RSB filling</span><br><span class="line">Vulnerability Srbds:             Not affected</span><br><span class="line">Vulnerability Tsx async abort:   Not affected</span><br></pre></td></tr></table></figure><h2 id="测速工具"><a href="#测速工具" class="headerlink" title="测速工具"></a>测速工具</h2><ul><li>使用 iperf3 进行服务器之间裸连测速</li><li>使用 speedtest-cli 进行代理测速</li><li>测速节点搭建见 → <a href="https://iitii.github.io/2022/02/27/1/">https://iitii.github.io/2022/02/27/1/</a></li></ul><h2 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h2><table><thead><tr><th>Host</th><th>v2ray</th><th>speedtest-mini</th></tr></thead><tbody><tr><td>n3kr.google.com</td><td>server</td><td>server</td></tr><tr><td>n4kr.google.com</td><td>server</td><td>server</td></tr><tr><td>n5kr.google.com</td><td>client</td><td>client</td></tr></tbody></table><ul><li>iperf3 可以查看客户端和服务端为 4Gbps 的带宽</li><li>speedtest-cli 的测速结果也基本如此</li></ul><table><thead><tr><th>序号</th><th>上传</th><th>下载</th></tr></thead><tbody><tr><td>0</td><td>3695.28</td><td>2651.07</td></tr><tr><td>1</td><td>3743</td><td>2528.95</td></tr><tr><td>2</td><td>3737.46</td><td>2526.12</td></tr><tr><td>3</td><td>3720.5</td><td>2518.34</td></tr><tr><td>4</td><td>3707.66</td><td>2169.3</td></tr><tr><td>5</td><td>3696.48</td><td>2668.12</td></tr><tr><td>6</td><td>3740.51</td><td>2534.96</td></tr><tr><td>7</td><td>3623.87</td><td>2178.24</td></tr><tr><td>8</td><td>3651.62</td><td>2278.35</td></tr><tr><td>9</td><td>3681.29</td><td>2627.53</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/0.png" alt="Untitled"></p><h2 id="Vmess-测速"><a href="#Vmess-测速" class="headerlink" title="Vmess 测速"></a>Vmess 测速</h2><ul><li>测速命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">three</span></span> ()&#123;</span><br><span class="line"><span class="keyword">for</span> i  <span class="keyword">in</span> &#123;1..<span class="variable">$1</span>&#125;</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line"> <span class="built_in">eval</span> <span class="variable">$2</span></span><br><span class="line"> <span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">three 10 <span class="string">&quot;speedtest-cli --mini http://n3kr.google.com --csv&quot;</span></span><br><span class="line"><span class="comment"># speedtest-cli --mini http://138.2.114.253:80 --csv-header</span></span><br></pre></td></tr></table></figure><ul><li>测速节点使用 speedtest mini 搭建，详见 →</li></ul><blockquote><p>h2 测速的过程中原版客户端出了点奇奇怪怪的问题，后续都换成了 clash premium 进行测试</p></blockquote><h3 id="HTTP-2-TLS-H2C-AUTO-WEB"><a href="#HTTP-2-TLS-H2C-AUTO-WEB" class="headerlink" title="HTTP/2+TLS+H2C+AUTO+WEB"></a>HTTP/2+TLS+H2C+AUTO+WEB</h3><blockquote><p>测试过程中 此种测试模式出现过服务端被打挂的情况</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RyZWFtYWNyby9jbGFzaC9yZWxlYXNlcy90YWcvcHJlbWl1bQ==">https://github.com/Dreamacro/clash/releases/tag/premium<i class="fa fa-external-link-alt"></i></span></p><ul><li><code>three 20 &quot;speedtest-cli --mini http://n4kr.google.com --csv&quot;</code></li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1076.26</td><td>2231.14</td></tr><tr><td>1</td><td>1078.07</td><td>1844.21</td></tr><tr><td>2</td><td>1065.16</td><td>2322.42</td></tr><tr><td>3</td><td>1091.96</td><td>2508.72</td></tr><tr><td>4</td><td>1066.28</td><td>1718.2</td></tr><tr><td>5</td><td>1087.6</td><td>1513</td></tr><tr><td>6</td><td>1047.8</td><td>1628.8</td></tr><tr><td>7</td><td>1091.55</td><td>1880.86</td></tr><tr><td>8</td><td>1076.29</td><td>1597.85</td></tr><tr><td>9</td><td>1088.29</td><td>2505.67</td></tr><tr><td>10</td><td>1080.98</td><td>2045.66</td></tr><tr><td>11</td><td>1061.3</td><td>2531.48</td></tr><tr><td>12</td><td>1071.67</td><td>1211.68</td></tr><tr><td>13</td><td>1061.07</td><td>2367.3</td></tr><tr><td>14</td><td>1080.41</td><td>1783.14</td></tr><tr><td>15</td><td>1068.84</td><td>1295.37</td></tr><tr><td>16</td><td>1084.67</td><td>1853.48</td></tr><tr><td>17</td><td>1070.99</td><td>2470.81</td></tr><tr><td>18</td><td>1056.12</td><td>1826.57</td></tr><tr><td>19</td><td>1075.17</td><td>1855.11</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/1.png" alt="Untitled"></p><h3 id="HTTP-2-TLS-H2C-NONE-WEB"><a href="#HTTP-2-TLS-H2C-NONE-WEB" class="headerlink" title="HTTP/2+TLS+H2C+NONE+WEB"></a>HTTP/2+TLS+H2C+NONE+WEB</h3><blockquote><p>测试过程中 此种测试模式出现过服务端被打挂的情况</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RyZWFtYWNyby9jbGFzaC9yZWxlYXNlcy90YWcvcHJlbWl1bQ==">https://github.com/Dreamacro/clash/releases/tag/premium<i class="fa fa-external-link-alt"></i></span></p><ul><li><code>three 20 &quot;speedtest-cli --mini http://n4kr.google.com --csv&quot;</code></li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>963.34</td><td>2111.67</td></tr><tr><td>1</td><td>977.8</td><td>1724.18</td></tr><tr><td>2</td><td>945.92</td><td>1629.36</td></tr><tr><td>3</td><td>963.28</td><td>1378.45</td></tr><tr><td>4</td><td>954.78</td><td>1723.26</td></tr><tr><td>5</td><td>972.52</td><td>1910.12</td></tr><tr><td>6</td><td>962.8</td><td>2213.12</td></tr><tr><td>7</td><td>961</td><td>2104.75</td></tr><tr><td>8</td><td>953.15</td><td>2176.02</td></tr><tr><td>9</td><td>961.77</td><td>1243.26</td></tr><tr><td>10</td><td>996.41</td><td>1521.64</td></tr><tr><td>11</td><td>975.14</td><td>2414.55</td></tr><tr><td>12</td><td>972.16</td><td>1720.12</td></tr><tr><td>13</td><td>972.96</td><td>1478.24</td></tr><tr><td>14</td><td>996.41</td><td>1649.12</td></tr><tr><td>15</td><td>970.1</td><td>1860</td></tr><tr><td>16</td><td>978.04</td><td>1719</td></tr><tr><td>17</td><td>962.62</td><td>2077.84</td></tr><tr><td>18</td><td>959.15</td><td>1891.93</td></tr><tr><td>19</td><td>959.18</td><td>1909.39</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/2.png" alt="Untitled"></p><h3 id="HTTP-2-TLS-H2C-AES-128-GCM-WEB"><a href="#HTTP-2-TLS-H2C-AES-128-GCM-WEB" class="headerlink" title="HTTP/2+TLS+H2C+AES-128-GCM+WEB"></a>HTTP/2+TLS+H2C+AES-128-GCM+WEB</h3><ul><li><code>three 20 &quot;speedtest-cli --mini http://n4kr.google.com --csv&quot;</code></li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1072.17</td><td>1728.56</td></tr><tr><td>1</td><td>1077.94</td><td>1688.53</td></tr><tr><td>2</td><td>1090.05</td><td>2240.06</td></tr><tr><td>3</td><td>1081.83</td><td>1629.94</td></tr><tr><td>4</td><td>1090.17</td><td>2013.98</td></tr><tr><td>5</td><td>1063.47</td><td>1975.27</td></tr><tr><td>6</td><td>246.05</td><td>1874.91</td></tr><tr><td>7</td><td>1063.88</td><td>2011.35</td></tr><tr><td>8</td><td>1074.73</td><td>1903.28</td></tr><tr><td>9</td><td>1105.14</td><td>2267.92</td></tr><tr><td>10</td><td>1073.03</td><td>2054.66</td></tr><tr><td>11</td><td>1078.88</td><td>1472.24</td></tr><tr><td>12</td><td>1078.27</td><td>1920.74</td></tr><tr><td>13</td><td>1070.27</td><td>1822.1</td></tr><tr><td>14</td><td>1068.5</td><td>1832.75</td></tr><tr><td>15</td><td>1077.01</td><td>1870.06</td></tr><tr><td>16</td><td>1094.16</td><td>1855.11</td></tr><tr><td>17</td><td>1073.3</td><td>1972.83</td></tr><tr><td>18</td><td>1061.9</td><td>1856.69</td></tr><tr><td>19</td><td>1004.17</td><td>2513.06</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/3.png" alt="Untitled"></p><h3 id="HTTP1-x-TLS-WS-NONE-WEB"><a href="#HTTP1-x-TLS-WS-NONE-WEB" class="headerlink" title="HTTP1.x+TLS+WS+NONE+WEB"></a>HTTP1.x+TLS+WS+NONE+WEB</h3><ul><li><code>three 20 &quot;speedtest-cli --mini http://n4kr.google.com --csv&quot;</code></li><li><strong>clash</strong></li><li>Clash HTTP1.x+TLS+WS+NONE+WEB</li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1882.92</td><td>1267.29</td></tr><tr><td>1</td><td>1883.45</td><td>934.95</td></tr><tr><td>2</td><td>1886.13</td><td>492.51</td></tr><tr><td>3</td><td>1901.5</td><td>383.79</td></tr><tr><td>4</td><td>1874.9</td><td>414.77</td></tr><tr><td>5</td><td>1874.42</td><td>370.57</td></tr><tr><td>6</td><td>1910.24</td><td>307.24</td></tr><tr><td>7</td><td>1877.43</td><td>637.83</td></tr><tr><td>8</td><td>1869.76</td><td>361.3</td></tr><tr><td>9</td><td>1897.93</td><td>2059.06</td></tr><tr><td>10</td><td>1889.59</td><td>1005.95</td></tr><tr><td>11</td><td>1873.72</td><td>276.55</td></tr><tr><td>12</td><td>1893.87</td><td>372.17</td></tr><tr><td>13</td><td>1879.64</td><td>226.87</td></tr><tr><td>14</td><td>1896.9</td><td>1142.58</td></tr><tr><td>15</td><td>1882.13</td><td>1007.48</td></tr><tr><td>16</td><td>1874.78</td><td>366.35</td></tr><tr><td>17</td><td>1880.32</td><td>2021.74</td></tr><tr><td>18</td><td>1901.97</td><td>1766.16</td></tr><tr><td>19</td><td>1877.77</td><td>950.76</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/4.png" alt="Untitled"></p><ul><li>Clash HTTP1.x+TLS+WS+AUTO+WEB</li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1887.99</td><td>1871.85</td></tr><tr><td>1</td><td>1868.47</td><td>380.05</td></tr><tr><td>2</td><td>1876.47</td><td>2409.5</td></tr><tr><td>3</td><td>1882.28</td><td>2029.39</td></tr><tr><td>4</td><td>1865.41</td><td>1821.91</td></tr><tr><td>5</td><td>1868.34</td><td>1157.13</td></tr><tr><td>6</td><td>1871.73</td><td>489.02</td></tr><tr><td>7</td><td>1885.19</td><td>1850.75</td></tr><tr><td>8</td><td>1859.45</td><td>2485.44</td></tr><tr><td>9</td><td>1876.98</td><td>1934.64</td></tr><tr><td>10</td><td>1685.45</td><td>364.68</td></tr><tr><td>11</td><td>1873.05</td><td>78.48</td></tr><tr><td>12</td><td>1857</td><td>1973.31</td></tr><tr><td>13</td><td>1870.48</td><td>1829.71</td></tr><tr><td>14</td><td>1736.28</td><td>1656.51</td></tr><tr><td>15</td><td>1874.78</td><td>1971.4</td></tr><tr><td>16</td><td>1856.34</td><td>675.46</td></tr><tr><td>17</td><td>1869.51</td><td>2069.49</td></tr><tr><td>18</td><td>1856.84</td><td>515.95</td></tr><tr><td>19</td><td>1879.48</td><td>2031.77</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/5.png" alt="Untitled"></p><ul><li><strong>v2ray client</strong></li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1870.21</td><td>706.89</td></tr><tr><td>1</td><td>1910.88</td><td>438.43</td></tr><tr><td>2</td><td>1891.06</td><td>677.95</td></tr><tr><td>3</td><td>1884.05</td><td>756.88</td></tr><tr><td>4</td><td>1920.39</td><td>172.93</td></tr><tr><td>5</td><td>1921.31</td><td>619.55</td></tr><tr><td>6</td><td>1882.68</td><td>697.71</td></tr><tr><td>7</td><td>1920.67</td><td>154.28</td></tr><tr><td>8</td><td>1828.46</td><td>196.31</td></tr><tr><td>9</td><td>1926.01</td><td>468.58</td></tr><tr><td>10</td><td>1901.83</td><td>647.56</td></tr><tr><td>11</td><td>1889.04</td><td>617.24</td></tr><tr><td>12</td><td>1921.46</td><td>1630.4</td></tr><tr><td>13</td><td>1905.12</td><td>62.38</td></tr><tr><td>14</td><td>1899.19</td><td>204.08</td></tr><tr><td>15</td><td>1914.48</td><td>600.8</td></tr><tr><td>16</td><td>1924.44</td><td>462.51</td></tr><tr><td>17</td><td>1890.84</td><td>429.16</td></tr><tr><td>18</td><td>1923.15</td><td>110.51</td></tr><tr><td>19</td><td>1861.36</td><td>660.72</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/6.png" alt="Untitled"></p><p><img src="/images/v2ray/benchmark/7.png" alt="Untitled"></p><h3 id="HTTP1-x-TLS-WS-AES-128-GCM-WEB"><a href="#HTTP1-x-TLS-WS-AES-128-GCM-WEB" class="headerlink" title="HTTP1.x+TLS+WS+AES-128-GCM+WEB"></a>HTTP1.x+TLS+WS+AES-128-GCM+WEB</h3><ul><li><code>three 20 &quot;speedtest-cli --mini [http://n3kr.google.com](http://n3kr.google.com/) --csv&quot;</code></li><li><strong>clash</strong></li></ul><table><thead><tr><th>0</th><th>1829.87</th><th>1848.88</th></tr></thead><tbody><tr><td>1</td><td>1856.46</td><td>1862.17</td></tr><tr><td>2</td><td>1883.04</td><td>962.03</td></tr><tr><td>3</td><td>1880.82</td><td>85.32</td></tr><tr><td>4</td><td>1874.22</td><td>1843.67</td></tr><tr><td>5</td><td>1886.13</td><td>452.37</td></tr><tr><td>6</td><td>1884.27</td><td>1679.2</td></tr><tr><td>7</td><td>1877.98</td><td>2068.18</td></tr><tr><td>8</td><td>1866.52</td><td>438.04</td></tr><tr><td>9</td><td>1861.99</td><td>1761.73</td></tr><tr><td>10</td><td>1881.63</td><td>1622.57</td></tr><tr><td>11</td><td>1890.39</td><td>543.63</td></tr><tr><td>12</td><td>280.41</td><td>2282.18</td></tr><tr><td>13</td><td>1843.48</td><td>1100.14</td></tr><tr><td>14</td><td>1867.55</td><td>94.3</td></tr><tr><td>15</td><td>1884.06</td><td>233.99</td></tr><tr><td>16</td><td>1849.24</td><td>2343.5</td></tr><tr><td>17</td><td>1885.6</td><td>128.86</td></tr><tr><td>18</td><td>1841.05</td><td>344.33</td></tr><tr><td>19</td><td>1868.43</td><td>421.24</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/8.png" alt="Untitled"></p><ul><li><strong>v2ray client</strong></li></ul><table><thead><tr><th>序号</th><th>下载</th><th>上传</th></tr></thead><tbody><tr><td>0</td><td>1844.75</td><td>462.54</td></tr><tr><td>1</td><td>1900.02</td><td>154.19</td></tr><tr><td>2</td><td>1866.24</td><td>71.44</td></tr><tr><td>3</td><td>1873.19</td><td>455.46</td></tr><tr><td>4</td><td>1899.42</td><td>671.59</td></tr><tr><td>5</td><td>1868.68</td><td>102.96</td></tr><tr><td>6</td><td>1886.71</td><td>175.74</td></tr><tr><td>7</td><td>1833.61</td><td>202.97</td></tr><tr><td>8</td><td>1852.31</td><td>331.49</td></tr><tr><td>9</td><td>1867.58</td><td>1285.72</td></tr><tr><td>10</td><td>1884.36</td><td>1376.54</td></tr><tr><td>11</td><td>1831.86</td><td>416.34</td></tr><tr><td>12</td><td>1872.34</td><td>179.22</td></tr><tr><td>13</td><td>1867.74</td><td>1349.64</td></tr><tr><td>14</td><td>1830.08</td><td>718.3</td></tr><tr><td>15</td><td>1880.34</td><td>177.74</td></tr><tr><td>16</td><td>1896.96</td><td>608.69</td></tr><tr><td>17</td><td>1908.02</td><td>18.55</td></tr><tr><td>18</td><td>1859.84</td><td>170.36</td></tr><tr><td>19</td><td>1878.93</td><td>196.64</td></tr></tbody></table><p><img src="/images/v2ray/benchmark/9.png" alt="Untitled"></p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul><li>单看 HTTP 1.x 的话，无论是 NONE、AUTO还是 AES-128-GCM，下载都区别不大，上传貌似 AUTO 要好一点，推荐 Clash HTTP1.x+TLS+WS+AUTO+WEB</li><li>单看 HTTP/2 的话，AUTO 和 AES-128-GCM 在下载时略优于 NONE，上传貌似 AES-128-GCM略优一点，平均速度三种都差不多，抖动的话AES-128-GCM小点。</li><li>不知道是 HTTP/2 目前线程数量有限还是怎么，下载只有 HTTP 1.x 的一半。速度倒是差不多有后者的两倍。</li></ul><blockquote><p>推荐配置</p></blockquote><ul><li>对于大带宽、延迟一般的机器还是使用传统的 WSS（HTTP1.x+TLS+WS+AUTO+WEB）</li><li>对于带宽有限、延迟较低的机器，推荐使用 H2（HTTP/2+TLS+H2C+AES-128-GCM+WEB）</li></ul><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul><li>完整测速结果：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvMVZGSllqUVVwZDBySU9TbVhuOGVjRWlLV3d6RVp1aTVNbzdDT2RxaEtpcTgvZWRpdD91c3A9c2hhcmluZw==">https://docs.google.com/spreadsheets/d/1VFJYjQUpd0rIOSmXn8ecEiKWwzEZui5Mo7COdqhKiq8/edit?usp=sharing<i class="fa fa-external-link-alt"></i></span></li><li>配置文件：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL3YycmF5X2JhbmNobWFyaw==">https://github.com/IITII/v2ray_banchmark<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> v2ray </category>
          
          <category> speedtest </category>
          
      </categories>
      
      
        <tags>
            
            <tag> v2ray </tag>
            
            <tag> HTTP/2+TLS+H2C+AUTO+WEB </tag>
            
            <tag> HTTP/2+TLS+H2C+NONE+WEB </tag>
            
            <tag> HTTP/2+TLS+H2C+AES-128-GCM+WEB </tag>
            
            <tag> HTTP1.x+TLS+WS+NONE+WEB </tag>
            
            <tag> HTTP1.x+TLS+WS+AES-128-GCM+WEB </tag>
            
            <tag> speedtest </tag>
            
            <tag> h2c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建自己的 SpeedTest 测速节点</title>
      <link href="/2022/02/27/1/"/>
      <url>/2022/02/27/1/</url>
      
        <content type="html"><![CDATA[<h2 id="用过的工具"><a href="#用过的工具" class="headerlink" title="用过的工具"></a>用过的工具</h2><ul><li>librespeed/speedtest<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpYnJlc3BlZWQvc3BlZWR0ZXN0L2Jsb2IvbWFzdGVyL2RvY19kb2NrZXIubWQ=">https://github.com/librespeed/speedtest/blob/master/doc_docker.md<i class="fa fa-external-link-alt"></i></span></li><li>测速服务端，貌似只能网页</li><li>搭来玩玩还是不错的</li><li>换端口貌似有问题？</li><li><code>docker run -e MODE=standalone -p 80:80 -it adolfintel/speedtest</code></li></ul></li><li>iPerf3<ul><li><span class="exturl" data-url="aHR0cHM6Ly9pcGVyZi5mci9pcGVyZi1kb3dubG9hZC5waHA=">https://iperf.fr/iperf-download.php<i class="fa fa-external-link-alt"></i></span></li><li>性能不错</li><li>无法通过代理测速</li></ul></li><li>goperf<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2h1emhhbzM3L2dvcGVyZg==">https://github.com/huzhao37/goperf<i class="fa fa-external-link-alt"></i></span></li><li>性能不如 iPerf3</li><li>配置很多</li><li>但是好像无法通过代理访问</li><li>只能一直测速，无法指定测速总次数</li><li>缺少统计</li><li>测速时客户端退出，服务端也会退出</li></ul></li><li>openspeedtest<ul><li><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL29wZW5zcGVlZHRlc3QvbGF0ZXN0">https://hub.docker.com/r/openspeedtest/latest<i class="fa fa-external-link-alt"></i></span></li><li>只能网页</li><li><code>docker run --restart=unless-stopped --name=openspeedtest -d -p 3000:3000 openspeedtest/latest</code></li></ul></li><li>speedtest<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuc3BlZWR0ZXN0Lm5ldC8=">https://www.speedtest.net/<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuc3BlZWR0ZXN0Lm5ldC96aC1IYW5zL2FwcHMvY2xp">https://www.speedtest.net/zh-Hans/apps/cli<i class="fa fa-external-link-alt"></i></span></li><li>性能不错，节点较多</li><li>支持网页和命令行</li><li>无法通过代理测速</li><li><code>sudo apt-get install curl &amp;&amp; curl -s [https://install.speedtest.net/app/cli/install.deb.sh](https://install.speedtest.net/app/cli/install.deb.sh) | sudo bash &amp;&amp; sudo apt-get install speedtest</code></li></ul></li><li>speedtest-cli<ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NpdmVsL3NwZWVkdGVzdC1jbGk=">https://github.com/sivel/speedtest-cli<i class="fa fa-external-link-alt"></i></span></li><li><code>sudo apt install speedtest-cli</code></li><li>性能不错</li><li>支持代理测速</li><li>节点较少，而且存在被ban的可能性 （比如测着测着，这个节点就消失了。。。。</li></ul></li><li>Speedtest Custom<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cub29rbGEuY29tL3NwZWVkdGVzdC1jdXN0b20=">https://www.ookla.com/speedtest-custom<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuc3BlZWR0ZXN0Lm5ldC9taW5p">https://www.speedtest.net/mini<i class="fa fa-external-link-alt"></i></span></li><li>经过复杂的注册后，这个其实和 speedtest 是一个东西，只不过能自定义界面。。。</li></ul></li><li>mlabbe/speedtest-mini<ul><li><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL21sYWJiZS9zcGVlZHRlc3QtbWluaQ==">https://hub.docker.com/r/mlabbe/speedtest-mini<i class="fa fa-external-link-alt"></i></span></li><li><code>docker run --restart=unless-stopped --name=speedtest -d -p 80:8080 mlabbe/speedtest-mini</code></li><li>已经废弃了，但是还是能用</li><li><code>speedtest-cli --mini [speedtest_mini_addr]</code></li><li>支持命令行</li><li>支持代理测速</li><li>网页好像不太行，，，（用的 flash，那没事了</li></ul></li></ul><h2 id="获取源文件"><a href="#获取源文件" class="headerlink" title="获取源文件"></a>获取源文件</h2><ul><li>因为 SpeedTest Mini 已经废弃了，所以直接从 <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3BlZWR0ZXN0Lm5ldC8=">https://www.speedtest.net/<i class="fa fa-external-link-alt"></i></span> 下载下来的压缩包好像无法解压。不过可以从 mlabbe/speedtest-mini 的 docker image中提取出来。</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL3YycmF5X2JhbmNobWFyay9yYXcvbWFpbi9zcGVlZHRlc3RfbWluaS50YXIuZ3o=">speedtest_mini.tar.gz<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id="安装主服务"><a href="#安装主服务" class="headerlink" title="安装主服务"></a>安装主服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update -y &amp;&amp; sudo apt install nginx php-fpm speedtest-cli -y</span><br><span class="line"><span class="built_in">cd</span> /var/www/html/ &amp;&amp; tar -xzvf speedtest_mini.tar.gz .</span><br></pre></td></tr></table></figure><ul><li>如果直接访问网页也无法显示的话，检查一下NGINX日志文件和文件权限，必要时可以开启 php 反代</li><li>网页基于 Flash，显示 <code>Speedtest.net Mini requires at least version 8 of Flash. Please update your client</code>的话也很正常, 毕竟是废弃5年的项目了…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    index index index.html index.htm index.php.html index.nginx-debian.html;</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        include snippets/fastcgi-php.conf;</span><br><span class="line">        fastcgi_pass unix:/run/php/php-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测速"><a href="#测速" class="headerlink" title="测速"></a>测速</h2><ul><li><code>speedtest-cli --mini http://localhost:80</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯ speedtest-cli --mini http://localhost:80</span><br><span class="line">Retrieving speedtest.net configuration...</span><br><span class="line">Testing from Oracle Cloud (x.x.x.x)...</span><br><span class="line">Hosted by Speedtest Mini (localhost:80) [0.00 km]: 0.127 ms</span><br><span class="line">Testing download speed................................................................................</span><br><span class="line">Download: 4546.08 Mbit/s</span><br><span class="line">Testing upload speed......................................................................................................</span><br><span class="line">Upload: 3681.71 Mbit/s</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>这样我们就已经搭建好了一个简单的 SpeedTest Mini 测速节点。可以用来测试内网速度，或者过代理后的速度。</li></ul>]]></content>
      
      
      <categories>
          
          <category> speedtest </category>
          
      </categories>
      
      
        <tags>
            
            <tag> speedtest </tag>
            
            <tag> cli </tag>
            
            <tag> speedtest mini </tag>
            
            <tag> 搭建自己的 SpeedTest 测速节点 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA Database 连接指定 hive 版本</title>
      <link href="/2022/01/07/1/"/>
      <url>/2022/01/07/1/</url>
      
        <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>hive jdbc 的驱动并不是通用的，链接 hive 需要对应版本的 jdbc 驱动</p><p>要不然可能会这样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The specified database user/password combination is rejected: [ 08S01] Could not open client transport with JDBC Uri: jdbc:hive2://192.168.1.***:10000: Could not establish connection to jdbc:hive2://192.168.1.***:10000: Required field &#x27;client_protocol&#x27; is unset! Struct:TOpenSessionReq(client_protocol:null, configuration:&#123;set:hiveconf:hive.server2.thrift.resultset.default.fetch.size=1000, use:database=default&#125;) [ 08S01] Could not establish connection to jdbc:hive2://192.168.1.***:10000: Required field &#x27;client_protocol&#x27; is unset! Struct:TOpenSessionReq(client_protocol:null, configuration:&#123;set:hiveconf:hive.server2.thrift.resultset.default.fetch.size=1000, use:database=default&#125;)</span><br></pre></td></tr></table></figure><ul><li>以 hive 1.2.1 版本为例</li></ul><h3 id="驱动"><a href="#驱动" class="headerlink" title="驱动"></a>驱动</h3><ul><li><p>hive 1.2.1, 下载 standalone jar<br><span class="exturl" data-url="aHR0cHM6Ly9tdm5yZXBvc2l0b3J5LmNvbS9hcnRpZmFjdC9vcmcuYXBhY2hlLmhpdmUvaGl2ZS1qZGJjLzEuMi4x">https://mvnrepository.com/artifact/org.apache.hive/hive-jdbc/1.2.1<i class="fa fa-external-link-alt"></i></span></p></li><li><p>hadoop common 2.10.0 （这个版本需要根据具体的 hdfs 版本来确认，选择 2.10.0 也不是不行<br><span class="exturl" data-url="aHR0cHM6Ly9tdm5yZXBvc2l0b3J5LmNvbS9hcnRpZmFjdC9vcmcuYXBhY2hlLmhhZG9vcC9oYWRvb3AtY29tbW9uLzIuMTAuMA==">https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-common/2.10.0<i class="fa fa-external-link-alt"></i></span></p></li></ul><blockquote><p>如果没有 hadoop common 包的话，会这样  </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Driver class &#x27;org.apache.hadoop.conf.Configuration&#x27; not found.</span><br></pre></td></tr></table></figure><h3 id="添加-User-Driver"><a href="#添加-User-Driver" class="headerlink" title="添加 User Driver"></a>添加 User Driver</h3><p><img src="/images/hive/driver/1.png" alt="alt"><br><img src="/images/hive/driver/2.png" alt="alt"></p>]]></content>
      
      
      <categories>
          
          <category> tool </category>
          
      </categories>
      
      
        <tags>
            
            <tag> database </tag>
            
            <tag> idea </tag>
            
            <tag> hive 1.2.1 </tag>
            
            <tag> Driver class &#39;org.apache.hadoop.conf.Configuration&#39; not found. </tag>
            
            <tag> hive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次奇怪 systemd-resolved 出错</title>
      <link href="/2021/11/02/1/"/>
      <url>/2021/11/02/1/</url>
      
        <content type="html"><![CDATA[<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="systemd-resolved"><a href="#systemd-resolved" class="headerlink" title="systemd-resolved"></a>systemd-resolved</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">❯ systemctl status systemd-resolved.service</span><br><span class="line">● systemd-resolved.service - Network Name Resolution</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/systemd-resolved.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: failed (Result: exit-code) since Mon 2021-11-01 16:38:05 CST; 23h ago</span><br><span class="line">       Docs: man:systemd-resolved.service(8)</span><br><span class="line">             https://www.freedesktop.org/wiki/Software/systemd/resolved </span><br><span class="line">             https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers </span><br><span class="line">             https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients </span><br><span class="line">    Process: 2515466 ExecStart=/lib/systemd/systemd-resolved (code=exited, status=226/NAMESPACE)</span><br><span class="line">   Main PID: 2515466 (code=exited, status=226/NAMESPACE)</span><br><span class="line"></span><br><span class="line">Nov 01 16:38:04 hkt.mcmc.live systemd[1]: Stopped Network Name Resolution.</span><br><span class="line">Nov 01 16:38:04 hkt.mcmc.live systemd[1]: Starting Network Name Resolution...</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: systemd-resolved.service: Main process exited, code=exited, status=226/NAMESPACE</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: systemd-resolved.service: Failed with result <span class="string">&#x27;exit-code&#x27;</span>.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: Failed to start Network Name Resolution.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: systemd-resolved.service: Scheduled restart job, restart counter is at 5.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: Stopped Network Name Resolution.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: systemd-resolved.service: Start request repeated too quickly.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: systemd-resolved.service: Failed with result <span class="string">&#x27;exit-code&#x27;</span>.</span><br><span class="line">Nov 01 16:38:05 hkt.mcmc.live systemd[1]: Failed to start Network Name Resolution.</span><br></pre></td></tr></table></figure><h4 id="apt-update"><a href="#apt-update" class="headerlink" title="apt update"></a>apt update</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">❯ apt update</span><br><span class="line">Hit:1 http://mirrors.tencentyun.com/ubuntu focal InRelease</span><br><span class="line">Hit:2 http://mirrors.tencentyun.com/ubuntu focal-security InRelease</span><br><span class="line">Hit:3 http://mirrors.tencentyun.com/ubuntu focal-updates InRelease</span><br><span class="line">0% [Connecting to ppa.launchpad.net (91.189.95.85)]gpgv: Signature made Fri Apr 24 01:34:17 2020 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Fri Apr 24 01:34:17 2020 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">0% [Connecting to ppa.launchpad.net (91.189.95.85)]gpgv: Signature made Tue Nov  2 05:30:01 2021 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Tue Nov  2 05:30:01 2021 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">0% [Waiting <span class="keyword">for</span> headers]gpgv: Signature made Tue Nov  2 05:30:35 2021 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Tue Nov  2 05:30:35 2021 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">Hit:4 http://ppa.launchpad.net/alessandro-strada/ppa/ubuntu focal InRelease</span><br><span class="line">0% [Working]gpgv: Signature made Sun Oct 24 03:17:20 2021 CST</span><br><span class="line">gpgv:                using RSA key 9EA4D6FCA5D37A5D1CA9C09AAD5F235DF639B041</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Launchpad PPA for Alessandro Strada&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">Reading package lists... Done</span><br></pre></td></tr></table></figure><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><h4 id="apt-update-1"><a href="#apt-update-1" class="headerlink" title="apt update"></a>apt update</h4><ul><li>解决方法见：<a href="/2021/11/01/1/">apt update 出现 cannot create /dev/null: Permission denied</a><h4 id="systemd-resolved-1"><a href="#systemd-resolved-1" class="headerlink" title="systemd-resolved"></a>systemd-resolved</h4></li><li>初步怀疑是 dns 出了问题，然后并不是，只是因为解析服务挂了</li></ul><ol><li>cat /lib/systemd/system/systemd-resolved.service</li><li>直接执行启动解析服务，没有任何错误，应该是上面修复造成的影响 <code>/lib/systemd/systemd-resolved</code></li><li>直接重启服务，启动成功</li></ol><ul><li>所以问题就很明显了，systemd-resolved 启动需要用到 /dev/null 设备，然而该设备出了问题，导致启动失败</li></ul><h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><ul><li>重启就好了，重启后该设备会自动重新创建</li></ul><h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><ul><li>手动重新创建该设备</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /dev/null; <span class="built_in">mknod</span> -m 666 /dev/null c 1 3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> dns </category>
          
      </categories>
      
      
        <tags>
            
            <tag> systemd-resolved </tag>
            
            <tag> dns </tag>
            
            <tag> linux </tag>
            
            <tag> systemd-resolved (code=exited, status=226/NAMESPACE) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apt update 出现 cannot create /dev/null: Permission denied</title>
      <link href="/2021/11/01/1/"/>
      <url>/2021/11/01/1/</url>
      
        <content type="html"><![CDATA[<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul><li>原因是 /dev/null 设备可能被常规文件替换了，重新创建即可</li></ul><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><ul><li>重启就好了，重启后该设备会自动重新创建</li></ul><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><ul><li>手动重新创建该设备</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /dev/null; <span class="built_in">mknod</span> -m 666 /dev/null c 1 3</span><br></pre></td></tr></table></figure><ul><li>重建之后看起来就正常了</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hit:1 http://mirrors.tencentyun.com/ubuntu focal InRelease</span><br><span class="line">Hit:2 http://mirrors.tencentyun.com/ubuntu focal-security InRelease</span><br><span class="line">Hit:3 http://mirrors.tencentyun.com/ubuntu focal-updates InRelease</span><br><span class="line">Hit:4 http://ppa.launchpad.net/alessandro-strada/ppa/ubuntu focal InRelease</span><br><span class="line">Reading package lists... Done</span><br></pre></td></tr></table></figure><h3 id="问题表现"><a href="#问题表现" class="headerlink" title="问题表现"></a>问题表现</h3><blockquote><p>这一大堆，我也懒得看…  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">❯ apt update</span><br><span class="line">Hit:1 http://mirrors.tencentyun.com/ubuntu focal InRelease</span><br><span class="line">Hit:2 http://mirrors.tencentyun.com/ubuntu focal-security InRelease</span><br><span class="line">Hit:3 http://mirrors.tencentyun.com/ubuntu focal-updates InRelease</span><br><span class="line">0% [Connecting to ppa.launchpad.net (91.189.95.85)]gpgv: Signature made Fri Apr 24 01:34:17 2020 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Fri Apr 24 01:34:17 2020 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">0% [Connecting to ppa.launchpad.net (91.189.95.85)]gpgv: Signature made Tue Nov  2 05:30:01 2021 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Tue Nov  2 05:30:01 2021 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">0% [Waiting <span class="keyword">for</span> headers]gpgv: Signature made Tue Nov  2 05:30:35 2021 CST</span><br><span class="line">gpgv:                using RSA key 3B4FE6ACC0B21F32</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2012) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">gpgv: Signature made Tue Nov  2 05:30:35 2021 CST</span><br><span class="line">gpgv:                using RSA key 871920D1991BC93C</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Ubuntu Archive Automatic Signing Key (2018) &lt;ftpmaster@ubuntu.com&gt;&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">Hit:4 http://ppa.launchpad.net/alessandro-strada/ppa/ubuntu focal InRelease</span><br><span class="line">0% [Working]gpgv: Signature made Sun Oct 24 03:17:20 2021 CST</span><br><span class="line">gpgv:                using RSA key 9EA4D6FCA5D37A5D1CA9C09AAD5F235DF639B041</span><br><span class="line">gpgv: Good signature from <span class="string">&quot;Launchpad PPA for Alessandro Strada&quot;</span></span><br><span class="line">/usr/bin/apt-key: 57: cannot create /dev/null: Permission denied</span><br><span class="line">Reading package lists... Done</span><br></pre></td></tr></table></figure><h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly91bml4LnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8xNDY2MzMvYmFzaC1kZXYtbnVsbC1wZXJtaXNzaW9uLWRlbmllZA==">https://unix.stackexchange.com/questions/146633/bash-dev-null-permission-denied<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> apt </category>
          
          <category> ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bug </tag>
            
            <tag> ubuntu </tag>
            
            <tag> apt </tag>
            
            <tag> cannot create /dev/null </tag>
            
            <tag> /dev/null </tag>
            
            <tag> Permission denied </tag>
            
            <tag> apt update </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Asrock B460M Pro 安装 BigSur</title>
      <link href="/2021/09/10/1/"/>
      <url>/2021/09/10/1/</url>
      
        <content type="html"><![CDATA[<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><table><thead><tr><th align="center">名称</th><th align="center">型号</th><th align="center">价格</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">主板</td><td align="center">Asrock B460M Pro</td><td align="center">600</td><td align="center">可以考虑换B560M</td></tr><tr><td align="center">CPU</td><td align="center">i5-10600K</td><td align="center">1300</td><td align="center">买 10600 也可以，因为跑不满，主板也有BFB之类的功能</td></tr><tr><td align="center">CPU散热器</td><td align="center">利民AK120 plus</td><td align="center">130</td><td align="center">双塔压i5 10600k问题不大，平时使用没啥声音</td></tr><tr><td align="center">集显</td><td align="center">Intel UHD 630</td><td align="center">0</td><td align="center">集显又不是不能用</td></tr><tr><td align="center">内存</td><td align="center">海盗船 16x2 3200MHz</td><td align="center">800</td><td align="center">血亏，主板和CPU限制最高 2666MHz…，换B560M还能超</td></tr><tr><td align="center">硬盘</td><td align="center">三星 PM981 128G</td><td align="center">100？</td><td align="center">很久以前的硬盘了，又不是不能用</td></tr><tr><td align="center">蓝牙/WiFi</td><td align="center">FV T919</td><td align="center">180</td><td align="center">咸鱼二手，黑果免驱，支持 AirDrop 和 handoff，windows需要下载驱动</td></tr><tr><td align="center">机箱</td><td align="center">先马 趣造 钛灰</td><td align="center">350</td><td align="center">jd这家自营店态度太拉了，不如咸鱼买全新</td></tr><tr><td align="center">电源</td><td align="center">-</td><td align="center">60？</td><td align="center">咸鱼60包邮，不能再多了</td></tr></tbody></table><ul><li>内存加了光威天策 32G, 固态加了西数 SN770, 多花了大概 1000</li></ul><blockquote><p>合计：600 + 1300 + 130 + 800 + 100 + 180 + 350 + 60 = 3520  </p></blockquote><p><img src="/images/macos/bmac/b460m/info_1.png" alt="mac_info"></p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li><strong>先找一台 Mac 电脑</strong></li></ul><h4 id="下载OC"><a href="#下载OC" class="headerlink" title="下载OC"></a>下载OC</h4><blockquote><p>选择 Download zip  </p></blockquote><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lyYW1ibGVyMjAwMS9IYWNraW50b3NoLUludGVsLWk1LTEwNjAwLVJYNTYwLUFzUm9jay1CNDYwTS1Qcm80">yrambler2001/Hackintosh-Intel-i5-10600-RX560-AsRock-B460M-Pro4<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL0hhY2tpbnRvc2gtSW50ZWwtaTUtMTA2MDBLLUFzUm9jay1CNDYwTS1Qcm80">IITII/Hackintosh-Intel-i5-10600K-AsRock-B460M-Pro4<i class="fa fa-external-link-alt"></i></span></li></ul><h4 id="生成-MLB-SystemSerialNumber-SystemUUID"><a href="#生成-MLB-SystemSerialNumber-SystemUUID" class="headerlink" title="生成 MLB, SystemSerialNumber, SystemUUID"></a>生成 MLB, SystemSerialNumber, SystemUUID</h4><blockquote><p>在需要安装 BigSur 的电脑执行这一步操作  </p></blockquote><ol><li>下载 zip, <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvcnBuZXd0L0dlblNNQklPUw==">corpnewt/GenSMBIOS<i class="fa fa-external-link-alt"></i></span><ol><li>linux: <code>chmod +x GenSMBIOS.command &amp;&amp; ./GenSMBIOS.command</code></li><li>windows: 双击<code>GenSMBIOS.bat</code></li></ol></li><li>按需要的mac机型输入mac标识符，比如: <code>iMac19,1</code></li><li>按下回车，就会出现 MLB, SystemSerialNumber, SystemUUID 信息</li><li>将其保存到文本文件</li></ol><h4 id="修改OC"><a href="#修改OC" class="headerlink" title="修改OC"></a>修改OC</h4><ol><li>将下载的 oc 解压</li><li>使用 vscode 进行编辑</li><li>找到 UUID 关键字</li><li>将上下文的 MLB, SystemSerialNumber, SystemUUID 的 data 值修改为之前保存的值</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>AdviseWindows<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>MaxBIOSVersion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>MLB<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xxxxxxxxxxxxxxx<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProcessorType<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ROM<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span>ESIzRFVm<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SpoofVendor<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SystemMemoryStatus<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>Auto<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SystemProductName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>iMac20,1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SystemSerialNumber<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xxxxxxxxxxx<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>SystemUUID<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xxxxxxxx-xxxxx-xxxxx-xxxx-xxxxxxxx<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="下载-BigSur-系统镜像"><a href="#下载-BigSur-系统镜像" class="headerlink" title="下载 BigSur 系统镜像"></a>下载 BigSur 系统镜像</h4><ul><li>使用 Mac 电脑在 App Store下载 BigSur 镜像</li><li><span class="exturl" data-url="aHR0cHM6Ly9zdXBwb3J0LmFwcGxlLmNvbS96aC1jbi9IVDIwMTQ3NQ==">Apple Support<i class="fa fa-external-link-alt"></i></span></li></ul><blockquote><p>或者直接打开该连接：<span class="exturl" data-url="aHR0cHM6Ly9hcHBzLmFwcGxlLmNvbS9jbi9hcHAvbWFjb3MtYmlnLXN1ci9pZDE1MjY4NzgxMzI/bXQ9MTI=">Apple Store BigSur<i class="fa fa-external-link-alt"></i></span></p></blockquote><h4 id="制作-BigSur-启动盘"><a href="#制作-BigSur-启动盘" class="headerlink" title="制作 BigSur 启动盘"></a>制作 BigSur 启动盘</h4><blockquote><p>和 <a href="https://iitii.github.io/2021/01/24/1/">在 Dell 5577 上使用 OC(OpenCore) 安装BigSur</a> 一样的操作  </p></blockquote><h5 id="分区表说明"><a href="#分区表说明" class="headerlink" title="分区表说明"></a>分区表说明</h5><ul><li>硬盘分区应当为 GPT 分区表，才能正常安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">macos<span class="comment"># diskutil list</span></span><br><span class="line">/dev/disk1 (internal, physical):</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *1.0 TB     disk1</span><br><span class="line">   1:                        EFI ⁨EFI⁩                     209.7 MB   disk1s1</span><br><span class="line">   2:                 Apple_APFS ⁨Container disk3⁩         128.0 GB   disk1s2</span><br></pre></td></tr></table></figure><h5 id="制作可移动安装介质"><a href="#制作可移动安装介质" class="headerlink" title="制作可移动安装介质"></a>制作可移动安装介质</h5><ol><li>将U盘插到可以运行 MacOS 的电脑上</li><li>使用 <code>diskutil list</code> 查看硬盘列表，确定硬盘标识符</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">❯ diskutil list</span><br><span class="line">...</span><br><span class="line">/dev/disk1 (internal, physical):</span><br><span class="line">...</span><br><span class="line">/dev/disk2 (synthesized):</span><br><span class="line">...</span><br><span class="line">/dev/disk3 (synthesized):</span><br><span class="line">...</span><br><span class="line">/dev/disk4 (internal, physical):</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *31.5 GB    disk4</span><br><span class="line">   1:                        EFI ⁨EFI⁩                     209.7 MB   disk4s1</span><br><span class="line">   2:                  Apple_HFS ⁨apple⁩                   31.1 GB    disk4s2</span><br></pre></td></tr></table></figure><blockquote><p>从这里我们可以知道硬盘的标识符为 <code>/dev/disk4</code>  </p></blockquote><ol start="3"><li>使用 <code>diskutil eraseDisk HFS+ [分区卷标] [硬盘标识符]</code> 清空硬盘并格式化为 MacOS 扩展分区（HFS+），会自动将磁盘格式化为 GPT 分区表</li></ol><blockquote><p>这里随便填了一个 install<br>如果格式化失败并且提示无法格式化具有 APFS 容器的分区的话，请先使用磁盘工具将 APFS 分区格式化为其他类型的分区。如：HFS+, exFat  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">❯ diskutil eraseDisk HFS+ install /dev/disk4</span><br><span class="line">Started erase on disk4</span><br><span class="line">Unmounting disk</span><br><span class="line">Creating the partition map</span><br><span class="line">Waiting <span class="keyword">for</span> partitions to activate</span><br><span class="line">Formatting disk4s2 as Mac OS Extended with name install</span><br><span class="line">Initialized /dev/rdisk4s2 as a 29 GB case-insensitive HFS Plus volume</span><br><span class="line">Mounting disk</span><br><span class="line">Finished erase on disk4</span><br></pre></td></tr></table></figure><ol start="4"><li>格式化以后就可以开始写入安装镜像了</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先我们需要进入 BigSur 镜像里面对应的文件夹</span></span><br><span class="line">❯ <span class="built_in">cd</span> <span class="string">&quot;Install macOS Big Sur.app/Contents/Resources&quot;</span></span><br><span class="line">❯ sudo ./createinstallmedia --volume /Volumes/install</span><br><span class="line">Password:</span><br><span class="line">Ready to start.</span><br><span class="line">To <span class="built_in">continue</span> we need to erase the volume at /Volumes/install.</span><br><span class="line">If you wish to <span class="built_in">continue</span> <span class="built_in">type</span> (Y) <span class="keyword">then</span> press <span class="built_in">return</span>: y</span><br><span class="line">Erasing disk: 0%... 10%... 20%... 30%... 100%</span><br><span class="line">Copying to disk: 0%... 10%... 20%... 30%... 40%... 50%... 60%... 70%... 80%... 90%... 100%</span><br><span class="line">Making disk bootable...</span><br><span class="line">Install media now available at <span class="string">&quot;/Volumes/Install macOS Big Sur&quot;</span></span><br></pre></td></tr></table></figure><h5 id="复制引导文件"><a href="#复制引导文件" class="headerlink" title="复制引导文件"></a>复制引导文件</h5><ol><li>之前已经修改过了 OC 文件，这里直接挂载 efi 分区即可</li></ol><blockquote><p>以 <code>/dev/disk4s1</code> 为例  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; <span class="built_in">mkdir</span> 1</span><br><span class="line">sudo mount -t msdos /dev/disk4s1 /tmp/1</span><br><span class="line">open /tmp/1</span><br><span class="line"><span class="comment"># 新打开的 finder 窗口里面应该会有一个 EFI 文件夹</span></span><br><span class="line"><span class="comment"># 如果没有的话请手动创建它, 然后将 OC 和 BOOT 文件夹拷贝过去</span></span><br></pre></td></tr></table></figure><blockquote><p>最后 EFI 分区的目录结构应该如下（注意：如果目录结构不对的话，是无法进入OC的引导界面的）  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/tmp/1</span><br><span class="line">├── EFI</span><br><span class="line">│   ├── BOOT</span><br><span class="line">│   └── OC</span><br></pre></td></tr></table></figure><h4 id="修改BIOS设置"><a href="#修改BIOS设置" class="headerlink" title="修改BIOS设置"></a>修改BIOS设置</h4><blockquote><p>Thanks to <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lyYW1ibGVyMjAwMQ==">yrambler2001<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><p><img src="/images/macos/bmac/b460m/bios_settings/000001.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000002.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000003.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000004.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000005.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000006.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000007.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000008.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000009.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000010.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000011.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000012.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000013.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000014.png" alt="alt"><br><img src="/images/macos/bmac/b460m/bios_settings/000015.png" alt="alt"></p><h3 id="正式安装"><a href="#正式安装" class="headerlink" title="正式安装"></a>正式安装</h3><ol><li>确保 OC 正确编辑，BIOS已修改以后即可开始安装</li><li>将启动盘插入主板后面板的USB接口（机箱前面板的接口大概率启动不了…）</li><li>开机</li><li>摁F11，进入启动项选择</li><li>选择自己的U盘</li><li>等待进度条加载, 然后自行选择就行</li></ol><blockquote><p>如果启动失败，显示禁止标志应该是 MLB, SystemSerialNumber, SystemUUID 设置有问题，重复试一下  </p></blockquote><h3 id="HDMI-输出紫屏"><a href="#HDMI-输出紫屏" class="headerlink" title="HDMI 输出紫屏"></a>HDMI 输出紫屏</h3><ul><li>应该是显存修复出了问题，使用我修改后的OC即可，然后重新走一遍流程</li></ul><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL0hhY2tpbnRvc2gtSW50ZWwtaTUtMTA2MDBLLUFzUm9jay1CNDYwTS1Qcm80">IITII/Hackintosh-Intel-i5-10600K-AsRock-B460M-Pro4<i class="fa fa-external-link-alt"></i></span></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> hack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> bigsur </tag>
            
            <tag> 华擎 B460M 黑苹果 </tag>
            
            <tag> 华擎 B460M pro 黑苹果 </tag>
            
            <tag> 黑苹果 生成 MLB, SystemSerialNumber, SystemUUID </tag>
            
            <tag> opencore 安装黑苹果 </tag>
            
            <tag> Big Sur </tag>
            
            <tag> 黑苹果 </tag>
            
            <tag> oc </tag>
            
            <tag> opencore </tag>
            
            <tag> hidpi </tag>
            
            <tag> Intel i5-10600K </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 GithubAction 自动更新部署 Hexo 博客</title>
      <link href="/2021/05/29/1/"/>
      <url>/2021/05/29/1/</url>
      
        <content type="html"><![CDATA[<h3 id="什么是Github-Action"><a href="#什么是Github-Action" class="headerlink" title="什么是Github Action"></a>什么是Github Action</h3><ul><li>Github Actions是Github推出的一个新的功能，可以为我们的项目自动化地构建工作流，例如代码检查，自动化打包，测试，发布版本等等。入口在项目 <code>Actions</code>。</li></ul><div class="note danger">            <p>该文章不涉及Github Action以及Hexo的教学。请自行查阅</p>          </div><h3 id="添加Github-Action"><a href="#添加Github-Action" class="headerlink" title="添加Github Action"></a>添加Github Action</h3><blockquote><p>可以在网页上 Actions 里编辑配置文件，也可以直接在源文件的仓库的本地目录添加直接 commit。  </p></blockquote><ul><li>本文直接在源文件的仓库的本地目录提交配置文件，将配置文件存至原文件仓库目录下的 .github/workflows/<em>随便起名</em>.yml。</li><li>脚本配置如下：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">CI</span> <span class="string">CD</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build-and-deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">🛎️</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span> </span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;Using Special Node Version&quot;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&quot;12&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">Hexo</span> <span class="string">site</span> <span class="string">⚗️</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;Github Action Env Checking...&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Node Version: `node -v`&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Coping theme config file&quot;</span></span><br><span class="line"><span class="string">          CONFIG_FILE=&quot;_config.yml&quot;</span></span><br><span class="line"><span class="string">          NEXT_THEME_FILE=&quot;next.theme.yml&quot;</span></span><br><span class="line"><span class="string">          THEME_DIR=&quot;themes/next&quot;</span></span><br><span class="line"><span class="string">          TARGET_FILE=&quot;$&#123;THEME_DIR&#125;/$&#123;CONFIG_FILE&#125;&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Copying theme config file&quot;</span></span><br><span class="line"><span class="string">          cp &quot;$&#123;NEXT_THEME_FILE&#125;&quot; &quot;$&#123;TARGET_FILE&#125;&quot;</span></span><br><span class="line"><span class="string">          head -n 1 &quot;$&#123;TARGET_FILE&#125;&quot;</span></span><br><span class="line"><span class="string">          # Install dependencies &amp;&amp; update env</span></span><br><span class="line"><span class="string">          echo &quot;Install npm dependencies&quot;</span></span><br><span class="line"><span class="string">          npm i</span></span><br><span class="line"><span class="string">          echo &quot;Load hexo binary...&quot;</span></span><br><span class="line"><span class="string">          export PATH=&quot;$PATH:./node_modules/.bin&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Hexo version: $(hexo -v)&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Gulp version: $(gulp -v)&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Gulp Tasks&quot; &amp;&amp; gulp --tasks</span></span><br><span class="line"><span class="string">          # Generate site &amp;&amp; minify site files, such as: html, js, css</span></span><br><span class="line"><span class="string">          hexo g --debug &amp;&amp; gulp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">🚀</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@3.6.2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">GITHUB_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">BRANCH:</span> <span class="string">gh-pages</span> <span class="comment"># The branch the action should deploy to.</span></span><br><span class="line">          <span class="attr">FOLDER:</span> <span class="string">public/</span> <span class="comment"># The folder the action should deploy.</span></span><br><span class="line">          <span class="attr">CLEAN:</span> <span class="literal">true</span> <span class="comment"># Automatically remove deleted </span></span><br><span class="line">          <span class="attr">PRESERVE:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="后续工作"><a href="#后续工作" class="headerlink" title="后续工作"></a>后续工作</h3><ul><li>构建出来的文件将会部署到 gh-pages 分支，将 Github Pages 的分支设置为其即可</li><li>主题文件名（next.theme.yml）请自行修改</li><li>需要配置主题可以参考: <a href="/2021/05/28/1/">Hexo Next 主题安装、配置及美化</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> cicd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> GitHubAction </tag>
            
            <tag> 自动化部署 </tag>
            
            <tag> Github Page </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Next 主题安装、配置及美化</title>
      <link href="/2021/05/28/1/"/>
      <url>/2021/05/28/1/</url>
      
        <content type="html"><![CDATA[<div class="note success">            <p>文章内容有点多，推荐使用 <code>CTRL+F</code> 快速查找</p>          </div><h3 id="前因"><a href="#前因" class="headerlink" title="前因"></a>前因</h3><ul><li>博客许久之前就上线了，但是当初比较简单，隐藏的问题有点多。随着时间推移，问题一个一个的暴露出来了(/□＼*)</li></ul><h3 id="必须支持的功能"><a href="#必须支持的功能" class="headerlink" title="必须支持的功能"></a>必须支持的功能</h3><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>为了现代化和可持续发展</p>            <i class="fa fa-quote-right"></i>          </blockquote><ul><li>暗黑主题</li><li>主题跟随系统</li><li>界面简洁</li><li>可配置功能多</li><li>主题持续更新</li><li>可以做到主题平滑升级</li></ul><h3 id="选择-hexo-next-theme-的理由？"><a href="#选择-hexo-next-theme-的理由？" class="headerlink" title="选择 hexo-next-theme 的理由？"></a>选择 hexo-next-theme 的理由？</h3><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>写又写不来，就只能这样子过过生活啦~</p>            <i class="fa fa-quote-right"></i>          </blockquote><ul><li>支持暗黑模式</li><li>主题跟随系统</li><li>可配置功能多</li><li>个性化程度高</li><li>比较简洁</li><li>文档简单易懂</li><li>Github 更新频繁（持续更新）</li><li>其他社区支持的主题要么不够简洁，要么不定期更新，要么不支持暗黑模式</li></ul><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="安装-NodeJS"><a href="#安装-NodeJS" class="headerlink" title="安装 NodeJS"></a>安装 NodeJS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash</span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="subst">$([ -z <span class="string">&quot;<span class="variable">$&#123;XDG_CONFIG_HOME-&#125;</span>&quot;</span> ] &amp;&amp; printf %s <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/.nvm&quot;</span> || printf %s <span class="string">&quot;<span class="variable">$&#123;XDG_CONFIG_HOME&#125;</span>/nvm&quot;</span>)</span>&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="comment"># This loads nvm</span></span><br><span class="line">nvm install --lts</span><br></pre></td></tr></table></figure><h4 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><h4 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h4><div class="note warning">            <p>因为我们使用 Github Pages 作为部署方式，所以我们最好需要将项目名称建立为: &lt;Github Username&gt;.github.io<br>比如：iitii.github.io</p>          </div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;project name&gt;</span><br></pre></td></tr></table></figure><h4 id="安装-Hexo-next-theme"><a href="#安装-Hexo-next-theme" class="headerlink" title="安装 Hexo-next-theme"></a>安装 Hexo-next-theme</h4><ol><li>进入项目文件夹</li><li><code>git clone -b master https://github.com/theme-next/hexo-theme-next.git themes/next --depth=1</code></li><li>修改站点 <code>_config.yml</code> 里面的 <code>theme</code> 的值为 <code>next</code></li></ol><div class="note warning">            <p>如果不在特别声明的情况下:</p><ul><li>站点配置文件指项目根目录下面的 <code>_config.yml</code></li><li>主题配置文件指主题文件夹下面的 <code>_config.yml</code></li></ul>          </div><h3 id="配置主题"><a href="#配置主题" class="headerlink" title="配置主题"></a>配置主题</h3><h4 id="修改网站基本信息"><a href="#修改网站基本信息" class="headerlink" title="修改网站基本信息"></a>修改网站基本信息</h4><ul><li>修改站点配置文件里面的 site 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">网站标题</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">网站副标题</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">网站描述</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">作者</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span> <span class="comment">#语言</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">&quot;Asia/Shanghai&quot;</span> <span class="comment">#时区</span></span><br></pre></td></tr></table></figure><h4 id="修改博客自动生成的链接"><a href="#修改博客自动生成的链接" class="headerlink" title="修改博客自动生成的链接"></a>修改博客自动生成的链接</h4><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL3poLWNuL2RvY3MvcGVybWFsaW5rcy5odG1s">永久链接（Permalinks）<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>默认的链接太长了，而且修改文章标题的话，会丢失原来的访问次数（不是同一个链接）</li><li>为了方便分享和管理，推荐设置成如下形式</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:second/</span></span><br><span class="line"><span class="comment">#permalink: :year/:month/:day/1/</span></span><br></pre></td></tr></table></figure><h4 id="文章按创建时间排序"><a href="#文章按创建时间排序" class="headerlink" title="文章按创建时间排序"></a>文章按创建时间排序</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Home page setting</span></span><br><span class="line"><span class="comment"># path: Root path for your blogs index page. (default = &#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># per_page: Posts displayed per page. (0 = disable pagination)</span></span><br><span class="line"><span class="comment"># order_by: Posts order. (Order by date descending by default)</span></span><br><span class="line"><span class="attr">index_generator:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="number">10</span> <span class="comment"># 每页数量</span></span><br><span class="line">  <span class="attr">order_by:</span> <span class="string">-date</span></span><br></pre></td></tr></table></figure><h4 id="修改新建文章时的模板"><a href="#修改新建文章时的模板" class="headerlink" title="修改新建文章时的模板"></a>修改新建文章时的模板</h4><blockquote><p>自定义 hexo new 生成 md 文件的模板  </p></blockquote><ul><li>修改站点文件夹下面的 <code>scaffolds/post.md</code> 和 <code>scaffolds/draft.md</code> 如下</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> &#123;&#123; <span class="string">title</span> &#125;&#125;</span><br><span class="line"><span class="attr">date:</span> &#123;&#123; <span class="string">date</span> &#125;&#125;</span><br><span class="line"><span class="attr">updated:</span> &#123;&#123; <span class="string">date</span> &#125;&#125;</span><br><span class="line"><span class="attr">permalink:</span> </span><br><span class="line"><span class="attr">top:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">password:</span></span><br><span class="line"><span class="attr">comments:</span> </span><br><span class="line"><span class="attr">copyright:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="attr">categories:</span> </span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">description:</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h4 id="设置博客主题跟随系统主题"><a href="#设置博客主题跟随系统主题" class="headerlink" title="设置博客主题跟随系统主题"></a>设置博客主题跟随系统主题</h4><ul><li>修改主题配置文件的 <code>darkmode</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dark Mode</span></span><br><span class="line"><span class="attr">darkmode:</span> <span class="string">auto</span> <span class="comment"># dark|light|auto</span></span><br></pre></td></tr></table></figure><h4 id="修改网站图标"><a href="#修改网站图标" class="headerlink" title="修改网站图标"></a>修改网站图标</h4><ul><li>修改主题配置文件的 favicon 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favicon:</span></span><br><span class="line">  <span class="attr">small:</span> <span class="string">/images/site/16memo.ico</span></span><br><span class="line">  <span class="attr">medium:</span> <span class="string">/images/site/32memo.ico</span></span><br><span class="line">  <span class="attr">apple_touch_icon:</span> <span class="string">/images/site/96memo.png</span></span><br><span class="line">  <span class="attr">safari_pinned_tab:</span> <span class="string">/images/site/memo.ico</span></span><br><span class="line">  <span class="comment"># small: /images/favicon-16x16-next.png</span></span><br><span class="line">  <span class="comment"># medium: /images/favicon-32x32-next.png</span></span><br><span class="line">  <span class="comment"># apple_touch_icon: /images/apple-touch-icon-next.png</span></span><br><span class="line">  <span class="comment"># safari_pinned_tab: /images/logo.svg</span></span><br><span class="line">  <span class="comment">#android_manifest: /images/manifest.json</span></span><br><span class="line">  <span class="comment">#ms_browserconfig: /images/browserconfig.xml</span></span><br></pre></td></tr></table></figure><h4 id="修改菜单栏"><a href="#修改菜单栏" class="headerlink" title="修改菜单栏"></a>修改菜单栏</h4><ul><li>修改主题配置文件里面的 <code>menu</code> 部分</li></ul><blockquote><p>Github 的链接可以去掉或者换成自己的  </p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="comment">#tags: /tags/ || fa fa-tags</span></span><br><span class="line">  <span class="comment">#categories: /categories/ || fa fa-th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="attr">Github:</span> <span class="string">https://github.com/iitii</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="attr">RSS:</span> <span class="string">/atom.xml</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-rss</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || fa fa-heartbeat</span></span><br></pre></td></tr></table></figure><h4 id="修改边栏的位置"><a href="#修改边栏的位置" class="headerlink" title="修改边栏的位置"></a>修改边栏的位置</h4><ul><li>修改主题配置文件里面的 <code>sidebar</code> 部分的 <code>position</code></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sidebar:</span></span><br><span class="line">  <span class="comment"># Sidebar Position.</span></span><br><span class="line">  <span class="comment"># position: left</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Manual define the sidebar width. If commented, will be default for:</span></span><br><span class="line">  <span class="comment"># Muse | Mist: 320</span></span><br><span class="line">  <span class="comment"># Pisces | Gemini: 240</span></span><br><span class="line">  <span class="comment">#width: 300</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sidebar Display (only for Muse | Mist), available values:</span></span><br><span class="line">  <span class="comment">#  - post    expand on posts automatically. Default.</span></span><br><span class="line">  <span class="comment">#  - always  expand for all pages automatically.</span></span><br><span class="line">  <span class="comment">#  - hide    expand only when click on the sidebar toggle icon.</span></span><br><span class="line">  <span class="comment">#  - remove  totally remove sidebar including sidebar toggle.</span></span><br><span class="line">  <span class="attr">display:</span> <span class="string">post</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sidebar padding in pixels.</span></span><br><span class="line">  <span class="attr">padding:</span> <span class="number">18</span></span><br><span class="line">  <span class="comment"># Sidebar offset from top menubar in pixels (only for Pisces | Gemini).</span></span><br><span class="line">  <span class="attr">offset:</span> <span class="number">12</span></span><br><span class="line">  <span class="comment"># Enable sidebar on narrow view (only for Muse | Mist).</span></span><br><span class="line">  <span class="attr">onmobile:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="边栏显示图像和社交信息"><a href="#边栏显示图像和社交信息" class="headerlink" title="边栏显示图像和社交信息"></a>边栏显示图像和社交信息</h4><ul><li>修改主题配置文件的 <code>avatar</code> 和 <code>social</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sidebar Avatar</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="comment"># Replace the default image and set the url here.</span></span><br><span class="line">  <span class="comment"># url: #/images/avatar.gif</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/images/site/avatar.jpeg</span> <span class="comment"># 图片地址</span></span><br><span class="line">  <span class="comment"># If true, the avatar will be dispalyed in circle.</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">true</span> <span class="comment"># 是否可旋转</span></span><br><span class="line">  <span class="comment"># If true, the avatar will be rotated with the cursor.</span></span><br><span class="line">  <span class="attr">rotated:</span> <span class="literal">true</span> <span class="comment"># 是否圆角</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Posts / Categories / Tags in sidebar.</span></span><br><span class="line"><span class="attr">site_state:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Social Links</span></span><br><span class="line"><span class="comment"># Usage: `Key: permalink || icon`</span></span><br><span class="line"><span class="comment"># Key is the link label showing to end users.</span></span><br><span class="line"><span class="comment"># Value before `||` delimiter is the target permalink, value after `||` delimiter is the name of Font Awesome icon.</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/iitii</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="attr">E-Mail:</span> <span class="string">mailto:ccmejx@gmail.com</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-envelope</span></span><br><span class="line">  <span class="attr">Telegram:</span> <span class="string">https://t.me/callmehelp</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-telegram</span></span><br><span class="line">  <span class="comment">#GitHub: https://github.com/yourname || fab fa-github</span></span><br><span class="line">  <span class="comment">#E-Mail: mailto:yourname@gmail.com || fa fa-envelope</span></span><br><span class="line">  <span class="comment">#Weibo: https://weibo.com/yourname || fab fa-weibo</span></span><br><span class="line">  <span class="comment">#Google: https://plus.google.com/yourname || fab fa-google</span></span><br><span class="line">  <span class="comment">#Twitter: https://twitter.com/yourname || fab fa-twitter</span></span><br><span class="line">  <span class="comment">#FB Page: https://www.facebook.com/yourname || fab fa-facebook</span></span><br><span class="line">  <span class="comment">#StackOverflow: https://stackoverflow.com/yourname || fab fa-stack-overflow</span></span><br><span class="line">  <span class="comment">#YouTube: https://youtube.com/yourname || fab fa-youtube</span></span><br><span class="line">  <span class="comment">#Instagram: https://instagram.com/yourname || fab fa-instagram</span></span><br><span class="line">  <span class="comment">#Skype: skype:yourname?call|chat || fab fa-skype</span></span><br><span class="line"></span><br><span class="line"><span class="attr">social_icons:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否启用</span></span><br><span class="line">  <span class="attr">icons_only:</span> <span class="literal">false</span> <span class="comment"># 只显示图标</span></span><br><span class="line">  <span class="attr">transition:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="页脚设置站点建立时间"><a href="#页脚设置站点建立时间" class="headerlink" title="页脚设置站点建立时间"></a>页脚设置站点建立时间</h4><blockquote><p>比如文章底部的: <code>© 2018 – 2021</code>  </p></blockquote><ul><li>修改主题配置文件 footer 部分的 since 的值为你想要的</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">since:</span> <span class="number">2018</span> <span class="comment">#设置站点建立的时间，默认为今年</span></span><br></pre></td></tr></table></figure><h4 id="修改页脚时间和作者之间的图标"><a href="#修改页脚时间和作者之间的图标" class="headerlink" title="修改页脚时间和作者之间的图标"></a>修改页脚时间和作者之间的图标</h4><ul><li>修改主题配置文件 footer 部分的 icon 的值为你想要的</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">icon:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fa</span> <span class="string">fa-heart</span> <span class="comment"># 图标 See: https://fontawesome.com/icons</span></span><br><span class="line">    <span class="attr">animated:</span> <span class="literal">true</span> <span class="comment"># 是否有动画效果</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">&quot;#ff0000&quot;</span> <span class="comment">#图标颜色</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">copyright:</span> <span class="comment"># 不填写将以站点配置文件里面的作者填充</span></span><br></pre></td></tr></table></figure><h4 id="隐藏页脚的-“由-xxxx-强力驱动”"><a href="#隐藏页脚的-“由-xxxx-强力驱动”" class="headerlink" title="隐藏页脚的 “由 xxxx 强力驱动”"></a>隐藏页脚的 “由 xxxx 强力驱动”</h4><ul><li>修改主题配置文件 footer 部分的 powered 的值为你想要的</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="comment"># 隐藏 footer &#x27;由 HEXO 强力驱动&#x27;</span></span><br><span class="line">  <span class="attr">powered:</span> <span class="literal">false</span> <span class="comment"># false: 不显示 true: 显示</span></span><br></pre></td></tr></table></figure><h4 id="添加书签-记录阅读位置"><a href="#添加书签-记录阅读位置" class="headerlink" title="添加书签(记录阅读位置)"></a>添加书签(记录阅读位置)</h4><ul><li>修改主题配置文件 <code>bookmark</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bookmark:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否启用</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#222&quot;</span> <span class="comment"># 颜色</span></span><br><span class="line">  <span class="attr">save:</span> <span class="string">auto</span> <span class="comment"># auto: 自动保存 manual: 手动保存</span></span><br></pre></td></tr></table></figure><h4 id="侧栏回到顶部按钮"><a href="#侧栏回到顶部按钮" class="headerlink" title="侧栏回到顶部按钮"></a>侧栏回到顶部按钮</h4><ul><li>修改主题配置文件 <code>back2top</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">back2top:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否启用</span></span><br></pre></td></tr></table></figure><h4 id="侧栏阅读进度提示"><a href="#侧栏阅读进度提示" class="headerlink" title="侧栏阅读进度提示"></a>侧栏阅读进度提示</h4><ul><li>修改主题配置文件 <code>back2top</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">back2top:</span></span><br><span class="line">  <span class="comment"># Scroll percent label in b2t button.</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">true</span> <span class="comment"># 是否显示阅读进度</span></span><br></pre></td></tr></table></figure><h4 id="类似加载条阅读进度提示"><a href="#类似加载条阅读进度提示" class="headerlink" title="类似加载条阅读进度提示"></a>类似加载条阅读进度提示</h4><ul><li>修改主题配置文件 <code>reading_progress</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reading_progress:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否启用</span></span><br><span class="line">  <span class="comment"># Available values: top | bottom</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">bottom</span> <span class="comment"># top: 顶部 bottom: 底部</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;#37c6c0&quot;</span> <span class="comment">#颜色</span></span><br><span class="line">  <span class="attr">height:</span> <span class="string">3px</span> <span class="comment">#高度</span></span><br></pre></td></tr></table></figure><h3 id="美化主题"><a href="#美化主题" class="headerlink" title="美化主题"></a>美化主题</h3><h4 id="文章添加居中模块"><a href="#文章添加居中模块" class="headerlink" title="文章添加居中模块"></a>文章添加居中模块</h4><ul><li>文章内容 markdown 书写如下:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% cq %&#125;</span><br><span class="line">就像这样</span><br><span class="line">&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>就像这样</p>            <i class="fa fa-quote-right"></i>          </blockquote><h4 id="自定义文件的路径"><a href="#自定义文件的路径" class="headerlink" title="自定义文件的路径"></a>自定义文件的路径</h4><ul><li>修改主题配置文件 <code>custom_file_path</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="attr">head:</span> <span class="string">source/_data/head.swig</span> <span class="comment">#添加自定义内容在 head</span></span><br><span class="line">  <span class="comment">#header: source/_data/header.swig #添加自定义内容在顶栏</span></span><br><span class="line">  <span class="comment">#sidebar: source/_data/sidebar.swig #添加自定义内容在边栏</span></span><br><span class="line">  <span class="comment">#postMeta: source/_data/post-meta.swig #添加自定义文章的 meta 信息</span></span><br><span class="line">  <span class="attr">postBodyEnd:</span> <span class="string">source/_data/post-body-end.swig</span> <span class="comment">#添加自定义内容在文章尾部</span></span><br><span class="line">  <span class="attr">footer:</span> <span class="string">source/_data/footer.swig</span> <span class="comment">#添加自定义内容在页脚</span></span><br><span class="line">  <span class="comment">#bodyEnd: source/_data/body-end.swig</span></span><br><span class="line">  <span class="comment">#variable: source/_data/variables.styl</span></span><br><span class="line">  <span class="comment">#mixin: source/_data/mixins.styl</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">source/_data/styles.styl</span> <span class="comment">#添加自定义css</span></span><br></pre></td></tr></table></figure><h4 id="鼠标点击出现小红心"><a href="#鼠标点击出现小红心" class="headerlink" title="鼠标点击出现小红心"></a>鼠标点击出现小红心</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ol><li>下载保存 <a href="/js/love.js">love.js</a> 到 <code>source/js/love.js</code></li><li>在 <code>source/_data/head.swig</code> 添加以下内容</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面点击小红心 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/js/love.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="文章加密访问"><a href="#文章加密访问" class="headerlink" title="文章加密访问"></a>文章加密访问</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>在 <code>source/_data/head.swig</code> 添加以下内容</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 文章加密 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span>(<span class="string">&#x27;&#123;&#123; page.password &#125;&#125;&#x27;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (<span class="title function_">prompt</span>(<span class="string">&#x27;请输入文章密码&#x27;</span>) !== <span class="string">&#x27;&#123;&#123; page.password &#125;&#125;&#x27;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="title function_">alert</span>(<span class="string">&#x27;密码错误！&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                history.<span class="title function_">back</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>然后文章中添加：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password: password</span><br></pre></td></tr></table></figure><blockquote><p>如果 <code>password</code> 后面为空，则表示不用密码。  </p></blockquote><h4 id="首页文章阴影-卡片化-效果"><a href="#首页文章阴影-卡片化-效果" class="headerlink" title="首页文章阴影(卡片化)效果"></a>首页文章阴影(卡片化)效果</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 主页文章添加阴影效果</span><br><span class="line"><span class="selector-class">.post-block</span> &#123;</span><br><span class="line">   <span class="attribute">padding</span>: <span class="number">25px</span>;</span><br><span class="line">   -webkit-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">203</span>, .<span class="number">5</span>);</span><br><span class="line">   -moz-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>, .<span class="number">5</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="避免链接和代码过长，而导致样式问题"><a href="#避免链接和代码过长，而导致样式问题" class="headerlink" title="避免链接和代码过长，而导致样式问题"></a>避免链接和代码过长，而导致样式问题</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 避免链接和代码过长，而导致样式问题</span><br><span class="line"><span class="selector-class">.post-block</span> <span class="selector-tag">code</span> &#123;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.post-block</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文章图片圆角"><a href="#文章图片圆角" class="headerlink" title="文章图片圆角"></a>文章图片圆角</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 图片圆角</span><br><span class="line"><span class="selector-class">.post-body</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1em</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改文章内链接文本的样式"><a href="#修改文章内链接文本的样式" class="headerlink" title="修改文章内链接文本的样式"></a>修改文章内链接文本的样式</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>将链接文本设置为蓝色，鼠标划过时文字颜色加深，并显示下划线。</li><li>添加以下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 将链接文本设置为蓝色，鼠标划过时文字颜色加深，并显示下划线。</span><br><span class="line"><span class="selector-class">.post-body</span> <span class="selector-tag">p</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0593d3</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#0477ab</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改文章底部的标签的-为图标"><a href="#修改文章底部的标签的-为图标" class="headerlink" title="修改文章底部的标签的 # 为图标"></a>修改文章底部的标签的 # 为图标</h4><ul><li>修改主题配置文件 <code>tag_icon</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tag_icon:</span> <span class="literal">true</span> <span class="comment"># true: 显示为图标</span></span><br></pre></td></tr></table></figure><h4 id="修复暗黑模式下标签的样式"><a href="#修复暗黑模式下标签的样式" class="headerlink" title="修复暗黑模式下标签的样式"></a>修复暗黑模式下标签的样式</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 适配暗黑模式下博客的 tag</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-tags</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--content-bg-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文章底部添加文章推荐功能"><a href="#文章底部添加文章推荐功能" class="headerlink" title="文章底部添加文章推荐功能"></a>文章底部添加文章推荐功能</h4><ul><li><code>npm install hexo-related-popular-posts</code></li><li>修改主题配置文件 <code>related_posts</code> 部分为你想要的</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">related_posts:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">要不看点其他的吧?..</span> <span class="comment"># Custom header, leave empty to use the default one</span></span><br><span class="line">  <span class="attr">display_in_home:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">params:</span></span><br><span class="line">    <span class="attr">maxCount:</span> <span class="number">5</span> <span class="comment"># 最多显示数量</span></span><br><span class="line">    <span class="attr">PPMixingRate:</span> <span class="number">0.5</span> <span class="comment"># 最大显示相似度</span></span><br></pre></td></tr></table></figure><h4 id="文章底部添加本文结束提示"><a href="#文章底部添加本文结束提示" class="headerlink" title="文章底部添加本文结束提示"></a>文章底部添加本文结束提示</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/post-body-end.swig</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;% <span class="keyword">if</span> not is_index %&#125;</span><br><span class="line">        &lt;div style=<span class="string">&quot;text-align:center;color: #ccc;font-size:14px;&quot;</span>&gt;-------------本文结束&lt;i <span class="keyword">class</span>=<span class="string">&quot;fa fa-paw&quot;</span>&gt;&lt;<span class="regexp">/i&gt;再接再厉-------------&lt;/</span>div&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h4 id="文章底部添加版权信息"><a href="#文章底部添加版权信息" class="headerlink" title="文章底部添加版权信息"></a>文章底部添加版权信息</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加以下内容到 <code>source/_data/post-body-end.swig</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> page.<span class="property">copyright</span> %&#125;</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;my_post_copyright&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>本文标题:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(page.path) &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>文章作者:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;访问 &#123;&#123; config.author &#125;&#125; 的个人博客&quot;</span>&gt;</span>&#123;&#123; config.author &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>发布时间:<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; page.date.format(&quot;YYYY年MM月DD日 - HH:MM&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>最后更新:<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; page.updated.format(&quot;YYYY年MM月DD日 - HH:MM&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>原始链接:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(page.path) &#125;&#125;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&#123;&#123; page.title &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; page.permalink &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>许可协议:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fab fa-creative-commons&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">rel</span>=<span class="string">&quot;license&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://creativecommons.org/licenses/by-nc-nd/4.0/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">title</span>=<span class="string">&quot;Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            署名-非商业性使用-禁止演绎 4.0 国际<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        转载请保留原文链接及作者。</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><ul><li>添加一下内容到 <code>source/_data/styles.styl</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">my_post_copyright</span> &#123;</span><br><span class="line"><span class="comment">//   width: 85%;</span></span><br><span class="line">  max-<span class="attr">width</span>: 45em;</span><br><span class="line">  <span class="attr">margin</span>: <span class="number">2.</span>8em auto <span class="number">0</span>;</span><br><span class="line">  <span class="attr">padding</span>: <span class="number">0.</span>5em <span class="number">1.</span>0em;</span><br><span class="line">  <span class="attr">border</span>: 1px solid #d3d3d3;</span><br><span class="line">  font-<span class="attr">size</span>: <span class="number">0.</span>93rem;</span><br><span class="line">  line-<span class="attr">height</span>: <span class="number">1.</span>6em;</span><br><span class="line">  word-<span class="attr">break</span>: <span class="keyword">break</span>-all;</span><br><span class="line"><span class="comment">//   background: rgba(255,255,255,0.4);</span></span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> p&#123;<span class="attr">margin</span>:<span class="number">0</span>;&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> span &#123;</span><br><span class="line">  <span class="attr">display</span>: inline-block;</span><br><span class="line">  <span class="attr">width</span>: <span class="number">5.</span>2em;</span><br><span class="line">  <span class="attr">color</span>: #b5b5b5;</span><br><span class="line">  font-<span class="attr">weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> .<span class="property">raw</span> &#123;</span><br><span class="line">  margin-<span class="attr">left</span>: 1em;</span><br><span class="line">  <span class="attr">width</span>: 5em;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> a &#123;</span><br><span class="line">  <span class="attr">color</span>: #<span class="number">808080</span>;</span><br><span class="line">  border-<span class="attr">bottom</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> <span class="attr">a</span>:hover &#123;</span><br><span class="line">  <span class="attr">color</span>: #a3d2a3;</span><br><span class="line">  text-<span class="attr">decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span>:hover .<span class="property">fa</span>-clipboard &#123;</span><br><span class="line">  <span class="attr">color</span>: #<span class="number">000</span>;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> .<span class="property">post</span>-<span class="attr">url</span>:hover &#123;</span><br><span class="line">  font-<span class="attr">weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> .<span class="property">copy</span>-path &#123;</span><br><span class="line">  margin-<span class="attr">left</span>: 1em;</span><br><span class="line">  <span class="attr">width</span>: 1em;</span><br><span class="line">  +<span class="title function_">mobile</span>(<span class="params"></span>)&#123;<span class="attr">display</span>:none;&#125;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">my_post_copyright</span> .<span class="property">copy</span>-<span class="attr">path</span>:hover &#123;</span><br><span class="line">  <span class="attr">color</span>: #<span class="number">808080</span>;</span><br><span class="line">  <span class="attr">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文章底部添加打赏按钮"><a href="#文章底部添加打赏按钮" class="headerlink" title="文章底部添加打赏按钮"></a>文章底部添加打赏按钮</h4><ul><li>修改主题配置文件 reward 部分为你想要的</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">wechatpay:</span> <span class="string">/images/site/wechatpay2.png</span> <span class="comment"># 微信</span></span><br><span class="line">  <span class="attr">alipay:</span> <span class="string">/images/site/alipay.png</span> <span class="comment"># 支付宝</span></span><br><span class="line">  <span class="comment">#paypal: /images/paypal.png</span></span><br><span class="line">  <span class="comment">#bitcoin: /images/bitcoin.png</span></span><br></pre></td></tr></table></figure><h4 id="页脚添加运行时间"><a href="#页脚添加运行时间" class="headerlink" title="页脚添加运行时间"></a>页脚添加运行时间</h4><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加如下内容到 <code>source/_data/footer.swig</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--添加网站运行时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>小破站已经在风雨中度过了<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timeDate&quot;</span>&gt;</span>载入天数...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;times&quot;</span>&gt;</span>载入时分秒...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">createtime</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> startTime = <span class="string">&#x27;09/27/2018 00:12:55&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            start = <span class="keyword">new</span> <span class="title class_">Date</span>(startTime)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> mill = <span class="keyword">new</span> <span class="title class_">Date</span>() - start,</span></span><br><span class="line"><span class="language-javascript">            seconds = <span class="title class_">Math</span>.<span class="title function_">floor</span>(mill / <span class="number">1000</span>),</span></span><br><span class="line"><span class="language-javascript">            mins = <span class="title class_">Math</span>.<span class="title function_">floor</span>(seconds / <span class="number">60</span>),</span></span><br><span class="line"><span class="language-javascript">            hours = <span class="title class_">Math</span>.<span class="title function_">floor</span>(mins / <span class="number">60</span>),</span></span><br><span class="line"><span class="language-javascript">            days = <span class="title class_">Math</span>.<span class="title function_">floor</span>(hours / <span class="number">24</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> time = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">seconds</span>: seconds - mins * <span class="number">60</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">mins</span>: mins - hours * <span class="number">60</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">hours</span>: hours - days * <span class="number">24</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> time) &#123;</span></span><br><span class="line"><span class="language-javascript">            time[k] = <span class="string">`<span class="subst">$&#123;time[k]&#125;</span>`</span>.<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;timeDate&quot;</span>).<span class="property">innerHTML</span> = <span class="string">` <span class="subst">$&#123;days&#125;</span> 天`</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;times&quot;</span>).<span class="property">innerHTML</span> = <span class="string">` <span class="subst">$&#123;time.hours&#125;</span> 小时 <span class="subst">$&#123;time.mins&#125;</span> 分 <span class="subst">$&#123;time.seconds&#125;</span> 秒`</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(createtime, <span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="博文压缩"><a href="#博文压缩" class="headerlink" title="博文压缩"></a>博文压缩</h4><ul><li>在站点的根目录下执行以下命令：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp -g</span><br><span class="line">npm install gulp-minify-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp gulp-babel @babel/preset-env @babel/core</span><br></pre></td></tr></table></figure><ul><li>在博客根目录下新建 <code>gulpfile.js</code>, 并填入以下内容：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>),</span><br><span class="line">    minifycss = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>),</span><br><span class="line">    uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>),</span><br><span class="line">    htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlmin&#x27;</span>),</span><br><span class="line">    htmlclean = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlclean&#x27;</span>),</span><br><span class="line">    imagemin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-imagemin&#x27;</span>),</span><br><span class="line">    babel = <span class="built_in">require</span>(<span class="string">&#x27;gulp-babel&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="keyword">function</span> (<span class="params">done</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.css&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">minifycss</span>())</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html文件</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="keyword">function</span> (<span class="params">done</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">continueOnParseError</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js文件</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-js&#x27;</span>, <span class="keyword">function</span> (<span class="params">done</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.js&#x27;</span>, <span class="string">&#x27;!./public/**/*.min.js&#x27;</span>])</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">babel</span>(&#123;</span><br><span class="line">            <span class="comment">//将ES6代码转译为可执行的JS代码</span></span><br><span class="line">            <span class="comment">// presets: [&#x27;es2015&#x27;] // es5检查机制</span></span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 public/images 目录内图片(Version&gt;3)</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-images&#x27;</span>, <span class="keyword">function</span> (<span class="params">done</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> opts = &#123; <span class="attr">verbose</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/images/**/*.*&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(imageMinify = <span class="title function_">imagemin</span>([</span><br><span class="line">            imagemin.<span class="title function_">gifsicle</span>(&#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">            imagemin.<span class="title function_">mozjpeg</span>(&#123; <span class="attr">quality</span>: <span class="number">70</span>, <span class="attr">progressive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">            imagemin.<span class="title function_">optipng</span>(&#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;),</span><br><span class="line">            imagemin.<span class="title function_">svgo</span>(&#123; <span class="attr">plugins</span>: [&#123; <span class="attr">removeViewBox</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">cleanupIDs</span>: <span class="literal">false</span> &#125;] &#125;)</span><br><span class="line">        ], opts))</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">done</span>(e))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public/images&#x27;</span>))</span><br><span class="line">    <span class="comment">// .on(&#x27;end&#x27;, () =&gt; done())</span></span><br><span class="line">    <span class="title function_">done</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.0以前的写法 </span></span><br><span class="line"><span class="comment">//gulp.task(&#x27;default&#x27;, [&#x27;minify-html&#x27;, &#x27;minify-css&#x27;, &#x27;minify-js&#x27;, &#x27;minify-images&#x27;])</span></span><br><span class="line"><span class="comment">//4.0以后的写法</span></span><br><span class="line"><span class="comment">// 执行 gulp 命令时执行的任务</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>, gulp.<span class="title function_">series</span>(gulp.<span class="title function_">parallel</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="string">&#x27;minify-css&#x27;</span>, <span class="string">&#x27;minify-js&#x27;</span>, <span class="string">&#x27;minify-images&#x27;</span>)))</span><br></pre></td></tr></table></figure><h4 id="搜索功能"><a href="#搜索功能" class="headerlink" title="搜索功能"></a>搜索功能</h4><ul><li>安装 <code>hexo-generator-searchdb</code>，在站点的根目录下执行以下命令：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-searchdb</span><br></pre></td></tr></table></figure><ul><li>编辑站点配置文件，新增以下内容到任意位置：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure><h4 id="文章阅读量、访问量计数"><a href="#文章阅读量、访问量计数" class="headerlink" title="文章阅读量、访问量计数"></a>文章阅读量、访问量计数</h4><blockquote><p>不蒜子计数好像无法访问<br>不蒜子计数存在部分 BUG<br>不蒜子计数无法控制<br>综上，放弃不蒜子计数，统一使用 <strong>LeanCloud</strong> 进行计数  </p></blockquote><ol><li>注册或登录 <code>leancloud.app</code></li><li>新建或打开已有应用</li><li>获取 APPID 和 AppKey</li><li>数据存储 -&gt; 结构化数据 -&gt; 创建名为 <code>Counter</code> 的 <code>class</code></li><li>修改主题配置文件 <code>leancloud_visitors</code> 部分</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">leancloud_visitors:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否启用</span></span><br><span class="line">  <span class="attr">app_id:</span> <span class="comment"># &lt;your app id&gt;</span></span><br><span class="line">  <span class="attr">app_key:</span>  <span class="comment"># &lt;your app key&gt;</span></span><br><span class="line">  <span class="comment"># Required for apps from CN region</span></span><br><span class="line">  <span class="attr">server_url:</span> <span class="comment"># &lt;your server url&gt;</span></span><br><span class="line">  <span class="attr">security:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="页脚添加总访问量"><a href="#页脚添加总访问量" class="headerlink" title="页脚添加总访问量"></a>页脚添加总访问量</h4><blockquote><p>不蒜子计数好像无法访问<br>不蒜子计数存在部分 BUG<br>不蒜子计数无法控制<br>综上，放弃不蒜子计数，统一使用 <strong>LeanCloud</strong> 进行计数  </p></blockquote><blockquote><p>请先配置<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84">自定义文件的路径</a>  </p></blockquote><ul><li>添加如下内容到 <code>source/_data/footer.swig</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--添加总阅读次数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>本站总访问量<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;site_total_read_count&quot;</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">ms = <span class="number">1000</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="built_in">clearTimeout</span>(timer)</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="title function_">resolve</span>()</span></span><br><span class="line"><span class="language-javascript">                &#125;, ms)</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">site_read_count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> className = <span class="string">&#x27;Counter&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                query = <span class="keyword">new</span> <span class="variable constant_">AV</span>.<span class="title class_">Query</span>(className)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> query.<span class="title function_">find</span>()</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">then</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i.<span class="property">attributes</span>.<span class="property">time</span>))</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">then</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b))</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable constant_">AV</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="built_in">clearInterval</span>(timer)</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="title function_">resolve</span>()</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;, <span class="number">250</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title function_">site_read_count</span>())</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> s = <span class="string">` <span class="subst">$&#123;_&#125;</span> 次`</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;site_total_read_count&quot;</span>).<span class="property">innerHTML</span> = s</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(e.<span class="property">message</span>))</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="评论功能"><a href="#评论功能" class="headerlink" title="评论功能"></a>评论功能</h4><ol><li>注册或登录 <code>leancloud.app</code></li><li>新建或打开已有应用</li><li>获取 APPID 和 AppKey</li><li>数据存储 -&gt; 结构化数据 -&gt; 创建名为 <code>Comment</code> 的 <code>class</code></li><li>修改主题配置文件 <code>valine</code> 部分</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">appid:</span>  <span class="comment"># Your leancloud application appid</span></span><br><span class="line">  <span class="attr">appkey:</span>  <span class="comment"># Your leancloud application appkey</span></span><br><span class="line">  <span class="attr">notify:</span> <span class="literal">true</span> <span class="comment"># 邮件通知</span></span><br><span class="line">  <span class="attr">verify:</span> <span class="literal">true</span> <span class="comment"># 验证码</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="string">写点什么...</span> <span class="comment"># Comment box placeholder</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">mm</span> <span class="comment"># Gravatar style</span></span><br><span class="line">  <span class="attr">guest_info:</span> <span class="string">nick,mail,link</span> <span class="comment"># Custom comment header</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># Pagination size</span></span><br><span class="line">  <span class="attr">language:</span> <span class="string">zh-cn</span> <span class="comment"># Language, available values: en, zh-cn</span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">true</span> <span class="comment"># Article reading statistic</span></span><br><span class="line">  <span class="attr">comment_count:</span> <span class="literal">true</span> <span class="comment"># If false, comment count will only be displayed in post page, not in home page</span></span><br><span class="line">  <span class="attr">recordIP:</span> <span class="literal">false</span> <span class="comment"># Whether to record the commenter IP</span></span><br><span class="line">  <span class="attr">serverURLs:</span> <span class="comment"># When the custom domain name is enabled, fill it in here (it will be detected automatically by default, no need to fill in)</span></span><br><span class="line">  <span class="comment">#post_meta_order: 0</span></span><br></pre></td></tr></table></figure><h4 id="文章字数计数、阅读时间估计、站点总字数统计、总时间统计"><a href="#文章字数计数、阅读时间估计、站点总字数统计、总时间统计" class="headerlink" title="文章字数计数、阅读时间估计、站点总字数统计、总时间统计"></a>文章字数计数、阅读时间估计、站点总字数统计、总时间统计</h4><ul><li><code>npm install hexo-symbols-count-time</code></li><li>修改主题配置文件的 <code>symbols_count_time</code> 部分</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_post:</span> <span class="literal">true</span> <span class="comment"># 文章字数统计</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">true</span> <span class="comment"># 站点总字数统计</span></span><br><span class="line">  <span class="comment"># 平均单词长度（单词的计数）。默认值:4。CN≈2 EN≈5 俄文≈6</span></span><br><span class="line">  <span class="attr">awl:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># 每分钟的单词。默认值:275。缓慢≈200 正常≈275 快≈350</span></span><br><span class="line">  <span class="attr">wpm:</span> <span class="number">275</span></span><br></pre></td></tr></table></figure><h3 id="如何平滑升级"><a href="#如何平滑升级" class="headerlink" title="如何平滑升级"></a>如何平滑升级</h3><div class="note info">            <p><code>git pull</code> 即可</p>          </div><ul><li>因为之前我们只对主题的配置文件进行了修改，所以做到平滑升级其实很简单</li></ul><ol><li>复制一份主题配置文件到站点文件夹下里，切记要不同的名字</li><li>git reset –hard HEAD 撤销子模块的更改</li><li>git pull 即可升级</li><li>升级完成以后可以将配置文件复制回去</li><li>这样就完成了升级操作</li><li>也可以写成脚本，更加方便</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">cd &quot;$(cd &quot;$(dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot;)&quot; &amp;&amp; pwd)&quot; &amp;&amp; cd ..</span><br><span class="line">CONFIG_FILE=&quot;_config.yml&quot;</span><br><span class="line">NEXT_THEME_FILE=&quot;next.theme.yml&quot;</span><br><span class="line">THEME_DIR=&quot;themes/next&quot;</span><br><span class="line">TARGET_FILE=&quot;$&#123;THEME_DIR&#125;/$&#123;CONFIG_FILE&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">clone</span> and update submodules</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> themes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -r themes/next</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -r <span class="string">&quot;<span class="variable">$&#123;THEME_DIR&#125;</span>&quot;</span></span></span><br><span class="line">echo &quot;Init git submodules&quot;</span><br><span class="line">[ -s &quot;$&#123;THEME_DIR&#125;&quot; ] || git submodule init</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git submodule init</span></span><br><span class="line">echo &quot;Update git submodules&quot;</span><br><span class="line">git submodule update --recursive</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">copy theme config file</span></span><br><span class="line">echo &quot;Coping theme config file&quot;</span><br><span class="line">[ -s &quot;$&#123;NEXT_THEME_FILE&#125;&quot; ] &amp;&amp; cp &quot;$&#123;NEXT_THEME_FILE&#125;&quot; &quot;$&#123;TARGET_FILE&#125;&quot;</span><br><span class="line">head -n 1 &quot;$&#123;TARGET_FILE&#125;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Install dependencies &amp;&amp; update <span class="built_in">env</span></span></span><br><span class="line">echo &quot;Install npm dependencies&quot;</span><br><span class="line">[ -s &quot;node_modules&quot; ] || npm i</span><br><span class="line">echo &quot;Load hexo binary...&quot;</span><br><span class="line">export PATH=&quot;$PATH:./node_modules/.bin&quot;</span><br><span class="line">echo &quot;Hexo version: $(hexo -v)&quot;</span><br><span class="line">echo &quot;Gulp version: $(gulp -v)&quot;</span><br><span class="line">echo &quot;Gulp Tasks&quot; &amp;&amp; gulp --tasks</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Generate site &amp;&amp; minify site files, such as: html, js, css</span></span><br><span class="line">hexo g --debug &amp;&amp; gulp -LLLL</span><br></pre></td></tr></table></figure><h3 id="自动化部署更新"><a href="#自动化部署更新" class="headerlink" title="自动化部署更新"></a>自动化部署更新</h3><blockquote><p>使用 Github Action 进行自动化部署  </p></blockquote><p>See: <a href="/2021/05/29/1/">使用 GithubAction 自动更新部署 Hexo 博客</a></p><h3 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h3><h4 id="Git-not-a-command"><a href="#Git-not-a-command" class="headerlink" title="Git not a command"></a>Git not a command</h4><ul><li>百度安装 Git 即可</li></ul><h4 id="Deployer-not-found-git"><a href="#Deployer-not-found-git" class="headerlink" title="Deployer not found: git"></a>Deployer not found: git</h4><ul><li><code>npm install hexo-deployer-git –save</code></li></ul><h4 id="ERROR-Plugin-load-failed-hexo-generator-feed"><a href="#ERROR-Plugin-load-failed-hexo-generator-feed" class="headerlink" title="ERROR Plugin load failed: hexo-generator-feed"></a>ERROR Plugin load failed: hexo-generator-feed</h4><h4 id="Module-xxx-NOT-FOUND"><a href="#Module-xxx-NOT-FOUND" class="headerlink" title="Module xxx NOT_FOUND"></a>Module xxx NOT_FOUND</h4><ul><li>检查站点文件夹下面的 <code>package.json</code>, 至少要有以下内容</li><li>没有的可以通过 <code>npm install xxx</code> 进行安装</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@babel/core&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.14.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@babel/preset-env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.14.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-babel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^8.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-htmlclean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.7.22&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-htmlmin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-imagemin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^7.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-minify-css&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.2.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gulp-uglify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-archive&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-feed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-search&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.4.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-generator-tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-related-popular-posts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-ejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-kramed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.1.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-marked&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-renderer-stylus&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hexo-symbols-count-time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^0.7.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安装 </tag>
            
            <tag> theme </tag>
            
            <tag> hexo </tag>
            
            <tag> hexo-next-theme </tag>
            
            <tag> 暗黑模式 </tag>
            
            <tag> 主题跟随 </tag>
            
            <tag> 平滑升级 </tag>
            
            <tag> 配置 </tag>
            
            <tag> 美化 </tag>
            
            <tag> sidebar </tag>
            
            <tag> 自动部署 </tag>
            
            <tag> gulp 压缩 </tag>
            
            <tag> hexo 文件压缩 </tag>
            
            <tag> Github Action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac 强制删除过长文件名文件</title>
      <link href="/2021/05/27/1/"/>
      <url>/2021/05/27/1/</url>
      
        <content type="html"><![CDATA[<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul><li>无法删除 xxxxxxx， 因为其路径名称太长</li></ul><p><img src="/images/macos/delete/000001.jpg" alt="alt"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">❯ <span class="built_in">ls</span> .Trash</span><br><span class="line"><span class="built_in">ls</span>: .Trash: Operation not permitted</span><br><span class="line">❯ sudo <span class="built_in">ls</span> .Trash</span><br><span class="line">Password:</span><br><span class="line"><span class="built_in">ls</span>: .Trash: Operation not permitted</span><br><span class="line">❯ <span class="built_in">rm</span> -rf .Trash</span><br><span class="line"><span class="built_in">rm</span>: .Trash: Operation not permitted</span><br><span class="line">❯ sudo <span class="built_in">rm</span> -rf .Trash</span><br><span class="line"><span class="built_in">rm</span>: .Trash: Operation not permitted</span><br></pre></td></tr></table></figure><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>BigSur 11.3.1</li></ul><h3 id="不是很靠谱的方法"><a href="#不是很靠谱的方法" class="headerlink" title="不是很靠谱的方法"></a>不是很靠谱的方法</h3><ul><li>如果文件是有限个的话，可以尝试重命名文件再进行删除</li><li>尝试删除用户文件夹下面的 <code>.Trash</code> 文件夹, <code>rm -rf .Trash</code> 或 <code>sudo rm -rf .Trash</code></li></ul><h3 id="正确操作"><a href="#正确操作" class="headerlink" title="正确操作"></a>正确操作</h3><ol><li>重启电脑</li><li>进去 <code>MacOS</code> 的 <code>Recovery</code> 模式</li><li>使用 <code>diskutil list</code> 查看分区表</li><li>使用 <code>diskutil mount</code> 挂载系统主分区。如果系统主分区已经被加密了的话，还需要使用开机密码解密分区</li></ol><div class="note info">            <p>因为 Recovery 模式下面的系统主分区，并不是我们正常使用的那个主分区，所以我们还需要使用 <code>diskutil mount</code> 挂载系统主分区</p>          </div><ol start="5"><li>挂载以后的系统分区位于 <code>/Volumes</code> 下面，不清楚的话可以使用 <code>mount</code> 进行查看</li><li>使用 <code>cd</code> 进入挂载点对应的用户文件夹: <code>cd User/&lt;username&gt;</code></li><li><code>ls -a</code> 即可看到 <code>.Trash</code> 文件夹</li><li>然后我们可以进 <code>.Trash</code> 文件夹去删除想删除的文件夹了也可以直接删除 <code>.Trash</code> 文件夹</li><li>重启之后再查看垃圾篓就可以看到文件已经被删除了</li></ol>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 强制删除 </tag>
            
            <tag> 文件名过长 </tag>
            
            <tag> Recovery </tag>
            
            <tag> force </tag>
            
            <tag> delete </tag>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS BigSur IDEA 同窗口多开</title>
      <link href="/2021/05/26/1/"/>
      <url>/2021/05/26/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这里并不讨论 IDEA 打开项目的提供的 attach 模式<br>更不讨论新建一个根文件夹作为多个项目文件夹的 root 文件夹的模式  </p></blockquote><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>为什么？因为都不好用…</p>            <i class="fa fa-quote-right"></i>          </blockquote><ul><li>承接上文，因为这是 BigSur 提供的功能，设置文档默认打开方式即可</li></ul><blockquote><p> -&gt; 系统偏好设置 -&gt; 通用 -&gt; 首选以标签页的方式打开文稿  </p></blockquote><p><img src="/images/macos/doc_open_style/3.png" alt="alt"></p><ul><li>效果如下  </li></ul><p><img src="/images/macos/doc_open_style/1.png" alt="alt"><br><img src="/images/macos/doc_open_style/2.png" alt="alt"><br><img src="/images/macos/doc_open_style/4.png" alt="alt"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 标签页打开文档 </tag>
            
            <tag> 同窗口 idea 多开 </tag>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Dell 5577 上使用 OC(OpenCore) 安装BigSur</title>
      <link href="/2021/01/24/1/"/>
      <url>/2021/01/24/1/</url>
      
        <content type="html"><![CDATA[<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="硬件部分"><a href="#硬件部分" class="headerlink" title="硬件部分"></a>硬件部分</h4><ul><li>一台运行 MacOS 的电脑</li><li>一个 U盘（16G+）</li><li>Dell inspire 5577</li></ul><h4 id="软件部分"><a href="#软件部分" class="headerlink" title="软件部分"></a>软件部分</h4><ul><li>MacOS BigSur 系统镜像</li><li>OpenCore EFI 引导文件</li></ul><h3 id="写入系统镜像"><a href="#写入系统镜像" class="headerlink" title="写入系统镜像"></a>写入系统镜像</h3><blockquote><p>这里提供两种方式，使用 U盘安装和直接安装到硬盘<br>其实仔细想想，使用U盘安装就是比直接安装到硬盘多了一步制作 U盘引导牌的过程  </p></blockquote><h4 id="分区表说明"><a href="#分区表说明" class="headerlink" title="分区表说明"></a>分区表说明</h4><ul><li>硬盘分区应当为 GPT 分区表，才能正常安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">macos<span class="comment"># diskutil list</span></span><br><span class="line">/dev/disk1 (internal, physical):</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *1.0 TB     disk1</span><br><span class="line">   1:                        EFI ⁨EFI⁩                     209.7 MB   disk1s1</span><br><span class="line">   2:                 Apple_APFS ⁨Container disk3⁩         128.0 GB   disk1s2</span><br></pre></td></tr></table></figure><h4 id="制作可移动安装介质（可选）"><a href="#制作可移动安装介质（可选）" class="headerlink" title="制作可移动安装介质（可选）"></a>制作可移动安装介质（可选）</h4><ol><li>将U盘插到可以运行 MacOS 的电脑上</li><li>使用 <code>diskutil list</code> 查看硬盘列表，确定硬盘标识符</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">❯ diskutil list</span><br><span class="line">...</span><br><span class="line">/dev/disk1 (internal, physical):</span><br><span class="line">...</span><br><span class="line">/dev/disk2 (synthesized):</span><br><span class="line">...</span><br><span class="line">/dev/disk3 (synthesized):</span><br><span class="line">...</span><br><span class="line">/dev/disk4 (internal, physical):</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *31.5 GB    disk4</span><br><span class="line">   1:                        EFI ⁨EFI⁩                     209.7 MB   disk4s1</span><br><span class="line">   2:                  Apple_HFS ⁨apple⁩                   31.1 GB    disk4s2</span><br></pre></td></tr></table></figure><blockquote><p>从这里我们可以知道硬盘的标识符为 <code>/dev/disk4</code>  </p></blockquote><ol start="3"><li>使用 <code>diskutil eraseDisk HFS+ [分区卷标] [硬盘标识符]</code> 清空硬盘并格式化为 MacOS 扩展分区（HFS+），会自动将磁盘格式化为 GPT 分区表</li></ol><blockquote><p>这里随便填了一个 install<br>如果格式化失败并且提示无法格式化具有 APFS 容器的分区的话，请先使用磁盘工具将 APFS 分区格式化为其他类型的分区。如：HFS+, exFat  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">❯ diskutil eraseDisk HFS+ install /dev/disk4</span><br><span class="line">Started erase on disk4</span><br><span class="line">Unmounting disk</span><br><span class="line">Creating the partition map</span><br><span class="line">Waiting <span class="keyword">for</span> partitions to activate</span><br><span class="line">Formatting disk4s2 as Mac OS Extended with name install</span><br><span class="line">Initialized /dev/rdisk4s2 as a 29 GB case-insensitive HFS Plus volume</span><br><span class="line">Mounting disk</span><br><span class="line">Finished erase on disk4</span><br></pre></td></tr></table></figure><ol start="4"><li>格式化以后就可以开始写入安装镜像了</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先我们需要进入 BigSur 镜像里面对应的文件夹</span></span><br><span class="line">❯ <span class="built_in">cd</span> <span class="string">&quot;Install macOS Big Sur.app/Contents/Resources&quot;</span></span><br><span class="line">❯ sudo ./createinstallmedia --volume /Volumes/install</span><br><span class="line">Password:</span><br><span class="line">Ready to start.</span><br><span class="line">To <span class="built_in">continue</span> we need to erase the volume at /Volumes/install.</span><br><span class="line">If you wish to <span class="built_in">continue</span> <span class="built_in">type</span> (Y) <span class="keyword">then</span> press <span class="built_in">return</span>: y</span><br><span class="line">Erasing disk: 0%... 10%... 20%... 30%... 100%</span><br><span class="line">Copying to disk: 0%... 10%... 20%... 30%... 40%... 50%... 60%... 70%... 80%... 90%... 100%</span><br><span class="line">Making disk bootable...</span><br><span class="line">Install media now available at <span class="string">&quot;/Volumes/Install macOS Big Sur&quot;</span></span><br></pre></td></tr></table></figure><h3 id="复制引导文件"><a href="#复制引导文件" class="headerlink" title="复制引导文件"></a>复制引导文件</h3><ol><li>引导文件可以在以下链接下载，自行斟酌<ol><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1dteWFhYS9EZWxsNTU3Ny1oYWNraW50b3No">https://github.com/Wmyaaa/Dell5577-hackintosh<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dnZ2dTZy9PcGVuQ29yZS1Gb3ItREVMTC01NTc3">https://github.com/wgggSg/OpenCore-For-DELL-5577<i class="fa fa-external-link-alt"></i></span></li></ol></li><li>将下载以后的 zip 包解压，可以看到有一个 OC 和 BOOT 文件夹</li><li>挂载 efi 分区</li></ol><blockquote><p>以 <code>/dev/disk4s1</code> 为例  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; <span class="built_in">mkdir</span> 1</span><br><span class="line">sudo mount -t msdos /dev/disk4s1 /tmp/1</span><br><span class="line">open /tmp/1</span><br><span class="line"><span class="comment"># 新打开的 finder 窗口里面应该会有一个 EFI 文件夹</span></span><br><span class="line"><span class="comment"># 如果没有的话请手动创建它, 然后将 OC 和 BOOT 文件夹拷贝过去</span></span><br></pre></td></tr></table></figure><blockquote><p>最后 EFI 分区的目录结构应该如下（注意：如果目录结构不对的话，是无法进入OC的引导界面的）  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/tmp/1</span><br><span class="line">├── EFI</span><br><span class="line">│   ├── BOOT</span><br><span class="line">│   └── OC</span><br></pre></td></tr></table></figure><h3 id="修改-BIOS-设置"><a href="#修改-BIOS-设置" class="headerlink" title="修改 BIOS 设置"></a>修改 BIOS 设置</h3><ul><li>使用 <code>UEFI</code> 进行引导</li><li>关闭 <code>Security Boot</code></li></ul><h3 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h3><ol><li>通过 <code>OC</code> 进入 <code>Install BigSur</code>（如果是直接磁盘安装的话，跳过此步）</li><li>跟上面一样，使用 <code>diskutil</code> 确定安装磁盘的分区以及将磁盘格式化为 HFS+</li><li>打开磁盘工具，将想要安装系统的分区格式化 APFS 分区<ul><li>右键选择分区 -&gt; 抹掉 -&gt; 格式选择 APFS -&gt; 点击下一步即可</li></ul></li><li>启动安装</li><li>将安装磁盘设置为想要安装系统的分区</li><li>一直下一步</li></ol><ul><li>如果安装的时候发现为俄语或者其他不认识的语言的话 </li></ul><blockquote><p>建议直接重新安装系统，修改 config.plist 和进 Recovery 之类的方法，本人都尝试过了，无效  </p></blockquote><ul><li>如果安装后重启的时候提示 <em><strong>No port micro restart. We don’t support SMC on this platform</strong></em></li></ul><blockquote><p>这是由于自动重启的模块缺失的问题导致的，问题不大，手动重启电脑就好了  </p></blockquote><h3 id="初始化设置系统"><a href="#初始化设置系统" class="headerlink" title="初始化设置系统"></a>初始化设置系统</h3><ul><li>一直下一步，有手就行</li></ul><h3 id="调教系统"><a href="#调教系统" class="headerlink" title="调教系统"></a>调教系统</h3><h4 id="HIDPI-设置"><a href="#HIDPI-设置" class="headerlink" title="HIDPI 设置"></a>HIDPI 设置</h4><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3h6aGloL29uZS1rZXktaGlkcGk=">https://github.com/xzhih/one-key-hidpi<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>可能有些人已发现了安装完以后，感觉 Mac 的桌面有点大，图标有点小，看起来有点累。所以我们需要使用这个项目来优化我们的体验</li><li>该项目支持两种安装模式，<del>不过在 BigSur 不能使用远程模式进行安装，因为 BigSur 对文件系统的要求更高了</del>  </li></ul><h5 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h5><ol><li>打开项目 URL 地址</li><li>下载项目的 zip 压缩包</li><li>双击运行 <code>hidpi.command</code></li><li>重启电脑即可生效</li></ol><blockquote><p>个人推荐选项: <code>2 6 2</code>, 然后 <code>设置 -&gt; 显示器 -&gt; 缩放 -&gt; 更多空间</code>  </p></blockquote><h5 id="远程模式"><a href="#远程模式" class="headerlink" title="远程模式"></a>远程模式</h5><ol><li>终端执行: <code>bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh)&quot;</code></li><li>熟悉的界面，可以按照本地模式按的推荐顺序选择选项</li></ol><h4 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h4><blockquote><p>默认情况下是无法驱动 Intel 网卡的，所以需要折腾一下  </p></blockquote><h5 id="使用第三方驱动驱动-Intel-网卡"><a href="#使用第三方驱动驱动-Intel-网卡" class="headerlink" title="使用第三方驱动驱动 Intel 网卡"></a>使用第三方驱动驱动 Intel 网卡</h5><blockquote><p>修改配置文件，安装网卡驱动，直接驱动原生网卡  </p></blockquote><p>目前的话，网卡驱动还是有点问题。延迟比较高，速度也不尽如人意。<br>但是就网页浏览方面而言，不卡，能用</p><p>See: <span class="exturl" data-url="aHR0cHM6Ly93d3cubWZwdWQuY29tL3RvcGljcy8zNDAzLw==">https://www.mfpud.com/topics/3403/<i class="fa fa-external-link-alt"></i></span></p><h5 id="安卓通过-USB-共享网络给-Mac"><a href="#安卓通过-USB-共享网络给-Mac" class="headerlink" title="安卓通过 USB 共享网络给 Mac"></a>安卓通过 USB 共享网络给 Mac</h5><p>iphone 可以直接共享，不提<br>但是安卓不行，我们需要安装一个驱动</p><ul><li>驱动仓库地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p3aXNlL0hvUk5ESVM=">https://github.com/jwise/HoRNDIS<i class="fa fa-external-link-alt"></i></span></li><li>目前最新版的 Release（HoRNDIS 9.2） 安装会失败，这个是可用的修改后的驱动安装包：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p3aXNlL0hvUk5ESVMvaXNzdWVzLzEwMiNpc3N1ZWNvbW1lbnQtNTQxMjM3MjMy">https://github.com/jwise/HoRNDIS/issues/102#issuecomment-541237232<i class="fa fa-external-link-alt"></i></span></li><li>下载后解压安装即可</li></ul><h5 id="购买-USB-网卡"><a href="#购买-USB-网卡" class="headerlink" title="购买 USB 网卡"></a>购买 USB 网卡</h5><p>免驱的无驱的都可以，比如某宝上面的 comfast usb 外接USB网卡，延迟什么的都很低，应该可以打游戏了（狗头）</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>目前大部分功能都正常，声卡，耳机插孔，HDMI都可以正常使用，除了有小部分瑕疵。比如：USB在长时间不使用以后可能会无法唤醒（但是至少有一个USB还是保持唤醒的）、触摸板驱动还是有点小问题，体验没有原生的好</li><li>该把换电脑提上日程了</li></ul>]]></content>
      
      
      <categories>
          
          <category> hack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> bigsur </tag>
            
            <tag> opencore 安装黑苹果 </tag>
            
            <tag> 黑苹果 </tag>
            
            <tag> oc </tag>
            
            <tag> opencore </tag>
            
            <tag> hidpi </tag>
            
            <tag> dell </tag>
            
            <tag> dell 5577 </tag>
            
            <tag> hack </tag>
            
            <tag> itlwm </tag>
            
            <tag> heliport </tag>
            
            <tag> No port micro restart </tag>
            
            <tag> We don&#39;t support SMC on this platform </tag>
            
            <tag> 黑苹果调教 </tag>
            
            <tag> 黑苹果安装界面为俄语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git本地修改子模块URL</title>
      <link href="/2021/01/23/1/"/>
      <url>/2021/01/23/1/</url>
      
        <content type="html"><![CDATA[<ol><li>初始化模块</li></ol><blockquote><p>如果已经初始化过了，也不要慌。可以使用 <code>git submodule deinit [moduleName]</code> 来取消对某一个模块的初始化，或者使用 <code>git submodule deinit --all</code> 取消对所有模块的初始化  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule init</span><br></pre></td></tr></table></figure><ol start="2"><li>修改模块的 URL</li></ol><blockquote><p>修改名为 <em><strong>hello</strong></em> 子模块的 url 为 <code>ssh://baidu@baidu.com</code>: <code>git config submodule.hello.url ssh://baidu@baidu.com</code><br>当然在初始化子模块以后，也可以通过直接修改 <code>.git/config</code> 文件来修改 url，但是 <strong>并不推荐</strong>  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config submodule.[moduleName].url ssh://user@server/path</span><br></pre></td></tr></table></figure><ol start="3"><li>更新模块</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --recursive --remote</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> submodule </tag>
            
            <tag> git submodule init </tag>
            
            <tag> git 修改子模块 url </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将 Git 默认编辑器修改为 VS Code</title>
      <link href="/2020/12/24/1/"/>
      <url>/2020/12/24/1/</url>
      
        <content type="html"><![CDATA[<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.editor <span class="string">&quot;code -w&quot;</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">git config --global core.editor <span class="string">&quot;code --wait&quot;</span></span><br></pre></td></tr></table></figure><h3 id="安装-VS-Code"><a href="#安装-VS-Code" class="headerlink" title="安装 VS Code"></a>安装 <code>VS Code</code></h3><blockquote><p>如果已经安装 <code>VS Code</code> 又不想卸载重装，可以自行将 <code>VS Code</code> 添加到环境变量<br>如果只是单纯的删除 <code>Application</code> 文件夹下面的 <code>VS Code</code> 然后重新安装的话，配置文件和扩展将会被保留下来   </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install --cask visual-studio-code</span><br></pre></td></tr></table></figure><h3 id="如何验证？"><a href="#如何验证？" class="headerlink" title="如何验证？"></a>如何验证？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="built_in">mkdir</span> git &amp;&amp; <span class="built_in">cd</span> git</span><br><span class="line">git init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;wait&quot;</span> &gt;&gt; ./test</span><br><span class="line">git add * &amp;&amp; git commit</span><br><span class="line"><span class="comment"># 看到 Cli 等待 VS Code 编辑后才显示命令结束即可</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> vscode </tag>
            
            <tag> code -w </tag>
            
            <tag> code --wait </tag>
            
            <tag> 修改 git 默认编辑器 </tag>
            
            <tag> 将 Git 默认编辑器修改为 VS Code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过 brew 和 brew services 安装管理 aria2</title>
      <link href="/2020/12/21/1/"/>
      <url>/2020/12/21/1/</url>
      
        <content type="html"><![CDATA[<h3 id="一些说明"><a href="#一些说明" class="headerlink" title="一些说明"></a>一些说明</h3><ul><li>目前并不能直接将 aria2 安装成 brew services 可以直接使用的样子。不过我们可以手动修改添加一些配置文件，使其支持</li></ul><h3 id="安装-aria2"><a href="#安装-aria2" class="headerlink" title="安装 aria2"></a>安装 aria2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install aria2</span><br></pre></td></tr></table></figure><h3 id="创建一些必须文件"><a href="#创建一些必须文件" class="headerlink" title="创建一些必须文件"></a>创建一些必须文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.aria2</span><br><span class="line"><span class="built_in">touch</span> ~/.aria2/aria2.conf ~/.aria2/aria2.session /usr/local/opt/aria2/homebrew.mxcl.aria2.plist</span><br></pre></td></tr></table></figure><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><ol><li>vim /usr/local/opt/aria2/homebrew.mxcl.aria2.plist</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.aria2<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>/usr/local/opt/aria2/bin/aria2c<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>新版 M1 aria2 的目录变成了 <code>/opt/homebrew/opt/aria2</code>, 新版配置文件修改为以下内容</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.aria2<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/opt/aria2/bin/aria2c<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>vim ~/.aria2/aria2.conf</li></ol><blockquote><p>一个 aria2 配置模版，可以参考参考  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## &#x27;#&#x27;开头为注释内容, 选项都有相应的注释说明, 根据需要修改 ##</span></span><br><span class="line"><span class="comment">## 被注释的选项填写的是默认值, 建议在需要修改时再取消注释  ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文件保存相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件的保存路径(可使用绝对路径或相对路径), 默认: 当前启动位置</span></span><br><span class="line"><span class="built_in">dir</span>=~/Downloads</span><br><span class="line"><span class="comment"># 启用磁盘缓存,0为禁用缓存, 需1.16以上版本, 默认: 16M</span></span><br><span class="line">disk-cache=32M</span><br><span class="line"><span class="comment"># 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span></span><br><span class="line"><span class="comment"># 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span></span><br><span class="line"><span class="comment"># falloc和trunc则需要文件系统和内核支持</span></span><br><span class="line"><span class="comment"># NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span></span><br><span class="line"><span class="comment"># file-allocation=falloc</span></span><br><span class="line"><span class="comment"># 断点续传</span></span><br><span class="line"><span class="built_in">continue</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载连接相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置连接代理</span></span><br><span class="line"><span class="comment">#--all-proxy=localhost:10809</span></span><br><span class="line"><span class="comment">#--all-proxy-passwd=&lt;PASSWD&gt;</span></span><br><span class="line"><span class="comment">#--all-proxy-user=&lt;USER&gt;</span></span><br><span class="line"><span class="comment">#--http-proxy=&lt;PROXY&gt;</span></span><br><span class="line"><span class="comment">#--https-proxy=&lt;PROXY&gt;</span></span><br><span class="line"><span class="comment">#--ftp-proxy=&lt;PROXY&gt;</span></span><br><span class="line"><span class="comment"># 最大同时下载任务数, 运行时可修改, 默认: 5</span></span><br><span class="line">max-concurrent-downloads=32</span><br><span class="line"><span class="comment"># 同一服务器连接数, 添加时可指定, 默认: 1</span></span><br><span class="line">max-connection-per-server=16</span><br><span class="line"><span class="comment"># 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认: 20M</span></span><br><span class="line"><span class="comment"># 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"><span class="comment"># 单个任务最大线程数, 添加时可指定, 默认: 5</span></span><br><span class="line"><span class="built_in">split</span>=32</span><br><span class="line"><span class="comment"># 整体下载速度限制, 运行时可修改, 默认: 0</span></span><br><span class="line"><span class="comment">#max-overall-download-limit=0</span></span><br><span class="line"><span class="comment"># 单个任务下载速度限制, 默认: 0</span></span><br><span class="line"><span class="comment">#max-download-limit=0</span></span><br><span class="line"><span class="comment"># 整体上传速度限制, 运行时可修改, 默认: 0</span></span><br><span class="line">max-overall-upload-limit=5M</span><br><span class="line"><span class="comment"># 单个任务上传速度限制, 默认: 0</span></span><br><span class="line"><span class="comment">#max-upload-limit=0</span></span><br><span class="line"><span class="comment"># 禁用IPv6, 默认: false</span></span><br><span class="line">disable-ipv6=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 进度保存相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从会话文件中读取下载任务</span></span><br><span class="line">input-file=.aria2/aria2.session</span><br><span class="line"><span class="comment"># 在Aria2退出时保存`错误/未完成`的下载任务到会话文件</span></span><br><span class="line">save-session=.aria2/aria2.session</span><br><span class="line"><span class="comment"># 定时保存会话,0为退出时才保存, 需1.16.1以上版本, 默认: 0</span></span><br><span class="line">save-session-interval=60</span><br><span class="line"><span class="comment"># 下载完成后</span></span><br><span class="line"><span class="comment"># on-download-complete=bash ~/Format.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## RPC相关设置 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用RPC, 默认: false</span></span><br><span class="line">enable-rpc=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许所有来源, 默认: false</span></span><br><span class="line">rpc-allow-origin-all=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许非外部访问, 默认: false</span></span><br><span class="line">rpc-listen-all=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 事件轮询方式, 取值: [epoll, kqueue, port, poll, select], 不同系统默认值不同</span></span><br><span class="line"><span class="comment">#event-poll=select</span></span><br><span class="line"><span class="comment"># RPC监听端口, 端口被占用时可以修改, 默认: 6800</span></span><br><span class="line">rpc-listen-port=6800</span><br><span class="line"><span class="comment"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span></span><br><span class="line">rpc-secret=1</span><br><span class="line"><span class="comment"># 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="comment">#rpc-user=&lt;USER&gt;</span></span><br><span class="line"><span class="comment"># 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="comment">#rpc-passwd=&lt;PASSWD&gt;</span></span><br><span class="line"><span class="comment"># 是否启用 RPC 服务的 SSL/TLS 加密,</span></span><br><span class="line"><span class="comment"># 启用加密后 RPC 服务需要使用 https 或者 wss 协议连接</span></span><br><span class="line"><span class="comment">#rpc-secure=true</span></span><br><span class="line"><span class="comment"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件(.pem/.crt)</span></span><br><span class="line"><span class="comment">#rpc-certificate=/root/xxx.pem</span></span><br><span class="line"><span class="comment"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件(.key)</span></span><br><span class="line"><span class="comment">#rpc-private-key=/root/xxx.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## BT/PT下载相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认: true</span></span><br><span class="line">follow-torrent=<span class="literal">true</span></span><br><span class="line"><span class="comment"># BT监听端口, 当端口被屏蔽时使用, 默认: 6881-6999</span></span><br><span class="line">listen-port=51413</span><br><span class="line"><span class="comment"># 单个种子最大连接数, 默认: 55</span></span><br><span class="line"><span class="comment">#bt-max-peers=55</span></span><br><span class="line"><span class="comment"># 打开DHT功能, PT需要禁用, 默认: true</span></span><br><span class="line">enable-dht=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 打开IPv6 DHT功能, PT需要禁用</span></span><br><span class="line">enable-dht6=<span class="literal">true</span></span><br><span class="line"><span class="comment"># DHT网络监听端口, 默认: 6881-6999</span></span><br><span class="line"><span class="comment">#dht-listen-port=6881-6999</span></span><br><span class="line"><span class="comment"># 本地节点查找, PT需要禁用, 默认: false</span></span><br><span class="line">bt-enable-lpd=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 种子交换, PT需要禁用, 默认: true</span></span><br><span class="line">enable-peer-exchange=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 每个种子限速, 对少种的PT很有用, 默认: 50K</span></span><br><span class="line"><span class="comment">#bt-request-peer-speed-limit=50K</span></span><br><span class="line"><span class="comment"># 客户端伪装, PT需要</span></span><br><span class="line">peer-id-prefix=-TR2770-</span><br><span class="line">user-agent=Transmission/2.77</span><br><span class="line"><span class="comment"># 当种子的分享率达到这个数时, 自动停止做种,0为一直做种, 默认: 1.0</span></span><br><span class="line">seed-ratio=2.0</span><br><span class="line"><span class="comment"># 强制保存会话, 即使任务已经完成, 默认: false</span></span><br><span class="line"><span class="comment"># 较新的版本开启后会在任务完成后依然保留.aria2文件</span></span><br><span class="line">force-save=<span class="literal">false</span></span><br><span class="line"><span class="comment"># BT校验相关, 默认: true</span></span><br><span class="line"><span class="comment">#bt-hash-check-seed=true</span></span><br><span class="line"><span class="comment"># 继续之前的BT任务时, 无需再次校验, 默认: false</span></span><br><span class="line">bt-seed-unverified=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 保存磁力链接元数据为种子文件(.torrent文件), 默认: false</span></span><br><span class="line"><span class="comment">#bt-save-metadata=true</span></span><br></pre></td></tr></table></figure><h3 id="测试配置文件"><a href="#测试配置文件" class="headerlink" title="测试配置文件"></a>测试配置文件</h3><ul><li>直接在终端输入 <code>cd &amp;&amp; aria2c</code> 即可</li><li>默认情况下 <code>aria2</code> 会主动去读取 <code>~/.aria2/aria2.conf</code> 作为启动配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ vim ~/.aria2/aria2.conf</span><br><span class="line">❯ aria2c</span><br><span class="line"></span><br><span class="line">12/21 15:49:51 [NOTICE] IPv4 RPC: listening on TCP port 6800</span><br><span class="line"></span><br><span class="line">12/21 15:49:51 [NOTICE] IPv6 RPC: listening on TCP port 6800</span><br></pre></td></tr></table></figure><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><ul><li>查看所有服务及状态：<code>brew services list</code></li><li>启动 aria2: <code>brew services start aria2</code></li><li>停止 aria2: <code>brew services stop aria2</code></li><li>重启 aria2: <code>brew services restart aria2</code></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> aria2 </tag>
            
            <tag> brew </tag>
            
            <tag> brew services </tag>
            
            <tag> rpc </tag>
            
            <tag> brew services aria2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将 Git 默认分支从 master 修改为 main</title>
      <link href="/2020/12/06/1/"/>
      <url>/2020/12/06/1/</url>
      
        <content type="html"><![CDATA[<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><blockquote><p>全局修改 git 配置即可  </p></blockquote><ul><li>快捷修改当前项目的分支为 <code>main</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -M main</span><br></pre></td></tr></table></figure><ul><li>快捷修改当前项目的分支为任意分支, 比如 <code>custom_branch</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -M custom_branch</span><br></pre></td></tr></table></figure><ul><li>修改默认分支为 <code>main</code> 分支</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.defaultBranch main</span><br></pre></td></tr></table></figure><ul><li>修改默认分支为任意分支，比如 <code>main_main</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.defaultBranch main_main</span><br></pre></td></tr></table></figure><h3 id="基本要求"><a href="#基本要求" class="headerlink" title="基本要求"></a>基本要求</h3><ul><li>Git 版本为 <strong>v2.28</strong> 或更高</li></ul><div class="note info">            <p>如何查看 Git 版本？</p><ul><li><p>Windows</p><ul><li> <code>Win键 + R</code></li><li> 输入 <code>powershell</code> 并回车</li><li> 在弹出的框里面输入 <code>git --version</code> 并回车</li></ul></li><li><p>Linux/Mac</p><ul><li>打开终端</li><li>输入 <code>git --version</code> 并回车</li></ul></li><li><p>版本不对或者没有 <code>git</code> 的可以在 <span class="exturl" data-url="aHR0cHM6Ly9naXQtc2NtLmNvbS9kb3dubG9hZHM=">https://git-scm.com/downloads<i class="fa fa-external-link-alt"></i></span> 下载对应版本</p></li></ul>          </div><h3 id="验证修改结果"><a href="#验证修改结果" class="headerlink" title="验证修改结果"></a>验证修改结果</h3><h4 id="未修改默认分支之前"><a href="#未修改默认分支之前" class="headerlink" title="未修改默认分支之前"></a>未修改默认分支之前</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$</span><br><span class="line">bash-3.2$ <span class="built_in">mkdir</span> master main</span><br><span class="line">bash-3.2$ <span class="built_in">cd</span> master/</span><br><span class="line">bash-3.2$ git init</span><br><span class="line">已初始化空的 Git 仓库于 /tmp/master/.git/</span><br><span class="line">bash-3.2$ <span class="built_in">echo</span> <span class="string">&quot;master&quot;</span> &gt; master</span><br><span class="line">bash-3.2$ git add * &amp;&amp; git commit -m <span class="string">&quot;master&quot;</span></span><br><span class="line">[master（根提交） aaea3df] master</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 master</span><br><span class="line">bash-3.2$ git branch -l</span><br><span class="line">master</span><br><span class="line">bash-3.2$</span><br></pre></td></tr></table></figure><h4 id="修改默认分支为-main"><a href="#修改默认分支为-main" class="headerlink" title="修改默认分支为 main"></a>修改默认分支为 main</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.defaultBranch main</span><br></pre></td></tr></table></figure><h4 id="修改默认分支以后"><a href="#修改默认分支以后" class="headerlink" title="修改默认分支以后"></a>修改默认分支以后</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ <span class="built_in">cd</span> ../main/</span><br><span class="line">bash-3.2$ git init</span><br><span class="line">已初始化空的 Git 仓库于 /tmp/main/.git/</span><br><span class="line">bash-3.2$ <span class="built_in">echo</span> <span class="string">&quot;master&quot;</span> &gt; master</span><br><span class="line">bash-3.2$ git add * &amp;&amp; git commit -m <span class="string">&quot;main&quot;</span></span><br><span class="line">[main（根提交） 9aa3bd8] main</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 master</span><br><span class="line">bash-3.2$ git branch -l</span><br><span class="line">main</span><br><span class="line">bash-3.2$</span><br></pre></td></tr></table></figure><ul><li>验证成功, Happy Coding.</li></ul>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
          <category> vcs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KUbuntu20.04 美化</title>
      <link href="/2020/08/19/1/"/>
      <url>/2020/08/19/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>u1s1, qt 写的 kde 桌面，从体验上来说就是比 py 写的 gnome 稳定的多  </p></blockquote><h2 id="桌面"><a href="#桌面" class="headerlink" title="桌面"></a>桌面</h2><h3 id="Preview"><a href="#Preview" class="headerlink" title="Preview"></a>Preview</h3><p><img src="/images/Linux/kde/Screenshot_20200819_201653.png" alt="alt"><br><img src="/images/Linux/kde/Screenshot_20200819_204749.png" alt="alt"></p><h3 id="ocs-url"><a href="#ocs-url" class="headerlink" title="ocs-url"></a>ocs-url</h3><blockquote><p>便于直接从网页安装主题  </p></blockquote><ol><li>open: <span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvMTEzNjgwNS8=">ocs-url<i class="fa fa-external-link-alt"></i></span></li><li>点击 <code>Files</code> 或者 <code>donwload</code>，下载对应版本</li><li>安装：<code>sudo dpkg -i *.deb</code></li></ol><h3 id="kvantum"><a href="#kvantum" class="headerlink" title="kvantum"></a>kvantum</h3><blockquote><p>主题个性化神器  </p></blockquote><ol><li>sudo add-apt-repository ppa:papirus/papirus</li><li>sudo apt update</li><li>sudo apt install qt5-style-kvantum qt5-style-kvantum-themes</li></ol><h3 id="oh-my-zsh-Powerlevel10k"><a href="#oh-my-zsh-Powerlevel10k" class="headerlink" title="(oh-my-zsh + Powerlevel10k)"></a>(oh-my-zsh + Powerlevel10k)</h3><blockquote><p>shell 主题<br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29obXl6c2gvb2hteXpzaA==">oh-my-zsh<i class="fa fa-external-link-alt"></i></span><br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEwayNtZXNsby1uZXJkLWZvbnQtcGF0Y2hlZC1mb3ItcG93ZXJsZXZlbDEwaw==">Powerlevel10k<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>这个属于我个人按照自己的喜好修改后的配置, 如果必要的话请务必备份自己的 <code>~/.zshrc</code> 文件</li></ul><ol><li><code>bash &lt;(curl -fsSL https://raw.githubusercontent.com/IITII/Useless/master/custom_zsh/zsh-p10k.sh)</code></li><li><code>bash &lt;(curl -fsSL https://raw.githubusercontent.com/IITII/Useless/master/custom_zsh/zsh-p10k.sh)</code> (务必执行两次)</li><li><code>source ~/.zshrc</code></li><li>默认的字体一般是会乱码的，所以需要格外安装</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEway1tZWRpYS9yYXcvbWFzdGVyL01lc2xvTEdTJTIwTkYlMjBSZWd1bGFyLnR0Zg==">MesloLGS NF Regular.ttf<i class="fa fa-external-link-alt"></i></span></li><li> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEway1tZWRpYS9yYXcvbWFzdGVyL01lc2xvTEdTJTIwTkYlMjBCb2xkLnR0Zg==">MesloLGS NF Bold.ttf<i class="fa fa-external-link-alt"></i></span></li><li> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEway1tZWRpYS9yYXcvbWFzdGVyL01lc2xvTEdTJTIwTkYlMjBJdGFsaWMudHRm">MesloLGS NF Italic.ttf<i class="fa fa-external-link-alt"></i></span></li><li> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEway1tZWRpYS9yYXcvbWFzdGVyL01lc2xvTEdTJTIwTkYlMjBCb2xkJTIwSXRhbGljLnR0Zg==">MesloLGS NF Bold Italic.ttf<i class="fa fa-external-link-alt"></i></span></li><li> 在终端的设置里面修改字体并保存即可</li></ol><p><img src="/images/Linux/kde/Screenshot_20200820_103256.png" alt="shell"></p><h3 id="layan-全局主题"><a href="#layan-全局主题" class="headerlink" title="layan 全局主题"></a>layan 全局主题</h3><ol><li>open: <span class="exturl" data-url="aHR0cHM6Ly93d3cucGxpbmcuY29tL3AvMTMyNTI0Ni8=">layan 全局主题<i class="fa fa-external-link-alt"></i></span></li><li>点击 install</li><li>选择对应压缩包文件</li><li>点击安装即可</li></ol><h3 id="BreedBlurred"><a href="#BreedBlurred" class="headerlink" title="BreedBlurred"></a>BreedBlurred</h3><blockquote><p>优化标题栏感观  </p></blockquote><ol><li><code>cd /tmp</code></li><li><code>sudo apt install git g++ extra-cmake-modules cmake gettext libkf5config-dev libkdecorations2-dev libqt5x11extras5-dev qtdeclarative5-dev libkf5guiaddons-dev libkf5configwidgets-dev libkf5windowsystem-dev libkf5coreaddons-dev libfftw3-dev</code></li><li><code>git clone https://github.com/alex47/BreezeBlurred</code></li><li><code>cd BreezeBlurred</code></li><li><code>mkdir build</code></li><li><code>cd build</code></li><li><code>cmake .. -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DKDE_INSTALL_LIBDIR=lib -DBUILD_TESTING=OFF -DKDE_INSTALL_USE_QT_SYS_PATHS=ON</code></li><li><code>sudo make install</code></li><li><code>kwin_x11 --replace &amp;</code></li></ol><h3 id="kcm-colorful"><a href="#kcm-colorful" class="headerlink" title="kcm-colorful"></a>kcm-colorful</h3><blockquote><p>根据当前的壁纸改变KDE Plasma的颜色。  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; \</span><br><span class="line">sudo apt install -y cmake make extra-cmake-modules gettext \</span><br><span class="line">libqt5x11extras5-dev qt5-default qtquickcontrols2-5-dev \</span><br><span class="line">git g++ libkf5kio-dev libkf5kcmutils-dev libkf5declarative-dev</span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/IsoaSFlus/kcm-colorful.git --depth=1</span><br><span class="line"><span class="built_in">cd</span> kcm-colorful</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> ./build</span><br><span class="line">cmake ../</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="comment">#Then set your plasma desktop theme to &quot;Colorful&quot; for best experience.</span></span><br></pre></td></tr></table></figure><h3 id="Papirus-图标"><a href="#Papirus-图标" class="headerlink" title="Papirus 图标"></a>Papirus 图标</h3><ol><li>open: <span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvMTE2NjI4OQ==">https://store.kde.org/p/1166289<i class="fa fa-external-link-alt"></i></span></li><li>点击 install</li><li>选择对应压缩包文件</li><li>点击安装即可</li></ol><h3 id="KDE部件（插件）"><a href="#KDE部件（插件）" class="headerlink" title="KDE部件（插件）"></a>KDE部件（插件）</h3><blockquote><p>都可以点按安装，不一一说明  </p></blockquote><ol><li><span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvMTI5ODk1NQ==">Plasma Customization Saver<i class="fa fa-external-link-alt"></i></span>: 备份跑路首选</li><li><span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvOTk4ODk1">Netspeed Widget<i class="fa fa-external-link-alt"></i></span>: 任务栏网速显示</li><li><span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvOTk4OTA3Lw==">Separator<i class="fa fa-external-link-alt"></i></span>: 一个简单的分隔符，有的时候还是蛮有用的</li><li><span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvMTE3MzUwOS8=">Simple System Monitor<i class="fa fa-external-link-alt"></i></span>: 任务栏显示系统CPU，内存使用率</li></ol><h3 id="SDDM-主题"><a href="#SDDM-主题" class="headerlink" title="SDDM 主题"></a>SDDM 主题</h3><blockquote><p>设置 -&gt; 开机和关机 -&gt; 登录屏幕（SDDM） </p></blockquote><ul><li>推荐 <code>Sugar Candy</code>: <span class="exturl" data-url="aHR0cHM6Ly9zdG9yZS5rZGUub3JnL3AvMTMxMjY1OC8=">https://store.kde.org/p/1312658/<i class="fa fa-external-link-alt"></i></span></li><li>点按安装即可</li></ul><h3 id="欢迎屏幕"><a href="#欢迎屏幕" class="headerlink" title="欢迎屏幕"></a>欢迎屏幕</h3><blockquote><p>设置 -&gt; 开机和关机 -&gt; 欢迎屏幕  </p></blockquote><ul><li>推荐 Layan. See -&gt; <a href="#layan-%E5%85%A8%E5%B1%80%E4%B8%BB%E9%A2%98">layan-全局主题</a></li></ul><h3 id="统一设置"><a href="#统一设置" class="headerlink" title="统一设置"></a>统一设置</h3><ol><li>打开设置</li><li><code>全局主题</code>，设置为 <code>Layan</code> 并应用</li><li><code>Plasma 样式</code>，设置为 <code>Lanyan</code> 并应用</li><li><code>应用程序风格 -&gt; 应用样式</code>，设置为 <code>kvantum</code> 并应用</li><li><code>应用程序风格 -&gt; 窗口装饰</code>，设置为 <code>微风Blurred</code> 并应用</li><li><code>图标</code>，设置为 <code>Papirus</code> 并应用</li><li>光标，设置为 <code>微风</code> 即可</li><li><code>开机和关机 -&gt; 登录屏幕（SDDM）</code>，设置为 <code>Sugar Candy</code> 并应用</li><li><code>设置 -&gt; 开机和关机 -&gt; 欢迎屏幕</code>，设置为 <code>Layan</code> 并应用</li><li>打开 <code>kvantum</code>，选择 <code>配置当前主题</code>，按个人喜好选择并保存</li><li>右键面板，自行添加部件</li><li>时钟格式推荐自定义为 <code>yyyy/M/d</code></li></ol><h2 id="显卡驱动"><a href="#显卡驱动" class="headerlink" title="显卡驱动"></a>显卡驱动</h2><ul><li>See: <a href="https://iitii.github.io/2020/08/17/1/">Ubuntu20.04 CUDA 开发环境配置</a></li></ul><h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><h3 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h3><blockquote><p>Google-pinyin  </p></blockquote><ul><li><code>sudo apt install fcitx-google-pinyin -y</code></li><li><code>fcitx</code> 输入法</li><li>搜狗拼音<strong>暂不支持</strong> Ubuntu20.04, 故选择 <code>google-pinyin</code></li></ul><h3 id="影音"><a href="#影音" class="headerlink" title="影音"></a>影音</h3><blockquote><p>ffmpeg (ffplay)  </p></blockquote><ul><li><code>sudo apt install ffmpeg -y</code></li><li>基本支持所有主流编码</li><li>如果电脑带 <em><strong>NVIDIA</strong></em> 显卡的话，推荐自行编译, See -&gt; <a href="#%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8">显卡驱动</a></li><li>如果没有，使用 <code>sudo apt install ffmpeg -y</code> 进行安装</li></ul><blockquote><p>vlc  </p></blockquote><ul><li><code>sudo apt install -y vlc</code></li><li>vlc 会默认调用 ffmpeg 的解码器</li></ul><h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><blockquote><p>Chrome  </p></blockquote><ul><li><code>cd /tmp &amp;&amp; wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb &amp;&amp; sudo dpkg -i *.deb</code></li></ul><h3 id="文本编辑"><a href="#文本编辑" class="headerlink" title="文本编辑"></a>文本编辑</h3><blockquote><p>Vim  </p></blockquote><ul><li><code>sudo apt install vim -y</code></li></ul><blockquote><p>VS Code  </p></blockquote><ul><li>打开<span class="exturl" data-url="aHR0cHM6Ly9jb2RlLnZpc3VhbHN0dWRpby5jb20vZG93bmxvYWQj">VS Code官网<i class="fa fa-external-link-alt"></i></span>，下载对应 deb 包。</li><li><code>sudo dpkg -i *.deb</code> 安装即可</li></ul><blockquote><p>WPS：<span class="exturl" data-url="aHR0cHM6Ly9saW51eC53cHMuY24v">WPS官网<i class="fa fa-external-link-alt"></i></span>   </p></blockquote><ul><li>根据需要下载对于软件包，使用 <code>sudo dpkg -i *.deb</code> 进行安装</li></ul><h3 id="沟通"><a href="#沟通" class="headerlink" title="沟通"></a>沟通</h3><blockquote><p>飞书：字节跳动产品，有手机、Windows、MacOS客户端以及 <strong>网页版</strong>  </p></blockquote><ul><li><code>alias feishu=&#39;google-chrome --app=https://lakggmlmae.feishu.cn/messenger/\?i18n_locale\=zh-CN\&amp;onboarding\=true&#39; &amp;&amp; feishu</code></li><li>使用 Chrome 的 <code>App mode</code> 实现类桌面客户端的感觉</li></ul><p><img src="/images/Linux/kde/Screenshot_20200819_211139.png" alt="飞书"></p><blockquote><p>Telegram  </p></blockquote><ul><li>全平台软件</li><li>懂的都懂</li></ul><h2 id="有点问题？"><a href="#有点问题？" class="headerlink" title="有点问题？"></a>有点问题？</h2><ul><li>设置透明，但是没有透明效果</li></ul><blockquote><p>检查 <code>设置 -&gt; 工作空间行为 -&gt; 桌面特效 -&gt; 透明度</code>,确保是启用状态    </p></blockquote><blockquote><p>重新选择混成器 <code>设置 -&gt; 显示与监控 -&gt; 混成器 -&gt; 渲染后端</code>  </p></blockquote><ul><li>如何启用窗口毛玻璃效果</li></ul><blockquote><p>检查 <code>设置 -&gt; 工作空间行为 -&gt; 桌面特效 -&gt; 模糊</code>,确保是启用状态  </p></blockquote><ul><li>窗口还是比较透明的，看不清楚字，能不能再优化一下</li></ul><blockquote><p> 打开 <code>kvantum Manager</code> 减少透明度并保存  </p></blockquote><blockquote><p>检查 <code>设置 -&gt; 工作空间行为 -&gt; 桌面特效 -&gt; 背景对比度</code>,确保是启用状态  </p></blockquote><ul><li>如何隐藏部分图标？</li></ul><blockquote><p>右键系统托盘（图标为向上的箭头）-&gt; 配置系统托盘 -&gt; 编辑对应图标的可见性 -&gt; 保存  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> KUbuntu </tag>
            
            <tag> 20.04美化 </tag>
            
            <tag> osc-url </tag>
            
            <tag> kde </tag>
            
            <tag> Papirus </tag>
            
            <tag> Layan </tag>
            
            <tag> zsh </tag>
            
            <tag> oh-my-zsh </tag>
            
            <tag> p10k </tag>
            
            <tag> BreedBlurred </tag>
            
            <tag> kcm-colorful </tag>
            
            <tag> ffmpeg vlc </tag>
            
            <tag> kde 全局主题 </tag>
            
            <tag> SDDM 美化 </tag>
            
            <tag> kde设置透明，但是没有透明效果 </tag>
            
            <tag> kde启用窗口毛玻璃效果 </tag>
            
            <tag> kde如何隐藏部分图标 </tag>
            
            <tag> kde窗口还是比较透明的，看不清楚字，能不能再优化一下 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu20.04 CUDA 开发环境配置</title>
      <link href="/2020/08/17/1/"/>
      <url>/2020/08/17/1/</url>
      
        <content type="html"><![CDATA[<h2 id="环境描述"><a href="#环境描述" class="headerlink" title="环境描述"></a>环境描述</h2><blockquote><p>注意：不要轻易重启  </p></blockquote><ol><li>ubuntu20.04</li><li>nvidia gtx 1050 mobile</li><li>16G MEM</li><li>cuda 11</li><li>ffmpeg 4.3.1 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZGbXBlZy9GRm1wZWcvY29tbWl0LzZiNmI5ZTU5M2RkNGQzYWFmNzVmNDhkNDBhMTNlZjAzYmRlZjlmZGI=">https://github.com/FFmpeg/FFmpeg/commit/6b6b9e593dd4d3aaf75f48d40a13ef03bdef9fdb<i class="fa fa-external-link-alt"></i></span></li></ol><h2 id="Cuda-安装"><a href="#Cuda-安装" class="headerlink" title="Cuda 安装"></a>Cuda 安装</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLWRvd25sb2Fkcw==">https://developer.nvidia.com/cuda-downloads<i class="fa fa-external-link-alt"></i></span>  </li><li>图像界面可以使用 <code>NVIDIA X Server Setting</code> 修改独显集显，命令行下可以使用 <code>prime-select</code> 来切换  <ul><li>Usage：/usr/bin/prime-select nvidia|intel|on-demand|query  </li></ul></li></ul><h3 id="deb-local"><a href="#deb-local" class="headerlink" title="deb (local)"></a>deb (local)</h3><blockquote><p>按照官方的来即可<br>下面给出 cuda11的安装步骤  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin</span><br><span class="line">sudo <span class="built_in">mv</span> cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600</span><br><span class="line">wget https://developer.download.nvidia.com/compute/cuda/11.0.3/local_installers/cuda-repo-ubuntu2004-11-0-local_11.0.3-450.51.06-1_amd64.deb</span><br><span class="line">sudo dpkg -i cuda-repo-ubuntu2004-11-0-local_11.0.3-450.51.06-1_amd64.deb</span><br><span class="line">sudo apt-key add /var/cuda-repo-ubuntu2004-11-0-<span class="built_in">local</span>/7fa2af80.pub</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install cuda</span><br></pre></td></tr></table></figure><h3 id="deb-Network-Install"><a href="#deb-Network-Install" class="headerlink" title="deb (Network Install)"></a>deb (Network Install)</h3><blockquote><p>考虑网络环境问题，使用 <code>aliyun</code> 的源: <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9taXJyb3IvbnZpZGlhLWN1ZGE=">https://developer.aliyun.com/mirror/nvidia-cuda<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>下面给出官方源的使用方法</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin</span><br><span class="line">sudo <span class="built_in">mv</span> cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600</span><br><span class="line">sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/7fa2af80.pub</span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ /&quot;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install cuda</span><br></pre></td></tr></table></figure><ul><li><em><strong>Aliyun</strong></em></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.aliyun.com/mirror/nvidia-cuda/ubuntu2004/x86_64/cuda-ubuntu2004.pin</span><br><span class="line">sudo <span class="built_in">mv</span> cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600</span><br><span class="line">sudo apt-key adv --fetch-keys https://developer.aliyun.com/mirror/nvidia-cuda/ubuntu2004/x86_64/7fa2af80.pub</span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb https://developer.aliyun.com/mirror/nvidia-cuda/ubuntu2004/x86_64/ /&quot;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install cuda</span><br></pre></td></tr></table></figure><ul><li>如果 <code>sudo apt-get update</code> 出现问题的话，修改源 (<code>vim /etc/apt/sources.list</code>) 为如下即可：<code>deb https://mirrors.aliyun.com/nvidia-cuda/ubuntu2004/x86_64/ /</code>. 即去掉<strong>该条源</strong>的 <code>focal</code> 即可.</li></ul><h3 id="cuDNN"><a href="#cuDNN" class="headerlink" title="cuDNN"></a>cuDNN</h3><blockquote><p>cuDNN: <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9yZHAvY3Vkbm4tZG93bmxvYWQ=">https://developer.nvidia.com/rdp/cudnn-download<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ol><li>下载与 cuda 和 系统相对应的版本</li><li>对于 <code>ubuntu20.04</code> <code>nvidia</code> 目前 (<strong>2020-8-17</strong>) 还未提供对应版本 (<em>cuda 11</em>) 的 <code>cuDNN</code>, 可以选择下载 <code>ubuntu18.04</code> 的 <code>cuda 11</code> 的 <code>cuDNN</code> 使用</li><li>安装：<code>sudo dpkg -i *.deb</code></li></ol><h3 id="NVCC"><a href="#NVCC" class="headerlink" title="NVCC"></a>NVCC</h3><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9oZWxwL2NsaW9uL2N1ZGEtcHJvamVjdHMuaHRtbCNzZXQtbnZjYw==">https://www.jetbrains.com/help/clion/cuda-projects.html#set-nvcc<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ol><li>默认安装路径在 <code>/usr/local/cuda/</code></li><li>添加到 <code>PATH</code> 即可: <code>sudo vim /etc/environment</code> 将 <code>/usr/local/cuda/bin</code> 添加进 PATH 即可</li><li><code>source /etc/environment</code></li><li><code>nvcc -V</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ nvcc -V</span><br><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2020 NVIDIA Corporation</span><br><span class="line">Built on Wed_Jul_22_19:09:09_PDT_2020</span><br><span class="line">Cuda compilation tools, release 11.0, V11.0.221</span><br><span class="line">Build cuda_11.0_bu.TC445_37.28845127_0</span><br></pre></td></tr></table></figure><hr><ol><li>Clion 测试: <code>File</code> -&gt; <code>New Project</code> -&gt; <code>CUDA Executable</code> -&gt; <code>Create</code></li><li>默认会创建一个输出 <code>hello world</code> 的 <em><strong>main.cu</strong></em> 文件</li><li>运行即可输出 <code>hello world</code></li></ol><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ol><li>使用 <code>nvidia-smi</code> 来验证 <code>cuda</code> 的安装结果</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">❯ nvidia-smi</span><br><span class="line">Mon Aug 17 22:16:59 2020       </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  GeForce GTX 1050    On   | 00000000:01:00.0 Off |                  N/A |</span><br><span class="line">| N/A   45C    P8    N/A /  N/A |    719MiB /  4042MiB |      7%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">                                                                               </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">|    0   N/A  N/A      1209      G   /usr/lib/xorg/Xorg                224MiB |</span><br><span class="line">|    0   N/A  N/A      3264      G   /usr/bin/kwin_x11                  80MiB |</span><br><span class="line">|    0   N/A  N/A      3284      G   /usr/bin/plasmashell               71MiB |</span><br><span class="line">|    0   N/A  N/A      4653      G   ...AAAAAAAAA= --shared-files      218MiB |</span><br><span class="line">|    0   N/A  N/A     64873      G   ...token=3860532832627472219      119MiB |</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>使用软件包管理器来查看目前使用的附加驱动，应当使用的是 <strong>专有驱动</strong> 或者 <strong>手动安装</strong> 的驱动</li><li><code>reboot</code></li></ol><h2 id="nvidia-smi-说明"><a href="#nvidia-smi-说明" class="headerlink" title="nvidia-smi 说明"></a>nvidia-smi 说明</h2><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuZG93bmxvYWQubnZpZGlhLmNvbS9jb21wdXRlL0RDR00vZG9jcy9udmlkaWEtc21pLTM2Ny4zOC5wZGY=">https://developer.download.nvidia.com/compute/DCGM/docs/nvidia-smi-367.38.pdf<i class="fa fa-external-link-alt"></i></span><br>See: <code>nvidia-smi --help</code><br>See: <code>man nvidia-smi</code><br>See: <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0NfY2h1eGluL2FydGljbGUvZGV0YWlscy84Mjk5MzM1MA==">https://blog.csdn.net/C_chuxin/article/details/82993350<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote><p>nvidia-smi是nvidia 的系统管理界面 ，其中smi是System management interface的缩写，它可以收集各种级别的信息，查看显存使用情况。此外, 可以启用和禁用 GPU 配置选项 (如 ECC 内存功能)。  </p></blockquote><p><img src="/images/nvidia/smi/20181010103711710.png" alt="alt"></p><ul><li>GPU：本机中的GPU编号</li><li>Name：GPU 类型</li><li>Persistence-M：</li><li>Fan：风扇转速</li><li>Temp：温度，单位摄氏度</li><li>Perf：表征性能状态，从P0到P12，P0表示最大性能，P12表示状态最小性能</li><li>Pwr:Usage/Cap：能耗表示</li><li>Bus-Id：涉及GPU总线的相关信息；</li><li>Disp.A：Display Active，表示GPU的显示是否初始化</li><li>Memory-Usage：显存使用率</li><li>Volatile GPU-Util：浮动的GPU利用率</li><li>Uncorr. ECC：关于ECC的东西</li><li>Compute M.：计算模式</li><li>Processes 显示每块GPU上每个进程所使用的显存情况。</li></ul><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><table><thead><tr><th align="center">命令</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center"><code>nvidia-smi -L</code></td><td align="center">列出所有可用的 NVIDIA 设备</td></tr><tr><td align="center"><code>nvidia-smi topo --matrix</code></td><td align="center">查看系统拓扑</td></tr><tr><td align="center"><code> nvidia-smi -q -d CLOCK</code></td><td align="center">查看当前的 GPU 时钟速度、默认时钟速度和最大可能的时钟速度</td></tr><tr><td align="center"><code>nvidia-smi -q -d SUPPORTED_CLOCKS</code></td><td align="center">显示每个 GPU 的可用时钟速度列表</td></tr><tr><td align="center"><code>nvidia-smi vgpu</code></td><td align="center">查看当前vGPU的状态信息</td></tr><tr><td align="center"><code>nvidia-smi vgpu -p</code></td><td align="center">循环显示虚拟桌面中应用程序对GPU资源的占用情况</td></tr><tr><td align="center"><code>nvidia-smi -q</code></td><td align="center">查看当前所有GPU的信息，也可以通过参数i指定具体的GPU</td></tr></tbody></table><h2 id="Ffmpeg-安装"><a href="#Ffmpeg-安装" class="headerlink" title="Ffmpeg 安装"></a>Ffmpeg 安装</h2><h3 id="一些说明"><a href="#一些说明" class="headerlink" title="一些说明"></a>一些说明</h3><ol><li>ERROR: opencv not found using pkg-config</li></ol><blockquote><p><code>opencv4</code> 放弃了对于 <code>pkg-config</code> 的支持,但是可以通过<strong>自己编译</strong>生成 <code>opencv.pc</code> 文件<br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5jdi9vcGVuY3YvaXNzdWVzLzEzMTU0">https://github.com/opencv/opencv/issues/13154<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ pkg-config --list-all | grep opencv</span><br><span class="line">opencv4                        OpenCV - Open Source Computer Vision Library</span><br></pre></td></tr></table></figure><ol start="2"><li>“ERROR: failed checking for nvcc”</li></ol><blockquote><p>This error happens because since the latest CUDA SDK (11.0) only accepts compute capability 5.2 - 8.0 (Maxwell, Pascal, Volta, Turing, Ampere). Compute_30<br>See: <span class="exturl" data-url="aHR0cHM6Ly90cmFjLmZmbXBlZy5vcmcvdGlja2V0Lzg3OTA=">https://trac.ffmpeg.org/ticket/8790<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><blockquote><p>修复方法: cd /path/to/ffmpeg &amp;&amp; vim configure  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第 4313 到 4320 行，替换为以下内容</span></span><br><span class="line"><span class="comment">#if enabled cuda_nvcc; then</span></span><br><span class="line"><span class="comment">#    nvcc_default=&quot;nvcc&quot;</span></span><br><span class="line"><span class="comment">#    nvccflags_default=&quot;-gencode arch=compute_30,code=sm_30 -O2&quot;</span></span><br><span class="line"><span class="comment">#else</span></span><br><span class="line"><span class="comment">#    nvcc_default=&quot;clang&quot;</span></span><br><span class="line"><span class="comment">#    nvccflags_default=&quot;--cuda-gpu-arch=sm_30 -O2&quot;</span></span><br><span class="line"><span class="comment">#    NVCC_C=&quot;&quot;</span></span><br><span class="line"><span class="comment">#fi</span></span><br><span class="line"><span class="keyword">if</span> enabled cuda_nvcc; <span class="keyword">then</span></span><br><span class="line">    nvcc_default=<span class="string">&quot;nvcc&quot;</span></span><br><span class="line">    nvccflags_default=<span class="string">&quot;-gencode arch=compute_52,code=sm_52 -O2&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    nvcc_default=<span class="string">&quot;clang&quot;</span></span><br><span class="line">    nvccflags_default=<span class="string">&quot;--cuda-gpu-arch=sm_52 -O2&quot;</span></span><br><span class="line">    NVCC_C=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="基本要求"><a href="#基本要求" class="headerlink" title="基本要求"></a>基本要求</h3><ol><li><code>cuda</code> 已正确安装</li><li><code>nvcc</code> 已添加到 <code>PATH</code></li></ol><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><blockquote><p>使用 apt 安装的 opencv</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</span><br><span class="line">sudo apt install libavcodec-dev \</span><br><span class="line">libavformat-dev libavutil-dev \</span><br><span class="line">libavfilter-dev libavdevice-dev \</span><br><span class="line">libswresample-dev libswscale-dev \</span><br><span class="line">libchromaprint-dev \</span><br><span class="line">libchromaprint-tools \</span><br><span class="line">libavcodec-dev libavformat-dev libavutil-dev \</span><br><span class="line">libchromaprint1 \</span><br><span class="line">libchromaprint-dev \</span><br><span class="line">pkg-config libopencv-dev \</span><br><span class="line">libxml2-dev \</span><br><span class="line">libopenal-dev \</span><br><span class="line">libomxil-bellagio-dev \</span><br><span class="line">yasm libc6 libc6-dev \</span><br><span class="line">wget curl unzip cmake libtool</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#安装 *Video Codec SDK*</span><br><span class="line">git clone https://git.videolan.org/git/ffmpeg/nv-codec-headers.git</span><br><span class="line">cd nv-codec-headers &amp;&amp; sudo make install &amp;&amp; cd –</span><br><span class="line"># ffmpeg</span><br><span class="line">cd /path/to/ffmpeg;</span><br><span class="line">./configure --enable-cuda-nvcc --enable-cuvid --enable-nvenc --enable-nonfree --enable-libnpp --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64 --extra-cflags=-DOPENCV_GENERATE_PKGCONFIG=ON --enable-libx264 --enable-libx265 --enable-gpl --enable-libmp3lame --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-frei0r --enable-libx264 --enable-shared</span><br><span class="line"># 第一次编译可能会出现一点问题，多尝试几次即可</span><br><span class="line">core=$(cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l)</span><br><span class="line">sudo make -j $(expr $core \* 2) &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -version</span><br><span class="line">ffprobe -version</span><br><span class="line">ffplay -version</span><br><span class="line">ffmpeg -y -vsync 0 -hwaccel cuvid \</span><br><span class="line">-c:v h264_cuvid -i \</span><br><span class="line">input.mp4 \</span><br><span class="line">-c:a copy -c:v h264_nvenc \</span><br><span class="line">-b:v 5M  -f mp4 \</span><br><span class="line">output.mp4</span><br></pre></td></tr></table></figure><h2 id="NVIDIA-Docker"><a href="#NVIDIA-Docker" class="headerlink" title="NVIDIA Docker"></a>NVIDIA Docker</h2><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9udmlkaWEtZG9ja2Vy">https://github.com/NVIDIA/nvidia-docker<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><h3 id="基本要求-1"><a href="#基本要求-1" class="headerlink" title="基本要求"></a>基本要求</h3><ol><li><code>cuda</code> 已正确安装</li><li><code>docker 19.03+</code> 已安装</li></ol><ul><li>Docker 推荐配置文件<ul><li><code>sudo vim /lib/systemd/system/docker.service</code></li><li>删除 <code>-H</code> 及其参数即可，比如修改 <code>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</code> 为 <code>ExecStart=/usr/bin/dockerd --containerd=/run/containerd/containerd.sock</code></li><li><code>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker.service</code></li></ul></li></ul><blockquote><p>公网服务器推荐配置<br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20va2VrcnUvOTc0ZTQwYmIxY2Q0Yjk0N2E1M2NjYTViYTRiMGJiZTU=">https://gist.github.com/kekru/974e40bb1cd4b947a53cca5ba4b0bbe5<i class="fa fa-external-link-alt"></i></span><br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tla3J1L2xpbnV4LXV0aWxzL2Jsb2IvbWFzdGVyL2NlcnQtZ2VuZXJhdGUvY3JlYXRlLWNlcnRzLnNo">https://github.com/kekru/linux-utils/blob/master/cert-generate/create-certs.sh<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;tcp://0.0.0.0:2376&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tlscacert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/ssl/ca.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tlscert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/ssl/server-cert.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tlskey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/docker/ssl/server-key.pem&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tlsverify&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;iptables&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>本地推荐配置  </p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;tcp://127.0.0.1:2375&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;https://dockerhub.azk8s.cn&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;iptables&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="镜像-nvidia-docker"><a href="#镜像-nvidia-docker" class="headerlink" title="镜像 nvidia-docker"></a>镜像 <em>nvidia-docker</em></h3><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly9udmlkaWEuZ2l0aHViLmlvL252aWRpYS1kb2NrZXIv">https://nvidia.github.io/nvidia-docker/<i class="fa fa-external-link-alt"></i></span><br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9udmlkaWEtZG9ja2VyL2lzc3Vlcy82MzUjaXNzdWVjb21tZW50LTM2NTE2MDA5OA==">https://github.com/NVIDIA/nvidia-docker/issues/635#issuecomment-365160098<i class="fa fa-external-link-alt"></i></span><br>See: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9udmlkaWEtZG9ja2VyL2lzc3Vlcy83MDYjaXNzdWVjb21tZW50LTM4MjU3ODE1Mw==">https://github.com/NVIDIA/nvidia-docker/issues/706#issuecomment-382578153<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><blockquote><p>Clone 下来以后可以使用 nginx 之类的 web server 对外提供访问<br>See: <a href="https://iitii.github.io/2019/04/06/1/">WebServer 基本配置文件</a>  </p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="attribute">root</span> /var/www/html/; <span class="comment">#指定目录所在路径</span></span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>; <span class="comment">#开启目录浏览</span></span><br><span class="line">    <span class="attribute">autoindex_format</span> html; <span class="comment">#以html风格将目录展示在浏览器中</span></span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>; <span class="comment">#切换为 off 后，以可读的方式显示文件大小，单位为 KB、MB 或者 GB</span></span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>; <span class="comment">#以服务器的文件时间作为显示的时间</span></span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>,gbk; <span class="comment">#展示中文文件名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$LOCALDIR</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$LOCALDIR</span></span><br><span class="line">git <span class="built_in">clone</span> -b gh-pages https://github.com/NVIDIA/libnvidia-container.git</span><br><span class="line">git <span class="built_in">clone</span> -b gh-pages https://github.com/NVIDIA/nvidia-container-runtime.git</span><br><span class="line">git <span class="built_in">clone</span> -b gh-pages https://github.com/NVIDIA/nvidia-docker.git</span><br></pre></td></tr></table></figure><h3 id="安装-NVIDA-Docker"><a href="#安装-NVIDA-Docker" class="headerlink" title="安装 NVIDA Docker"></a>安装 NVIDA Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> $ID<span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L <span class="variable">$LOCALDIR</span>/nvidia-docker/gpgkey | sudo apt-key add -</span><br><span class="line">curl -s -L <span class="variable">$LOCALDIR</span>/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.list | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line"></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y nvidia-container-toolkit</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><ol><li><code>docker run --gpus all nvidia/cuda:11.0-base nvidia-smi</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">❯ docker run --gpus all nvidia/cuda:11.0-base nvidia-smi</span><br><span class="line">Tue Aug 18 02:30:00 2020       </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |</span><br><span class="line">|-------------------------------+----------------------+----------------------+</span><br><span class="line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                               |                      |               MIG M. |</span><br><span class="line">|===============================+======================+======================|</span><br><span class="line">|   0  GeForce GTX 1050    On   | 00000000:01:00.0 Off |                  N/A |</span><br><span class="line">| N/A   52C    P0    N/A /  N/A |    588MiB /  4042MiB |      0%      Default |</span><br><span class="line">|                               |                      |                  N/A |</span><br><span class="line">+-------------------------------+----------------------+----------------------+</span><br><span class="line">                                                                               </span><br><span class="line">+-----------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                  |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span><br><span class="line">|        ID   ID                                                   Usage      |</span><br><span class="line">|=============================================================================|</span><br><span class="line">+-----------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### Test nvidia-smi with the latest official CUDA image</span></span><br><span class="line">docker run --gpus all nvidia/cuda:11.0-base nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start a GPU enabled container on two GPUs</span></span><br><span class="line">docker run --gpus 2 nvidia/cuda:11.0-base nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Starting a GPU enabled container on specific GPUs</span></span><br><span class="line">docker run --gpus <span class="string">&#x27;&quot;device=1,2&quot;&#x27;</span> nvidia/cuda:11.0-base nvidia-smi</span><br><span class="line">docker run --gpus <span class="string">&#x27;&quot;device=UUID-ABCDEF,1&quot;&#x27;</span> nvidia/cuda:11.0-base nvidia-smi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifying a capability (graphics, compute, ...) for my container</span></span><br><span class="line"><span class="comment"># Note this is rarely if ever used this way</span></span><br><span class="line">docker run --gpus all,capabilities=utility nvidia/cuda:11.0-base nvidia-smi</span><br></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><ul><li>到目前为止 cuda 开发环境<em>基本</em>是 ok 的了</li><li>还请留意最后更新时间，可能会年久失修</li><li><strong>Enjoy yourself</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> cuda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cuda </tag>
            
            <tag> ubuntu </tag>
            
            <tag> ffmpeg </tag>
            
            <tag> docker </tag>
            
            <tag> ubuntu20.04 </tag>
            
            <tag> focal </tag>
            
            <tag> cuda11 </tag>
            
            <tag> nvidia </tag>
            
            <tag> cudnn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端 js 获取IP归属地信息</title>
      <link href="/2020/06/20/1/"/>
      <url>/2020/06/20/1/</url>
      
        <content type="html"><![CDATA[<h3 id="API接口"><a href="#API接口" class="headerlink" title="API接口"></a>API接口</h3><blockquote><p>为了避免重复查找，这里记录一下接口  </p></blockquote><ol><li>ip.sb 获取自己IP：<span class="exturl" data-url="aHR0cHM6Ly9hcGkuaXAuc2IvaXA=">https://api.ip.sb/ip<i class="fa fa-external-link-alt"></i></span></li><li>ip.sb IP归属地查询: <span class="exturl" data-url="aHR0cHM6Ly9hcGkuaXAuc2IvZ2VvaXA=">https://api.ip.sb/geoip<i class="fa fa-external-link-alt"></i></span></li><li>ip-api.com 接口：<span class="exturl" data-url="aHR0cDovL2lwLWFwaS5jb20vanNvbi8=">http://ip-api.com/json/<i class="fa fa-external-link-alt"></i></span></li><li>域名信息查询接口：<span class="exturl" data-url="aHR0cHM6Ly9kbnNseXRpY3MuY29tL2FwaQ==">https://dnslytics.com/api<i class="fa fa-external-link-alt"></i></span></li><li>搜狐IP接口（默认 GBK）：<span class="exturl" data-url="aHR0cDovL3B2LnNvaHUuY29tL2NpdHlqc29u">http://pv.sohu.com/cityjson<i class="fa fa-external-link-alt"></i></span></li><li>搜狐接口（UTF-8）: <span class="exturl" data-url="aHR0cDovL3B2LnNvaHUuY29tL2NpdHlqc29uP2llPXV0Zi04">http://pv.sohu.com/cityjson?ie=utf-8<i class="fa fa-external-link-alt"></i></span></li></ol><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol><li>ip.sb 以及 ip-api.com 都是返回 JSON 数据</li></ol><ul><li>IP信息:<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Usage example: --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">getip</span>(<span class="params">json</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;My IP address is: &quot;</span>, json.<span class="property">ip</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://api.ip.sb/jsonip?callback=getip&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Usage example (jQuery): --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">getJSON</span>(<span class="string">&quot;https://api.ip.sb/jsonip?callback=?&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;My IP address is: &quot;</span>, json.<span class="property">ip</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    );</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>GeoIP 信息：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;185.255.55.55&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;country_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NL&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;country&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Netherlands&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;continent_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EU&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span> <span class="number">52.3824</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span> <span class="number">4.8995</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;asn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3214&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;organization&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xTom Limited&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Europe/Amsterdam&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>搜狐的那个相当于在 js 中声明变量，也就是说不能直接在其他语言里面用，而且查询到的信息有限。</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://pv.sohu.com/cityjson?ie=utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//获得设备ip</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> ip = returnCitySN.<span class="property">cip</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(returnCitySN.<span class="property">cip</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><blockquote><p>本站的跳转实现  </p></blockquote><ul><li>思路：  <ol><li>获取用户IP的国家代码</li><li>判断是不是中国</li><li>是，尝试访问 Cookie，若有执行对应操作，无则询问，并将结果保存并执行对应操作。不是则结束。</li></ol></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">redirct</span>(<span class="params">geoip</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable constant_">REDIRCT_KEY</span> = <span class="string">&quot;redirct&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> redirct_sites = <span class="string">&quot;iitii.malateam.cn&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> confirm_string = <span class="string">&quot;是否转到国内CDN加速站？（不保证永久可访问。选择\&quot;是\&quot;以后，如果需重新选择请清除浏览器 Cookies）&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> country_code = <span class="string">&quot;CN&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (country_code.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>).<span class="title function_">indexOf</span>(geoip.<span class="property">country_code</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="title function_">getCookieValueByKey</span>(<span class="variable constant_">REDIRCT_KEY</span>);</span><br><span class="line">        <span class="keyword">if</span> (result === <span class="string">&quot;true&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>.<span class="title function_">replace</span>(</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span>,</span><br><span class="line">                redirct_sites</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result === <span class="string">&quot;false&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> question = <span class="title function_">confirm</span>(confirm_string);</span><br><span class="line">            <span class="comment">//每个站点 Cookies 独享，为了避免错误地设置 Cookies</span></span><br><span class="line">            <span class="comment">//虽然 confirm 返回的值为 Boolean 类型，但是存入cookies中会变成字符串类型，true -&gt; &quot;true&quot;</span></span><br><span class="line">            <span class="title function_">setCookie</span>(<span class="variable constant_">REDIRCT_KEY</span>, question, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span> (question) &#123;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>.<span class="title function_">replace</span>(</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span>,</span><br><span class="line">                    redirct_sites</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getCookieValueByKey</span>(<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> tmp = key + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">      <span class="keyword">let</span> cookies = <span class="variable language_">document</span>.<span class="property">cookie</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cookies.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> cookie = cookies[i].<span class="title function_">trim</span>();</span><br><span class="line">          <span class="keyword">if</span> (cookie.<span class="title function_">indexOf</span>(tmp) == <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> cookie.<span class="title function_">substring</span>(tmp.<span class="property">length</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 设置cookies</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> key key</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> value value</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> expireDays 过期时间</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setCookie</span>(<span class="params">key, value, expireDays</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (expireDays &gt; <span class="number">0</span> || expireDays &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">          date.<span class="title function_">setTime</span>(</span><br><span class="line">              date.<span class="title function_">getTime</span>() + (</span><br><span class="line">                  expireDays * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span></span><br><span class="line">              )</span><br><span class="line">          );</span><br><span class="line">          <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>; expires=<span class="subst">$&#123;date.toGMTString()&#125;</span>`</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://api.ip.sb/geoip?callback=redirct&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IP查询 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派入坑指南</title>
      <link href="/2020/05/23/1/"/>
      <url>/2020/05/23/1/</url>
      
        <content type="html"><![CDATA[<div class="note danger">            <ul><li>本文以 <strong>3b+</strong> 为基础硬件设施，暂时只保证 3b+ 的可用性。为什么？我只有 3b+ ㄟ( ▔, ▔ )ㄏ</li><li>推荐使用 <code>CTRL+F</code> 快速定位问题</li><li>请关注最后修改时间，本文内容可能年久失修</li></ul>          </div><hr><div class="note danger">            <ul><li>更多简单操作自行发掘 raspi-config</li></ul>          </div><hr><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><ol><li>所有文档: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24v">https://www.raspberrypi.org/documentation/<i class="fa fa-external-link-alt"></i></span></li><li>串口文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vY29uZmlndXJhdGlvbi91YXJ0Lm1k">https://www.raspberrypi.org/documentation/configuration/uart.md<i class="fa fa-external-link-alt"></i></span></li><li><code>/boot/config.txt</code> 配置文件说明: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vY29uZmlndXJhdGlvbi9jb25maWctdHh0L1JFQURNRS5tZA==">https://www.raspberrypi.org/documentation/configuration/config-txt/README.md<i class="fa fa-external-link-alt"></i></span></li><li><code>raspi-config</code> 工具说明: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vY29uZmlndXJhdGlvbi9yYXNwaS1jb25maWcubWQ=">https://www.raspberrypi.org/documentation/configuration/raspi-config.md<i class="fa fa-external-link-alt"></i></span></li></ol><p><img src="https://www.raspberrypi.org/documentation/configuration/images/raspi-config.png" alt="alt"></p><ol start="5"><li>电源说明(供电电流，USB最大输出电流): <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vaGFyZHdhcmUvcmFzcGJlcnJ5cGkvcG93ZXIvUkVBRE1FLm1k">https://www.raspberrypi.org/documentation/hardware/raspberrypi/power/README.md<i class="fa fa-external-link-alt"></i></span>  </li></ol><table><thead><tr><th>Product</th><th>Recommended PSU current capacity</th><th>Maximum total USB peripheral current draw</th><th>Typical bare-board active current consumption</th></tr></thead><tbody><tr><td>Raspberry Pi Model A</td><td>700mA</td><td>500mA</td><td>200mA</td></tr><tr><td>Raspberry Pi Model B</td><td>1.2A</td><td>500mA</td><td>500mA</td></tr><tr><td>Raspberry Pi Model A+</td><td>700mA</td><td>500mA</td><td>180mA</td></tr><tr><td>Raspberry Pi Model B+</td><td>1.8A</td><td>600mA/1.2A (switchable)</td><td>330mA</td></tr><tr><td>Raspberry Pi 2 Model B</td><td>1.8A</td><td>600mA/1.2A (switchable)</td><td>350mA</td></tr><tr><td>Raspberry Pi 3 Model B</td><td>2.5A</td><td>1.2A</td><td>400mA</td></tr><tr><td>Raspberry Pi 3 Model A+</td><td>2.5A</td><td>Limited by PSU, board, and connector ratings only.</td><td>350mA</td></tr><tr><td>Raspberry Pi 3 Model B+</td><td>2.5A</td><td>1.2A</td><td>500mA</td></tr><tr><td>Raspberry Pi 4 Model B</td><td>3.0A</td><td>1.2A</td><td>600mA</td></tr><tr><td>Raspberry Pi Zero</td><td>1.2A</td><td>Limited by PSU, board, and connector ratings only</td><td>100mA</td></tr><tr><td>Raspberry Pi Zero W/WH</td><td>1.2A</td><td>Limited by PSU, board, and connector ratings only.</td><td>150mA</td></tr></tbody></table><ol><li>USB 说明（已知问题，排查问题方法）: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vaGFyZHdhcmUvcmFzcGJlcnJ5cGkvdXNiL1JFQURNRS5tZA==">https://www.raspberrypi.org/documentation/hardware/raspberrypi/usb/README.md<i class="fa fa-external-link-alt"></i></span></li><li>GPIO引脚说明: <span class="exturl" data-url="aHR0cHM6Ly9waW5vdXQueHl6L3Bpbm91dC9ncm91bmQ=">https://pinout.xyz/pinout/ground<i class="fa fa-external-link-alt"></i></span></li></ol><h3 id="启用串口"><a href="#启用串口" class="headerlink" title="启用串口"></a>启用串口</h3><blockquote><p>最简单的方法：使用 <a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3">raspi-config</a><br>Interfacing Options -&gt; P6 Serial  </p></blockquote><p><img src="/images/raspberrypi/ssh1.png" alt="alt"><br><img src="/images/raspberrypi/interface.png" alt="alt"></p><ol><li>因为现在 <em><strong>(2020-05-13)</strong></em> 安装的系统，默认禁用串口和ssh，所以在做这件事之前，我们得需要一个显示器，233  </li><li>但是由于树莓派分区默认不加密，所以我们可以使用一个支持 <code>ext4</code> 文件系统的软件(Diskgenius) 或系统 (Linux)，修改树莓派 <code>boot</code> 分区下面的 <code>config.txt</code></li><li>在树莓派 <code>/boot/config.txt</code> 尾部添加 <code>enable_uart=1</code> 然后重启即可</li></ol><h3 id="启用SSH"><a href="#启用SSH" class="headerlink" title="启用SSH"></a>启用SSH</h3><blockquote><p>最简单的方法：使用 <a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3">raspi-config</a><br>Interfacing Options -&gt; P2 SSH  </p></blockquote><p><img src="/images/raspberrypi/ssh1.png" alt="alt"><br><img src="/images/raspberrypi/interface.png" alt="alt"></p><ul><li>在 /boot/ 文件夹下面创建 ssh 或者 ssh.txt 文件即可，文件可以为空，重启后 ssh 就会默认启用</li></ul><blockquote><p>ssh or ssh.txt<br>When this file is present, SSH will be enabled on boot. The contents don’t matter, it can be empty. SSH is otherwise disabled by default.</p></blockquote><h3 id="修改静态-IP"><a href="#修改静态-IP" class="headerlink" title="修改静态 IP"></a>修改静态 IP</h3><blockquote><p>可使用 <code>ip addr</code> 查看接口信息  </p></blockquote><ol><li>修改 <code>/etc/dhcpcd.conf</code> ，在文件尾部添加</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example static IP configuration:</span></span><br><span class="line">interface eth0 <span class="comment"># 接口名称</span></span><br><span class="line">static ip_address=192.168.0.10/24 <span class="comment"># ipv4 地址</span></span><br><span class="line">static ip6_address=fd51:42f8:caae:d92e::ff/64 <span class="comment"># ipv6 地址</span></span><br><span class="line">static routers=192.168.0.1 <span class="comment"># 网关</span></span><br><span class="line">static domain_name_servers=192.168.0.1 8.8.8.8 fd51:42f8:caae:d92e::1 <span class="comment"># DNS 服务器地址</span></span><br></pre></td></tr></table></figure><ol start="2"><li>重启树莓派即可</li></ol><blockquote><p>直接修改 <code>/etc/network/interface</code> 也可  </p></blockquote><h3 id="从外置-USB-大容量硬盘或者U盘启动树莓派"><a href="#从外置-USB-大容量硬盘或者U盘启动树莓派" class="headerlink" title="从外置 USB 大容量硬盘或者U盘启动树莓派"></a>从外置 USB 大容量硬盘或者U盘启动树莓派</h3><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2RvY3VtZW50YXRpb24vaGFyZHdhcmUvcmFzcGJlcnJ5cGkvYm9vdG1vZGVzL21zZC5tZA==">https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/msd.md<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ol><li>目前只有 <strong>3b+</strong> 和 <strong>CM3+</strong> 支持开箱即用的USB大容量存储启动</li><li>所有操作和从 SD 卡启动一样（刷入系统，启动）</li></ol><h3 id="修改源"><a href="#修改源" class="headerlink" title="修改源"></a>修改源</h3><blockquote><p>示例基于 <em><strong>rasbian 10</strong></em> 和 <em><strong>清华源</strong></em><br>因为默认我安装的这个版本，默认不安装 vim， 故使用 echo<br>See: <span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL2hlbHAvcmFzcGJpYW4v">https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">echo</span> <span class="string">&#x27;deb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui&#x27;</span> &gt; /etc/apt/sources.list.d</span><br><span class="line">/raspi.list</span><br><span class="line">sudo <span class="built_in">echo</span> <span class="string">&#x27;deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi</span></span><br><span class="line"><span class="string">deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi&#x27;</span> &gt; /etc/apt/sources.list</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h3 id="apt-update-出错"><a href="#apt-update-出错" class="headerlink" title="apt update 出错"></a>apt update 出错</h3><blockquote><p>E: <span class="exturl" data-url="aHR0cDovL21pcnJvcnMudHVuYS50c2luZ2h1YS5lZHUuY24vcmFzcGJlcnJ5cGkvZGlzdHMvYnVzdGVyL0luUmVsZWFzZQ==">http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/dists/buster/InRelease<i class="fa fa-external-link-alt"></i></span> 的 Release 文件已经过期(已经过期了 95天 14小时 42分 13秒) 。该仓库的更新将不会应用。</p></blockquote><p><img src="/images/raspberrypi/source.png" alt="alt"></p><ul><li>经多方排查后发现这是由于 <strong>树莓派时间不对</strong> 导致的，应该是安装后未校准时间导致的</li><li>校对时间有两种方式，但是 btpd未安装所以我们先通过 <code>date</code> 粗略对准时间(见上图)<ul><li><code>ntpd</code></li><li><code>date</code></li></ul></li><li><code>date --s=&quot;2020-05-23 13:01:20&quot;</code></li><li>然后再 <code>sudo apt-get update</code> 即可</li></ul><h3 id="通过电脑以太网口共享网络给树莓派"><a href="#通过电脑以太网口共享网络给树莓派" class="headerlink" title="通过电脑以太网口共享网络给树莓派"></a>通过电脑以太网口共享网络给树莓派</h3><ol><li>连接网线</li><li>电脑设置共享网络，共享接口设置为树莓派的接口</li><li>使用 <code>arp -a</code> 或者直接查看IP，然后进行 <code>ping</code> 测试</li><li>一般来说都是可以直接通的</li><li>若出现已分配正确的IP，但访问不到的问题，尝试重置bug10的网络配置先。</li></ol><h3 id="树莓派通过以太网口共享-WiFi-给电脑"><a href="#树莓派通过以太网口共享-WiFi-给电脑" class="headerlink" title="树莓派通过以太网口共享 WiFi 给电脑"></a>树莓派通过以太网口共享 <code>WiFi</code> 给电脑</h3><blockquote><p>See: <span class="exturl" data-url="aHR0cHM6Ly93d3cucmFzcGJlcnJ5cGkub3JnL2ZvcnVtcy92aWV3dG9waWMucGhwP3Q9MTMyNjc0"> Wifi to Ethernet Bridge<i class="fa fa-external-link-alt"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FycGl0amluZGFsOTcvcmFzcGJpYW4tcmVjaXBlcy9ibG9iL21hc3Rlci93aWZpLXRvLWV0aC1yb3V0ZS5zaA==">https://github.com/arpitjindal97/raspbian-recipes/blob/master/wifi-to-eth-route.sh<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ol><li>安装组件：<code>sudo apt-get update &amp;&amp; sudo apt-get upgrade -y &amp;&amp; sudo apt-get install rpi-update dnsmasq -y sudo rpi-update</code></li><li>连接WiFi (使用 <code>raspi-config</code>)</li><li>树莓派以太网口设定固定IP，<code>vim /etc/dhcpcd.conf</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface eth0</span><br><span class="line">static ip_address=192.168.1.1/24</span><br><span class="line">static routers=192.168.1.0</span><br><span class="line">static domain_name_servers=10.1.89.100 223.5.5.5</span><br></pre></td></tr></table></figure></li><li>修改 dnsmasp 配置文件, <code>sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig &amp;&amp; sudo vim /etc/dnsmasq.conf</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">interface=eth0      <span class="comment"># Use interface eth0  </span></span><br><span class="line">listen-address=172.24.1.1 <span class="comment"># Explicitly specify the address to listen on  </span></span><br><span class="line">bind-interfaces      <span class="comment"># Bind to the interface to make sure we aren&#x27;t sending things elsewhere  </span></span><br><span class="line">server=8.8.8.8       <span class="comment"># Forward DNS requests to Google DNS  </span></span><br><span class="line">domain-needed        <span class="comment"># Don&#x27;t forward short names  </span></span><br><span class="line">bogus-priv           <span class="comment"># Never forward addresses in the non-routed address spaces.  </span></span><br><span class="line">dhcp-range=172.24.1.50,172.24.1.150,12h <span class="comment"># Assign IP addresses between 172.24.1.50 and 172.24.1.150 with a 12 hour lease time  </span></span><br></pre></td></tr></table></figure></li><li>开启内核转发, <code>echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p</code></li><li>修改 iptables 规则: <code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE</code></li><li> 保存 <code>iptables</code> 规则, <code>sudo sh -c &quot;iptables-save &gt; /etc/iptables.ipv4.nat&quot;</code></li><li> 修改 <code>/etc/rc.local</code> 使其开机加载（或者其他方法）</li></ol><blockquote><p>使用 <code>systemctl status dnsmasq ufw</code> 检查问题出错原因  </p></blockquote><h3 id="树莓派接外置硬盘出错"><a href="#树莓派接外置硬盘出错" class="headerlink" title="树莓派接外置硬盘出错"></a>树莓派接外置硬盘出错</h3><blockquote><p>[  354.951916] EXT4-fs error (device sda2): ext4_find_entry:1455: inode #1436: comm gmain: reading directory lblock 0  </p></blockquote><ul><li>原因：机械硬盘标称电流为0.8A, 树莓派3B+ USB口最大总输出电流为1.2A，机械硬盘起转电流要大于标称电流，而且上面还插了一个启动U盘。供电电流不够导致启动U盘电流不够，进而导致树莓派 down 机。</li></ul><blockquote><p>还是推荐上外供电（有源hub）  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> raspberrypi </category>
          
      </categories>
      
      
        <tags>
            
            <tag> raspberrypi </tag>
            
            <tag> raspbian </tag>
            
            <tag> 树莓派 </tag>
            
            <tag> 3b+ </tag>
            
            <tag> 树莓派使用指南 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各类虚拟机与主机大文件IO测试</title>
      <link href="/2020/04/27/1/"/>
      <url>/2020/04/27/1/</url>
      
        <content type="html"><![CDATA[<div class="note danger">            <ul><li>只测试了大文件IO，未测试小文件  </li><li>测试方法比较简陋，仅供参考  </li><li>请关注最后修改时间，本文内容可能年久失修</li></ul>          </div><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="note info">            <ul><li>Sys: Win10 1909</li><li>CPU: i5-7300HQ</li><li>MEM: DDR4 2400 16G</li><li>NVME：C2000 pro 1T (C, D, T)</li><li>SATA：东芝 256G (E)</li></ul>          </div><h3 id="直接拷贝-E-gt-D"><a href="#直接拷贝-E-gt-D" class="headerlink" title="直接拷贝 E -&gt; D"></a>直接拷贝 E -&gt; D</h3><p><img src="/images/IOTest/direct.png" alt="Loading"></p><h3 id="一般提高网络IO的方法"><a href="#一般提高网络IO的方法" class="headerlink" title="一般提高网络IO的方法"></a>一般提高网络IO的方法</h3><ol><li>使用巨型帧(<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSnVtYm9fZnJhbWU=">Jumbo Frame<i class="fa fa-external-link-alt"></i></span>)，调大 <code>MTU</code> （Up to 9000 bytes）</li><li>修改 Windows 注册表，调大 Windows 滑动窗口大小</li></ol><h3 id="VMware"><a href="#VMware" class="headerlink" title="VMware"></a>VMware</h3><h4 id="适配器信息"><a href="#适配器信息" class="headerlink" title="适配器信息"></a>适配器信息</h4><p><img src="/images/IOTest/vma.png" alt="Loading"></p><h4 id="速度"><a href="#速度" class="headerlink" title="速度"></a>速度</h4><blockquote><p>CPU 占用 +50% (直接拉满 100%)<br>适配器未出现大幅IO变化  </p></blockquote><p><img src="/images/IOTest/vm1.jpg" alt="Loading"></p><h4 id="已知信息"><a href="#已知信息" class="headerlink" title="已知信息"></a>已知信息</h4><ol><li><code>VMware workstation</code> 不支持巨型帧</li><li><code>VMware workstation</code> 使用 <code>samba</code> 来进行虚拟机和主机的文件访问，CPU资源占用较高</li></ol><h4 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h4><ul><li>为什么只有VMnat只有 100 Mbps？不能更快了吗？</li><li><span class="exturl" data-url="aHR0cHM6Ly9jb21tdW5pdGllcy52bXdhcmUuY29tL3RocmVhZC80Mzk3MjI=">这个只是表面速度，实际甚至可以上 10Gbps<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="HyperV"><a href="#HyperV" class="headerlink" title="HyperV"></a>HyperV</h3><h4 id="适配器信息-1"><a href="#适配器信息-1" class="headerlink" title="适配器信息"></a>适配器信息</h4><p><img src="/images/IOTest/hy.png" alt="Loading"></p><h4 id="速度-1"><a href="#速度-1" class="headerlink" title="速度"></a>速度</h4><blockquote><p>CPU 占用 <strong>+20%</strong><br>适配器出现大型IO变化，基本等同于下载速度  </p></blockquote><p><img src="/images/IOTest/hyva.png" alt="Loading"></p><h4 id="已知信息-1"><a href="#已知信息-1" class="headerlink" title="已知信息"></a>已知信息</h4><ol><li><code>HyperV</code> 和 <code>VMware</code> 都属于通过硬件辅助虚拟化实现的完全虚拟化。</li><li><code>HyperV</code>属于第一类管理程序，<code>VMware workstation</code> 属于第二类管理程序。两者不兼容</li><li>现在有基于<code>HyperV</code>的VMware预览版</li><li><code>Vbox</code> 也早也加入了对于 <code>HyperV</code> 的支持(但是未声明，可能还不稳定)</li><li><code>Google</code> 基于 <code>HyperV</code> 的安卓模拟器目前也在有序开发中</li></ol><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul><li>Docker 采取 cgroup 进行资源的管控，在访问挂载分区的时候使用 iptables 向本机发送数据，理论上性能损耗是很小的，故不考虑测试  </li><li>题外话：如果使用 -p 或 -P 参数，docker会直接向 iptables 添加规则，直接将端口暴露出去而不受防火墙的控制。</li><li>解决方法：<ul><li>采取硬件防火墙，不使用软件</li><li>修改 <code>/etc/docker/daemon.json</code> 添加或修改 <code>&#123; &quot;iptables&quot;: false &#125;</code>, 然后 <code>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker.service</code></li></ul></li></ul><h4 id="Docker-for-windows-Linux-container"><a href="#Docker-for-windows-Linux-container" class="headerlink" title="Docker for windows (Linux container)"></a>Docker for windows (Linux container)</h4><blockquote><p>适配器是使用上面的 HyperV vSwitch  </p></blockquote><h5 id="速度（访问挂载卷）"><a href="#速度（访问挂载卷）" class="headerlink" title="速度（访问挂载卷）"></a>速度（访问挂载卷）</h5><blockquote><p>CPU +50% (直接拉满)<br>1 GB/s左右及以上的是 <strong>docker内 IO 测试</strong>, 只有最后两条是挂载卷访问速度  </p></blockquote><p><img src="/images/IOTest/docker.png" alt="Loading"></p><h5 id="已知信息-2"><a href="#已知信息-2" class="headerlink" title="已知信息"></a>已知信息</h5><ul><li>Docker for windows 采取 samba 来实现主机和 container 的文件共享，速度较慢</li><li>Windows2004 通过了一个基于 HyperV 的 WSL2，实现了类原生访问。对于挂载卷的访问速度提升很大，基本接近于直接访问。</li></ul><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmlydHVhbF9tYWNoaW5lI0hhcmR3YXJlLWFzc2lzdGVkX3ZpcnR1YWxpemF0aW9u">https://en.wikipedia.org/wiki/Virtual_machine#Hardware-assisted_virtualization<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSHlwZXItViNBcmNoaXRlY3R1cmU=">https://en.wikipedia.org/wiki/Hyper-V#Architecture<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cucXVvcmEuY29tL1doYXQtaXMtdGhlLWRpZmZlcmVuY2UtYmV0d2Vlbi1WTXdhcmUtYW5kLUh5cGVyLVY=">https://www.quora.com/What-is-the-difference-between-VMware-and-Hyper-V<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> vm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> speedtest </tag>
            
            <tag> vmware </tag>
            
            <tag> hyperv </tag>
            
            <tag> docker </tag>
            
            <tag> io </tag>
            
            <tag> 速度 </tag>
            
            <tag> 大文件IO </tag>
            
            <tag> vmware 文件传输慢 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 安装 Oracle 数据库</title>
      <link href="/2020/02/24/1/"/>
      <url>/2020/02/24/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>若无特殊说明，文中的 “网络畅通” 自行解决  </p></blockquote><h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 <code>Docker</code></h3><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a><code>Windows</code></h4><h5 id="检查必需项"><a href="#检查必需项" class="headerlink" title="检查必需项"></a>检查必需项</h5><ul><li>控制面板 -&gt; 程序和功能 -&gt; 启用或关闭 <code>Windows</code> 功能 -&gt; 勾选 <code>HyperV</code> 和 <code>Containers</code> -&gt; 确定 -&gt; （待运行完成）重启电脑</li><li>必须启用 <code>HyperV</code> 和 <code>Containers</code></li></ul><p><img src="/images/docker/windows_features_enable.png" alt="Loading"></p><div class="note danger">            <ul><li>如果启用或关闭 <code>Windows</code> 功能里面没有上述两项，继续这一步，有则跳到下一步</li></ul>          </div><blockquote><p>将下述脚本分别复制黏贴保存为 <code>HyperV.cmd</code> 和 <code>Containers.cmd</code><br>或者直接从这里 <a href="/images/docker/docker.zip">下载</a><br>然后使用管理员身份运行</p></blockquote><ol><li>启用 <code>HyperV</code></li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem require Administrator</span></span><br><span class="line"><span class="built_in">pushd</span> &quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">dir</span> /b <span class="variable">%SystemRoot%</span>\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;<span class="built_in">findstr</span> /i . hyper-v.txt <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> dism /online /norestart /add-package:&quot;<span class="variable">%SystemRoot%</span>\servicing\Packages\<span class="variable">%%i</span>&quot;</span><br><span class="line"><span class="built_in">del</span> hyper-v.txt</span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure><ol start="2"><li>启用 <code>Containers</code></li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">rem require Administrator</span></span><br><span class="line"><span class="built_in">pushd</span> &quot;%~dp0&quot;</span><br><span class="line"><span class="built_in">dir</span> /b <span class="variable">%SystemRoot%</span>\servicing\Packages\*containers*.mum &gt;containers.txt</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;<span class="built_in">findstr</span> /i . containers.txt <span class="number">2</span>^&gt;<span class="built_in">nul</span>&#x27;) <span class="keyword">do</span> dism /online /norestart /add-package:&quot;<span class="variable">%SystemRoot%</span>\servicing\Packages\<span class="variable">%%i</span>&quot;</span><br><span class="line"><span class="built_in">del</span> containers.txt</span><br><span class="line">Dism /online /enable-feature /featurename:Containers -All /LimitAccess /ALL</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><h5 id="安装-docker"><a href="#安装-docker" class="headerlink" title="安装 docker"></a>安装 <code>docker</code></h5><ol><li>保证网络畅通</li><li>浏览器打开 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9wcm9kdWN0cy9kb2NrZXItZGVza3RvcA==">https://www.docker.com/products/docker-desktop<i class="fa fa-external-link-alt"></i></span></li><li>选择自己的版本</li><li>下载</li><li>双击安装</li><li>一切默认，一直点下一步</li><li>安装完成</li></ol><ul><li>如果出现 <code>Docker Desktop requires Windows 10 Pro...</code> </li></ul><p><img src="/images/docker/os_error.png" alt="Loading"></p><ol start="8"><li><code>Win + R</code> 打开运行，输入 <code>regedit</code> 回车</li><li> 导航到 <code>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion</code></li><li>修改 <code>EditionID</code> 值为 <code>Professional</code> 即可</li><li>重新执行第五步</li></ol><p><img src="/images/docker/regedit.png" alt="Loading"></p><h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a><code>Ubuntu</code></h4><ul><li><code>sudo apt-get update &amp;&amp; sudo apt install docker.io -y</code></li></ul><h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><ol><li>保证网络畅通</li><li>打开 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS8=">https://www.docker.com/<i class="fa fa-external-link-alt"></i></span></li><li>点击 <code>Get Started</code> 旁边的 <code>Sign In</code></li><li>有账号直接登录，没账号就点击 <code>Sign Up</code> 进行注册</li><li>登录以后打开 <span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fL29yYWNsZS1kYXRhYmFzZS1lbnRlcnByaXNlLWVkaXRpb24=">https://hub.docker.com/_/oracle-database-enterprise-edition<i class="fa fa-external-link-alt"></i></span></li><li>点击 <code>Proceed to Checkout</code></li><li>填写必要信息并提交</li><li>在页面右侧，我们可以看见 <code>docker pull store/oracle/database-enterprise:12.2.0.1</code></li><li>打开 <code>powershell</code> 或 <code>bash</code></li><li>设置命令行代理 (Windows 现在只能通过设置系统变量的方式给命令行设置代理) -&gt; See: <a href="https://iitii.github.io/2018/12/19/%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86/">命令行代理方式</a></li><li><code>docker login</code> 使用 <code>docker info</code> 去查看登录信息，如果没有 <code>Username</code> 这一行则没有登陆</li><li>填写必要信息，密码无回显</li><li>Run: <code>docker pull store/oracle/database-enterprise:12.2.0.1</code></li><li>耐心等待</li></ol><ul><li>你也可以从别人已有的镜像 Copy 一份给自己</li></ul><ol><li><code>docker image save 12a359cd0528 &gt; oracle_12.2.0.1.tar</code></li><li><code>docker image load &lt; oracle_12.2.0.1.tar</code></li><li>耐心等待，直到输出一长串字符（假设为：12a359cd0528）</li><li><code>docker image tag 12a359cd0528 store/oracle/database-enterprise:12.2.0.1</code></li><li>输入 <code>docker images</code> 即可看见镜像</li></ol><h3 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h3><div class="note danger">            <ul><li>容器正常运行最低要求为：8GB磁盘空间和2GB RAM</li><li>其中 <code>&lt;Oracle-DB&gt;</code> 为容器名称, 默认用户名和密码为 <code>sys</code> 和 <code>Oradoc_db1</code></li></ul>          </div><ul><li><code>docker run -d -it --name &lt;Oracle-DB&gt; -p 1521:1521 -p 5500:5500 store/oracle/database-enterprise:12.2.0.1</code></li><li>Example: <code>docker run -d -it --name oracle -p 1521:1521 -p 5500:5500 store/oracle/database-enterprise:12.2.0.1</code></li><li>使用 <code>docker ps -a</code> 来查看暴露的端口和运行状态</li><li>如果启动失败先确认自己是否已经登录</li><li>使用 <code>docker logs oracle</code> 查看错误信息</li></ul><h3 id="通过-IDEA-进行远程管理-连接-可选"><a href="#通过-IDEA-进行远程管理-连接-可选" class="headerlink" title="通过 IDEA 进行远程管理/连接 [可选]"></a>通过 IDEA 进行远程管理/连接 [可选]</h3><h4 id="启用-API"><a href="#启用-API" class="headerlink" title="启用 API"></a>启用 API</h4><h5 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h5><ol><li>双击 <code>docker</code> 图标</li><li>在 <code>General</code> 界面勾选 <code>Expose daemoon on tcp://...</code> </li><li>在 <code>Docker Engine</code> 界面添加 <code>&quot;ip&quot;: &quot;0.0.0.0&quot;</code></li><li>点击 <code>Apply &amp; Restart</code></li></ol><p><img src="/images/docker/docker_api_1.jpg" alt="Loading"><br><img src="/images/docker/docker_api_2.jpg" alt="Loading"></p><h5 id="Ubuntu-1"><a href="#Ubuntu-1" class="headerlink" title="Ubuntu"></a>Ubuntu</h5><ol><li><code>vim /etc/systemd/system/docker.service.d/startup_options.conf</code></li><li>修改 <code>ExecStart=/usr/bin/docker daemon</code> 为 <code>ExecStart=/usr/bin/docker daemon -H fd:// -H tcp://0.0.0.0:2375</code></li><li><code>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker.service</code></li><li><code>curl http://localhost:2375/version</code> 应该会返回一个关于当前版本的 <code>json</code> 信息</li></ol><h4 id="IDEA-连接"><a href="#IDEA-连接" class="headerlink" title="IDEA 连接"></a>IDEA 连接</h4><ol><li>打开: <code>Setting -&gt; Build, Execution, Deployment -&gt; Docker</code></li><li>点击 “+” 号</li><li>选择 <code>TCP socket</code></li><li><strong>根据自己的情况</strong>，在 <code>Engine API URL</code> 输入对应的 <code>URL</code></li><li>点击ok</li><li>等待连接</li><li>连接成功</li></ol><p><img src="/images/docker/idea1.png" alt="Loading"><br><img src="/images/docker/idea2.png" alt="Loading"></p><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p><img src="/images/docker/idea4.png" alt="Loading"><br><img src="/images/docker/idea3.png" alt="Loading"></p>]]></content>
      
      
      <categories>
          
          <category> Oracle </category>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> database </tag>
            
            <tag> Windows </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> Oracle数据库 </tag>
            
            <tag> 安装 </tag>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V2ray NGINX+TLS+WS 一键部署</title>
      <link href="/2020/02/08/1/"/>
      <url>/2020/02/08/1/</url>
      
        <content type="html"><![CDATA[<hr><blockquote><p><em>Update at Sun Feb  9 13:13:17 CST 2020</em>  </p></blockquote><ul><li>为了简化操作同时也为了一些可以自定义开机脚本的云服务厂商（如：GCP），添加了 <a href="https://github.com/IITII/AutoV2ray/blob/master/startUp.sh"><code>startUp.sh</code></a></li><li>当然您也可以在系统正常运行时直接执行该脚本</li></ul><div class="note warning">            <ul><li>使用方法<ol><li>打开链接，全选，复制</li><li>打开可以自定义启动脚本的地方，黏贴</li><li>修改脚本首部必要的信息，如: <code>SSL_PATH</code>, <code>SITE_NAME</code>, <code>WS_PATH</code>, <code>UUID</code>, <code>DDNS_KEY</code></li></ol></li></ul>          </div><div class="note info">            <p>注意：<strong>不一定</strong> 要全部填写。</p><ul><li>服务端必须填写: <code>SITE_NAME</code></li></ul>          </div><div class="note primary">            <h4 id="GCP-在实例创建时添加启动脚本"><a href="#GCP-在实例创建时添加启动脚本" class="headerlink" title="GCP 在实例创建时添加启动脚本"></a>GCP 在实例创建时添加启动脚本</h4><ol><li>在 GCP Console 中，转到虚拟机实例页面。</li><li>点击创建实例。</li><li>在创建新实例页面上，填写实例的属性。 对于高级的配置选项，展开管理、安全、磁盘、网络、单独租用部分。</li><li>在自动化部分的启动脚本下，提供启动脚本的内容。</li><li>点击创建以创建实例。</li></ol>          </div><div class="note danger">            <ul><li>查看 <code>v2ray</code>, <code>nginx</code> 运行状态: <code>systemctl status v2ray nginx</code></li><li><code>v2ray</code> 配置文件: <code>/etc/v2ray/config.json</code></li><li><code>nginx</code> 配置文件: <code>/etc/nginx/sites-available/default</code></li><li><code>v2ray</code> 日志文件: <code>/var/log/v2ray/*</code></li><li><code>nginx</code> 日志文件: <code>/var/log/nginx/*</code></li><li><code>GCP</code> 启动脚本输出会写入以下日志文件：<ul><li>CentOS 和 RHEL：<code>/var/log/messages</code></li><li>Debian：<code>/var/log/daemon.log</code></li><li>Ubuntu：<code>/var/log/syslog</code></li><li>SLES：<code>/var/log/messages</code></li></ul></li></ul>          </div><hr><div class="note warning">            <h4 id="特别说明"><a href="#特别说明" class="headerlink" title="特别说明"></a>特别说明</h4><ol><li>如果传递了 <code>ddns_key</code> 参数, 将使用 <code>dns.he.net</code> 的 <code>ddns</code> 服务来对 <code>dns</code> 解析记录进行更新，然后使用 <code>let&#39;s encrypt</code> 完成证书的颁发</li><li>如果传递了 <code>sslPath</code> 参数，文件名和路径请尽量不要使用特殊字符。证书推荐命名方式: <code>pem.pem</code>, <code>key.key</code>. 证书将会被复制到 <code>/etc/nginx/ssl/${网站名称}/</code> 下</li><li>如果以上两者都未赋值，将使用自签证书</li><li>不推荐使用自签证书，毕竟可信度不够。</li></ol>          </div><hr><h4 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h4><ol><li>有一个域名</li><li><del>有一个 <span class="exturl" data-url="aHR0cDovL2Rucy5oZS5uZXQv">dns.he.net<i class="fa fa-external-link-alt"></i></span> 的账号，而且至少托管了一个域名</del></li><li><del>有一个在 <span class="exturl" data-url="aHR0cDovL2Rucy5oZS5uZXQv">dns.he.net<i class="fa fa-external-link-alt"></i></span> 上托管的域名而且配置了 DDNS （动态域名解析）</del></li><li>一台干净的 Linux 服务器</li><li>会一些 Linux 的基本操作</li></ol><h4 id="开启-DDNS-非必需"><a href="#开启-DDNS-非必需" class="headerlink" title="开启 DDNS (非必需)"></a>开启 DDNS (非必需)</h4><blockquote><p>如果有，可以跳过  </p></blockquote><ol><li>登录 <span class="exturl" data-url="aHR0cDovL2Rucy5oZS5uZXQv">dns.he.net<i class="fa fa-external-link-alt"></i></span> 并且进入到域名管理界面</li><li>点击添加 <em><strong><code>A</code></strong></em> 记录</li><li>填写要开启 <code>DDNS</code> 的域名</li><li>勾选 <strong><code>Enable entry for dynamic dns</code></strong> 并点击 <code>submit</code></li><li>在域名列表里面找到添加的域名，在右边 <code>DDNS</code> 这一栏应该有一个箭头，点击箭头</li><li>点击生成 <code>DDNS key</code> 或者自己填一遍</li><li>将 <code>DDNS key</code> 复制出来，然后点击提交即可</li></ol><p><img src="/images/Linux/v2ray/tls.png" alt="alt"><br><img src="/images/Linux/v2ray/tls1.png" alt="alt"></p><h4 id="一些假设"><a href="#一些假设" class="headerlink" title="一些假设"></a>一些假设</h4><ol><li>服务器IP为: <code>1.1.1.1</code></li><li>域名为: <code>v2.google.com</code></li><li>DDNS key 为: <code>re35A5xFGdEzrRow</code></li><li>ws 路径为: <code>path</code></li><li>uuid为: <code>85d0e39a-4571-44da-80bb-caf5f853c2ba</code></li></ol><h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><ol><li>登录到服务器: <code>ssh root@1.1.1.1</code></li><li>Clone 仓库: <code>git clone https://github.com/IITII/AutoV2ray.git</code></li><li>参考例子和help，拼接参数即可</li><li>Enjoy it.</li></ol><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/IITII/AutoV2ray.git &amp;&amp; <span class="built_in">cd</span> AutoV2ray</span><br><span class="line"></span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span></span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span> </span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span>  -p <span class="string">&quot;path&quot;</span></span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span>  -p <span class="string">&quot;path&quot;</span> -u <span class="string">&quot;85d0e39a-4571-44da-80bb-caf5f853c2ba&quot;</span> </span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span>  -p <span class="string">&quot;path&quot;</span> -u <span class="string">&quot;85d0e39a-4571-44da-80bb-caf5f853c2ba&quot;</span> --ddns <span class="string">&quot;re35A5xFGdEzrRow&quot;</span></span><br><span class="line">bash ./v2ray -w <span class="string">&quot;v2.google.com&quot;</span>  -p <span class="string">&quot;path&quot;</span> -u <span class="string">&quot;85d0e39a-4571-44da-80bb-caf5f853c2ba&quot;</span> --sslPath <span class="string">&quot;/etc/nginx/ssl&quot;</span></span><br><span class="line"></span><br><span class="line">systemctl status v2ray nginx</span><br></pre></td></tr></table></figure><hr><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@test-machine<span class="comment"># bash v2ray.sh</span></span><br><span class="line">Usage:</span><br><span class="line">  draft/v2ray.sh -h, --<span class="built_in">help</span>            Show this page</span><br><span class="line">  draft/v2ray.sh -w                    siteName</span><br><span class="line">  draft/v2ray.sh -p, --path            v2ray web socket path, default <span class="string">&quot;/bin/date +&quot;</span>%S<span class="string">&quot; | /usr/bin/base64&quot;</span></span><br><span class="line">  draft/v2ray.sh -u, --uuid            v2ray uuid</span><br><span class="line">  draft/v2ray.sh --ddns                dns.he.net ddns<span class="string">&#x27;s key</span></span><br><span class="line"><span class="string">  draft/v2ray.sh --sslPath             ssl cert path</span></span><br></pre></td></tr></table></figure><h4 id="Docker-部署-实验性"><a href="#Docker-部署-实验性" class="headerlink" title="Docker 部署 (实验性)"></a>Docker 部署 (实验性)</h4><ul><li>随机配置文件: <code>docker run -d --name v2ray --restart always sikii/autov2ray</code></li><li>指定配置文件: <code>docker run -d --name v2ray -p 433:443 -v /path/config.json:/etc/v2ray/config.json --restart always sikii/autov2ray</code></li><li>如果需要进行后续修改的话<ol><li><code>docker exec -it v2ray bash</code></li><li><code>cd /root/AutoV2ray</code></li><li><code>./v2ray -w ... --ddns ...</code></li></ol></li></ul><h4 id="有点问题？"><a href="#有点问题？" class="headerlink" title="有点问题？"></a>有点问题？</h4><ol><li>仔细查看命令是否有问题</li><li>查看运行时终端的输出</li><li>查看 <code>/usr/local/etc/v2ray/config.json</code>, <code>/var/v2ray/config.json</code> 和 <code>/etc/nginx/sites-enabled/default</code> 文件的内容</li><li><code>systemctl status v2ray nginx; cat /var/v2ray/config.json; cat /usr/local/etc/v2ray/config.json</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> ladder </category>
          
      </categories>
      
      
        <tags>
            
            <tag> v2ray </tag>
            
            <tag> tls </tag>
            
            <tag> let&#39;s encrypt </tag>
            
            <tag> v2ray一键部署 </tag>
            
            <tag> ws </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 v2ray 中同时开启 socks 和 http 代理</title>
      <link href="/2020/02/04/1/"/>
      <url>/2020/02/04/1/</url>
      
        <content type="html"><![CDATA[<h3 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h3><ol><li>有 v2ray-core 客户端</li><li>有一定的 Linux 操作基础</li></ol><h3 id="一些介绍"><a href="#一些介绍" class="headerlink" title="一些介绍"></a>一些介绍</h3><ul><li>正如我们所知的那样, <code>v2ray</code> 的配置文件大体是由 <code>log</code> + <code>inbound</code> + <code>outbound</code> + <code>route</code> 组成的。</li><li>下面是一个简单的 v2ray 配置文件<blockquote><p>config.json  </p></blockquote></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;access&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\v2ray\\access.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\v2ray\\error.log&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;socks&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;noauth&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;udp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vnext&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;serveraddr.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">16823</span><span class="punctuation">,</span>  </span><br><span class="line">            <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span>    </span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IPOnDemand&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;geosite:cn&quot;</span><span class="punctuation">]</span> <span class="comment">// 中国大陆主流网站的域名</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geoip:cn&quot;</span><span class="punctuation">,</span> <span class="comment">// 中国大陆的 IP</span></span><br><span class="line">          <span class="string">&quot;geoip:private&quot;</span> <span class="comment">// 私有地址 IP，如路由器等</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/Linux/v2ray/multiInBounds.png" alt="alt"></p><ul><li>在图片中我们可以清楚的看到该配置文件有<strong>一个 <code>inbound</code></strong> 和 <strong>两个 <code>outbound</code></strong> 以及 <strong>两条路由规则</strong>。</li></ul><h3 id="一些想法"><a href="#一些想法" class="headerlink" title="一些想法"></a>一些想法</h3><ul><li>既然可以有多个 <code>outbound</code> 那么为什么不能有多个 <code>inbound</code> ？</li><li>而且官方文档里也说了，<code>inbounds</code> 和 <code>outbounds</code> 是 <code>inbound</code> 和 <code>outbound</code> 的集合。</li></ul><h4 id="简单的尝试"><a href="#简单的尝试" class="headerlink" title="简单的尝试"></a>简单的尝试</h4><blockquote><p>以上面的 config.json 为例，copy &amp; paste<br>然后再修改一下端口协议什么的  </p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;access&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;socks&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;noauth&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;udp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">1081</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;noauth&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;udp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vnext&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;serveraddr.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">16823</span><span class="punctuation">,</span>  </span><br><span class="line">            <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span>    </span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;domainStrategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IPOnDemand&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;geosite:cn&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;geoip:cn&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;geoip:private&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/images/Linux/v2ray/multiInBounds-1.png" alt="alt"></p><h4 id="尝试的结果"><a href="#尝试的结果" class="headerlink" title="尝试的结果"></a>尝试的结果</h4><ul><li><code>./v2ray --conf=./config.json</code>  </li></ul><p><img src="/images/Linux/v2ray/multiInBounds-2.png" alt="alt"></p><ul><li><code>lsof -i:1080 &amp;&amp; lsof -i:1081</code></li></ul><p><img src="/images/Linux/v2ray/multiInBounds-3.png" alt="alt"></p><blockquote><p>显然试验成功了。那么是 <strong>为什么</strong> 呢？</p></blockquote><h3 id="一些原因"><a href="#一些原因" class="headerlink" title="一些原因"></a>一些原因</h3><ol><li>我们可以将 <code>v2ray</code> 看成一个带加密功能的 <code>switch</code> , 将 <code>inbound</code> 看成 <code>LAN</code> 口，将 <code>outbound</code> 看成 <code>WAN</code> 口。</li><li>如果我们想正常上网，那么我们就得添加路由规则。也就是 <code>routing</code> 下面的 <code>rule</code> 。</li><li><code>v2ray</code> 接收来着 <code>LAN口</code> 的流量（也就是用户的流量），经过 <code>rule</code> 的匹配筛选后，转发给对应的 <code>WAN口</code> ，从而实现正常上网。</li><li>参考上面 <code>config.json</code> 里面的 <code>rule</code> ，<code>inboundTag</code> 都为空，<code>outboundTag</code> 都有明显的值。相当于匹配所有 <code>inboundTag</code> ，不区分，只区分应该转发到哪个 <code>outboundTag</code> （<em><strong>相当于默认路由</strong></em>）。</li><li>？如何匹配路由？我们可以看到在每一个 <code>rule</code> 下面都有一个 <code>ip</code> 或者 <code>domain</code>, <code>v2ray</code> 根据这个来匹配。<a href="#routing-%E4%B8%8B-rule-%E7%9A%84-ip-%E6%88%96%E5%9F%9F%E5%90%8D%E4%B9%A6%E5%86%99%E8%A7%84%E8%8C%83">书写规范</a><img src="/images/Linux/v2ray/multiInBounds-4.png" alt="alt"></li></ol><h3 id="routing-下-rule-的-IP-或域名书写规范"><a href="#routing-下-rule-的-IP-或域名书写规范" class="headerlink" title="routing 下 rule 的 IP 或域名书写规范"></a>routing 下 rule 的 IP 或域名书写规范</h3><blockquote><p>官方文档：<span class="exturl" data-url="aHR0cHM6Ly9ndWlkZS52MmZseS5vcmcvYmFzaWNzL3JvdXRpbmcvYmFzaWNzX3JvdXRpbmcuaHRtbA==">https://guide.v2fly.org/basics/routing/basics_routing.html<i class="fa fa-external-link-alt"></i></span><br>为了方便，copy 一份如下：</p></blockquote><h4 id="关于路由规则的注意事项"><a href="#关于路由规则的注意事项" class="headerlink" title="关于路由规则的注意事项"></a>关于路由规则的注意事项</h4><p>本节记录了一些新手朋友使用 V2Ray 使用路由功能时常范的错误，希望大家能够避免。</p><h5 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h5><p>如果我想让淘宝和京东的域名直连，路由功能的规则写成下面这样的，你觉得这样的规则有问题吗？</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;*.taobao.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;*.jd.com&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>看起来没有什么问题，但事实上，有。如果使用了这样的规则，你会发现根本没有走 direct 直连。很奇怪？这并不奇怪。这是因为你的经验在作祟。在 V2Ray 中，星号 * 不具备通配符的意义，只是一个普通的字符而已，是你以为星号 * 是通配符，这是臆想。如果想要匹配所有子域名的话，可以这么写规则：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;domain:taobao.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;domain:jd.com&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p><code>domain:</code> 代表子域名，如 “domain:taobao.com” 这样一条规则包含了所有 taobao.com 域名及其子域名。</p><h5 id="IP-amp-domain"><a href="#IP-amp-domain" class="headerlink" title="IP &amp; domain"></a>IP &amp; domain</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;domain:taobao.com&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;192.168.0.0/16&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>这样的一个规则的严格来说没有问题，真正的问题在与使用者不理解规则的配置。如果要匹配以上的规则，那么代表这有一个数据包的目标地址域名是 taobao.com 并且 IP 属于 192.168.0.0.1/16。通常情况下这是不可能的，所以你访问淘宝是不会匹配这个规则。如果你要满足域名和 IP 任一条件都能够匹配规则，那么应该这么写：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;domain&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;domain:taobao.com&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span>，</span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;direct&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;192.168.0.0/16&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ladder </category>
          
      </categories>
      
      
        <tags>
            
            <tag> v2ray </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V2ray WebSocket+TLS+Web + NGINX 国内反代</title>
      <link href="/2019/11/04/1/"/>
      <url>/2019/11/04/1/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>新手止步 </p>            <i class="fa fa-quote-right"></i>          </blockquote><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><ol><li>可以熟练的使用 vim, 原生 V2ray, NGINX</li><li>懂得提问的艺术</li><li>具有文中提到的软硬件资源。如：VPS &amp; 域名</li></ol><h3 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h3><blockquote><p>当然在反代服务器那边也可以套 N 多层…</p></blockquote><p><img src="/images/Linux/v2ray/1.png" alt="Loading"></p><h3 id="DEFINE"><a href="#DEFINE" class="headerlink" title="DEFINE"></a>DEFINE</h3><ul><li>V2ray Server<ul><li>Domain: <code>server.com</code></li><li>id: <code>7e6d2332-880e-4814-82ab-587bbb852361</code></li><li>path: <code>/path</code></li><li>SSL path: <code>/ssl</code></li><li>SSL file name: <code>pem.pem</code>, <code>key.key</code></li></ul></li><li>Reverse Server<ul><li>Domain: <code>reverse.com</code></li><li>path: <code>/path</code></li></ul></li></ul><blockquote><p>注意：V2ray Server 的 nginx 站点配置应为 <strong>default_server</strong>, 反代服务器的 NGINX 配置文件没有要求为 <strong>default_server</strong>, 但是也 <strong>不应该</strong> 指定其他站点为 <strong>default_server</strong>。<br>推荐将其都设置为 <strong>default_server</strong>。  </p></blockquote><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><blockquote><p>TLS 服务由 NGINX 提供，无需再 config.json 定义</p></blockquote><ol><li><p>安装必须项</p><ol><li><p>sudo apt install nginx -y 或者 yum install nginx -y </p></li><li><p>bash &lt;(curl -L -s <span class="exturl" data-url="aHR0cHM6Ly9pbnN0YWxsLmRpcmVjdC9nby5zaA==">https://install.direct/go.sh<i class="fa fa-external-link-alt"></i></span>)</p></li></ol></li><li><p>vim /etc/v2ray/config.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">23233</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7e6d2332-880e-4814-82ab-587bbb852361&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/path&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>vim /etc/nginx/sites-enabled/default</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl default_server;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>       /ssl/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>   /ssl/key.key;</span><br><span class="line">    <span class="attribute">ssl_protocols</span>         TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span>           HIGH:!aNULL:!MD5;</span><br><span class="line">    <span class="attribute">server_name</span>           server.com;</span><br><span class="line">      <span class="section">location</span> /path &#123;</span><br><span class="line">                <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://127.0.0.1:23233;</span><br><span class="line">                <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">                 <span class="comment"># Show real IP in v2ray access.log</span></span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>service v2ray restart &amp;&amp; nginx -t &amp;&amp; nginx -s reload</p></li></ol><blockquote><p>到此 TLS+WEB+WS 即可用了，但是个人的网（城域网）从各个意义上来说一般是不如国内服务器的，所以继续…</p></blockquote><h3 id="反代服务器"><a href="#反代服务器" class="headerlink" title="反代服务器"></a>反代服务器</h3><blockquote><p>当然还可以上 CDN 加速</p></blockquote><ol><li><p>sudo apt install nginx -y 或者 yum install nginx -y  </p></li><li><p>vim /etc/nginx/sites-enabled/default</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> server &#123;</span><br><span class="line">    <span class="attribute">server</span> server.com:<span class="number">443</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;  </span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl default_server;</span><br><span class="line">    <span class="attribute">server_name</span> reverse.com;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /ssl/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /ssl/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="comment">#error_log    /var/log/nginx/l_error.log    error;</span></span><br><span class="line">    <span class="comment">#access_log    /var/log/nginx/l_accss.log;</span></span><br><span class="line">    <span class="section">location</span> /china &#123;</span><br><span class="line">        <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://server;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://server;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real_IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> User-Agent <span class="variable">$http_user_agent</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Accept-Encoding <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><blockquote><p>如果设置了反代的话，服务器地址应修改为反代服务器地址, 所以 <code>outbounds</code> 里面的 <code>address</code> 应修改为 <code>reverse.com</code>  </p></blockquote><p><img src="/images/Linux/v2ray/2.png" alt="Loading"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;socks&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sniffing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;destOverride&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="string">&quot;noauth&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;udp&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;vnext&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">443</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7e6d2332-880e-4814-82ab-587bbb852361&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/path&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="¿¿¿¿¿¿"><a href="#¿¿¿¿¿¿" class="headerlink" title="¿¿¿¿¿¿"></a>¿¿¿¿¿¿</h3><ul><li><p>连接不上？看看服务器443端口开了没？防火墙？云防火墙？服务器被Q了？</p></li><li><p>看看 NGINX 和 V2RAY 日志，看不懂？哦</p></li><li><p>国内服务器被Q了？看看域名备案了没？</p></li><li><p>… …</p></li><li><p>¿¿¿</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ladder </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> v2ray </tag>
            
            <tag> websocket </tag>
            
            <tag> 国内反代 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个简单的 vnStat 监控界面</title>
      <link href="/2019/10/11/1/"/>
      <url>/2019/10/11/1/</url>
      
        <content type="html"><![CDATA[<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a><a href="https://iitii.github.io/VNSTAT-DASHBOARD/">Demo</a></h3><ul><li>项目链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL1ZOU1RBVC1EQVNIQk9BUkQ=">https://github.com/IITII/VNSTAT-DASHBOARD<i class="fa fa-external-link-alt"></i></span></li></ul><p><img src="/images/SimpleLineChart/demo.png" alt="alt"></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><blockquote><p>以 <code>Ubuntu</code> 为例 (Ctrl C V)  </p></blockquote><ol><li>在终端运行以下代码</li><li>打开浏览器访问服务器IP，即可查看效果</li></ol><div class="note warning">            <ul><li>如果没有数据，可能是因为刚刚才安装 vnstat，vnstat没有收集到足够的数据</li></ul>          </div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt insall nginx vnstat -y</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/IITII/VNSTAT-DASHBOARD /var/www/vnstat</span><br><span class="line"><span class="built_in">cd</span> /var/www/vnstat &amp;&amp; git checkout ALLINONE</span><br><span class="line">sed -i <span class="string">&quot;s/root \S\+/root \/var\/www\/vnstat;/g&quot;</span> /etc/nginx/sites-available/default \</span><br><span class="line">&amp;&amp; nginx -t &amp;&amp; nginx -s reload \</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1 * * * * /usr/bin/vnstat --json &gt; /var/www/vnstat/vnstat.json&quot;</span> \</span><br><span class="line">&gt;&gt; /var/spool/cron/crontabs/`<span class="built_in">whoami</span>`</span><br><span class="line">crontab -l</span><br></pre></td></tr></table></figure><h3 id="一些注意事项"><a href="#一些注意事项" class="headerlink" title="一些注意事项"></a>一些注意事项</h3><ul><li><code>index.html</code> 会自动加载同级目录下的 <code>vnstat.json</code> 来生成图表，若无则否。</li><li>你也可以在输入框里面手动输入 <code>vnstat json</code> 数据，数据可以使用 <code>vnstat --json</code> 来生成</li></ul><h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><ul><li>Q: 图表有的时候回闪烁，BUG？NO。 </li><li>A: 修改<code>index.html</code>，在 <code>options.tooltips</code> 里面指定 <code>&quot;animation&quot;: &#123;&quot;duration&quot;: 0&#125;</code> 即可</li></ul><!--### 如何使用？1. `git clone` 项目2. 使用 `nginx` 或者其他 `web` 服务器去为其提供服务3. 打开浏览器，访问 `localhost`### 举例* 实现确保该目录在 `nginx` 的 `web` 服务路径下面<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;  </span><br><span class="line">    <span class="attribute">server_name</span> _;  </span><br><span class="line">    <span class="section">location</span> / &#123; </span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html; </span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="直接读取-txt-文件版本"><a href="#直接读取-txt-文件版本" class="headerlink" title="直接读取 txt 文件版本"></a>直接读取 <code>txt</code> 文件版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/nginx/html</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/IITII/SimpleLineChart</span><br></pre></td></tr></table></figure><ul><li>打开浏览器，访问 <code>localhost/SimpleLineChart/</code> 即可看到效果</li></ul><h4 id="JS-生成配置文件版本"><a href="#JS-生成配置文件版本" class="headerlink" title="JS 生成配置文件版本"></a>JS 生成配置文件版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/nginx/html</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/IITII/SimpleLineChart</span><br></pre></td></tr></table></figure><ul><li>打开浏览器，访问 <code>localhost/SimpleLineChart/JSONLineChart</code> 即可看到效果</li></ul><h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><h4 id="直接读取-txt-文件版本-1"><a href="#直接读取-txt-文件版本-1" class="headerlink" title="直接读取 txt 文件版本"></a>直接读取 <code>txt</code> 文件版本</h4><ul><li>直接向 <code>label.txt</code>,<code>label.txt</code>,<code>label.txt</code> 这三个文件里面添加数据即可<h4 id="JS-生成配置文件版本-1"><a href="#JS-生成配置文件版本-1" class="headerlink" title="JS 生成配置文件版本"></a>JS 生成配置文件版本</h4></li></ul><blockquote><p>在修改完 <code>line.json</code> 后请务必运行一下 <code>node JSONLineChart/index.js</code> 以重新生成 <code>config.json</code></p></blockquote><ul><li>原本的 <code>line.json</code>, 如下：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;label&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datasets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;label1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;borderColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lineTension&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol><li>添加 x 轴数据：在 <code>line.json</code> 的 <code>labels</code> 里面添加数据</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;label&quot;</span><span class="punctuation">,</span><span class="string">&quot;2323&quot;</span><span class="punctuation">,</span><span class="string">&quot;4444&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datasets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;label1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;borderColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lineTension&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>添加点：在 <code>line.json</code> 的 <code>datasets[*].data</code> 里面添加数据</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;label&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datasets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;label1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;borderColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lineTension&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>添加线：在 <code>line.json</code> 的 <code>datasets</code> 里面添加数据</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;label&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datasets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;label1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;borderColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lineTension&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;label1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">40</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">78</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">78</span><span class="punctuation">,</span><span class="number">56</span><span class="punctuation">,</span><span class="number">78</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(25, 99, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;borderColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rgb(255, 9, 132)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lineTension&quot;</span><span class="punctuation">:</span> <span class="number">0.1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="个性化"><a href="#个性化" class="headerlink" title="个性化"></a>个性化</h3><p><img src="/images/SimpleLineChart/comment.png" alt="alt"></p><h4 id="直接读取-txt-文件版本-2"><a href="#直接读取-txt-文件版本-2" class="headerlink" title="直接读取 txt 文件版本"></a>直接读取 <code>txt</code> 文件版本</h4><ul><li>根据需要可修改以下字段</li></ul><ol><li>Title: <code>options.title.text</code> in <code>config.json</code></li><li>X axis title: <code>options.scales.xAxes.xAxes[0].scaleLabel.labelString</code> in <code>config.json</code></li><li>Y axis title: <code>options.scales.yAxes.yAxes[0].scaleLabel.labelString</code> in <code>config.json</code></li><li>Line label: <code>data.datasets[*].data</code> in <code>config.json</code></li><li>Line color: <code>data.datasets[*].borderColor</code> in <code>config.json</code></li><li>Label background color: <code>data.datasets[*].backgroundColor</code> in <code>config.json</code></li></ol><h4 id="JS-生成配置文件版本-2"><a href="#JS-生成配置文件版本-2" class="headerlink" title="JS 生成配置文件版本"></a>JS 生成配置文件版本</h4><ul><li>根据需要可修改以下字段</li></ul><ol><li>Title: <code>options.title.text</code> in <code>config.json</code></li><li>X axis title: <code>options.scales.xAxes.xAxes[0].scaleLabel.labelString</code> in <code>config.json</code></li><li>Y axis title: <code>options.scales.yAxes.yAxes[0].scaleLabel.labelString</code> in <code>config.json</code></li><li>Line label: <code>datasets[*].label</code> in <code>line.json</code></li><li>Line color: <code>datasets[*].borderColor</code> in <code>line.json</code></li><li>Label background color: <code>datasets[*].backgroundColor</code> in <code>line.json</code></li></ol><h3 id="Advance"><a href="#Advance" class="headerlink" title="Advance"></a>Advance</h3><ol><li>图表有的时候回闪烁，BUG？NO。 在 <code>options.tooltips</code> 里面指定 <code>&quot;animation&quot;: &#123;&quot;duration&quot;: 0&#125;</code> 即可</li><li>你还可以修改 options 里面的其他的参数</li><li>参见<ol><li>官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY2hhcnRqcy5vcmcvZG9jcy9sYXRlc3QvY2hhcnRzL2xpbmUuaHRtbCNkYXRhc2V0LXByb3BlcnRpZXM=">https://www.chartjs.org/docs/latest/charts/line.html#dataset-properties<i class="fa fa-external-link-alt"></i></span></li><li>网友翻译：<span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAwODQ5ODY2NCNhcnRpY2xlSGVhZGVyMTY=">https://segmentfault.com/a/1190000008498664#articleHeader16<i class="fa fa-external-link-alt"></i></span></li></ol></li></ol><p>–&gt;</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> HTML </category>
          
          <category> JS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vnstat </tag>
            
            <tag> 前端 </tag>
            
            <tag> 折线图 </tag>
            
            <tag> 在线图表 </tag>
            
            <tag> chart.js </tag>
            
            <tag> chart </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用tar命令来实现Linux系统的备份与恢复</title>
      <link href="/2019/08/06/1/"/>
      <url>/2019/08/06/1/</url>
      
        <content type="html"><![CDATA[<div class="note warning">            <ol><li>本文适用于具有一定基础和动手能力的 Linux 用户, 不清楚之处还请自行百度</li><li>系统的备份与恢复具有很大风险，在操作之前还请备份重要数据先。</li></ol>          </div><h3 id="以-Ubuntu18-04-系统为例"><a href="#以-Ubuntu18-04-系统为例" class="headerlink" title="以 Ubuntu18.04 系统为例"></a>以 Ubuntu18.04 系统为例</h3><blockquote><p>系统配置</p></blockquote><ul><li>OS: Ubuntu 18.04</li><li>mem: 16G</li><li>disk1: TOSHIBA 256G 2280 m.2 sata</li><li>disk2: HS-C2000Pro 1024</li><li>Display: NVIDIA GTX 1050 (cuda 已配置)</li></ul><blockquote><p>磁盘分区表</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@l: lsblk</span><br><span class="line">NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                         8:0    0  256G  0 disk</span><br><span class="line">├─sda1                      8:1    0   99M  0 part /boot/efi</span><br><span class="line">├─sda2                      8:2    0  216M  0 part</span><br><span class="line">└─sda3                      8:3    0   40G  0 part /</span><br><span class="line">sdb                         8:0    0 1024G  0 disk</span><br><span class="line">├─sdb1                      8:1    0   99M  0 part</span><br><span class="line">├─sdb2                      8:2    0  128M  0 part </span><br><span class="line">├─sdb3                      8:2    0  873G  0 part </span><br><span class="line">└─sdb4                      8:3    0  150G  0 part </span><br></pre></td></tr></table></figure><h3 id="对于整个系统进行备份与恢复"><a href="#对于整个系统进行备份与恢复" class="headerlink" title="对于整个系统进行备份与恢复"></a>对于整个系统进行备份与恢复</h3><ul><li>示例：将系统从 <code>/dev/sda3</code> 移动到 <code>/dev/sdb4</code><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3></li></ul><ol><li>删除不必要的日志文件</li><li>取消不重要 <em>盘/分区</em> 的挂载</li></ol><h3 id="开始备份"><a href="#开始备份" class="headerlink" title="开始备份"></a>开始备份</h3><ul><li>同理，您也可以将压缩以后的文件任意移动到一个足够大的分区中，然后使用U盘引导，进入 live 桌面  </li><li>当然你也可以通过网络实现实时远程备份，如使用 <code>netcat(nc)</code> 和 <code>ssh</code>，或者先备份，之后再通过网络发送压缩包。</li></ul><ol><li>进入了单人模式，首先将不必要的挂载分区给取消挂载</li><li>挂载要存放文件的分区</li><li>压缩根目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份系统</span></span><br><span class="line">root@l: <span class="built_in">cd</span> / &amp;&amp; apt clean</span><br><span class="line">root@l: mount /dev/sdb4 /media/D</span><br><span class="line">root@l: tar -cvpzf /media/D/backup.tar.gz \</span><br><span class="line">--exclude=/media \</span><br><span class="line">--exclude=/media/D/backup.tar.gz \</span><br><span class="line">--exclude=/proc \</span><br><span class="line">--exclude=/tmp \</span><br><span class="line">--exclude=/mnt \</span><br><span class="line">--exclude=/dev \</span><br><span class="line">--exclude=/sys \</span><br><span class="line">--exclude=/run \</span><br><span class="line">--exclude=/var/cache/apt/archives \</span><br><span class="line">--one-file-system /</span><br></pre></td></tr></table></figure><ul><li>c：创建压缩包</li><li>v：输出压缩信息</li><li>p：保持文件原有的权限和属性</li><li>z：压缩文件为 <code>.gz</code></li><li>f：指定文件名</li><li>–exclude=/example/path：不压缩指定路径下面的文件</li><li>-one-file-system：不备份其他文件系统中的文件（只备份和系统根分区一样分区类型的文件）</li><li>如果您希望其他文件系统（例如 /home分区或安装在 /media备份中的外部介质），您需要单独备份它们，或省略此标志。如果省略此标志，则需要添加几个 –exclude= 参数以避免您不想要的文件系统。 </li><li>/proc 和 /sys 是虚拟文件系统，它为正在运行的内核的变量提供接口，因此没有必要尝试备份或还原它们。 /dev 是一个tmpfs，其内容由udev动态创建和删除，因此您也没有必要尝试备份或还原它。同样，/run 是一个 tmpfs，它保存有关系统运行的一些变量.<ul><li>For more: <a href="https://iitii.github.io/2019/07/10/1/">Here</a><blockquote><p>注意：<code>--exclude=</code> 的排除是递归的，把相对越长的目录写在前面。要不然就不会备份或者排除该目录</p></blockquote></li></ul></li></ul><h3 id="分卷压缩"><a href="#分卷压缩" class="headerlink" title="分卷压缩"></a>分卷压缩</h3><ul><li>注意：因为 FAT32 最大支持文件大小为4G而且系统备份 <strong>一般</strong> 比较大（<strong>一般 30G 起步</strong>），不强制要求，自行抉择</li></ul><h4 id="压缩后分卷"><a href="#压缩后分卷" class="headerlink" title="压缩后分卷"></a>压缩后分卷</h4><ul><li><code>split -d -b 3900m /path/to/backup.tar.gz /name/of/backup.tar.gz</code>  </li><li>简单地拆分由/path/to/backup.tar.gz指定的现有文件。<h4 id="压缩前分卷"><a href="#压缩前分卷" class="headerlink" title="压缩前分卷"></a>压缩前分卷</h4></li><li><code>tar -cvpz &lt;put options here&gt; / | split -d -b 3900m  -  /name/of/backup.tar.gz</code></li><li>直到管道（|）的前半部分与我们之前的例子相同，但是省略了 <em><strong>f</strong></em> 选项。去掉 <em><strong>f</strong></em> 参数，tar会将存档输出到标准输出，然后通过管道输出到split命令。</li><li><code>-d</code>  此选项表示存档后缀将是数字而不是字母，每个拆分将从01开始顺序，并随每个新的拆分文件而增加。</li><li><code>-b</code>  此选项指定要拆分的大小，在此示例中，已将其设置为 <em><strong>3900MB</strong></em> 以适合FAT32分区。</li><li><code>-</code> 连字符是输入文件的占位符（通常是已创建的实际文件），并指示拆分以使用标准输入。 </li><li><code>/name/of/backup.tar.gz</code> 是将应用于所有生成的拆分文件的前缀。它应该指向您希望放置存档的文件夹。在这个示例中，第一个拆分归档文件将位于 <code>/name/of/</code> 目录中，并命名为 <code>backup.tar.gz.01</code></li></ul><h4 id="合并分卷文件"><a href="#合并分卷文件" class="headerlink" title="合并分卷文件"></a>合并分卷文件</h4><ol><li>cd 进入文件所在的目录</li><li>使用 <code>cat *tar.gz* |tar -xvpzf - -C /</code> 提取到根目录（也可以修改为其他目录）</li></ol><h3 id="开始恢复"><a href="#开始恢复" class="headerlink" title="开始恢复"></a>开始恢复</h3><div class="note info">            <ol><li>对于同一台电脑进行备份直接跟着教程走</li><li>不同的电脑实现备份的话，可以先做一个启动盘，然后U盘启动进入live桌面，接下来操作是一样的</li><li>对于已有系统想替换掉的话，可以和第二点进行一样的做法，不过记得 <em><strong>备份和格式化分区</strong></em></li></ol>          </div><ol><li>重启，正常进入系统</li><li>挂载要安装系统的分区</li><li>解压</li><li>创建缺少的文件夹</li><li>挂载启动分区</li><li>安装 <code>grub</code></li><li>reboot</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@l: mount /dev/sdb4 /media/D</span><br><span class="line">root@l: <span class="built_in">cd</span> /media/D/</span><br><span class="line">root@l: sudo tar -xvpzf /path/to/backup.tar.gz -C /media/D/ --numeric-owner</span><br><span class="line">root@l: <span class="built_in">mkdir</span> proc sys mnt media tmp dev run</span><br><span class="line">root@l: sudo -s</span><br><span class="line"><span class="comment"># 挂载启动分区</span></span><br><span class="line">root@l: mount /dev/sdb1 /media/c</span><br><span class="line">root@l: mount -o <span class="built_in">bind</span> /sys sys</span><br><span class="line">root@l: mount -o proc rpoc</span><br><span class="line">root@l: <span class="built_in">cd</span> / ; <span class="keyword">for</span> f <span class="keyword">in</span> dev dev/pts proc ; <span class="keyword">do</span> mount --<span class="built_in">bind</span> /<span class="variable">$f</span> /media/D/<span class="variable">$f</span> ; <span class="keyword">done</span></span><br><span class="line">root@l: <span class="built_in">chroot</span> /media/D/</span><br><span class="line">root@l: grub-install --recheck --no-floppy /dev/sdb1</span><br><span class="line">root@l: <span class="built_in">echo</span> <span class="string">&quot;`blkid | grep sda1 | awk &#x27;&#123;printf <span class="variable">$2</span>&#125;&#x27; | sed &#x27;s/&quot;</span>//g<span class="string">&#x27;` /opt ext4 defaults 0 0&quot; &gt;&gt; /etc/fstab</span></span><br><span class="line"><span class="string">root@l: echo &quot;`blkid | grep sda4 | awk &#x27;</span>&#123;<span class="built_in">printf</span> <span class="variable">$2</span>&#125;<span class="string">&#x27; | sed &#x27;</span>s/<span class="string">&quot;//g&#x27;` /opt ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line">root@l: vim /etc/fstab</span><br><span class="line">root@l: update-grub</span><br><span class="line">root@l: <span class="built_in">exit</span></span><br><span class="line">root@l: reboot</span><br></pre></td></tr></table></figure><ol><li><code>x</code> 解压文件</li><li>-C <directory> 解压至指定路径</li><li>–numeric-owner - 此选项告诉tar恢复归档文件的数字所有者，而不是匹配要还原的环境中的任何用户名。因为这是您要恢复的系统中的用户 <code>id:s</code> 不一定与您用于恢复的系统匹配(例如: <em>live CD</em> )</li></ol><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><ol><li><span class="exturl" data-url="aHR0cHM6Ly9oZWxwLnVidW50dS5jb20vY29tbXVuaXR5L0JhY2t1cFlvdXJTeXN0ZW0vVEFS">Ubuntu Documentation: TAR<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly96ZWxkb3IuYml6LzIwMTAvMTIvaW5zdGFsbC1ncnViLWZyb20tY2hyb290Lw==">Install Grub from chroot<i class="fa fa-external-link-alt"></i></span></li><li>+实践</li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> tar </tag>
            
            <tag> restore </tag>
            
            <tag> 系统备份 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一种解决Linux无法识别并挂载外接硬盘的办法(uas)</title>
      <link href="/2019/08/05/1/"/>
      <url>/2019/08/05/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>系统参见：Ubuntu server 18.04，外接硬盘类型：绿联硬盘盒（SATA3.0 to USB3.0, 希捷500G）</p></blockquote><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><ul><li>插上外接硬盘后，tty输出：<code>usb stat urb: status -32</code>, <em>df</em> 和 <em>lsblk</em> 都看不到外接硬盘的存在。</li></ul><h3 id="问题发现"><a href="#问题发现" class="headerlink" title="问题发现"></a>问题发现</h3><ul><li><code>tail -f kern.log</code>  </li></ul><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ol><li><code>lsusb -v</code> 查找挂载的USB设备，并记录 <code>idVendor idProduct</code></li></ol><ol start="2"><li>对指定USB设备禁用 <code>uas</code> 模块 </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options usb-storage quirks=idVendor:idProduct:u&quot;</span> | sudo <span class="built_in">tee</span> /etc/modprobe.d/anyname.conf</span><br><span class="line">sudo update-initramfs -u</span><br></pre></td></tr></table></figure><blockquote><p><code>update-initramfs -u</code> 更新 <code>initramfs</code><br>对于 <code>Arch Linux</code> 使用 <code>mkinitcpio -p linux</code> 来实现类似的操作</p></blockquote><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p><img src="/images/Linux/USB/uas.png" alt="alt"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options usb-storage quirks=0x174c:0x55aa:u&quot;</span> | sudo <span class="built_in">tee</span> /etc/modprobe.d/ingore_nas.conf</span><br><span class="line">sudo update-initramfs -u</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> mount </tag>
            
            <tag> uas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lvm简单使用以及grub2菜单不显示的解决方法</title>
      <link href="/2019/08/04/1/"/>
      <url>/2019/08/04/1/</url>
      
        <content type="html"><![CDATA[<h3 id="lvm-的简单使用"><a href="#lvm-的简单使用" class="headerlink" title="lvm 的简单使用"></a>lvm 的简单使用</h3><blockquote><p>因为lvextend扩展的是lv, df看到的是文件系统，所以调整分区后 df 和 lsblk 的结果<strong>可能</strong>不一致<br>若调整分区后 df 和 lsblk 的结果不一致，使用  <code>resize2fs -p -F /dev/part</code> 进行文件系统的调整  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@server1804:~<span class="comment"># resize2fs -p -F /dev/mapper/ubuntu--vg-ubuntu--lv</span></span><br><span class="line">resize2fs 1.44.1 (24-Mar-2018)</span><br><span class="line">Filesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 1, new_desc_blocks = 2</span><br><span class="line">The filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now 2621440 (4k) blocks long.</span><br><span class="line"></span><br><span class="line">root@server1804:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h4><ol><li>增加<strong>到</strong>10G：<code>lvextend -L 10G /dev/ubuntu-vg/ubuntu-lv</code> </li><li>增加10G：<code>lvextend -L +10G /dev/ubuntu-vg/ubuntu-lv</code> </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@server1804:~<span class="comment"># lvextend -L 10G /dev/ubuntu-vg/ubuntu-lv</span></span><br><span class="line">  Size of logical volume ubuntu-vg/ubuntu-lv changed from 4.00 GiB (1024 extents) to 10.00 GiB (2560 extents).</span><br><span class="line">  Logical volume ubuntu-vg/ubuntu-lv successfully resized.</span><br><span class="line">root@server1804:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="减少"><a href="#减少" class="headerlink" title="减少"></a>减少</h4><ol><li>减少<strong>到</strong>10G：<code>lvextend -L 10G /dev/ubuntu-vg/ubuntu-lv</code> </li><li>减少10G：<code>lvextend -L -10G /dev/ubuntu-vg/ubuntu-lv</code> </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@server1804:~<span class="comment"># lvreduce -L -1G /dev/ubuntu-vg/ubuntu-lv</span></span><br><span class="line">  WARNING: Reducing active and open logical volume to 10.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce ubuntu-vg/ubuntu-lv? [y/n]: y</span><br><span class="line">  Size of logical volume ubuntu-vg/ubuntu-lv changed from 11.00 GiB (2816 extents) to 10.00 GiB (2560 extents).</span><br><span class="line">  Logical volume ubuntu-vg/ubuntu-lv successfully resized.</span><br><span class="line">root@server1804:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="grub2-菜单不显示"><a href="#grub2-菜单不显示" class="headerlink" title="grub2 菜单不显示"></a>grub2 菜单不显示</h3><blockquote><p>若要使修改生效，必须 <em><strong>update-grub</strong></em>  </p></blockquote><ol><li>保证 grub 延迟不为零</li><li>延迟等待样式不为 <em><strong>hidden</strong></em></li></ol><ul><li>修改 <code>/etc/default/grub</code>: <code>vim /etc/default/grub</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GRUB_DEFAULT=0</span><br><span class="line">GRUB_TIMEOUT_STYLE=hidden</span><br><span class="line">GRUB_TIMEOUT=10</span><br><span class="line">GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || <span class="built_in">echo</span> Debian`</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;debian-installer/custom-installation=/custom find_preseed=/preseed.cfg auto preseed/file=/floppy/preseed.cfg automatic-ubiquity noprompt priority=critical locale=en_US console-setup/modelcode=evdev&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><ul><li>将 <code>GRUB_TIMEOUT_STYLE=hidden</code> 修改为 <code>GRUB_TIMEOUT_STYLE=menu</code> 且 <code>GRUB_TIMEOUT</code> 不为零。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GRUB_DEFAULT=0</span><br><span class="line">GRUB_TIMEOUT_STYLE=menu</span><br><span class="line">GRUB_TIMEOUT=10</span><br><span class="line">GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || <span class="built_in">echo</span> Debian`</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;debian-installer/custom-installation=/custom find_preseed=/preseed.cfg auto preseed/file=/floppy/preseed.cfg automatic-ubiquity noprompt priority=critical locale=en_US console-setup/modelcode=evdev&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> df和lsblk结果不一致 </tag>
            
            <tag> grub </tag>
            
            <tag> lvm </tag>
            
            <tag> boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用tar命令来实现对Linux系统挂载点的调整</title>
      <link href="/2019/08/03/1/"/>
      <url>/2019/08/03/1/</url>
      
        <content type="html"><![CDATA[<div class="note warning">            <ol><li>本文适用于具有一定基础和动手能力的 Linux 用户, 不清楚之处还请自行百度</li><li>系统挂载点的调整具有很大风险，在操作之前还请备份重要数据先。</li></ol>          </div><h3 id="以-Ubuntu18-04-系统为例"><a href="#以-Ubuntu18-04-系统为例" class="headerlink" title="以 Ubuntu18.04 系统为例"></a>以 Ubuntu18.04 系统为例</h3><blockquote><p>系统配置</p></blockquote><ul><li>OS: Ubuntu 18.04</li><li>mem: 16G</li><li>disk1: TOSHIBA 256G 2280 m.2 sata</li><li>disk2: HS-C2000Pro 1024</li><li>Display: NVIDIA GTX 1050 (cuda 已配置)</li></ul><blockquote><p>磁盘分区表</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@l: lsblk</span><br><span class="line">NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                         8:0    0  256G  0 disk</span><br><span class="line">├─sda1                      8:1    0   99M  0 part /boot/efi</span><br><span class="line">├─sda2                      8:2    0  216M  0 part</span><br><span class="line">└─sda3                      8:3    0   40G  0 part /</span><br><span class="line">sdb                         8:0    0 1024G  0 disk</span><br><span class="line">├─sdb1                      8:1    0   99M  0 part</span><br><span class="line">├─sdb2                      8:2    0  128M  0 part </span><br><span class="line">├─sdb3                      8:2    0  873G  0 part </span><br><span class="line">└─sdb4                      8:3    0  150G  0 part </span><br></pre></td></tr></table></figure><h3 id="更改Linux挂载点，如将-opt-挂载到-dev-sdb3-上"><a href="#更改Linux挂载点，如将-opt-挂载到-dev-sdb3-上" class="headerlink" title="更改Linux挂载点，如将 /opt 挂载到 /dev/sdb3 上"></a>更改Linux挂载点，如将 /opt 挂载到 /dev/sdb3 上</h3><ol><li>修改 <code>/etc/fstab</code>，将里面所有的通过设备名称来 mount 的分区全部修改为通过 UUID 来挂载（这样子不会导致因为系统分区调整而导致系统启动失败）。<code>sudo update-grub</code></li><li>reboot 进入单人维护模式</li><li>格式化分区为 ext4，格式化为与根目录系统一样的分区</li><li>挂载分区</li><li>压缩文件</li><li>解压文件</li><li>修改文件夹名称</li><li>修改 <code>/etc/fstab</code></li><li>更新启动信息并重启</li><li>正常启动后删除中间文件夹，如果启动异常或安装在备份目录里面的软件失效了，到第一步重新开始。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@l: lsblk <span class="comment">#查看分区信息</span></span><br><span class="line">root@l: <span class="built_in">mkdir</span> /opt1</span><br><span class="line">root@l: mkfs.ext4 /dev/sdb3 <span class="comment"># 格式化分区为 ext4，格式化为与根目录系统一样的分区</span></span><br><span class="line">root@l: mount /dev/sdb3 /opt1 <span class="comment"># 挂载</span></span><br><span class="line">root@l: tar -cvf /opt1/opt.tar /opt <span class="comment"># 备份</span></span><br><span class="line">root@l: <span class="built_in">cd</span> /opt1</span><br><span class="line">root@l: tar -xvf opt.tar <span class="comment"># 解压</span></span><br><span class="line">root@l: <span class="built_in">mv</span> /opt /opt2 &amp;&amp; <span class="built_in">mv</span> /opt1 /opt <span class="comment"># 修改文件夹名称</span></span><br><span class="line">root@l: blkid <span class="comment">#查看分区信息</span></span><br><span class="line"><span class="comment"># 修改启动信息</span></span><br><span class="line">root@l: <span class="built_in">echo</span> <span class="string">&quot;`blkid | grep sda3 | awk &#x27;&#123;printf <span class="variable">$2</span>&#125;&#x27; | sed &#x27;s/&quot;</span>//g<span class="string">&#x27;` /opt ext4 defaults 0 0&quot; &gt;&gt; /etc/fstab # 将 grep 和 awk 里面参数酌情修改   </span></span><br><span class="line"><span class="string"># 检查启动信息  </span></span><br><span class="line"><span class="string">root@l: vim  /etc/fstab  </span></span><br><span class="line"><span class="string"># 更新启动信息并重启  </span></span><br><span class="line"><span class="string">root@l: update-grub &amp;&amp; reboot  </span></span><br><span class="line"><span class="string">root@l: rm -rf /opt2 </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> backup </tag>
            
            <tag> Linux </tag>
            
            <tag> tar </tag>
            
            <tag> restore </tag>
            
            <tag> 挂载点调整 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UFW 的简单使用</title>
      <link href="/2019/08/02/1/"/>
      <url>/2019/08/02/1/</url>
      
        <content type="html"><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul><li>Ubuntu 的默认防火墙配置工具是 <code>ufw</code>，是为了简化 <code>iptables </code>防火墙配置而开发， <code>ufw </code>提供了一种友好的方式来创建基于IPv4或IPv6主机的防火墙。一般情况下系统默认禁用UFW。</li><li><em>Gufw</em> 是一个 ufw 的图形界面版本。</li></ul><h3 id="基本的语法和一些示例"><a href="#基本的语法和一些示例" class="headerlink" title="基本的语法和一些示例"></a>基本的语法和一些示例</h3><blockquote><p>默认规则适用于普通家庭用户  </p></blockquote><ul><li>当您打开UFW时，它使用一组默认规则（配置文件），所有“传入”都被拒绝，然后用户再定义一些例外的端口或应用，就差不多了</li></ul><h4 id="启用和禁用"><a href="#启用和禁用" class="headerlink" title="启用和禁用"></a>启用和禁用</h4><h5 id="启用UFW"><a href="#启用UFW" class="headerlink" title="启用UFW"></a>启用UFW</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><h5 id="检查UFW的状态"><a href="#检查UFW的状态" class="headerlink" title="检查UFW的状态"></a>检查UFW的状态</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status </span><br></pre></td></tr></table></figure><ul><li>请注意，默认情况下，deny正在应用于传入。有一些例外，可以在此命令的输出中找到: <code>sudo ufw show raw</code></li><li>您也可以通过读取 /etc/ufw 中的规则文件（后缀名：.rules），来查看防火墙规则。</li></ul><h5 id="禁用UFW"><a href="#禁用UFW" class="headerlink" title="禁用UFW"></a>禁用UFW</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure><h4 id="允许和拒绝（特定规则）"><a href="#允许和拒绝（特定规则）" class="headerlink" title="允许和拒绝（特定规则）"></a>允许和拒绝（特定规则）</h4><h5 id="允许"><a href="#允许" class="headerlink" title="允许"></a>允许</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow &lt;port&gt;/&lt;optional: protocol&gt;</span><br></pre></td></tr></table></figure><h6 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h6><ol><li>允许在端口53上传入tcp和udp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 53</span><br></pre></td></tr></table></figure></li><li>允许端口53上的传入tcp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 53/tcp</span><br></pre></td></tr></table></figure></li><li>允许端口53上的传入udp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 53/udp</span><br></pre></td></tr></table></figure></li></ol><h5 id="拒绝"><a href="#拒绝" class="headerlink" title="拒绝"></a>拒绝</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny &lt;port&gt;/&lt;optional: protocol&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h6><ol><li>拒绝端口53上的tcp和udp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny 53</span><br></pre></td></tr></table></figure></li><li>拒绝端口53上的传入tcp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny 53/tcp</span><br></pre></td></tr></table></figure></li><li>拒绝端口53上传入的udp数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny 53/udp</span><br></pre></td></tr></table></figure></li></ol><h4 id="删除现有规则"><a href="#删除现有规则" class="headerlink" title="删除现有规则"></a>删除现有规则</h4><ul><li>要删除规则，只需在原始规则前加上删除。</li><li>例如，如果原始规则是：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw deny 80/tcp</span><br></pre></td></tr></table></figure></li><li>用这一条命令来删除它<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw delete deny 80/tcp</span><br></pre></td></tr></table></figure></li></ul><h4 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h4><p>您也可以允许或拒绝服务名称，因为ufw会从从 /etc/services读取服务名称。</p><ul><li>查看所有服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less /etc/services</span><br></pre></td></tr></table></figure></li></ul><h5 id="按服务名称允许"><a href="#按服务名称允许" class="headerlink" title="按服务名称允许"></a>按服务名称允许</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow &lt;service name&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h6><ol><li>允许ssh<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow ssh</span><br></pre></td></tr></table></figure></li></ol><h5 id="按服务名称拒绝"><a href="#按服务名称拒绝" class="headerlink" title="按服务名称拒绝"></a>按服务名称拒绝</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny &lt;service name&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h6><ol><li>拒绝ssh<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny ssh</span><br></pre></td></tr></table></figure></li></ol><h4 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h4><ul><li><p>检查ufw的状态将告诉您是否启用了ufw，并列出了应用于iptables的ufw规则。</p></li><li><p>查看状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu<span class="comment"># sudo ufw status</span></span><br><span class="line">Firewall loaded</span><br><span class="line"></span><br><span class="line">To                         Action  From</span><br><span class="line">--                         ------  ----</span><br><span class="line">22:tcp                     DENY    192.168.0.1</span><br><span class="line">22:udp                     DENY    192.168.0.1</span><br><span class="line">22:tcp                     DENY    192.168.0.7</span><br><span class="line">22:udp                     DENY    192.168.0.7</span><br><span class="line">22:tcp                     ALLOW   192.168.0.0/24</span><br><span class="line">22:udp                     ALLOW   192.168.0.0/24</span><br></pre></td></tr></table></figure></li><li><p>如果未启用ufw，则输出将为</p></li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br><span class="line">Status: inactive</span><br></pre></td></tr></table></figure><h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><ol><li>要启用日志记录，请使用: <code>sudo ufw logging on</code></li><li>要禁用日志记录，请使用：<code>sudo ufw logging off</code></li></ol><h3 id="高级语法"><a href="#高级语法" class="headerlink" title="高级语法"></a>高级语法</h3><blockquote><p>您还可以使用更全面的语法，指定源和目标地址，端口和协议。</p></blockquote><h4 id="允许访问"><a href="#允许访问" class="headerlink" title="允许访问"></a>允许访问</h4><h5 id="按特定IP允许："><a href="#按特定IP允许：" class="headerlink" title="按特定IP允许："></a>按特定IP允许：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from &lt;ip address&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h6><ol><li>允许来自207.46.232.182的数据包<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 207.46.232.182</span><br></pre></td></tr></table></figure></li><li>允许子网<blockquote><p>你也许会使用网关来配置</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.1.0/24</span><br></pre></td></tr></table></figure></li></ol><h4 id="允许特定端口，IP地址"><a href="#允许特定端口，IP地址" class="headerlink" title="允许特定端口，IP地址"></a>允许特定端口，IP地址</h4> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from &lt;target&gt; to &lt;destination&gt; port &lt;port number&gt;</span><br></pre></td></tr></table></figure><h5 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h5><ol><li>允许使用TCP访问端口22的IP地址192.168.0.4<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.4 to any port 22</span><br></pre></td></tr></table></figure></li></ol><h4 id="允许特定端口，IP地址和协议"><a href="#允许特定端口，IP地址和协议" class="headerlink" title="允许特定端口，IP地址和协议"></a>允许特定端口，IP地址和协议</h4> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from &lt;target&gt; to &lt;destination&gt; port &lt;port number&gt; proto &lt;protocol name&gt;</span><br></pre></td></tr></table></figure><h5 id="示例-6"><a href="#示例-6" class="headerlink" title="示例"></a>示例</h5><ol><li>允许使用 <em><strong>TCP</strong></em> 访问端口22的IP地址192.168.0.4<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.4 to any port 22 proto tcp</span><br></pre></td></tr></table></figure></li></ol><h4 id="禁用-ping"><a href="#禁用-ping" class="headerlink" title="禁用 ping"></a>禁用 ping</h4><ul><li>默认允许ping，如果要禁用 ping， 您可以在 <code>/etc/ufw/before.rules</code> 里面删除以下行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ok icmp codes</span></span><br><span class="line">-A ufw-before-input -p icmp --icmp-type destination-unreachable -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type source-quench -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type time-exceeded -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type parameter-problem -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type echo-request -j ACCEPT</span><br></pre></td></tr></table></figure><p>或者把 <em>ACCEPT</em> 修改为 <em>DROP</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ok icmp codes</span></span><br><span class="line">-A ufw-before-input -p icmp --icmp-type destination-unreachable -j DROP</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type source-quench -j DROP</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type time-exceeded -j DROP</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type parameter-problem -j DROP</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type echo-request -j DROP</span><br></pre></td></tr></table></figure><h4 id="拒绝访问"><a href="#拒绝访问" class="headerlink" title="拒绝访问"></a>拒绝访问</h4><h5 id="按特定IP拒绝"><a href="#按特定IP拒绝" class="headerlink" title="按特定IP拒绝"></a>按特定IP拒绝</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny from &lt;ip address&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-7"><a href="#示例-7" class="headerlink" title="示例"></a>示例</h6><ol><li>阻止来自207.46.232.182的数据包：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny from 207.46.232.182</span><br></pre></td></tr></table></figure></li></ol><h5 id="通过特定端口和IP地址拒绝"><a href="#通过特定端口和IP地址拒绝" class="headerlink" title="通过特定端口和IP地址拒绝"></a>通过特定端口和IP地址拒绝</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny from &lt;ip address&gt; to &lt;protocol&gt; port &lt;port number&gt;</span><br></pre></td></tr></table></figure><h6 id="示例-8"><a href="#示例-8" class="headerlink" title="示例"></a>示例</h6><ol><li>拒绝所有协议的端口22的IP地址192.168.0.1访问<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny from 192.168.0.1 to any port 22</span><br></pre></td></tr></table></figure></li></ol><h4 id="使用规则的编号进行管理"><a href="#使用规则的编号进行管理" class="headerlink" title="使用规则的编号进行管理"></a>使用规则的编号进行管理</h4><h5 id="显示规则的顺序和ID号"><a href="#显示规则的顺序和ID号" class="headerlink" title="显示规则的顺序和ID号"></a>显示规则的顺序和ID号</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status numbered</span><br></pre></td></tr></table></figure><h4 id="编辑编号规则"><a href="#编辑编号规则" class="headerlink" title="编辑编号规则"></a>编辑编号规则</h4><h5 id="删除编号规则"><a href="#删除编号规则" class="headerlink" title="删除编号规则"></a>删除编号规则</h5><ul><li>然后，您可以使用该号码删除规则。这将删除第一个规则，规则将向上移动以填充列表。</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw delete 1</span><br></pre></td></tr></table></figure><h5 id="插入编号规则"><a href="#插入编号规则" class="headerlink" title="插入编号规则"></a>插入编号规则</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw insert 1 allow from &lt;ip address&gt;</span><br></pre></td></tr></table></figure><h6 id="高级示例"><a href="#高级示例" class="headerlink" title="高级示例"></a>高级示例</h6><ol><li>阻止从192.168.0.1和192.168.0.7访问端口22，但允许所有其他192.168.0.x IP使用tcp访问端口22</li></ol> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw deny from 192.168.0.1 to any port 22</span><br><span class="line">sudo ufw deny from 192.168.0.7 to any port 22</span><br><span class="line">sudo ufw allow from 192.168.0.0/24 to any port 22 proto tcp</span><br></pre></td></tr></table></figure><blockquote><p>这将特定规则放在第一位，将通用第二位放在第二位。一旦规则匹配，其他规则将不会被匹配. 因此您必须首先列出特定规则。 ‘’’随着规则的变化，您可能需要删除旧规则，以确保按照正确的顺序放置新规则。</p></blockquote><ol start="2"><li>阻止访问端口22到192.168.0.3以及192.168.0.1和192.168.0.7</li></ol> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw delete allow from 192.168.0.0/24 to any port 22</span><br><span class="line">sudo ufw status</span><br><span class="line">Firewall loaded</span><br><span class="line"></span><br><span class="line">To                         Action  From</span><br><span class="line">--                         ------  ----</span><br><span class="line">22:tcp                     DENY    192.168.0.1</span><br><span class="line">22:udp                     DENY    192.168.0.1</span><br><span class="line">22:tcp                     DENY    192.168.0.7</span><br><span class="line">22:udp                     DENY    192.168.0.7</span><br><span class="line"></span><br><span class="line">sudo ufw deny 192.168.0.3 to any port 22</span><br><span class="line">sudo ufw allow 192.168.0.0/24 to any port 22 proto tcp</span><br><span class="line">sudo ufw status</span><br><span class="line"></span><br><span class="line">Firewall loaded</span><br><span class="line"></span><br><span class="line">To                         Action  From</span><br><span class="line">--                         ------  ----</span><br><span class="line">22:tcp                     DENY    192.168.0.1</span><br><span class="line">22:udp                     DENY    192.168.0.1</span><br><span class="line">22:tcp                     DENY    192.168.0.7</span><br><span class="line">22:udp                     DENY    192.168.0.7</span><br><span class="line">22:tcp                     DENY    192.168.0.3</span><br><span class="line">22:udp                     DENY    192.168.0.3</span><br><span class="line">22:tcp                     ALLOW   192.168.0.0/24</span><br></pre></td></tr></table></figure><blockquote><p>如果你只是添加拒绝规则，那么 allow 的优先级就会超过它并被应用.</p></blockquote><h3 id="解释日志条目"><a href="#解释日志条目" class="headerlink" title="解释日志条目"></a>解释日志条目</h3><h4 id="根据对报文的回复"><a href="#根据对报文的回复" class="headerlink" title="根据对报文的回复"></a>根据对报文的回复</h4><blockquote><p>SPT和DPT值以及SRC和DST值通常是分析防火墙日志时要关注的值。</p></blockquote><h5 id="伪日志条目"><a href="#伪日志条目" class="headerlink" title="伪日志条目"></a>伪日志条目</h5> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Feb  4 23:33:37 hostname kernel: [ 3529.289825] [UFW BLOCK] IN=eth0 OUT= MAC=00:11:22:33:44:55:66:77:88:99:aa:bb:cc:<span class="built_in">dd</span> SRC=444.333.222.111 DST=111.222.333.444 LEN=103 TOS=0x00 PREC=0x00 TTL=52 ID=0 DF PROTO=UDP SPT=53 DPT=36427 LEN=83</span><br></pre></td></tr></table></figure><ul><li><p>Date:查看日期和时间是一种很好的做法。如果事情发生故障或时间块丢失，那么攻击者可能会破坏您的日志。</p></li><li><p>hostname:服务器的主机名</p></li><li><p>uptime:正常运行的时间</p></li><li><p>Logged Event:记录事件的简短描述;例如[UFW BLOCK]</p></li><li><p>IN:如果有，则事件是传入事件</p></li><li><p>OUT:如果有，则事件是传出事件。</p></li><li><p>MAC: 这提供了目标MAC，源MAC和EtherType字段的14字节组合，遵循以太网II报头中的顺序。见 <span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdGhlcm5ldF9mcmFtZQ==">以太网帧<i class="fa fa-external-link-alt"></i></span> 和 <span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdGhlclR5cGU=">EtherType<i class="fa fa-external-link-alt"></i></span>  了解更多信息。</p></li></ul><ul><li>[UFW BLOCK]：这是记录事件的描述开始的位置。在此例中，它表示阻止了连接。</li><li> IN：如果它包含一个值，那么代表该事件是传入事件</li><li> OUT：如果它包含一个值，那么代表事件是传出事件 </li><li> MAC：目的地和源 MAC 地址的组合</li><li> SRC：包源的 IP</li><li> DST：包目的地的 IP</li><li> LEN：数据包长度</li><li> TTL：数据包 TTL，或称为 time to live。 在找到目的地之前，它将在路由器之间跳跃，直到它过期。</li><li> PROTO：数据包的协议</li><li> SPT：包的源端口</li><li> DPT：包的目标端口</li><li> WINDOW：发送方可以接收的数据包的大小</li><li> SYN URGP：指示是否需要三次握手。 0 表示不需要。</li></ul><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><ol><li><span class="exturl" data-url="aHR0cHM6Ly9oZWxwLnVidW50dS5jb20vY29tbXVuaXR5L1VGVw==">UFW<i class="fa fa-external-link-alt"></i></span></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> UFW </tag>
            
            <tag> firewall </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 文件目录参考 (FHS)</title>
      <link href="/2019/07/09/1/"/>
      <url>/2019/07/09/1/</url>
      
        <content type="html"><![CDATA[<h3 id="目录"><a href="#目录" class="headerlink" title="/ 目录"></a><code>/</code> 目录</h3><blockquote><p>系统根目录<br>一些Linux系统如GoboLinux和Syllable Server使用了和FHS完全不同的文件系统层次组织方法  </p></blockquote><details><summary>/</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#第一层次结构 的根、 整个文件系统层次结构的根目录</span></span><br><span class="line">├── bin <span class="comment">#基本命令所需的二进制文件</span></span><br><span class="line">├── boot <span class="comment">#引导程序文件，例如： kernel、initrd；时常是一个单独的分区</span></span><br><span class="line">├── cdrom <span class="comment">#光盘挂载点</span></span><br><span class="line">├── dev <span class="comment">#设备文件</span></span><br><span class="line">├── etc <span class="comment">#设备主机独有的系统配置文件</span></span><br><span class="line">├── home <span class="comment">#普通用户主文件夹的父目录</span></span><br><span class="line">├── initrd.img -&gt; boot/initrd.img-4.15.0-54-generic <span class="comment">#系统内核</span></span><br><span class="line">├── initrd.img.old -&gt; boot/initrd.img-4.15.0-52-generic <span class="comment">#系统内核</span></span><br><span class="line">├── lib <span class="comment">#必要的共享库和内核模块 (32 bit)</span></span><br><span class="line">├── lib64 <span class="comment">#备用格式基本共享库（可选）</span></span><br><span class="line">├── lost+found</span><br><span class="line">├── media <span class="comment">#可移动设备的挂载点</span></span><br><span class="line">├── mnt <span class="comment">#临时安装文件系统的挂载点</span></span><br><span class="line">├── opt <span class="comment">#可选的应用软件包</span></span><br><span class="line">├── proc <span class="comment">#虚拟文件系统，将内核与进程状态归档为文本文件。例如：uptime、 network。在Linux中，对应Procfs格式挂载</span></span><br><span class="line">├── root <span class="comment">#root 用户目录</span></span><br><span class="line">├── run <span class="comment">#代替/var/run目录</span></span><br><span class="line">├── sbin <span class="comment">#系统必要的二进制文件</span></span><br><span class="line">├── snap <span class="comment">#snap 包的安装目录</span></span><br><span class="line">├── srv <span class="comment">#系统服务的文件</span></span><br><span class="line">├── sys <span class="comment">#虚拟文件系统(sysfs，类似于 /proc，一个procfs)，它存储且允许修改连接到系统的设备，然而许多传统UNIX和类Unix操作系统使用/sys作为内核代码树的符号链接</span></span><br><span class="line">├── tmp <span class="comment">#交换文件</span></span><br><span class="line">├── usr <span class="comment">#二级层次结构</span></span><br><span class="line">├── var <span class="comment">#可变数据----在正常运行的系统中其内容不断变化的文件，如日志，脱机文件和临时电子邮件文件。有时是一个单独的分区</span></span><br><span class="line">│   └──run <span class="comment">#自最后一次启动以来运行中的系统的信息，例如：当前登录的用户和运行中的守护进程。现已经被/run代替</span></span><br><span class="line">├── vmlinuz -&gt; boot/vmlinuz-4.15.0-54-generic <span class="comment">#系统内核</span></span><br><span class="line">└── vmlinuz.old -&gt; boot/vmlinuz-4.15.0-52-generic <span class="comment">#系统内核</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></details><h3 id="bin-目录"><a href="#bin-目录" class="headerlink" title="/bin 目录"></a><code>/bin</code> 目录</h3><blockquote><p>必要的用户命令二进制文件的存放位置（可以被所有用户使用 ）</p></blockquote><details><summary>/bin</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bash</span><br><span class="line">├── brltty</span><br><span class="line">├── btrfs</span><br><span class="line">├── btrfsck -&gt; btrfs</span><br><span class="line">├── btrfs-debug-tree</span><br><span class="line">├── btrfs-find-root</span><br><span class="line">├── btrfs-image</span><br><span class="line">├── btrfs-map-logical</span><br><span class="line">├── btrfs-select-super</span><br><span class="line">├── btrfstune</span><br><span class="line">├── btrfs-zero-log</span><br><span class="line">├── bunzip2</span><br><span class="line">├── busybox</span><br><span class="line">├── bzcat</span><br><span class="line">├── bzcmp -&gt; bzdiff</span><br><span class="line">├── bzdiff</span><br><span class="line">├── bzegrep -&gt; bzgrep</span><br><span class="line">├── bzexe</span><br><span class="line">├── bzfgrep -&gt; bzgrep</span><br><span class="line">├── bzgrep</span><br><span class="line">├── bzip2</span><br><span class="line">├── bzip2recover</span><br><span class="line">├── bzless -&gt; bzmore</span><br><span class="line">├── bzmore</span><br><span class="line">├── <span class="built_in">cat</span></span><br><span class="line">├── chacl</span><br><span class="line">├── <span class="built_in">chgrp</span></span><br><span class="line">├── <span class="built_in">chmod</span></span><br><span class="line">├── <span class="built_in">chown</span></span><br><span class="line">├── chvt</span><br><span class="line">├── <span class="built_in">cp</span></span><br><span class="line">├── cpio</span><br><span class="line">├── dash</span><br><span class="line">├── <span class="built_in">date</span></span><br><span class="line">├── <span class="built_in">dd</span></span><br><span class="line">├── <span class="built_in">df</span></span><br><span class="line">├── <span class="built_in">dir</span></span><br><span class="line">├── dmesg</span><br><span class="line">├── dnsdomainname -&gt; hostname</span><br><span class="line">├── domainname -&gt; hostname</span><br><span class="line">├── dumpkeys</span><br><span class="line">├── <span class="built_in">echo</span></span><br><span class="line">├── ed</span><br><span class="line">├── efibootdump</span><br><span class="line">├── efibootmgr</span><br><span class="line">├── egrep</span><br><span class="line">├── <span class="literal">false</span></span><br><span class="line">├── fgconsole</span><br><span class="line">├── fgrep</span><br><span class="line">├── findmnt</span><br><span class="line">├── fsck.btrfs</span><br><span class="line">├── fuser</span><br><span class="line">├── fusermount</span><br><span class="line">├── getfacl</span><br><span class="line">├── grep</span><br><span class="line">├── gunzip</span><br><span class="line">├── gzexe</span><br><span class="line">├── gzip</span><br><span class="line">├── hciconfig</span><br><span class="line">├── hostname</span><br><span class="line">├── ip</span><br><span class="line">├── journalctl</span><br><span class="line">├── kbd_mode</span><br><span class="line">├── keyctl</span><br><span class="line">├── <span class="built_in">kill</span></span><br><span class="line">├── kmod</span><br><span class="line">├── less</span><br><span class="line">├── lessecho</span><br><span class="line">├── lessfile -&gt; lesspipe</span><br><span class="line">├── lesskey</span><br><span class="line">├── lesspipe</span><br><span class="line">├── <span class="built_in">ln</span></span><br><span class="line">├── loadkeys</span><br><span class="line">├── login</span><br><span class="line">├── loginctl</span><br><span class="line">├── lowntfs-3g</span><br><span class="line">├── <span class="built_in">ls</span></span><br><span class="line">├── lsblk</span><br><span class="line">├── lsmod -&gt; kmod</span><br><span class="line">├── <span class="built_in">mkdir</span></span><br><span class="line">├── mkfs.btrfs</span><br><span class="line">├── <span class="built_in">mknod</span></span><br><span class="line">├── <span class="built_in">mktemp</span></span><br><span class="line">├── more</span><br><span class="line">├── mount</span><br><span class="line">├── mountpoint</span><br><span class="line">├── mt -&gt; /etc/alternatives/mt</span><br><span class="line">├── mt-gnu</span><br><span class="line">├── <span class="built_in">mv</span></span><br><span class="line">├── nano</span><br><span class="line">├── nc -&gt; /etc/alternatives/nc</span><br><span class="line">├── nc.openbsd</span><br><span class="line">├── netcat -&gt; /etc/alternatives/netcat</span><br><span class="line">├── netstat</span><br><span class="line">├── networkctl</span><br><span class="line">├── nisdomainname -&gt; hostname</span><br><span class="line">├── ntfs-3g</span><br><span class="line">├── ntfs-3g.probe</span><br><span class="line">├── ntfscat</span><br><span class="line">├── ntfscluster</span><br><span class="line">├── ntfscmp</span><br><span class="line">├── ntfsfallocate</span><br><span class="line">├── ntfsfix</span><br><span class="line">├── ntfsinfo</span><br><span class="line">├── ntfsls</span><br><span class="line">├── ntfsmove</span><br><span class="line">├── ntfsrecover</span><br><span class="line">├── ntfssecaudit</span><br><span class="line">├── ntfstruncate</span><br><span class="line">├── ntfsusermap</span><br><span class="line">├── ntfswipe</span><br><span class="line">├── open -&gt; openvt</span><br><span class="line">├── openvt</span><br><span class="line">├── pidof -&gt; /sbin/killall5</span><br><span class="line">├── ping</span><br><span class="line">├── ping4 -&gt; ping</span><br><span class="line">├── ping6 -&gt; ping</span><br><span class="line">├── plymouth</span><br><span class="line">├── ps</span><br><span class="line">├── <span class="built_in">pwd</span></span><br><span class="line">├── rbash -&gt; bash</span><br><span class="line">├── <span class="built_in">readlink</span></span><br><span class="line">├── red</span><br><span class="line">├── <span class="built_in">rm</span></span><br><span class="line">├── <span class="built_in">rmdir</span></span><br><span class="line">├── rnano -&gt; nano</span><br><span class="line">├── run-parts</span><br><span class="line">├── rzsh -&gt; zsh</span><br><span class="line">├── sed</span><br><span class="line">├── setfacl</span><br><span class="line">├── setfont</span><br><span class="line">├── setupcon</span><br><span class="line">├── sh -&gt; dash</span><br><span class="line">├── sh.distrib -&gt; dash</span><br><span class="line">├── <span class="built_in">sleep</span></span><br><span class="line">├── ss</span><br><span class="line">├── static-sh -&gt; busybox</span><br><span class="line">├── <span class="built_in">stty</span></span><br><span class="line">├── su</span><br><span class="line">├── <span class="built_in">sync</span></span><br><span class="line">├── systemctl</span><br><span class="line">├── systemd -&gt; /lib/systemd/systemd</span><br><span class="line">├── systemd-ask-password</span><br><span class="line">├── systemd-escape</span><br><span class="line">├── systemd-hwdb</span><br><span class="line">├── systemd-inhibit</span><br><span class="line">├── systemd-machine-id-setup</span><br><span class="line">├── systemd-notify</span><br><span class="line">├── systemd-sysusers</span><br><span class="line">├── systemd-tmpfiles</span><br><span class="line">├── systemd-tty-ask-password-agent</span><br><span class="line">├── tar</span><br><span class="line">├── tempfile</span><br><span class="line">├── <span class="built_in">touch</span></span><br><span class="line">├── <span class="literal">true</span></span><br><span class="line">├── udevadm</span><br><span class="line">├── ulockmgr_server</span><br><span class="line">├── umount</span><br><span class="line">├── <span class="built_in">uname</span></span><br><span class="line">├── uncompress</span><br><span class="line">├── unicode_start</span><br><span class="line">├── <span class="built_in">vdir</span></span><br><span class="line">├── wdctl</span><br><span class="line">├── <span class="built_in">which</span></span><br><span class="line">├── whiptail</span><br><span class="line">├── ypdomainname -&gt; hostname</span><br><span class="line">├── zcat</span><br><span class="line">├── zcmp</span><br><span class="line">├── zdiff</span><br><span class="line">├── zegrep</span><br><span class="line">├── zfgrep</span><br><span class="line">├── zforce</span><br><span class="line">├── zgrep</span><br><span class="line">├── zless</span><br><span class="line">├── zmore</span><br><span class="line">├── znew</span><br><span class="line">├── zsh</span><br><span class="line">└── zsh5</span><br></pre></td></tr></table></figure></details><h3 id="boot-目录"><a href="#boot-目录" class="headerlink" title="/boot 目录"></a><code>/boot</code> 目录</h3><blockquote><p>操作系统内核必须存放在 <code>/</code> 或者 <code>/boot</code> 目录下面</p></blockquote><details><summary>/boot</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/boot</span><br><span class="line">├── config-4.15.0-52-generic</span><br><span class="line">├── config-4.15.0-54-generic</span><br><span class="line">├── efi</span><br><span class="line">├── grub</span><br><span class="line">├── initrd.img-4.15.0-52-generic</span><br><span class="line">├── initrd.img-4.15.0-54-generic</span><br><span class="line">├── memtest86+.bin</span><br><span class="line">├── memtest86+.elf</span><br><span class="line">├── memtest86+_multiboot.bin</span><br><span class="line">├── System.map-4.15.0-52-generic</span><br><span class="line">├── System.map-4.15.0-54-generic</span><br><span class="line">├── vmlinuz-4.15.0-52-generic</span><br><span class="line">└── vmlinuz-4.15.0-54-generic</span><br></pre></td></tr></table></figure></details><h3 id="dev-目录"><a href="#dev-目录" class="headerlink" title="/dev 目录"></a><code>/dev</code> 目录</h3><blockquote><p>用于存放特殊文件或者设备文件的地方  </p></blockquote><ul><li>如果在有设备需要在 <code>/dev</code> 目录下面手动创建，<code>/dev</code> 目录下面必须要有 <code>MAXKEDEV</code> 这个命令才能去创建它所需要的设备。  </li><li>同时对于任何本地设备，它可能也会包含在一个名为 <code>MAKEDEV.local</code> 的文件里面。  </li><li>如果需要，<code>MAKEDEV</code> 必须按规定为系统创建任何系统可以找到的设备，不仅仅只是已进行了安装的设备。  </li></ul><details><summary>/dev</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">/dev</span><br><span class="line">├── acpi_thermal_rel</span><br><span class="line">├── autofs</span><br><span class="line">├── block</span><br><span class="line">├── bsg</span><br><span class="line">├── btrfs-control</span><br><span class="line">├── bus</span><br><span class="line">├── cdrom -&gt; sr0</span><br><span class="line">├── char</span><br><span class="line">├── console</span><br><span class="line">├── core -&gt; /proc/kcore</span><br><span class="line">├── cpu</span><br><span class="line">├── cpu_dma_latency</span><br><span class="line">├── cuse</span><br><span class="line">├── disk</span><br><span class="line">├── dri</span><br><span class="line">├── drm_dp_aux0</span><br><span class="line">├── ecryptfs</span><br><span class="line">├── fb0</span><br><span class="line">├── fd -&gt; /proc/self/fd</span><br><span class="line">├── full</span><br><span class="line">├── fuse</span><br><span class="line">├── gpiochip0</span><br><span class="line">├── hidraw0</span><br><span class="line">├── hidraw1</span><br><span class="line">├── hpet</span><br><span class="line">├── hugepages</span><br><span class="line">├── hwrng</span><br><span class="line">├── i2c-0</span><br><span class="line">├── initctl -&gt; /run/systemd/initctl/fifo</span><br><span class="line">├── input</span><br><span class="line">├── kmsg</span><br><span class="line">├── kvm</span><br><span class="line">├── lightnvm</span><br><span class="line">├── <span class="built_in">log</span> -&gt; /run/systemd/journal/dev-log</span><br><span class="line">├── loop0</span><br><span class="line">├── loop1</span><br><span class="line">├── loop10</span><br><span class="line">├── loop-control</span><br><span class="line">├── mapper</span><br><span class="line">├── mcelog</span><br><span class="line">├── media0</span><br><span class="line">├── mei0</span><br><span class="line">├── mem</span><br><span class="line">├── memory_bandwidth</span><br><span class="line">├── mqueue</span><br><span class="line">├── net</span><br><span class="line">├── network_latency</span><br><span class="line">├── network_throughput</span><br><span class="line">├── null</span><br><span class="line">├── nvidia0</span><br><span class="line">├── nvidiactl</span><br><span class="line">├── nvidia-modeset</span><br><span class="line">├── nvidia-uvm</span><br><span class="line">├── nvidia-uvm-tools</span><br><span class="line">├── port</span><br><span class="line">├── ppp</span><br><span class="line">├── psaux</span><br><span class="line">├── ptmx</span><br><span class="line">├── pts</span><br><span class="line">├── random</span><br><span class="line">├── rfkill</span><br><span class="line">├── rtc -&gt; rtc0</span><br><span class="line">├── rtc0</span><br><span class="line">├── sda</span><br><span class="line">├── sda1</span><br><span class="line">├── sdb</span><br><span class="line">├── sdb1</span><br><span class="line">├── sg0</span><br><span class="line">├── shm</span><br><span class="line">├── snapshot</span><br><span class="line">├── snd</span><br><span class="line">├── sr0</span><br><span class="line">├── stderr -&gt; /proc/self/fd/2</span><br><span class="line">├── stdin -&gt; /proc/self/fd/0</span><br><span class="line">├── stdout -&gt; /proc/self/fd/1</span><br><span class="line">├── tpm0</span><br><span class="line">├── tpmrm0</span><br><span class="line">├── <span class="built_in">tty</span></span><br><span class="line">├── tty0</span><br><span class="line">├── tty1</span><br><span class="line">├── ttyprintk</span><br><span class="line">├── ttyS0</span><br><span class="line">├── ttyS1</span><br><span class="line">├── uhid</span><br><span class="line">├── uinput</span><br><span class="line">├── urandom</span><br><span class="line">├── usb</span><br><span class="line">├── userio</span><br><span class="line">├── v4l</span><br><span class="line">├── vcs</span><br><span class="line">├── vcs1</span><br><span class="line">├── vfio</span><br><span class="line">├── vga_arbiter</span><br><span class="line">├── vhci</span><br><span class="line">├── vhost-net</span><br><span class="line">├── vhost-vsock</span><br><span class="line">├── video0</span><br><span class="line">└── zero</span><br></pre></td></tr></table></figure></details><h3 id="etc-目录"><a href="#etc-目录" class="headerlink" title="/etc 目录"></a><code>/etc</code> 目录</h3><blockquote><p>设备主机独有的系统配置文件（特定主机，系统范围内的配置文件）<br>关于这个名称当前有争议。在贝尔实验室关于UNIX实现文档的早期版本中，/etc 被称为etcetera，这是由于过去此目录中存放所有不属于别处的所有东西（然而，FHS限制/etc存放静态配置文件，不能包含二进制文件）。 自从早期文档出版以来，目录名称已被以各种方式重新称呼。最近的解释包括反向缩略语如：”可编辑的文本配置”（英文 “Editable Text Configuration”）或”扩展工具箱”（英文 “Extended Tool Chest”)。<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU2JTk2JTg3JUU0JUJCJUI2JUU3JUIzJUJCJUU3JUJCJTlGJUU1JUIxJTgyJUU2JUFDJUExJUU3JUJCJTkzJUU2JTlFJTg0JUU2JUEwJTg3JUU1JTg3JTg2">Wiki<i class="fa fa-external-link-alt"></i></span>  </p></blockquote><ul><li>/etc 目录下面必须要以下这些文件夹或者说是软连接</li></ul><table><thead><tr><th align="right">目录</th><th align="right">用途</th></tr></thead><tbody><tr><td align="right">opt</td><td align="right">/opt的配置文件</td></tr><tr><td align="right">X11</td><td align="right">X桌面的配置文件（可选）</td></tr><tr><td align="right">sgml</td><td align="right">SGML的配置文件（可选）</td></tr><tr><td align="right">xml</td><td align="right">XML的配置文件（可选）</td></tr></tbody></table><details><summary>/etc</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">/etc</span><br><span class="line">├── acpi</span><br><span class="line">├── adduser.conf</span><br><span class="line">├── adjtime</span><br><span class="line">├── alternatives</span><br><span class="line">├── anacrontab</span><br><span class="line">├── apache2</span><br><span class="line">├── apg.conf</span><br><span class="line">├── apm</span><br><span class="line">├── apparmor</span><br><span class="line">├── apparmor.d</span><br><span class="line">├── apport</span><br><span class="line">├── appstream.conf</span><br><span class="line">├── apt</span><br><span class="line">├── avahi</span><br><span class="line">├── bash.bashrc</span><br><span class="line">├── bash_completion</span><br><span class="line">├── bash_completion.d</span><br><span class="line">├── bindresvport.blacklist</span><br><span class="line">├── binfmt.d</span><br><span class="line">├── bluetooth</span><br><span class="line">├── brlapi.key</span><br><span class="line">├── brltty</span><br><span class="line">├── brltty.conf</span><br><span class="line">├── ca-certificates</span><br><span class="line">├── ca-certificates.conf</span><br><span class="line">├── calendar</span><br><span class="line">├── chatscripts</span><br><span class="line">├── chromium</span><br><span class="line">├── console-setup</span><br><span class="line">├── containerd</span><br><span class="line">├── cracklib</span><br><span class="line">├── cron.d</span><br><span class="line">├── cron.daily</span><br><span class="line">├── cron.hourly</span><br><span class="line">├── cron.monthly</span><br><span class="line">├── crontab</span><br><span class="line">├── cron.weekly</span><br><span class="line">├── cryptsetup-initramfs</span><br><span class="line">├── crypttab</span><br><span class="line">├── cups</span><br><span class="line">├── cupshelpers</span><br><span class="line">├── dbus-1</span><br><span class="line">├── dconf</span><br><span class="line">├── debconf.conf</span><br><span class="line">├── debian_version</span><br><span class="line">├── default</span><br><span class="line">├── deluser.conf</span><br><span class="line">├── depmod.d</span><br><span class="line">├── dhcp</span><br><span class="line">├── dictionaries-common</span><br><span class="line">├── dkms</span><br><span class="line">├── dnsmasq.d</span><br><span class="line">├── dnsmasq.d-available</span><br><span class="line">├── docker</span><br><span class="line">├── dpkg</span><br><span class="line">├── drirc</span><br><span class="line">├── emacs</span><br><span class="line">├── environment</span><br><span class="line">├── ethertypes</span><br><span class="line">├── ffserver.conf</span><br><span class="line">├── firefox</span><br><span class="line">├── fonts</span><br><span class="line">├── fstab <span class="comment">#文件系统的静态信息</span></span><br><span class="line">├── fuse.conf</span><br><span class="line">├── fwupd</span><br><span class="line">├── gai.conf</span><br><span class="line">├── gconf</span><br><span class="line">├── gdb</span><br><span class="line">├── gdm3</span><br><span class="line">├── geoclue</span><br><span class="line">├── ghostscript</span><br><span class="line">├── glances</span><br><span class="line">├── glvnd</span><br><span class="line">├── gnome</span><br><span class="line">├── groff</span><br><span class="line">├── group <span class="comment">#关于用户组的文件</span></span><br><span class="line">├── group-</span><br><span class="line">├── grub.d</span><br><span class="line">├── gshadow</span><br><span class="line">├── gshadow-</span><br><span class="line">├── gss</span><br><span class="line">├── gtk-2.0</span><br><span class="line">├── gtk-3.0</span><br><span class="line">├── hddtemp.db</span><br><span class="line">├── hdparm.conf</span><br><span class="line">├── host.conf </span><br><span class="line">├── hostname</span><br><span class="line">├── hosts</span><br><span class="line">├── hosts.allow <span class="comment">#可访问本机的主机</span></span><br><span class="line">├── hosts.deny <span class="comment">#不可访问本机的主机</span></span><br><span class="line">├── hp</span><br><span class="line">├── ifplugd</span><br><span class="line">├── ImageMagick-6</span><br><span class="line">├── init</span><br><span class="line">├── init.d</span><br><span class="line">├── initramfs-tools</span><br><span class="line">├── inputrc</span><br><span class="line">├── insserv.conf.d</span><br><span class="line">├── iproute2</span><br><span class="line">├── issue</span><br><span class="line">├── issue.net</span><br><span class="line">├── java-11-openjdk</span><br><span class="line">├── java-8-openjdk</span><br><span class="line">├── kernel</span><br><span class="line">├── kernel-img.conf</span><br><span class="line">├── kerneloops.conf</span><br><span class="line">├── ldap</span><br><span class="line">├── ld.so.cache</span><br><span class="line">├── ld.so.conf</span><br><span class="line">├── ld.so.conf.d</span><br><span class="line">├── legal</span><br><span class="line">├── libao.conf</span><br><span class="line">├── libaudit.conf</span><br><span class="line">├── libblockdev</span><br><span class="line">├── libguestfs-tools.conf</span><br><span class="line">├── libibverbs.d</span><br><span class="line">├── libnl-3</span><br><span class="line">├── libpaper.d</span><br><span class="line">├── libvirt</span><br><span class="line">├── lighttpd</span><br><span class="line">├── lintianrc</span><br><span class="line">├── locale.alias</span><br><span class="line">├── locale.gen</span><br><span class="line">├── localtime -&gt; /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line">├── logcheck</span><br><span class="line">├── login.defs</span><br><span class="line">├── logrotate.conf</span><br><span class="line">├── logrotate.d</span><br><span class="line">├── lsb-release</span><br><span class="line">├── ltrace.conf</span><br><span class="line">├── lvm</span><br><span class="line">├── machine-id</span><br><span class="line">├── magic</span><br><span class="line">├── magic.mime</span><br><span class="line">├── mailcap</span><br><span class="line">├── mailcap.order</span><br><span class="line">├── manpath.config</span><br><span class="line">├── matplotlibrc</span><br><span class="line">├── mc</span><br><span class="line">├── mdadm</span><br><span class="line">├── mime.types</span><br><span class="line">├── minicom</span><br><span class="line">├── mke2fs.conf</span><br><span class="line">├── modprobe.d</span><br><span class="line">├── modules</span><br><span class="line">├── modules-load.d</span><br><span class="line">├── mtab -&gt; ../proc/self/mounts</span><br><span class="line">├── mtools.conf</span><br><span class="line">├── mysql</span><br><span class="line">├── nanorc</span><br><span class="line">├── netplan</span><br><span class="line">├── network</span><br><span class="line">├── networkd-dispatcher</span><br><span class="line">├── NetworkManager</span><br><span class="line">├── networks</span><br><span class="line">├── newt</span><br><span class="line">├── nginx</span><br><span class="line">├── nsswitch.conf</span><br><span class="line">├── openal</span><br><span class="line">├── OpenCL</span><br><span class="line">├── opt</span><br><span class="line">├── os-release -&gt; ../usr/lib/os-release</span><br><span class="line">├── PackageKit</span><br><span class="line">├── pam.conf</span><br><span class="line">├── pam.d</span><br><span class="line">├── papersize</span><br><span class="line">├── passwd</span><br><span class="line">├── passwd-</span><br><span class="line">├── pcmcia</span><br><span class="line">├── perl</span><br><span class="line">├── pki</span><br><span class="line">├── pm</span><br><span class="line">├── pnm2ppa.conf</span><br><span class="line">├── polkit-1</span><br><span class="line">├── popularity-contest.conf</span><br><span class="line">├── ppp</span><br><span class="line">├── presage.xml</span><br><span class="line">├── prime-discrete</span><br><span class="line">├── printcap -&gt; /run/cups/printcap</span><br><span class="line">├── profile</span><br><span class="line">├── profile.d</span><br><span class="line">├── protocols</span><br><span class="line">├── pulse</span><br><span class="line">├── python</span><br><span class="line">├── python2.7</span><br><span class="line">├── python3</span><br><span class="line">├── python3.6</span><br><span class="line">├── qemu-ifdown</span><br><span class="line">├── qemu-ifup</span><br><span class="line">├── ranger</span><br><span class="line">├── rc0.d <span class="comment">#开机运行项，优先级不同</span></span><br><span class="line">├── rc1.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rc2.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rc3.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rc4.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rc5.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rc6.d <span class="comment">#开机运行项</span></span><br><span class="line">├── rcS.d <span class="comment">#开机运行项</span></span><br><span class="line">├── request-key.conf</span><br><span class="line">├── request-key.d</span><br><span class="line">├── resolvconf</span><br><span class="line">├── resolv.conf -&gt; ../run/systemd/resolve/stub-resolv.conf</span><br><span class="line">├── rmt</span><br><span class="line">├── rpc</span><br><span class="line">├── rsyslog.conf</span><br><span class="line">├── rsyslog.d</span><br><span class="line">├── sane.d</span><br><span class="line">├── sasl2</span><br><span class="line">├── securetty</span><br><span class="line">├── security</span><br><span class="line">├── selinux</span><br><span class="line">├── sensors3.conf</span><br><span class="line">├── sensors.d</span><br><span class="line">├── services</span><br><span class="line">├── shadow</span><br><span class="line">├── shadow-</span><br><span class="line">├── shells</span><br><span class="line">├── skel</span><br><span class="line">├── speech-dispatcher</span><br><span class="line">├── ssh</span><br><span class="line">├── ssl</span><br><span class="line">├── subgid</span><br><span class="line">├── subgid-</span><br><span class="line">├── subuid</span><br><span class="line">├── subuid-</span><br><span class="line">├── sudoers</span><br><span class="line">├── sudoers.d</span><br><span class="line">├── sysctl.conf</span><br><span class="line">├── sysctl.d</span><br><span class="line">├── sysstat</span><br><span class="line">├── systemd</span><br><span class="line">├── tenable_tag</span><br><span class="line">├── terminfo</span><br><span class="line">├── texmf</span><br><span class="line">├── thermald</span><br><span class="line">├── timezone</span><br><span class="line">├── timidity</span><br><span class="line">├── tmpfiles.d</span><br><span class="line">├── ucf.conf</span><br><span class="line">├── udev</span><br><span class="line">├── udisks2</span><br><span class="line">├── ufw</span><br><span class="line">├── updatedb.conf</span><br><span class="line">├── update-manager</span><br><span class="line">├── update-motd.d</span><br><span class="line">├── update-notifier</span><br><span class="line">├── UPower</span><br><span class="line">├── usb_modeswitch.conf</span><br><span class="line">├── usb_modeswitch.d</span><br><span class="line">├── vconsole.conf</span><br><span class="line">├── vdpau_wrapper.cfg</span><br><span class="line">├── vim</span><br><span class="line">├── virt-builder -&gt; xdg/virt-builder</span><br><span class="line">├── vmware</span><br><span class="line">├── vtrgb -&gt; /etc/alternatives/vtrgb</span><br><span class="line">├── w3m</span><br><span class="line">├── wgetrc</span><br><span class="line">├── whoopsie</span><br><span class="line">├── wildmidi</span><br><span class="line">├── wpa_supplicant</span><br><span class="line">├── X11</span><br><span class="line">├── xdg</span><br><span class="line">├── zsh</span><br><span class="line">└── zsh_command_not_found</span><br></pre></td></tr></table></figure></details><h3 id="lib-目录"><a href="#lib-目录" class="headerlink" title="/lib 目录"></a><code>/lib</code> 目录</h3><blockquote><p>系统启动所需的共享二进制镜像文件和运行系统所必须的命令的二进制文件  </p></blockquote><ul><li>至少下面一个文件名称必须存在在 <code>/lib</code> 目录下</li></ul><table><thead><tr><th align="right">名称</th><th align="right">描述</th></tr></thead><tbody><tr><td align="right">libc.so.*</td><td align="right">C动态链接库</td></tr><tr><td align="right">ld*</td><td align="right">执行时链接器/加载器</td></tr></tbody></table><ul><li>如果 C 预处理程序已安装，那么由于历史原因 <code>/lib/cpp</code> 必须重定向到其目录。</li></ul><details><summary>/lib</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/lib</span><br><span class="line">├── apparmor</span><br><span class="line">├── bridge-utils</span><br><span class="line">├── brltty</span><br><span class="line">├── console-setup</span><br><span class="line">├── cpp -&gt; /etc/alternatives/cpp</span><br><span class="line">├── crda</span><br><span class="line">├── cryptsetup</span><br><span class="line">├── ebtables</span><br><span class="line">├── firmware</span><br><span class="line">├── hdparm</span><br><span class="line">├── ifupdown</span><br><span class="line">├── init</span><br><span class="line">├── klibc-wBFLvVtxy4xJqEadIBJMa78iJz8.so</span><br><span class="line">├── libhandle.so -&gt; libhandle.so.1</span><br><span class="line">├── libhandle.so.1 -&gt; libhandle.so.1.0.3</span><br><span class="line">├── libhandle.so.1.0.3</span><br><span class="line">├── linux-sound-base</span><br><span class="line">├── lsb</span><br><span class="line">├── modprobe.d</span><br><span class="line">├── modules</span><br><span class="line">├── netplan</span><br><span class="line">├── recovery-mode</span><br><span class="line">├── security</span><br><span class="line">├── systemd</span><br><span class="line">├── terminfo</span><br><span class="line">├── udev</span><br><span class="line">├── ufw</span><br><span class="line">└── x86_64-linux-gnu</span><br></pre></td></tr></table></figure></details> <h3 id="lib-lt-qual-gt-目录"><a href="#lib-lt-qual-gt-目录" class="headerlink" title="/lib&lt;qual&gt; 目录"></a><code>/lib&lt;qual&gt;</code> 目录</h3><blockquote><p>系统上可能存在一个或多个/lib目录变体， 它们支持多个需要单独库的二进制格式。<br>如果存在一个或多个这些目录，则其内容的要求与普通/lib 目录相同，但不是必需的。  </p></blockquote><details><summary>/lib<qual></summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/lib64</span><br><span class="line">└── ld-linux-x86-64.so.2 -&gt; /lib/x86_64-linux-gnu/ld-2.27.so</span><br></pre></td></tr></table></figure></details><h3 id="media-目录"><a href="#media-目录" class="headerlink" title="/media 目录"></a><code>/media</code> 目录</h3><blockquote><p>此目录包含子目录，这些子目录用作可移动介质（如软盘，U盘，cdroms和zip磁盘）的安装点。<br>从历史上看，已经有许多其他不同的地方用于安装可移动媒体，如 <code>/cdrom</code>，<code>/mnt</code>或 <code>/mnt</code>  <code>/cdrom</code>。将所有可移除介质的挂载点直接放在根目录中可能会导致/中存在大量额外目录。尽管最近在 <code>/mnt</code> 中使用子目录作为挂载点已经很常见了，但它与使用 <code>/mnt</code> 直接作为临时挂载点的更古老的传统相冲突</p></blockquote><ul><li>如果相应的子系统已正确安装，那么以下目录或目录的符号链接必须位于 <code>/media</code> 中  </li></ul><table><thead><tr><th align="right">目录</th><th align="right">描述</th></tr></thead><tbody><tr><td align="right">floppy</td><td align="right">软盘驱动器（可选）</td></tr><tr><td align="right">cdrom</td><td align="right">CD-ROM驱动器（可选）</td></tr><tr><td align="right">cdrecorder</td><td align="right">CD刻录机（可选）</td></tr><tr><td align="right">zip</td><td align="right">Zip驱动器（可选）</td></tr></tbody></table><details><summary>/media</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/media</span><br><span class="line">├── C</span><br><span class="line">├── D</span><br><span class="line">└── l</span><br></pre></td></tr></table></figure></details><h3 id="mnt-目录"><a href="#mnt-目录" class="headerlink" title="/mnt 目录"></a><code>/mnt</code> 目录</h3><blockquote><p>提供此目录，以便系统管理员可以根据需要临时安装文件系统。 此目录的内容是本地内容，不应影响任何程序的运行方式。 安装程序不得使用此目录：必须使用系统未使用的合适临时目录。</p></blockquote><details><summary>/mnt</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/mnt</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br></pre></td></tr></table></figure></details><h3 id="opt-目录"><a href="#opt-目录" class="headerlink" title="/opt 目录"></a><code>/opt</code> 目录</h3><blockquote><p>要安装在/opt中的软件包必须将其静态文件放在单独的 <code>/opt/&lt;package&gt;</code> 或中<br><code>/opt/&lt;provider&gt;</code> 目录树，其中 <code>&lt;package&gt;</code> 是描述软件包的名称，<code>&lt;provider&gt;</code> 是提供商的LANANA注册名称。  </p></blockquote><ul><li>保留目录 <code>/opt/bin</code>，<code>/opt/doc</code>，<code>/opt/include</code>，<code>/opt/info</code>，<code>/opt/lib</code>和<code>/opt/man</code> 供本地系统管理员使用。包可以提供旨在放入的“前端”文件（通过链接或<br>由本地系统管理员复制这些保留的目录，但在正常情况下必须保留这些目录。  </li><li>用户要调用的程序必须位于目录 <code>/opt/&lt;package&gt;/bin</code> 或其下 <code>/opt/&lt;provider&gt;</code> 层次结构。如果软件包包含 <strong>UNIX手册页</strong>，则它们必须位于 <code>/opt/&lt;package&gt;/share/man</code> 或在 <code>/opt/&lt;provider&gt;</code> 层次结构下 <strong>而且</strong> 子结构必须使用和 <code>/usr/share/man</code> 一样的目录结构。  </li><li>可更改的包文件 <strong>（在正常操作中更改）</strong> 必须安装在 <code>/var/opt</code> 中。</li></ul><details><summary>/opt</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/opt</span><br><span class="line">├── containerd</span><br><span class="line">├── google</span><br><span class="line">├── kingsoft</span><br><span class="line">├── netease</span><br><span class="line">├── openwrt</span><br><span class="line">└── openwrt-build.tar</span><br></pre></td></tr></table></figure></details><h3 id="root-目录"><a href="#root-目录" class="headerlink" title="/root 目录"></a><code>/root</code> 目录</h3><blockquote><p>root 用户目录</p></blockquote><h3 id="sbin-目录"><a href="#sbin-目录" class="headerlink" title="/sbin 目录"></a><code>/sbin</code> 目录</h3><blockquote><p>用于系统管理的实用程序（和其他仅用于root的命令）存储在<code>/sbin</code>，<code>/usr/sbin</code> 和 <code>/usr/local/sbin</code> 中。 除了 <code>/bin</code> 中的二进制文件之外，<code>/sbin</code> 还包含引导，恢复，恢复和 <code>/</code> 或修复系统所必需的二进制文件。 已知 <code>/usr</code> 安装后执行的程序（当没有问题时）通常放在 <code>/usr/sbin</code> 中。 本地安装的系统管理程序应放在 <code>/usr/local/sbin</code> 中</p></blockquote><details><summary>/usr</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">/sbin</span><br><span class="line">├── acpi_available</span><br><span class="line">├── agetty</span><br><span class="line">├── alsa</span><br><span class="line">├── apm_available</span><br><span class="line">├── apparmor_parser</span><br><span class="line">├── auibusy</span><br><span class="line">├── aumvdown</span><br><span class="line">├── auplink</span><br><span class="line">├── badblocks</span><br><span class="line">├── blkdeactivate</span><br><span class="line">├── blkdiscard</span><br><span class="line">├── blkid</span><br><span class="line">├── blockdev</span><br><span class="line">├── brctl</span><br><span class="line">├── bridge</span><br><span class="line">├── brltty -&gt; /bin/brltty</span><br><span class="line">├── brltty-setup</span><br><span class="line">├── capsh</span><br><span class="line">├── cfdisk</span><br><span class="line">├── cgdisk</span><br><span class="line">├── chcpu</span><br><span class="line">├── crda</span><br><span class="line">├── create-uvm-dev-node</span><br><span class="line">├── cryptdisks_start</span><br><span class="line">├── cryptdisks_stop</span><br><span class="line">├── cryptsetup</span><br><span class="line">├── cryptsetup-reencrypt</span><br><span class="line">├── ctrlaltdel</span><br><span class="line">├── debugfs</span><br><span class="line">├── debugreiserfs</span><br><span class="line">├── depmod -&gt; /bin/kmod</span><br><span class="line">├── devlink</span><br><span class="line">├── dhclient</span><br><span class="line">├── dhclient-script</span><br><span class="line">├── dmeventd</span><br><span class="line">├── dmsetup</span><br><span class="line">├── dmstats -&gt; dmsetup</span><br><span class="line">├── dosfsck -&gt; fsck.fat</span><br><span class="line">├── dosfslabel -&gt; fatlabel</span><br><span class="line">├── dumpe2fs</span><br><span class="line">├── dumpexfat</span><br><span class="line">├── e2fsck</span><br><span class="line">├── e2image</span><br><span class="line">├── e2label -&gt; tune2fs</span><br><span class="line">├── e2undo</span><br><span class="line">├── ebtables</span><br><span class="line">├── ebtables-restore</span><br><span class="line">├── ebtables-save</span><br><span class="line">├── exfatfsck</span><br><span class="line">├── exfatlabel</span><br><span class="line">├── fatlabel</span><br><span class="line">├── fdisk</span><br><span class="line">├── findfs</span><br><span class="line">├── fixparts</span><br><span class="line">├── fsadm</span><br><span class="line">├── fsck</span><br><span class="line">├── fsck.cramfs</span><br><span class="line">├── fsck.exfat -&gt; exfatfsck</span><br><span class="line">├── fsck.ext2 -&gt; e2fsck</span><br><span class="line">├── fsck.fat</span><br><span class="line">├── fsck.minix</span><br><span class="line">├── fsck.reiserfs</span><br><span class="line">├── fsck.xfs</span><br><span class="line">├── fsfreeze</span><br><span class="line">├── fstab-decode</span><br><span class="line">├── fstrim</span><br><span class="line">├── gdisk</span><br><span class="line">├── <span class="built_in">getcap</span></span><br><span class="line">├── getpcaps</span><br><span class="line">├── get-quirk-options</span><br><span class="line">├── getty -&gt; agetty</span><br><span class="line">├── halt -&gt; /bin/systemctl</span><br><span class="line">├── hdparm</span><br><span class="line">├── hwclock</span><br><span class="line">├── ifconfig</span><br><span class="line">├── ifdown -&gt; ifup</span><br><span class="line">├── ifquery -&gt; ifup</span><br><span class="line">├── ifup</span><br><span class="line">├── init -&gt; /lib/systemd/systemd</span><br><span class="line">├── insmod -&gt; /bin/kmod</span><br><span class="line">├── installkernel</span><br><span class="line">├── integritysetup</span><br><span class="line">├── ip -&gt; /bin/ip</span><br><span class="line">├── ipmaddr</span><br><span class="line">├── iptables -&gt; xtables-multi</span><br><span class="line">├── iptunnel</span><br><span class="line">├── isosize</span><br><span class="line">├── iw</span><br><span class="line">├── iwconfig</span><br><span class="line">├── iwevent</span><br><span class="line">├── iwgetid</span><br><span class="line">├── iwlist</span><br><span class="line">├── iwpriv</span><br><span class="line">├── iwspy</span><br><span class="line">├── kbdrate</span><br><span class="line">├── key.dns_resolver</span><br><span class="line">├── killall5</span><br><span class="line">├── ldconfig</span><br><span class="line">├── ldconfig.real</span><br><span class="line">├── logsave</span><br><span class="line">├── losetup</span><br><span class="line">├── lsmod -&gt; /bin/kmod</span><br><span class="line">├── lspcmcia -&gt; pccardctl</span><br><span class="line">├── lvchange -&gt; lvm</span><br><span class="line">├── lvm</span><br><span class="line">├── lvmconf</span><br><span class="line">├── lvmdump</span><br><span class="line">├── mdadm</span><br><span class="line">├── mdmon</span><br><span class="line">├── mii-tool</span><br><span class="line">├── mkdosfs -&gt; mkfs.fat</span><br><span class="line">├── mke2fs</span><br><span class="line">├── mkexfatfs</span><br><span class="line">├── mkfs</span><br><span class="line">├── mkfs.bfs</span><br><span class="line">├── mkfs.cramfs</span><br><span class="line">├── mkfs.exfat -&gt; mkexfatfs</span><br><span class="line">├── mkfs.fat</span><br><span class="line">├── mkfs.minix</span><br><span class="line">├── mkfs.msdos -&gt; mkfs.fat</span><br><span class="line">├── mkfs.vfat -&gt; mkfs.fat</span><br><span class="line">├── mkfs.xfs</span><br><span class="line">├── mkhomedir_helper</span><br><span class="line">├── mkntfs</span><br><span class="line">├── mkreiserfs</span><br><span class="line">├── mkswap</span><br><span class="line">├── modinfo -&gt; /bin/kmod</span><br><span class="line">├── modprobe -&gt; /bin/kmod</span><br><span class="line">├── mount.aufs</span><br><span class="line">├── mount.ecryptfs</span><br><span class="line">├── mount.ecryptfs_private</span><br><span class="line">├── mount.exfat -&gt; mount.exfat-fuse</span><br><span class="line">├── mount.exfat-fuse</span><br><span class="line">├── mount.fuse</span><br><span class="line">├── mount.lowntfs-3g -&gt; /bin/lowntfs-3g</span><br><span class="line">├── nameif</span><br><span class="line">├── ntfsclone</span><br><span class="line">├── ntfscp</span><br><span class="line">├── ntfslabel</span><br><span class="line">├── ntfsresize</span><br><span class="line">├── ntfsundelete</span><br><span class="line">├── on_ac_power</span><br><span class="line">├── pam_extrausers_chkpwd</span><br><span class="line">├── pam_extrausers_update</span><br><span class="line">├── pam_tally</span><br><span class="line">├── pam_tally2</span><br><span class="line">├── parted</span><br><span class="line">├── partprobe</span><br><span class="line">├── pccardctl</span><br><span class="line">├── pivot_root</span><br><span class="line">├── plipconfig</span><br><span class="line">├── plymouthd</span><br><span class="line">├── poweroff -&gt; /bin/systemctl</span><br><span class="line">├── prime-offload</span><br><span class="line">├── prime-switch</span><br><span class="line">├── rarp</span><br><span class="line">├── raw</span><br><span class="line">├── reboot -&gt; /bin/systemctl</span><br><span class="line">├── regdbdump</span><br><span class="line">├── reiserfsck</span><br><span class="line">├── reiserfstune</span><br><span class="line">├── request-key</span><br><span class="line">├── resize2fs</span><br><span class="line">├── resize_reiserfs</span><br><span class="line">├── rmmod -&gt; /bin/kmod</span><br><span class="line">├── route</span><br><span class="line">├── rtacct</span><br><span class="line">├── rtmon</span><br><span class="line">├── runlevel -&gt; /bin/systemctl</span><br><span class="line">├── runuser</span><br><span class="line">├── <span class="built_in">setcap</span></span><br><span class="line">├── setvtrgb</span><br><span class="line">├── sfdisk</span><br><span class="line">├── sgdisk</span><br><span class="line">├── shadowconfig</span><br><span class="line">├── shutdown -&gt; /bin/systemctl</span><br><span class="line">├── slattach</span><br><span class="line">├── start-stop-daemon</span><br><span class="line">├── sulogin</span><br><span class="line">├── swaplabel</span><br><span class="line">├── swapoff</span><br><span class="line">├── swapon</span><br><span class="line">├── switch_root</span><br><span class="line">├── sysctl</span><br><span class="line">├── tc</span><br><span class="line">├── telinit -&gt; /bin/systemctl</span><br><span class="line">├── tipc</span><br><span class="line">├── tune2fs</span><br><span class="line">├── u-d-c-print-pci-ids</span><br><span class="line">├── udevadm -&gt; /bin/udevadm</span><br><span class="line">├── umount.aufs</span><br><span class="line">├── umount.ecryptfs</span><br><span class="line">├── umount.ecryptfs_private -&gt; mount.ecryptfs_private</span><br><span class="line">├── umount.udisks2</span><br><span class="line">├── unix_chkpwd</span><br><span class="line">├── unix_update</span><br><span class="line">├── ureadahead</span><br><span class="line">├── veritysetup</span><br><span class="line">├── vgcfgbackup -&gt; lvm</span><br><span class="line">├── wipefs</span><br><span class="line">├── wpa_action</span><br><span class="line">├── wpa_cli</span><br><span class="line">├── wpa_supplicant</span><br><span class="line">├── xfs_repair</span><br><span class="line">├── xtables-multi</span><br><span class="line">└── zramctl</span><br></pre></td></tr></table></figure></details><h3 id="srv-目录"><a href="#srv-目录" class="headerlink" title="/srv 目录"></a><code>/srv</code> 目录</h3><blockquote><p>/srv 包含由此系统提供的特定于站点的数据。</p></blockquote><details><summary>/srv</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/srv</span><br><span class="line"></span><br><span class="line">0 directories, 0 files</span><br></pre></td></tr></table></figure></details><h3 id="tmp-目录"><a href="#tmp-目录" class="headerlink" title="/tmp 目录"></a><code>/tmp</code> 目录</h3><blockquote><p>/tmp 目录必须可用于需要临时文件的程序。<br>任何程序不得假定 /tmp 中的任何文件或目录在程序的调用之间可以保留下来。</p></blockquote><details><summary>/tmp</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/tmp</span><br><span class="line">├── appInsights-nodeAIF-444c3af9-8</span><br><span class="line">├── config-err-JF43Rd</span><br><span class="line">├── electron-ssr Crashes</span><br><span class="line">├── fcitx-socket-:0</span><br><span class="line">├── net-export</span><br><span class="line">├── qipc_sharedmemory_cffabfbbcaefccd</span><br><span class="line">├── qipc_sharedmemory_WallchMemoryf72</span><br><span class="line">├── qipc_systemsem_cffabfbbcaefccdab</span><br><span class="line">├── ssh-kuDeYu5jr0zD</span><br><span class="line">├── systemd-private-86a2e1ed2ff64d</span><br><span class="line">├── VSCode Crashes</span><br><span class="line">└── Wallch Local Socket Server</span><br></pre></td></tr></table></figure></details><h3 id="usr-目录"><a href="#usr-目录" class="headerlink" title="/usr 目录"></a><code>/usr</code> 目录</h3><blockquote><p>/usr 是文件系统的第二个主要部分。<br>/usr 是可共享的只读数据。这意味着 /usr 应该可以在各种符合FHS的主机之间共享，并且不得写入。<br>任何特定于主机或随时间变化的信息都应该存储在其他位置。<br>大型软件包不得直接使用 /usr 层次结构下的子目录。  </p></blockquote><ul><li>在 /usr 文件夹下面，必须要有这些文件夹：</li></ul><table><thead><tr><th align="right">名称</th><th align="right">描述</th></tr></thead><tbody><tr><td align="right">bin</td><td align="right">用户命令的主要存放点</td></tr><tr><td align="right">include</td><td align="right">C 语言的头文件</td></tr><tr><td align="right">lib</td><td align="right">库文件</td></tr><tr><td align="right">local</td><td align="right">本地二级目录（在主系统安装后为空）</td></tr><tr><td align="right">sbin</td><td align="right">不重要的系统二进制文件</td></tr><tr><td align="right">share</td><td align="right">与文件系统结构无关的数据</td></tr><tr><td align="right">games</td><td align="right">游戏文件</td></tr><tr><td align="right">X11R6</td><td align="right">X Windows，11版的第6个 release 文件</td></tr><tr><td align="right">lib<qual></td><td align="right">备用库</td></tr><tr><td align="right">src</td><td align="right">源码</td></tr></tbody></table><details><summary>/usr</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">├── bin</span><br><span class="line">├── games</span><br><span class="line">├── include</span><br><span class="line">├── lib</span><br><span class="line">├── lib64</span><br><span class="line">├── <span class="built_in">local</span></span><br><span class="line">├── sbin</span><br><span class="line">├── share</span><br><span class="line">│    └── man <span class="comment">#手册文件夹</span></span><br><span class="line">└── src <span class="comment">#source code</span></span><br></pre></td></tr></table></figure></details><h3 id="var-目录"><a href="#var-目录" class="headerlink" title="/var 目录"></a><code>/var</code> 目录</h3><blockquote><p>/var包 含可变数据文件。这包括假脱机目录和文件，管理和日志记录数据，以及瞬态和临时文件.<br>/var的某些部分在不同系统之间不可共享。例如，/var/log，/var/lock 和/var/run。其他部分可以共享，特别是 /var/mail，/var/cache/man，/var/cache/fonts，和 /var/spool/news。<br>如果 /var不能成为一个单独的分区，通常最好将 /var移出根分区并进入 /usr分区。 （有时这样做是为了减小根分区的大小，或者在根分区中空间不足时）。但是，/var不能链接到 /usr，因为这会使 /usr 和 /var 的分离变得更加困难并且很可能会产生命名冲突。 相反的，将 /var链接到/usr/var。就可以了。</p></blockquote><details><summary>/var</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/var</span><br><span class="line">├── backups</span><br><span class="line">├── cache <span class="comment">#应用数据缓存</span></span><br><span class="line">├── crash <span class="comment">#系统崩溃转储文件</span></span><br><span class="line">├── lib  <span class="comment">#可变状态信息</span></span><br><span class="line">├── <span class="built_in">local</span> <span class="comment">#/usr/local 的可变数据</span></span><br><span class="line">├── lock -&gt; /run/lock</span><br><span class="line">├── <span class="built_in">log</span> <span class="comment">#日志文件</span></span><br><span class="line">├── mail <span class="comment">#用户邮箱</span></span><br><span class="line">├── opt <span class="comment">#/opt 的可变数据</span></span><br><span class="line">├── run -&gt; /run <span class="comment">#与进程运行相关的数据</span></span><br><span class="line">├── spool <span class="comment">#应用脱机文件</span></span><br><span class="line">├── tmp <span class="comment">#两次重启之间的交换文件</span></span><br><span class="line">└── www</span><br></pre></td></tr></table></figure></details><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><h4 id="参考系统"><a href="#参考系统" class="headerlink" title="参考系统"></a>参考系统</h4><ul><li><em>Ubuntu 18.04</em></li></ul><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ol><li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU2JTk2JTg3JUU0JUJCJUI2JUU3JUIzJUJCJUU3JUJCJTlGJUU1JUIxJTgyJUU2JUFDJUExJUU3JUJCJTkzJUU2JTlFJTg0JUU2JUEwJTg3JUU1JTg3JTg2">文件系统层次结构标准<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cDovL3d3dy5wYXRobmFtZS5jb20vZmhzLw==">Filesystem Hierarchy Standard<i class="fa fa-external-link-alt"></i></span></li></ol><!-- ### `/usr` 目录<details><summary>/usr</summary><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></details> <p>–&gt;</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 文件目录 </tag>
            
            <tag> FHS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TAPD git关联提交</title>
      <link href="/2019/05/23/1/"/>
      <url>/2019/05/23/1/</url>
      
        <content type="html"><![CDATA[<h3 id="首先"><a href="#首先" class="headerlink" title="首先"></a>首先</h3><div class="note danger">            <p>不, 这里没有内容… </p>          </div>  <h3>然后</h3>    <div class="note success">            <p>我们需要的什么？是从摇篮到坟墓的全套服务 </p>          </div>  <h3 id="创建GitHub账号"><a href="#创建GitHub账号" class="headerlink" title="创建GitHub账号"></a>创建GitHub账号</h3><ul><li>这里有现成的轮子，就不再复述了。<br><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8wYzBkOGQxMGExY2I=">注册Github详细教程<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="创建GitHub仓库"><a href="#创建GitHub仓库" class="headerlink" title="创建GitHub仓库"></a>创建GitHub仓库</h3><ul><li>同上<br><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmppa2V4dWV5dWFuLmNvbS9wcm9qZWN0L2dpdGh1Yi1iYXNpY3MvY3JlYXQtbmV3LXJlcG8uaHRtbA==">在 GitHub 上创建一个新仓库<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="将-TAPD-与-Github仓库-关联起来"><a href="#将-TAPD-与-Github仓库-关联起来" class="headerlink" title="将 TAPD 与 Github仓库 关联起来"></a>将 <em>TAPD</em> 与 <em>Github仓库</em> 关联起来</h3><blockquote><p>ps: Secret Token 不是必须项，可以不生成。如果要用的话，就填到 <strong>Payload URL</strong> 下面的 <strong>Secret</strong> 里面去。<br>所谓的网络钩子，只是一个关联，相当于一个快捷方式。它并不会把文件什么的拉取到 <em>TAPD</em> 上，它只会告诉你有提交记录（相当于通知信息）。<br>可以把<em>TAPD</em>看成一个<strong>布告栏</strong>。当你看到有你感兴趣的信息时，你肯定不会向布告栏询问更具体的细节 <strong>而是</strong> 向发布公告的人(<em>Github</em>)询问更具体的细节。  </p></blockquote><ol><li>在GitHub上新建一个项目</li><li>点击仓库的设置</li><li>点击 <strong>Webhooks</strong> </li><li>点击 <strong>Add Webhook</strong></li></ol><p><img src="/images/git/1.png" alt="Loading"></p><ol start="5"><li>进入<strong>TAPD</strong> 项目详情页</li><li>点击设置</li><li>点击应用设置</li><li>点击Github源码（进去后可能会有个弹窗，关掉别管就行了）</li><li>点击复制URL</li><li>打开GitHub添加Webhook的那个页面，把URL复制到 <strong>PayLoad URL</strong> 里面去</li><li>点击下面的 <strong>Send me everything</strong></li><li>点击<strong>Add webhook</strong><br><img src="/images/git/2.png" alt="Loading"><br><img src="/images/git/3.png" alt="Loading"><br><img src="/images/git/4.png" alt="Loading"><br><img src="/images/git/5.png" alt="Loading">  </li></ol><h3 id="开始第一个提交"><a href="#开始第一个提交" class="headerlink" title="开始第一个提交"></a>开始第一个提交</h3><blockquote><p>提供3种提交方式：  </p><ol><li>网页提交  </li><li>使用 <em>Github Desktop</em> 进行提交</li><li>纯命令行操作<br>新手推荐第一种，也就是下面介绍的这种提交方式  </li></ol></blockquote><ul><li>大体操作可以参考这个：<span class="exturl" data-url="aHR0cDovL3dpa2kuamlrZXh1ZXl1YW4uY29tL3Byb2plY3QvZ2l0aHViLWJhc2ljcy9jb21taXQtZmlyc3QtY2hhbmdlLmh0bWw=">提交你的第一个更改<i class="fa fa-external-link-alt"></i></span>  </li><li><strong>注意</strong> ：在提交更改的时候，<em><strong>commit信息</strong></em> 必须符合接下来的提交格式，要不然 <strong>TAPD</strong> 没有关联提交记录</li></ul><h3 id="提交格式"><a href="#提交格式" class="headerlink" title="提交格式"></a>提交格式</h3><h4 id="标准提交格式"><a href="#标准提交格式" class="headerlink" title="标准提交格式"></a>标准提交格式</h4><ul><li>需求、缺陷、任务对应关键字：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># usernick 为 TAPD 的用户名</span><br><span class="line">需求： --story=[story id] --user=[usernick] 描述  </span><br><span class="line">缺陷： --bug=[bug id] --user=[usernick] 描述  </span><br><span class="line">任务： --task=[task id] --user=[usernick] 描述  </span><br></pre></td></tr></table></figure><h4 id="已尝试的提交格式（除标准）"><a href="#已尝试的提交格式（除标准）" class="headerlink" title="已尝试的提交格式（除标准）"></a>已尝试的提交格式（除标准）</h4><blockquote><ol><li>提交的时候，指定的 <strong>–user</strong> 用户名必须和 <strong>TAPD</strong> 里面的用户名相同。如果不是那就关联不到指定的用户.   </li><li>Windows默认字符集为 <strong>GBK</strong>，所以直接用命令行提交会乱码，结果可能不会关联到指定用户。推荐使用 <strong>Github Desktop</strong> 或者 网页提交的方式。  </li><li>如果没有关联到指定用户，但是同步到了 <strong>TAPD</strong> 的关联提交，就会显示 “Github助手关联了 ${github.username} 提交的源码”    </li><li>没有详情的提交会被 <em>TAPD</em> 视为 <strong>无效提交</strong>，<strong>不会</strong>被同步到<em>git</em>关联提交     </li><li>在关联提交之后，需求的类型不会改变。换句话说，就是不会从 “规划中” 自动变成 “已完成”，这个要自己改。<br>划掉的为未进行测试提交的示例。<br><img src="/images/git/6.png" alt="Loading"><br><img src="/images/git/7.png" alt="Loading">  </li></ol></blockquote><ol><li><code>--user=userName 提交说明</code> 提交有效，但是不会被关联到 TAPD</li><li><code>--story=1002534 --story=1002532 --user=Gayhub 测试关联提交</code> 提交有效，而且会被<strong>TAPD</strong>视为两次提交,完成了两个需求,显示为GitHub关联的提交（GitHub还是将这个视为一次提交）</li><li><del><code>--story=1002534 --story=1002532</code></del></li><li><del><code>--user=Gayhub --story=1002534 --story=1002532  测试关联提交</code></del></li><li>如果还有 <strong>其他可能的方案</strong> 或者 <strong>测试结果</strong> 欢迎留言</li></ol><h3 id="添加项目协助者（拉小组成员进项目）"><a href="#添加项目协助者（拉小组成员进项目）" class="headerlink" title="添加项目协助者（拉小组成员进项目）"></a>添加项目协助者（拉小组成员进项目）</h3><ul><li>跟设置 WebHook 差不多，还是项目那边的 <em>setting</em> 进去</li></ul><ol><li>点击 <em>setting</em></li><li>点击 <em>Collaborators</em></li><li>可以通过 <em>Github</em> 的 <strong>用户名</strong> 或者 <strong>全名</strong> 或者 <strong>注册使用的电子邮件地址</strong> 来查找并添加用户</li><li>点击 <em>Add collaborator</em>，完成。<blockquote><p>如果用户设置了隐藏电子邮件地址的话，那就无法通过电子邮件地址来添加协助者。</p></blockquote></li></ol><p><img src="/images/git/8.png" alt="Loading"></p><h3 id="发布仓库（仓库将变为只读状态）"><a href="#发布仓库（仓库将变为只读状态）" class="headerlink" title="发布仓库（仓库将变为只读状态）"></a>发布仓库（仓库将变为只读状态）</h3><ul><li>跟设置 WebHook 差不多，还是项目那边的 <em>setting</em> 进去  </li></ul><ol><li>点击 <em>setting</em></li><li>拉动网页到最底端</li><li>在 <code>Danger Zone</code> 里面找到 <code>Archive this repository</code></li><li>点击 <code>Archive this repository</code>，发布仓库，完成。</li></ol><p><img src="/images/git/9.png" alt="Loading"></p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> TAPD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>you-get+ffmpeg实现从下载到提取音视频</title>
      <link href="/2019/05/01/1/"/>
      <url>/2019/05/01/1/</url>
      
        <content type="html"><![CDATA[<h3 id="安装you-get"><a href="#安装you-get" class="headerlink" title="安装you-get"></a>安装you-get</h3><ul><li><code>sudo apt-get install python3-pip &amp;&amp; sudo pip3 install you-get</code></li><li>其他安装方法：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvaW1vcnQveW91LWdldCNvcHRpb24tMS1pbnN0YWxsLXZpYS1waXA=">https://github.com/soimort/you-get#option-1-install-via-pip<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="简单使用you-get"><a href="#简单使用you-get" class="headerlink" title="简单使用you-get"></a>简单使用you-get</h3><blockquote><p>更完善的使用方法请看：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvaW1vcnQveW91LWdldCNnZXR0aW5nLXN0YXJ0ZWQ=">https://github.com/soimort/you-get#getting-started<i class="fa fa-external-link-alt"></i></span></p></blockquote><h4 id="指定下载的画质或者媒体类型"><a href="#指定下载的画质或者媒体类型" class="headerlink" title="指定下载的画质或者媒体类型"></a>指定下载的画质或者媒体类型</h4><ol><li>使用 <code>-i</code> 选项进行查看可用下载：<code>you-get -i &#39;https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;</code></li><li>使用 <code>--itag=</code> 选项指定下载文件：<code>you-get --itag=18 &#39;https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;</code></li></ol><h4 id="直接下载-you-get-39-https-www-youtube-com-watch-v-jNQXAC9IVRw-39"><a href="#直接下载-you-get-39-https-www-youtube-com-watch-v-jNQXAC9IVRw-39" class="headerlink" title="直接下载: you-get &#39;https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;"></a>直接下载: <code>you-get &#39;https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;</code></h4><blockquote><p>直接下载一般会下载 <code>-i</code> 选项的第一个文件，<strong>一般</strong> 是最高的画质。</p></blockquote><h4 id="下载其他文件，不仅仅是媒体文件：you-get-https-stallman-org-rms-jpg"><a href="#下载其他文件，不仅仅是媒体文件：you-get-https-stallman-org-rms-jpg" class="headerlink" title="下载其他文件，不仅仅是媒体文件：you-get https://stallman.org/rms.jpg"></a>下载其他文件，不仅仅是媒体文件：<code>you-get https://stallman.org/rms.jpg</code></h4><h4 id="通过-HTTP-代理下载"><a href="#通过-HTTP-代理下载" class="headerlink" title="通过 HTTP 代理下载"></a>通过 <strong>HTTP</strong> 代理下载</h4><blockquote><p>没有代理？参见：<a href="https://iitii.github.io/2019/03/17/1/">自建简易代理</a></p></blockquote><ul><li>我们只需要在<strong>第一个选项前面</strong>插入<code>-x ip:port</code>就行，如：<code>you-get -x localhost:1080 -i &#39;https://www.youtube.com/watch?v=jNQXAC9IVRw&#39;</code><h3 id="安装FFmpeg"><a href="#安装FFmpeg" class="headerlink" title="安装FFmpeg"></a>安装FFmpeg</h3></li><li>参见我的这篇博文：<a href="https://iitii.github.io/2019/02/01/FFmpeg%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">FFmpeg的简单使用</a></li></ul><h3 id="使用you-get-ffmpeg实现从下载到提取音视频"><a href="#使用you-get-ffmpeg实现从下载到提取音视频" class="headerlink" title="使用you-get+ffmpeg实现从下载到提取音视频"></a>使用you-get+ffmpeg实现从下载到提取音视频</h3><h4 id="you-get下载视频"><a href="#you-get下载视频" class="headerlink" title="you-get下载视频"></a>you-get下载视频</h4><ul><li>参见：<a href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8you-get">简单使用you-get</a></li></ul><h4 id="ffmpeg提取指定音视频文件"><a href="#ffmpeg提取指定音视频文件" class="headerlink" title="ffmpeg提取指定音视频文件"></a>ffmpeg提取指定音视频文件</h4><h5 id="手动实现"><a href="#手动实现" class="headerlink" title="手动实现"></a>手动实现</h5><ul><li><p>参见我的这篇博文：<a href="https://iitii.github.io/2019/02/01/FFmpeg%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/">FFmpeg的简单使用</a></p><h5 id="脚本实现"><a href="#脚本实现" class="headerlink" title="脚本实现"></a>脚本实现</h5></li><li><p>获取脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/IITII/Useless/master/ffmpeg.sh</span><br></pre></td></tr></table></figure></li><li><p>使用脚本：</p><ol><li>直接<code>./ffmpeg.sh</code> 按着脚本一步一步来   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ./ffmpeg.sh</span><br><span class="line">请选择你要选择的操作的序号：</span><br><span class="line"></span><br><span class="line">* 所有文件名请完整输入文件名称，包括后缀名！</span><br><span class="line"></span><br><span class="line">1.获取aac音频文件</span><br><span class="line">2.获取mp3文件</span><br><span class="line">3.获取H.264视频流文件(.mp4文件)</span><br><span class="line">4.整合mp4文件和mp4文件</span><br><span class="line">5.整合mp4和mp3文件</span><br><span class="line">6.整合mp4和aac文件</span><br><span class="line">7.添加srt字幕</span><br><span class="line">8.srt字幕转ass</span><br><span class="line">9.添加ass字幕</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol start="2"><li>命令行传参<ol><li>使用 <code>-h</code> 查看帮助<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ./ffmpeg.sh -h</span><br><span class="line">-h: To show this menu</span><br><span class="line">-e: Show Some Useful Templates</span><br><span class="line">-m [1-9]: To switch mode</span><br><span class="line">     -m 1: 获取aac音频文件</span><br><span class="line">     -m 2: 获取mp3文件</span><br><span class="line">     -m 3: 获取H.264视频流文件(.mp4文件)</span><br><span class="line">     -m 4: 整合mp4文件和mp4文件</span><br><span class="line">     -m 5: .整合mp4和mp3文件</span><br><span class="line">     -m 6: 整合mp4和aac文件</span><br><span class="line">     -m 7: 添加srt字幕</span><br><span class="line">     -m 8: srt字幕转ass</span><br><span class="line">     -m 9: 添加ass字幕</span><br></pre></td></tr></table></figure></li><li>使用 <code>-e</code> 查看示例<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ./ffmpeg.sh -e</span><br><span class="line">./ffmpeg.sh -m 1 input.mp4 output.aac</span><br><span class="line">./ffmpeg.sh -m 2 input.mp4 output.mp3</span><br><span class="line">./ffmpeg.sh -m 3 input.mp4 output.mp4</span><br><span class="line">./ffmpeg.sh -m 4 input_audio.mp4 input_video.mp4 output.mp4</span><br><span class="line">./ffmpeg.sh -m 5 input.mp3 input.mp4 output.mp4</span><br><span class="line">./ffmpeg.sh -m 6 input.aac input.mp4 output.mp4</span><br><span class="line">./ffmpeg.sh -m 7 input.mp4 input.srt output.mp4</span><br><span class="line">./ffmpeg.sh -m 8 input.srt output.ass</span><br><span class="line">./ffmpeg.sh -m 9 input.mp4 input.ass output.mp4</span><br></pre></td></tr></table></figure></li><li>使用 <code>-m</code> 指定处理模式<blockquote><p>具体使用参见示例：<code>./ffmpeg.sh -e</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-m 1: 获取aac音频文件</span><br><span class="line">-m 2: 获取mp3文件</span><br><span class="line">-m 3: 获取H.264视频流文件(.mp4文件)</span><br><span class="line">-m 4: 整合mp4文件和mp4文件</span><br><span class="line">-m 5: 整合mp4和mp3文件</span><br><span class="line">-m 6: 整合mp4和aac文件</span><br><span class="line">-m 7: 添加srt字幕</span><br><span class="line">-m 8: srt字幕转ass</span><br><span class="line">-m 9: 添加ass字幕</span><br></pre></td></tr></table></figure><h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3></li></ol></li></ol><ul><li><span class="exturl" data-url="aHR0cHM6Ly95b3V0dS5iZS9rNDVFcGd3ZVQ5bw==">Carole &amp; Tuesday片头曲<i class="fa fa-external-link-alt"></i></span></li></ul><ol><li>下载文件：<code>you-get https://youtu.be/k45EpgweT9o</code></li><li>合并文件：<code>./ffmpeg.sh -m 4 *01*.mp4 *00*.mp4 output.mp4</code></li><li>压入字幕：<code>./ffmpeg.sh -m 7 output.mp4 *.ja.srt output_srt.mp4</code></li></ol><h3 id="So-Enjoy-it"><a href="#So-Enjoy-it" class="headerlink" title="So, Enjoy it!!!"></a>So, Enjoy it!!!</h3><blockquote><p>当然如果有 <em>bug</em> 的话，还请及时反馈（推荐 <em><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lJVElJL1VzZWxlc3M=">GitHub<i class="fa fa-external-link-alt"></i></span></em> 直接提 <strong>issues</strong>, 直接在文章底部留言也行）</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> software </category>
          
          <category> useful </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ffmpeg </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu使用命令修改屏幕的显示方向</title>
      <link href="/2019/04/22/1/"/>
      <url>/2019/04/22/1/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>Ubuntu踩坑记 </p>            <i class="fa fa-quote-right"></i>          </blockquote><p><del>之前VM的<code>查看-&gt;立即适应客户机</code>还没有变灰的时候倒是可以通过这个调屏幕的方向，不过天有不测风云 :-(</del></p><blockquote><p>PS: 在更改屏幕方向以后如果您想保持这个显示方向的话，还请在 <code>setting-&gt;Display</code> 里面修改显示器方向后保存。<br>如果不，重启之后系统就会恢复原来的显示器方向。  </p></blockquote><ul><li>具体操作：<ul><li><ol><li>打开 <code>Setting -&gt; Devices -&gt; Displays -&gt; Orientation</code></li></ol></li><li><ol start="2"><li>点击修改，其中 <code>Landscape</code> 表示正常，<code>Portrait right</code> 代表向右旋转，<code>Portrait left</code> 代表向左旋转，<code>Landscape flipped</code> 代表翻转</li></ol></li><li><ol start="3"><li>先修改为不正常，然后如果鼠标错位了的话，直接通过 <em><strong>Tab键和回车键</strong></em> 进行选择。</li></ol></li><li>最后修改为正常，然后再进行保存就 ok 了。</li></ul></li></ul><h3 id="恢复默认方向"><a href="#恢复默认方向" class="headerlink" title="恢复默认方向"></a>恢复默认方向</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr -o normal</span><br></pre></td></tr></table></figure><h3 id="左旋转"><a href="#左旋转" class="headerlink" title="左旋转"></a>左旋转</h3><blockquote><p>同理右旋转和反转屏幕等操作也类似，更多操作还请参考 <code>xrandr --help</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr -o left</span><br></pre></td></tr></table></figure><h3 id="查看当前显示器的输出信息"><a href="#查看当前显示器的输出信息" class="headerlink" title="查看当前显示器的输出信息"></a>查看当前显示器的输出信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr -o q</span><br></pre></td></tr></table></figure><h3 id="旋转某个视频接口的视频输出方向"><a href="#旋转某个视频接口的视频输出方向" class="headerlink" title="旋转某个视频接口的视频输出方向"></a>旋转某个视频接口的视频输出方向</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output HDMI1 --rotate left</span><br><span class="line"></span><br><span class="line">xrandr --output HDMI1 --rotate normal</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> config </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> Gnome </tag>
            
            <tag> xrandr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禁用Windows 驱动器/文件夹 压缩属性</title>
      <link href="/2019/04/10/1/"/>
      <url>/2019/04/10/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本教程介绍如何在Microsoft Windows中禁用“文件压缩”功能。<br>原文链接：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGVjaG5pcGFnZXMuY29tL2Rpc2FibGUtd2luZG93cy1maWxlLWNvbXByZXNzaW9u">https://www.technipages.com/disable-windows-file-compression<i class="fa fa-external-link-alt"></i></span></p></blockquote><h3 id="Windows-10-8-7和Vista命令"><a href="#Windows-10-8-7和Vista命令" class="headerlink" title="Windows 10,8,7和Vista命令"></a>Windows 10,8,7和Vista命令</h3><ul><li>选择 <code>开始</code> 按钮，然后键入 <code>CMD</code>。  </li><li>右键单击 <code>命令提示符</code> ，然后选择 <code>以管理员身份运行</code>。</li><li>如果提示输入密码，请输入具有管理员权限的帐户的凭据。键入以下内容，然后按 <code>Enter</code>:</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsutil behavior <span class="built_in">set</span> disablecompression <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li><p>您应该收到一条消息 <strong>请注意：对此设置的更改需要重新启动才能生效。重新启动计算机以进行更改。</strong></p></li><li><p>如果要再次启用它，可以使用该命令:</p></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsutil behavior <span class="built_in">set</span> disablecompression <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="Windows组策略"><a href="#Windows组策略" class="headerlink" title="Windows组策略"></a>Windows组策略</h3><ol><li>从组策略编辑器，导航到<code>计算机配置</code>&gt;<code>管理模板</code>&gt;<code>系统</code>&gt;<code>文件系统</code>&gt;<code>NTFS</code>。</li><li>打开<code>不允许在所有NTFS卷上进行压缩</code>。</li><li>选择<code>已启用 </code>单选按钮，然后选择<code>确定</code>。</li></ol><h3 id="Windows-2000和XP-NTFS卷"><a href="#Windows-2000和XP-NTFS卷" class="headerlink" title="Windows 2000和XP NTFS卷"></a>Windows 2000和XP NTFS卷</h3><ol><li><p>按住<code>Windows键</code>，然后按<code>R</code>。</p></li><li><p>输入<code>regedit</code>并选择<code>确定</code>。</p></li><li><p>导航到以下内容：<code>HKEY_LOCAL_MACHINE/SYSTEM/CURRENTCONTROLSET/Control/FileSystem</code></p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE</span><br><span class="line">SYSTEM</span><br><span class="line">CURRENTCONTROLSET</span><br><span class="line">Control</span><br><span class="line">FileSystem</span><br></pre></td></tr></table></figure></li><li><p>在<code>NtfsDisableCompression</code> 的右侧查找条目。如果它不存在，您将需要创建它。为此，右键单击<code>FileSystem</code>，然后选择<code>新建</code> &gt;  <code>DWORD值</code>。为该值指定<code>NtfsDisableCompression</code>。完成后按<code>Enter</code>键。</p></li><li><p>右键单击<code>NtfsDisableCompression</code>条目，然后单击<code>修改</code>。要禁用压缩，请将<code>值数据</code>设置为<code>1</code>。（要再次启用压缩，请将<code>数值数据</code>设置为0或删除NftsDisableCompression）</p></li><li><p>重新启动计算机以应用更改。</p></li><li><p>现在，当尝试压缩文件夹时，将产生以下错误：</p><center><P>将属性应用于文件时发生错误：<p>{file path and filename} <p>拒绝访问。<img src="https://www.technipages.com/images/articles/efs-error.gif"></center></li></ol>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebServer 基本配置文件</title>
      <link href="/2019/04/06/1/"/>
      <url>/2019/04/06/1/</url>
      
        <content type="html"><![CDATA[<h3 id="Apache-简单静态网页托管"><a href="#Apache-简单静态网页托管" class="headerlink" title="Apache 简单静态网页托管"></a>Apache 简单静态网页托管</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:80</span>&gt;</span></span><br><span class="line">        <span class="attribute">ServerName</span> iitii.me</span><br><span class="line">        <span class="attribute">ServerName</span> mail.iitii.me</span><br><span class="line">        <span class="attribute">ServerAdmin</span> webmaster@localhost</span><br><span class="line">        <span class="attribute">DocumentRoot</span> /var/www/v</span><br><span class="line">        <span class="attribute">ErrorLog</span> <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</span><br><span class="line">        <span class="attribute">CustomLog</span> <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span></span><br></pre></td></tr></table></figure><h3 id="Apache-SSL"><a href="#Apache-SSL" class="headerlink" title="Apache SSL"></a>Apache SSL</h3><blockquote><p>需要先激活对应 mod，如 ssl，rewrite。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost *<span class="number">:443</span>&gt;</span></span><br><span class="line">        <span class="attribute">ServerAdmin</span> webmaster@localhost</span><br><span class="line">        <span class="attribute">ServerName</span> chat.ccatk.tw</span><br><span class="line">        <span class="attribute">DocumentRoot</span> /var/www/FileList</span><br><span class="line">        <span class="attribute">SSLEngine</span> <span class="literal">On</span></span><br><span class="line">        <span class="attribute">SSLOptions</span> +StrictRequire</span><br><span class="line">        <span class="attribute">SSLCertificateFile</span> /etc/ssl/chat.ccatk.tw/pub.crt</span><br><span class="line">        <span class="attribute">SSLCertificateKeyFile</span> /etc/ssl/chat.ccatk.tw/private.key</span><br><span class="line"><span class="comment">#       SSLCertificateChainFile</span></span><br><span class="line">        <span class="attribute">Options</span> +FollowSymLinks</span><br><span class="line">        <span class="attribute">RewriteEngine</span> <span class="literal">on</span></span><br><span class="line">        <span class="attribute">RewriteCond</span>   <span class="variable">%&#123;HTTPS&#125;</span> !=<span class="literal">on</span></span><br><span class="line">        <span class="attribute">RewriteRule</span>   ^(.*)  https://<span class="variable">%&#123;SERVER_NAME&#125;</span>$<span class="number">1</span><span class="meta"> [L,R=301]</span></span><br><span class="line">        <span class="attribute">DirectoryIndex</span> index.php</span><br><span class="line">        <span class="attribute">ErrorLog</span> <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</span><br><span class="line">        <span class="attribute">CustomLog</span> <span class="variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined</span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span></span><br></pre></td></tr></table></figure><h3 id="简单静态网页托管"><a href="#简单静态网页托管" class="headerlink" title="简单静态网页托管"></a>简单静态网页托管</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;  </span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;  </span><br><span class="line">    <span class="section">location</span> / &#123; </span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html; </span><br><span class="line">    <span class="comment"># alias /usr/share/nginx/html; </span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简单文件目录浏览"><a href="#简单文件目录浏览" class="headerlink" title="简单文件目录浏览"></a>简单文件目录浏览</h3><ul><li>中文乱码 -&gt; <code>charset utf-8;</code></li></ul><ol><li>autoindex on;             //开启目录浏览功能；</li><li>autoindex_exact_size off; //关闭详细文件大小统计，让文件大小显示MB，GB单位，默认为b；</li><li>autoindex_localtime on;   //开启以服务器本地时区显示文件修改日期！<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /movie;</span><br><span class="line">    <span class="comment"># alias /usr/share/nginx/html;</span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="https静态页面托管"><a href="#https静态页面托管" class="headerlink" title="https静态页面托管"></a>https静态页面托管</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> blog.nchu-cn.tw;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">root</span> /www/hexo/;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/_.nchu-cn.tw.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/_.nchu-cn.tw.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1h</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>; </span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&quot;AES128+EECDH:AES128+EDH:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&quot;</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># HSTS (ngx_http_headers_module is required) (63072000 seconds)</span></span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=63072000&quot;</span> always;</span><br><span class="line">    <span class="comment"># OCSP stapling</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># verify chain of trust of OCSP response using Root CA and Intermediate certs</span></span><br><span class="line">    <span class="attribute">ssl_trusted_certificate</span> /etc/nginx/ssl/root_CA_cert_plus_intermediates;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> blog.nchu-cn.tw;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="密码访问"><a href="#密码访问" class="headerlink" title="密码访问"></a>密码访问</h3><blockquote><p>yum install httpd-tools               #适用centos<br>sudo apt-get install apache2-utils    #适用ubuntu</p></blockquote><ul><li>重点在于：<code>auth_basic &quot;movie:movie&quot;;auth_basic_user_file /movie/.htpasswd;</code></li></ul><h4 id="用户-amp-密码"><a href="#用户-amp-密码" class="headerlink" title="用户&amp;密码"></a>用户&amp;密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ htpasswd -c /var/www/html/.htpasswd user1  <span class="comment">#回车会要求输入两遍密码，会清除所有用户！</span></span><br><span class="line">$ htpasswd -bc /var/www/html/.htpasswd user1 password  <span class="comment">#不用回车，直接指定user1的密码为password</span></span><br><span class="line">$ htpasswd -b /var/www/html/.htpasswd user2 password   <span class="comment">#添加一个用户，如果用户已存在，则是修改密码</span></span><br><span class="line">$ htpasswd -D /var/www/html/.htpasswd user2  <span class="comment">#删除用户</span></span><br></pre></td></tr></table></figure><h4 id="conf"><a href="#conf" class="headerlink" title="conf"></a>conf</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> movie.iitii.me;</span><br><span class="line">    <span class="attribute">root</span> /movie/;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html movie.php;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/movie.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/movie.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/movie_error.log <span class="literal">debug</span>;</span><br><span class="line">    <span class="attribute">access_log</span>    /var/log/nginx/movie_accss.log;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">auth_basic</span> <span class="string">&quot;movie:movie&quot;</span>;</span><br><span class="line">        <span class="attribute">auth_basic_user_file</span> /movie/.htpasswd;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.0-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> movie.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PHP-动态网页托管（无-SSL）"><a href="#PHP-动态网页托管（无-SSL）" class="headerlink" title="PHP 动态网页托管（无 SSL）"></a>PHP 动态网页托管（无 SSL）</h3><blockquote><p>sudo apt-get install php-fpm php-mysql<br>vim /etc/php/7.0/fpm/php.ini<br>设置 cgi.fix_pathinfo=0<br>sudo systemctl restart php7.2-fpm</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/FileList;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PHP-SSL"><a href="#PHP-SSL" class="headerlink" title="PHP + SSL"></a>PHP + SSL</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">root</span> /var/www/FileList;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/ssl/mail.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/ssl/mail.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Another way</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/www.realyoung.cc/fullchain.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.realyoung.cc/privkey.pem;</span><br><span class="line">  <span class="attribute">server_name</span> www.realyoung.cc;</span><br><span class="line">  <span class="attribute">access_log</span> /data/wwwlogs/www.realyoung.cc_nginx.log combined;</span><br><span class="line">  <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">root</span> /data/wwwroot/www.realyoung.cc;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">include</span> /usr/local/nginx/conf/rewrite/wordpress.conf;</span><br><span class="line">  <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line">  <span class="comment">#error_page 502 /502.html;</span></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$ssl_protocol</span> = <span class="string">&quot;&quot;</span>) &#123; <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; &#125;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$host</span> != <span class="string">&quot;www.realyoung.cc&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://www.realyoung.cc/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ [^/]\.php(/|$)</span> &#123;</span><br><span class="line">    <span class="comment">#fastcgi_pass remote_php_ip:9000;</span></span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/dev/shm/php-cgi.sock;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ .*\.(js|css)?$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">7d</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-反代-node-js-负载均衡"><a href="#nginx-反代-node-js-负载均衡" class="headerlink" title="nginx 反代 node.js (负载均衡)"></a>nginx 反代 node.js (负载均衡)</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> node &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span>  _;</span><br><span class="line">    <span class="comment">#root   /xxx/xxx/hxxydexx/;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#set $my_server_name $scheme://$server_name; </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#if ( $my_server_name != https://$server_name ) &#123;</span></span><br><span class="line">    <span class="comment">#   rewrite ^ https://$server_name$request_uri? permanent;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/hyde_error.log    <span class="literal">error</span>;</span><br><span class="line">    <span class="comment">#access_log    /var/log/nginx/hyde_accss.log    main;</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host  <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Nginx-Proxy <span class="literal">true</span>;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 配置upstream节点</span></span><br><span class="line">        <span class="attribute">proxy_pass</span>    http://node;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="section">location</span> =  /xxx/xxx/40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">        <span class="section">location</span> =  /xxx/xxx/50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-反代-node-js-反代-HTTP-类型网站-负载均衡-ssl"><a href="#nginx-反代-node-js-反代-HTTP-类型网站-负载均衡-ssl" class="headerlink" title="nginx 反代 node.js (反代 HTTP 类型网站 + 负载均衡 + ssl)"></a>nginx 反代 node.js (反代 HTTP 类型网站 + 负载均衡 + ssl)</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> node &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl default_server;</span><br><span class="line">    <span class="attribute">server_name</span> dl.iitii.me;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#set $my_server_name $scheme://$server_name;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#if ( $my_server_name != https://$server_name ) &#123;</span></span><br><span class="line">    <span class="comment">#   rewrite ^ https://$server_name$request_uri? permanent;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/dl.iitii.me/dl.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/dl.iitii.me/dl.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/RemoteDl_error.log    <span class="literal">error</span>;</span><br><span class="line">    <span class="attribute">access_log</span>    /var/log/nginx/RemoteDl_accss.log;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host  <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Nginx-Proxy <span class="literal">true</span>;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 配置upstream节点</span></span><br><span class="line">        <span class="attribute">proxy_pass</span>    http://node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment"># error_page 404 /404.html;</span></span><br><span class="line">   <span class="comment">#     location =  /xxx/xxx/40x.html &#123;</span></span><br><span class="line">   <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#  error_page 500 502 503 504 /50x.html;</span></span><br><span class="line">  <span class="comment">#      location =  /xxx/xxx/50x.html &#123;</span></span><br><span class="line"> <span class="comment">#   &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> dl.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTPS-反代-（反代-HTTPS-类型网站-负载均衡-ssl）"><a href="#HTTPS-反代-（反代-HTTPS-类型网站-负载均衡-ssl）" class="headerlink" title="HTTPS 反代 （反代 HTTPS 类型网站 + 负载均衡 + ssl）"></a>HTTPS 反代 （反代 HTTPS 类型网站 + 负载均衡 + ssl）</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> iitii &#123;</span><br><span class="line">    <span class="attribute">server</span> openwrt.iitii.me:<span class="number">443</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;  </span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> china.iitii.me;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/nginx/ssl/china.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/china.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="comment">#error_log    /var/log/nginx/RemoteDl_error.log    error;</span></span><br><span class="line">    <span class="comment">#access_log    /var/log/nginx/RemoteDl_accss.log;</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://iitii;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real_IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> User-Agent <span class="variable">$http_user_agent</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Accept-Encoding <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTP-负载均衡"><a href="#HTTP-负载均衡" class="headerlink" title="HTTP 负载均衡"></a>HTTP 负载均衡</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123; </span><br><span class="line"> <span class="attribute">server</span> <span class="number">10.10.12.45:80</span> weight=<span class="number">1</span>; </span><br><span class="line"> <span class="attribute">server</span> app.example.com:<span class="number">80</span> weight=<span class="number">2</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">       <span class="section">location</span> / &#123; </span><br><span class="line">             <span class="attribute">proxy_pass</span> http://backend; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TCP负载平衡，如MySQL查询"><a href="#TCP负载平衡，如MySQL查询" class="headerlink" title="TCP负载平衡，如MySQL查询"></a>TCP负载平衡，如MySQL查询</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123; </span><br><span class="line"> <span class="section">upstream</span> mysql_read &#123; </span><br><span class="line"> <span class="attribute">server</span> read1.example.com:<span class="number">3306</span> weight=<span class="number">5</span>;</span><br><span class="line"><span class="attribute">server</span> read2.example.com:<span class="number">3306</span>; </span><br><span class="line"> <span class="attribute">server</span> <span class="number">10.10.12.34:3306</span> backup; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="section">server</span> &#123; </span><br><span class="line"> <span class="attribute">listen</span> <span class="number">3306</span>; </span><br><span class="line"> <span class="attribute">proxy_pass</span> mysql_read; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UDP负载平衡-如DNS查询"><a href="#UDP负载平衡-如DNS查询" class="headerlink" title="UDP负载平衡,如DNS查询"></a>UDP负载平衡,如DNS查询</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123; </span><br><span class="line"> <span class="section">upstream</span> ntp &#123; </span><br><span class="line"> <span class="attribute">server</span> ntp1.example.com:<span class="number">123</span> weight=<span class="number">2</span>; </span><br><span class="line"> <span class="attribute">server</span> ntp2.example.com:<span class="number">123</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="section">server</span> &#123; </span><br><span class="line">       <span class="attribute">listen</span> <span class="number">123</span> udp; </span><br><span class="line">       <span class="attribute">proxy_pass</span> ntp; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过geoIP来获取客户端的粗略地理位置"><a href="#通过geoIP来获取客户端的粗略地理位置" class="headerlink" title="通过geoIP来获取客户端的粗略地理位置"></a>通过geoIP来获取客户端的粗略地理位置</h3><blockquote><p><code>apt install nginx-module-geoip</code>  </p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">load_module</span> <span class="string">&quot;/usr/lib64/nginx/modules/ngx_http_geoip_module.so&quot;</span>; </span><br><span class="line"><span class="section">http</span> &#123; </span><br><span class="line"> <span class="attribute">geoip_country</span> /etc/nginx/geoip/GeoIP.dat;  </span><br><span class="line"> <span class="attribute">geoip_city</span> /etc/nginx/geoip/GeoLiteCity.dat; </span><br><span class="line">... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简单静态网页托管-1"><a href="#简单静态网页托管-1" class="headerlink" title="简单静态网页托管"></a>简单静态网页托管</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123; </span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;  </span><br><span class="line">    <span class="attribute">server_name</span> www.example.com;  </span><br><span class="line">    <span class="section">location</span> / &#123; </span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html; </span><br><span class="line">    <span class="comment"># alias /usr/share/nginx/html; </span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简单文件目录浏览-1"><a href="#简单文件目录浏览-1" class="headerlink" title="简单文件目录浏览"></a>简单文件目录浏览</h3><ul><li>中文乱码 -&gt; <code>charset utf-8;</code></li></ul><ol><li>autoindex on;             //开启目录浏览功能；</li><li>autoindex_exact_size off; //关闭详细文件大小统计，让文件大小显示MB，GB单位，默认为b；</li><li>autoindex_localtime on;   //开启以服务器本地时区显示文件修改日期！<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /movie;</span><br><span class="line">    <span class="comment"># alias /usr/share/nginx/html;</span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="https静态页面托管-1"><a href="#https静态页面托管-1" class="headerlink" title="https静态页面托管"></a>https静态页面托管</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> blog.nchu-cn.tw;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">root</span> /www/hexo/;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/_.nchu-cn.tw.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/_.nchu-cn.tw.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">1h</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:MozSSL:<span class="number">10m</span>; </span><br><span class="line">    <span class="attribute">ssl_session_tickets</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&quot;AES128+EECDH:AES128+EDH:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&quot;</span>;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># HSTS (ngx_http_headers_module is required) (63072000 seconds)</span></span><br><span class="line">    <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=63072000&quot;</span> always;</span><br><span class="line">    <span class="comment"># OCSP stapling</span></span><br><span class="line">    <span class="attribute">ssl_stapling</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_stapling_verify</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># verify chain of trust of OCSP response using Root CA and Intermediate certs</span></span><br><span class="line">    <span class="attribute">ssl_trusted_certificate</span> /etc/nginx/ssl/root_CA_cert_plus_intermediates;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> blog.nchu-cn.tw;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="密码访问-1"><a href="#密码访问-1" class="headerlink" title="密码访问"></a>密码访问</h3><blockquote><p>yum install httpd-tools               #适用centos<br>sudo apt-get install apache2-utils    #适用ubuntu</p></blockquote><ul><li>重点在于：<code>auth_basic &quot;movie:movie&quot;;auth_basic_user_file /movie/.htpasswd;</code></li></ul><h4 id="用户-amp-密码-1"><a href="#用户-amp-密码-1" class="headerlink" title="用户&amp;密码"></a>用户&amp;密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ htpasswd -c /var/www/html/.htpasswd user1  <span class="comment">#回车会要求输入两遍密码，会清除所有用户！</span></span><br><span class="line">$ htpasswd -bc /var/www/html/.htpasswd user1 password  <span class="comment">#不用回车，直接指定user1的密码为password</span></span><br><span class="line">$ htpasswd -b /var/www/html/.htpasswd user2 password   <span class="comment">#添加一个用户，如果用户已存在，则是修改密码</span></span><br><span class="line">$ htpasswd -D /var/www/html/.htpasswd user2  <span class="comment">#删除用户</span></span><br></pre></td></tr></table></figure><h4 id="conf-1"><a href="#conf-1" class="headerlink" title="conf"></a>conf</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> movie.iitii.me;</span><br><span class="line">    <span class="attribute">root</span> /movie/;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html movie.php;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/movie.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/movie.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/movie_error.log <span class="literal">debug</span>;</span><br><span class="line">    <span class="attribute">access_log</span>    /var/log/nginx/movie_accss.log;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">auth_basic</span> <span class="string">&quot;movie:movie&quot;</span>;</span><br><span class="line">        <span class="attribute">auth_basic_user_file</span> /movie/.htpasswd;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.0-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> movie.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PHP-动态网页托管（无-SSL）-1"><a href="#PHP-动态网页托管（无-SSL）-1" class="headerlink" title="PHP 动态网页托管（无 SSL）"></a>PHP 动态网页托管（无 SSL）</h3><blockquote><p>sudo apt-get install php-fpm php-mysql<br>vim /etc/php/7.0/fpm/php.ini<br>设置 cgi.fix_pathinfo=0<br>sudo systemctl restart php7.2-fpm</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /var/www/FileList;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PHP-SSL-1"><a href="#PHP-SSL-1" class="headerlink" title="PHP + SSL"></a>PHP + SSL</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">root</span> /var/www/FileList;</span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/ssl/mail.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/ssl/mail.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> snippets/fastcgi-php.conf;</span><br><span class="line">        <span class="attribute">fastcgi_pass</span> unix:/run/php/php7.2-fpm.sock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">        <span class="attribute">deny</span> all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mail.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Another way</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">  <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/www.realyoung.cc/fullchain.pem;</span><br><span class="line">  <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/www.realyoung.cc/privkey.pem;</span><br><span class="line">  <span class="attribute">server_name</span> www.realyoung.cc;</span><br><span class="line">  <span class="attribute">access_log</span> /data/wwwlogs/www.realyoung.cc_nginx.log combined;</span><br><span class="line">  <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">root</span> /data/wwwroot/www.realyoung.cc;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">include</span> /usr/local/nginx/conf/rewrite/wordpress.conf;</span><br><span class="line">  <span class="comment">#error_page 404 /404.html;</span></span><br><span class="line">  <span class="comment">#error_page 502 /502.html;</span></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$ssl_protocol</span> = <span class="string">&quot;&quot;</span>) &#123; <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; &#125;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$host</span> != <span class="string">&quot;www.realyoung.cc&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://www.realyoung.cc/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ [^/]\.php(/|$)</span> &#123;</span><br><span class="line">    <span class="comment">#fastcgi_pass remote_php_ip:9000;</span></span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/dev/shm/php-cgi.sock;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ .*\.(js|css)?$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">7d</span>;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="section">location</span> <span class="regexp">~ /\.ht</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-反代-node-js-负载均衡-1"><a href="#nginx-反代-node-js-负载均衡-1" class="headerlink" title="nginx 反代 node.js (负载均衡)"></a>nginx 反代 node.js (负载均衡)</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> node &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span>  _;</span><br><span class="line">    <span class="comment">#root   /xxx/xxx/hxxydexx/;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#set $my_server_name $scheme://$server_name; </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#if ( $my_server_name != https://$server_name ) &#123;</span></span><br><span class="line">    <span class="comment">#   rewrite ^ https://$server_name$request_uri? permanent;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/hyde_error.log    <span class="literal">error</span>;</span><br><span class="line">    <span class="comment">#access_log    /var/log/nginx/hyde_accss.log    main;</span></span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host  <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Nginx-Proxy <span class="literal">true</span>;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 配置upstream节点</span></span><br><span class="line">        <span class="attribute">proxy_pass</span>    http://node;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">        <span class="section">location</span> =  /xxx/xxx/40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">        <span class="section">location</span> =  /xxx/xxx/50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nginx-反代-node-js-反代-HTTP-类型网站-负载均衡-ssl-1"><a href="#nginx-反代-node-js-反代-HTTP-类型网站-负载均衡-ssl-1" class="headerlink" title="nginx 反代 node.js (反代 HTTP 类型网站 + 负载均衡 + ssl)"></a>nginx 反代 node.js (反代 HTTP 类型网站 + 负载均衡 + ssl)</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> node &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl default_server;</span><br><span class="line">    <span class="attribute">server_name</span> dl.iitii.me;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#set $my_server_name $scheme://$server_name;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#if ( $my_server_name != https://$server_name ) &#123;</span></span><br><span class="line">    <span class="comment">#   rewrite ^ https://$server_name$request_uri? permanent;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span>  /etc/nginx/ssl/dl.iitii.me/dl.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/dl.iitii.me/dl.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_log</span>    /var/log/nginx/RemoteDl_error.log    <span class="literal">error</span>;</span><br><span class="line">    <span class="attribute">access_log</span>    /var/log/nginx/RemoteDl_accss.log;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host  <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Nginx-Proxy <span class="literal">true</span>;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 配置upstream节点</span></span><br><span class="line">        <span class="attribute">proxy_pass</span>    http://node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment"># error_page 404 /404.html;</span></span><br><span class="line">   <span class="comment">#     location =  /xxx/xxx/40x.html &#123;</span></span><br><span class="line">   <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#  error_page 500 502 503 504 /50x.html;</span></span><br><span class="line">  <span class="comment">#      location =  /xxx/xxx/50x.html &#123;</span></span><br><span class="line"> <span class="comment">#   &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> dl.iitii.me;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTPS-反代-（反代-HTTPS-类型网站-负载均衡-ssl）-1"><a href="#HTTPS-反代-（反代-HTTPS-类型网站-负载均衡-ssl）-1" class="headerlink" title="HTTPS 反代 （反代 HTTPS 类型网站 + 负载均衡 + ssl）"></a>HTTPS 反代 （反代 HTTPS 类型网站 + 负载均衡 + ssl）</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> iitii &#123;</span><br><span class="line">    <span class="attribute">server</span> openwrt.iitii.me:<span class="number">443</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;  </span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> https://<span class="variable">$host</span><span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> china.iitii.me;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/nginx/ssl/china.iitii.me/pem.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/china.iitii.me/key.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="comment">#error_log    /var/log/nginx/RemoteDl_error.log    error;</span></span><br><span class="line">    <span class="comment">#access_log    /var/log/nginx/RemoteDl_accss.log;</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> https://iitii;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real_IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> User-Agent <span class="variable">$http_user_agent</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Accept-Encoding <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HTTP-负载均衡-1"><a href="#HTTP-负载均衡-1" class="headerlink" title="HTTP 负载均衡"></a>HTTP 负载均衡</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123; </span><br><span class="line"> <span class="attribute">server</span> <span class="number">10.10.12.45:80</span> weight=<span class="number">1</span>; </span><br><span class="line"> <span class="attribute">server</span> app.example.com:<span class="number">80</span> weight=<span class="number">2</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">       <span class="section">location</span> / &#123; </span><br><span class="line">             <span class="attribute">proxy_pass</span> http://backend; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TCP负载平衡，如MySQL查询-1"><a href="#TCP负载平衡，如MySQL查询-1" class="headerlink" title="TCP负载平衡，如MySQL查询"></a>TCP负载平衡，如MySQL查询</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123; </span><br><span class="line"> <span class="section">upstream</span> mysql_read &#123; </span><br><span class="line"> <span class="attribute">server</span> read1.example.com:<span class="number">3306</span> weight=<span class="number">5</span>;</span><br><span class="line"><span class="attribute">server</span> read2.example.com:<span class="number">3306</span>; </span><br><span class="line"> <span class="attribute">server</span> <span class="number">10.10.12.34:3306</span> backup; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="section">server</span> &#123; </span><br><span class="line"> <span class="attribute">listen</span> <span class="number">3306</span>; </span><br><span class="line"> <span class="attribute">proxy_pass</span> mysql_read; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UDP负载平衡-如DNS查询-1"><a href="#UDP负载平衡-如DNS查询-1" class="headerlink" title="UDP负载平衡,如DNS查询"></a>UDP负载平衡,如DNS查询</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123; </span><br><span class="line"> <span class="section">upstream</span> ntp &#123; </span><br><span class="line"> <span class="attribute">server</span> ntp1.example.com:<span class="number">123</span> weight=<span class="number">2</span>; </span><br><span class="line"> <span class="attribute">server</span> ntp2.example.com:<span class="number">123</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="section">server</span> &#123; </span><br><span class="line">       <span class="attribute">listen</span> <span class="number">123</span> udp; </span><br><span class="line">       <span class="attribute">proxy_pass</span> ntp; </span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过geoIP来获取客户端的粗略地理位置-1"><a href="#通过geoIP来获取客户端的粗略地理位置-1" class="headerlink" title="通过geoIP来获取客户端的粗略地理位置"></a>通过geoIP来获取客户端的粗略地理位置</h3><blockquote><p><code>apt install nginx-module-geoip</code>  </p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">load_module</span> <span class="string">&quot;/usr/lib64/nginx/modules/ngx_http_geoip_module.so&quot;</span>; </span><br><span class="line"><span class="section">http</span> &#123; </span><br><span class="line"> <span class="attribute">geoip_country</span> /etc/nginx/geoip/GeoIP.dat;  </span><br><span class="line"> <span class="attribute">geoip_city</span> /etc/nginx/geoip/GeoLiteCity.dat; </span><br><span class="line">... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WebServer </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> web server config </tag>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自建简易代理</title>
      <link href="/2019/03/17/1/"/>
      <url>/2019/03/17/1/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>智者建桥,愚者建墙 </p>            <i class="fa fa-quote-right"></i>          </blockquote><blockquote><p>实在不会的，可以 e-mail to <span class="exturl" data-url="bWFpbHRvOiYjeDYzOyYjOTk7JiN4NmQ7JiMxMDE7JiN4NmE7JiN4Nzg7JiN4NDA7JiMxMDM7JiN4NmQ7JiN4NjE7JiMxMDU7JiN4NmM7JiN4MmU7JiN4NjM7JiMxMTE7JiN4NmQ7">&#x63;&#99;&#x6d;&#101;&#x6a;&#x78;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#x6d;<i class="fa fa-external-link-alt"></i></span>，请求有偿帮助</p></blockquote><!--这都不会的，估计脑子有点问题--><div class="note danger">            <p>若链接失效，不考虑补链 </p>          </div>  <h3 id="为什么需要代理？"><a href="#为什么需要代理？" class="headerlink" title="为什么需要代理？"></a>为什么需要代理？</h3><!--沙雕问题，律师函警告--><center><img src="/images/shadiao.jpg" width=200px height=250px /><!--<p>破坏计算机信息系统罪</p>--></center><h3 id="滥用-代理会发生什么？"><a href="#滥用-代理会发生什么？" class="headerlink" title="滥用 代理会发生什么？"></a><strong>滥用</strong> 代理会发生什么？</h3><ul><li>喝茶</li></ul><h3 id="前提要求"><a href="#前提要求" class="headerlink" title="前提要求"></a>前提要求</h3><ul><li>有一台VPS</li><li></li><li>有基本文字阅读能力</li></ul><h3 id="连接VPS"><a href="#连接VPS" class="headerlink" title="连接VPS"></a>连接VPS</h3><ul><li>使用openssh,putty等进行连接</li><li>直接使用商家提供的console进行连接</li><li>特别注意，在输入密码的时候，终端无回显</li><li>实在不会的，可以 e-mail to <span class="exturl" data-url="bWFpbHRvOiYjOTk7JiN4NjM7JiN4NmQ7JiN4NjU7JiMxMDY7JiMxMjA7JiN4NDA7JiN4Njc7JiMxMDk7JiM5NzsmI3g2OTsmIzEwODsmI3gyZTsmI3g2MzsmIzExMTsmI3g2ZDs=">&#99;&#x63;&#x6d;&#x65;&#106;&#120;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;<i class="fa fa-external-link-alt"></i></span>，请求有偿帮助</li></ul><!--这都不会的，估计脑子有点问题--><h3 id="常用代理搭建方式"><a href="#常用代理搭建方式" class="headerlink" title="常用代理搭建方式"></a>常用代理搭建方式</h3><blockquote><p>声明：ssr, ss, mtproxy一键脚本均采用逗比的一键脚本</p></blockquote><h4 id="v2ray"><a href="#v2ray" class="headerlink" title="v2ray"></a>v2ray</h4><blockquote><p>v2ray内建支持 Mtproxy</p></blockquote><h5 id="官方go脚本"><a href="#官方go脚本" class="headerlink" title="官方go脚本"></a>官方go脚本</h5><blockquote><p>安装：<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s https://install.direct/go.sh)  </span><br></pre></td></tr></table></figure></p></blockquote><p>使用官方脚本可以参考以下步骤：</p><blockquote><p>不清楚的请使用一键脚本  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L -s https://install.direct/go.sh)  </span><br><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/IITII/Useless/master/v2ray-config.json</span><br><span class="line"><span class="built_in">mv</span> ./v2ray-config.json /etc/v2ray/config.json</span><br><span class="line">systemctl restart v2ray &amp;&amp; systemctl status v2ray</span><br></pre></td></tr></table></figure><h5 id="multi-v2ray一键脚本"><a href="#multi-v2ray一键脚本" class="headerlink" title="multi-v2ray一键脚本"></a><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0pyb2h5L211bHRpLXYycmF5">multi-v2ray<i class="fa fa-external-link-alt"></i></span>一键脚本</h5><h6 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h6><ul><li>V2ray &amp;&amp; Iptables 流量分析</li><li>多端口与用户管理</li><li>动态端口</li><li>禁止BT</li><li>Range port</li><li>TcpFastOpen</li><li>Vmess/Socks5/MTproto 链接分享</li><li>支持的协议类型:<ul><li>TCP</li><li>Fake http</li><li>WebSocket</li><li>mkcp</li><li>mKCP + srtp</li><li>mKCP + utp</li><li>mKCP + wechat-video</li><li>mKCP + dtls</li><li>mKCP + wireguard</li><li>HTTP/2</li><li>Socks5</li><li>MTProto</li><li>Shadowsocks</li><li>Quic</li></ul></li></ul><h6 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h6><p>new install</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &lt;(curl -sL https://git.io/fNgqx)</span><br></pre></td></tr></table></figure><p>keep profile to update</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &lt;(curl -sL https://git.io/fNgqx) -k</span><br></pre></td></tr></table></figure><p>uninstall</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &lt;(curl -sL https://git.io/fNgqx) --remove</span><br></pre></td></tr></table></figure><h4 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h4><ul><li>支持 限制 用户速度</li><li>支持 限制 端口设备数</li><li>支持 显示 当前连接IP</li><li>支持 显示 SS/SSR连接+二维码</li><li>支持 切换管理 单/多端口</li><li>支持 一键安装 锐速</li><li>支持 一键安装 BBR</li><li>支持 一键封禁 垃圾邮件(SMAP)/BT/PT  </li></ul><p>下载安装：</p><p>单用户：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh  </span><br></pre></td></tr></table></figure><p>多用户：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/ssrmu.sh &amp;&amp; chmod +x ssrmu.sh &amp;&amp; bash ssrmu.sh</span><br></pre></td></tr></table></figure><h4 id="SS"><a href="#SS" class="headerlink" title="SS"></a>SS</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/ss-go.sh &amp;&amp; chmod +x ss-go.sh &amp;&amp; bash ss-go.sh</span><br></pre></td></tr></table></figure><h4 id="Mtproxy"><a href="#Mtproxy" class="headerlink" title="Mtproxy"></a>Mtproxy</h4><p>一般版本：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/mtproxy.sh &amp;&amp; chmod +x mtproxy.sh &amp;&amp; bash mtproxy.sh  </span><br></pre></td></tr></table></figure><p>Go语言版本：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/mtproxy_go.sh &amp;&amp; chmod +x mtproxy_go.sh &amp;&amp; bash mtproxy_go.sh</span><br></pre></td></tr></table></figure><h4 id="BBR"><a href="#BBR" class="headerlink" title="BBR"></a>BBR</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubiBackup/doubi/master/bbr.sh &amp;&amp; chmod +x bbr.sh &amp;&amp; bash bbr.sh</span><br></pre></td></tr></table></figure><h3 id="生成属于自己的订阅"><a href="#生成属于自己的订阅" class="headerlink" title="生成属于自己的订阅"></a>生成属于自己的订阅</h3><ul><li>可以参考我这篇博文：<a href="https://iitii.github.io/2019/01/22/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E8%AE%A2%E9%98%85/">搭建个人订阅</a></li></ul><h3 id="关于代理的使用与常见问题的汇总"><a href="#关于代理的使用与常见问题的汇总" class="headerlink" title="关于代理的使用与常见问题的汇总"></a>关于代理的使用与常见问题的汇总</h3><ul><li>参见：<span class="exturl" data-url="aHR0cHM6Ly9tb2UuYmVzdC90dXRvcmlhbC9zaGFkb3dzb2Nrc3IuaHRtbA==">[ShadowsocksR] 大概是萌新也看得懂的SSR功能详细介绍&amp;使用教程<i class="fa fa-external-link-alt"></i></span></li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul><li>goproxy</li><li>frp</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FuYW5ra2Uvc3MtcGFuZWwtdjMtbW9kX1VpbQ==">ss panel v3 mod<i class="fa fa-external-link-alt"></i></span></li></ul><p>可以参考我这篇博文：<a href="https://iitii.github.io/2019/02/13/1/">内网穿透</a></p><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>无知亦无得 </p>            <i class="fa fa-quote-right"></i>          </blockquote>]]></content>
      
      
      <categories>
          
          <category> proxy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo跳过指定文件的渲染</title>
      <link href="/2019/02/15/1/"/>
      <url>/2019/02/15/1/</url>
      
        <content type="html"><![CDATA[<h3 id="关于hexo的-config-yml配置，官方文档中："><a href="#关于hexo的-config-yml配置，官方文档中：" class="headerlink" title="关于hexo的_config.yml配置，官方文档中："></a>关于hexo的<code>_config.yml</code>配置，官方文档中：</h3><ul><li>skip_render：跳过指定文件的渲染，您可使用 <code>glob</code> 表达式来匹配路径。 <ol><li>未说明具体该怎么配置  </li><li>修改的<code>_config.yml</code>配置文件应为站点文件夹下的，而非主题文件夹下的<code>_config.yml</code>配置文件  </li><li>可以直接 <em><code>Ctrl + F</code></em> 查找 <code>skip_render</code> 关键字</li></ol></li></ul><h3 id="跳过单文件"><a href="#跳过单文件" class="headerlink" title="跳过单文件"></a>跳过单文件</h3><ul><li>如果要跳过source文件夹下的test.html，可以这样配置：  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> <span class="string">test.html</span></span><br></pre></td></tr></table></figure>  or  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> [<span class="string">test.html</span>]</span><br></pre></td></tr></table></figure><blockquote><p>注意，千万不要手贱加上个/写成/test.html，这里只能填相对于source文件夹的相对路径。</p></blockquote></li></ul><h3 id="跳过多文件"><a href="#跳过多文件" class="headerlink" title="跳过多文件"></a>跳过多文件</h3><ol><li><p>如果要忽略source下的test文件夹下所有文件，可以这样配置：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> <span class="string">test/*</span></span><br></pre></td></tr></table></figure><p> or</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> [<span class="string">test/*</span>]</span><br></pre></td></tr></table></figure></li><li><p>如果要忽略source下的test文件夹下.html文件，可以这样配置：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> <span class="string">test/*.html</span></span><br></pre></td></tr></table></figure><p> or</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> [<span class="string">test/*.html</span>]</span><br></pre></td></tr></table></figure></li><li><p>如果要忽略source下的test文件夹下所有文件和目录，可以这样配置：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> <span class="string">test/**</span></span><br></pre></td></tr></table></figure><p> or</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> [<span class="string">test/**</span>]</span><br></pre></td></tr></table></figure></li><li><p>如果要忽略多个路径的文件或目录，可以这样配置：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">test.html</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;*.html&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">test/**</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">test/*</span></span><br></pre></td></tr></table></figure><p> or</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">skip_render:</span> [<span class="string">test.html</span>, <span class="string">&#x27;*.html&#x27;</span>, <span class="string">test/**</span>, <span class="string">test/*</span>]</span><br></pre></td></tr></table></figure><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3></li></ol><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcy8xMTQ2">如何不处理source目录下某个子目录的所有文件，仅仅是将其copy到public目录中对应目录？<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网穿透</title>
      <link href="/2019/02/13/1/"/>
      <url>/2019/02/13/1/</url>
      
        <content type="html"><![CDATA[<blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <p>梦一场 </p>            <i class="fa fa-quote-right"></i>          </blockquote><hr><ul><li><em>Update at Sat May 11 16:49:47 CST 2019</em><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9saWFtLnBhZ2UvMjAxOC8wNC8xMS9icmVhay1maXJld2FsbC1ieS10aGUtdXNlLW9mLVNTSC10dW5uZWwv">利用正反 SSH 隧道穿透防火墙访问内网服务器<i class="fa fa-external-link-alt"></i></span></p></blockquote></li></ul><hr><h3 id="Announce"><a href="#Announce" class="headerlink" title="Announce:"></a>Announce:</h3><ol><li>工具：实现内网穿透，我目前比较推荐frp和goproxy</li><li>Github: frp: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycA==">https://github.com/fatedier/frp<i class="fa fa-external-link-alt"></i></span> </li><li>Github: goproxy: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NuYWlsMDA3L2dvcHJveHk=">https://github.com/snail007/goproxy<i class="fa fa-external-link-alt"></i></span></li><li>frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。</li><li>goproxy是基于golang实现的高性能http,https,websocket,tcp,udp,socks5,ss代理服务器,支持正向代理、反向代理、透明代理、内网穿透、TCP/UDP端口映射、SSH中转、TLS加密传输、协议转换、防污染DNS代理。</li><li>对于内网穿透来说frp比goproxy更功能更多，goproxy更偏向于网络代理</li><li>goproxy内置了长驻后台的功能，如果想后台运行proxy,命令行可以关闭,只需要在命令最后加上<code>--daemon</code>参数即可。如果想防止应用异常退出，可以使用<code>--forever</code>参数，proxy会fork子进程,然后监控子进程,如果子进程异常退出,5秒后重启子进程，该参数配合后台运行参数<code>--daemon</code>和日志参数<code>--log</code>,可以保障proxy一直在后台执行不会因为意外退出,而且可以通过日志文件看到proxy的输出日志内容</li></ol><h3 id="Goproxy"><a href="#Goproxy" class="headerlink" title="Goproxy"></a>Goproxy</h3><h4 id="下载-amp-安装"><a href="#下载-amp-安装" class="headerlink" title="下载 &amp; 安装"></a>下载 &amp; 安装</h4><h5 id="自动安装"><a href="#自动安装" class="headerlink" title="自动安装"></a>自动安装</h5><ul><li>如果你的VPS是linux64位的系统,那么只需要执行下面一句,就可以完成自动安装和配置    <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.githubusercontent.com/snail007/goproxy/master/install_auto.sh | bash  </span><br></pre></td></tr></table></figure><blockquote><p>安装完成,配置目录是/etc/proxy,更详细的使用方法请参考手册目录,进一步了解你想要使用的功能.<br>如果安装失败或者你的vps不是linux64位系统,请按照下面的半自动步骤安装:  </p></blockquote></li></ul><h5 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h5><ol><li><p>下载proxy<br>下载地址: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NuYWlsMDA3L2dvcHJveHkvcmVsZWFzZXMvbGF0ZXN0">https://github.com/snail007/goproxy/releases/latest<i class="fa fa-external-link-alt"></i></span><br>下面以v6.2为例,如果有最新版,请使用最新版链接.   </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /root/proxy/  </span><br><span class="line">wget https://github.com/snail007/goproxy/releases/download/v6.2/proxy-linux-amd64.tar.gz  </span><br></pre></td></tr></table></figure></li><li><p>下载自动安装脚本</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root/proxy/  </span><br><span class="line">wget https://raw.githubusercontent.com/snail007/goproxy/master/install.sh </span><br><span class="line">chmod +x install.sh  </span><br><span class="line">./install.sh  </span><br></pre></td></tr></table></figure></li></ol><h5 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h5><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL3NuYWlsMDA3L2dvcHJveHk=">docker<i class="fa fa-external-link-alt"></i></span>  </p></li><li><p>项目根目录的Dockerfile文件用来构建,使用golang 1.10.3,构建基于goproxy的master分支最新版本,  </p></li><li><p>全部大小17.3MB,默认情况下使用master分支,不过可以通过修改配置文件Dockerfile<br>或者使用参数GOPROXY_VERSION指定构建的goproxy版本. </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARG GOPROXY_VERSION=v5.3</span><br></pre></td></tr></table></figure></li></ul><p>步骤:  </p><ol><li><p>克隆仓库,然后cd进入仓库文件夹,执行:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker build .</span><br></pre></td></tr></table></figure></li><li><p>镜像打标签:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker tag &lt;上一步的结果ID&gt; snail007/goproxy:latest</span><br></pre></td></tr></table></figure></li><li><p>运行<br>参数OPTS的值就是传递给proxy的所有参数<br>比如下面的例子启动了一个http服务:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --restart=always --name goproxy -e OPTS=&quot;http -p :33080&quot; -p 33080:33080 snail007/goproxy:latest</span><br></pre></td></tr></table></figure></li><li><p>查看日志:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker logs -f goproxy</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>Windows 直接下载 <code>*.exe</code> 版就行了</p></blockquote><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><blockquote><p>http,tcp,udp代理过程会和上级通讯,为了安全我们采用加密通讯,当然可以选择不加密通信通讯,本教程所有和上级通讯都采用加密,需要证书文件.<br>通过下面的命令生成自签名的证书和key文件。<code>proxy keygen -C proxy</code>  </p></blockquote><h5 id="TCP普通用法"><a href="#TCP普通用法" class="headerlink" title="TCP普通用法"></a>TCP普通用法</h5><ul><li>需求：可以通过服务器的28080端口访问到位于本地服务器上的web服务</li><li>条件：<ul><li>本地机器A提供了web服务80端口  </li></ul><ul><li>有VPS一个,公网IP:22.22.22.22</li></ul></li></ul><ul><li>步骤：  <ol><li>在vps上执行     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy bridge -p <span class="string">&quot;:33080&quot;</span> -C proxy.crt -K proxy.key</span><br><span class="line">proxy server -r <span class="string">&quot;:28080@:80&quot;</span> -P <span class="string">&quot;127.0.0.1:33080&quot;</span> -C proxy.crt -K proxy.key  </span><br></pre></td></tr></table></figure></li><li>在本地机器A上面执行     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy client -P <span class="string">&quot;22.22.22.22:33080&quot;</span> -C proxy.crt -K proxy.key` </span><br></pre></td></tr></table></figure></li><li>完成  </li></ol></li></ul><h5 id="UDP普通用法"><a href="#UDP普通用法" class="headerlink" title="UDP普通用法"></a>UDP普通用法</h5><ul><li><p>背景:  </p><ul><li>公司机器A提供了DNS解析服务,UDP:53端口  </li><li>有VPS一个,公网IP:22.22.22.22  </li></ul></li><li><p>需求:<br>  在家里能够通过设置本地dns为22.22.22.22,使用公司机器A进行域名解析服务.  </p></li><li><p>步骤:  </p><ol><li><p>在vps上执行 </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy bridge -p <span class="string">&quot;:33080&quot;</span> -C proxy.crt -K proxy.key</span><br><span class="line">proxy server --udp -r <span class="string">&quot;:53@:53&quot;</span> -P <span class="string">&quot;127.0.0.1:33080&quot;</span> -C proxy.crt -K proxy.key</span><br></pre></td></tr></table></figure></li><li><p>在公司机器A上面执行 </p>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy client -P <span class="string">&quot;22.22.22.22:33080&quot;</span> -C proxy.crt -K proxy.key</span><br></pre></td></tr></table></figure></li><li><p>完成    </p></li></ol></li></ul><h3 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h3><h4 id="下载-amp-安装-1"><a href="#下载-amp-安装-1" class="headerlink" title="下载 &amp; 安装"></a>下载 &amp; 安装</h4><ul><li><p>根据对应的操作系统及架构，从 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9yZWxlYXNlcw==">Release<i class="fa fa-external-link-alt"></i></span> 页面下载最新版本的程序。</p></li><li><p>将 <strong>frps</strong> 及 <strong>frps.ini</strong> 放到具有公网 IP 的机器上。</p></li><li><p>将 <strong>frpc</strong> 及 <strong>frpc.ini</strong> 放到处于内网环境的机器上。</p></li></ul><h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><hr><p><strong>Contents</strong></p><!-- no toc --><ul><li><a href="#%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E9%83%A8%E7%BD%B2%E4%BA%8E%E5%86%85%E7%BD%91%E7%9A%84web%E6%9C%8D%E5%8A%A1">通过自定义域名访问部署于内网的web服务</a></li><li><a href="#%E9%80%9A%E8%BF%87ssh%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">通过ssh访问内网机器</a></li><li><a href="#%E8%BD%AC%E5%8F%91DNS%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82">转发DNS查询请求</a></li><li><a href="#%E5%AF%B9%E5%A4%96%E6%8F%90%E4%BE%9B%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1">对外提供简单的文件访问服务</a></li><li><a href="#%E5%AE%89%E5%85%A8%E5%9C%B0%E6%9A%B4%E9%9C%B2%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1">安全地暴露内网服务</a></li><li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F">点对点内网穿透</a></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ul><hr><h5 id="通过自定义域名访问部署于内网的web服务"><a href="#通过自定义域名访问部署于内网的web服务" class="headerlink" title="通过自定义域名访问部署于内网的web服务"></a>通过自定义域名访问部署于内网的web服务</h5><p>有时想要让其他人通过域名访问或者测试我们在本地搭建的 web 服务，但是由于本地机器没有公网 IP，无法将域名解析到本地的机器，通过 frp 就可以实现这一功能，以下示例为 http 服务，https 服务配置方法相同， vhost_http_port 替换为 vhost_https_port， type 设置为 https 即可。</p><ol><li><p>修改 frps.ini 文件，设置 http 访问端口为 8080：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">8080</span></span><br></pre></td></tr></table></figure></li><li><p>启动 frps；</p><p> <code>./frps -c ./frps.ini</code></p></li><li><p>修改 frpc.ini 文件，假设 frps 所在的服务器的 IP 为 x.x.x.x，local_port 为本地机器上 web 服务对应的端口, 绑定自定义域名 <code>www.yourdomain.com</code>:</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">custom_domains</span> = www.yourdomain.com</span><br></pre></td></tr></table></figure></li><li><p>启动 frpc：</p><p> <code>./frpc -c ./frpc.ini</code></p></li><li><p>将 <code>www.yourdomain.com</code> 的域名 A 记录解析到 IP <code>x.x.x.x</code>，如果服务器已经有对应的域名，也可以将 CNAME 记录解析到服务器原先的域名。</p></li><li><p>通过浏览器访问 <code>http://www.yourdomain.com:8080</code> 即可访问到处于内网机器上的 web 服务。</p></li></ol><h5 id="通过ssh访问内网机器"><a href="#通过ssh访问内网机器" class="headerlink" title="通过ssh访问内网机器"></a>通过ssh访问内网机器</h5><ol><li><p>修改 frps.ini 文件，这里使用了最简化的配置：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br></pre></td></tr></table></figure></li><li><p>启动 frps：</p><p> <code>./frps -c ./frps.ini</code></p></li><li><p>修改 frpc.ini 文件，假设 frps 所在服务器的公网 IP 为 x.x.x.x；</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure></li><li><p>启动 frpc：</p><p> <code>./frpc -c ./frpc.ini</code></p></li><li><p>通过 ssh 访问内网机器，假设用户名为 test：</p><p> <code>ssh -oPort=6000 test@x.x.x.x</code></p></li></ol><h5 id="转发DNS查询请求"><a href="#转发DNS查询请求" class="headerlink" title="转发DNS查询请求"></a>转发DNS查询请求</h5><p>DNS 查询请求通常使用 UDP 协议，frp 支持对内网 UDP 服务的穿透，配置方式和 TCP 基本一致。</p><ol><li><p><a href="#%E9%80%9A%E8%BF%87ssh%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">frps 的部署步骤同上。</a></p></li><li><p>启动 frps：</p><p> <code>./frps -c ./frps.ini</code></p></li><li><p>修改 frpc.ini 文件，设置 frps 所在服务器的 IP 为 x.x.x.x，转发到 Google 的 DNS 查询服务器 <code>8.8.8.8</code> 的 udp 53 端口：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dns]</span></span><br><span class="line"><span class="attr">type</span> = udp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">53</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure></li><li><p>启动 frpc：</p><p> <code>./frpc -c ./frpc.ini</code></p></li><li><p>通过 dig 测试 UDP 包转发是否成功，预期会返回 <code>www.google.com</code> 域名的解析结果：</p><p> <code>dig @x.x.x.x -p 6000 www.google.com</code></p></li></ol><h5 id="对外提供简单的文件访问服务"><a href="#对外提供简单的文件访问服务" class="headerlink" title="对外提供简单的文件访问服务"></a>对外提供简单的文件访问服务</h5><ul><li><p>通过 <code>static_file</code> 插件可以对外提供一个简单的基于 HTTP 的文件访问服务。</p></li><li><p><a href="#%E9%80%9A%E8%BF%87ssh%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">frps 的部署步骤同上。</a></p><ol><li>启动 frpc，启用 <code>static_file</code> 插件，配置如下：</li></ol>  <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[test_static_file]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br><span class="line"><span class="attr">plugin</span> = static_file</span><br><span class="line"><span class="comment"># 要对外暴露的文件目录</span></span><br><span class="line"><span class="attr">plugin_local_path</span> = /tmp/file</span><br><span class="line"><span class="comment"># 访问 url 中会被去除的前缀，保留的内容即为要访问的文件路径</span></span><br><span class="line"><span class="attr">plugin_strip_prefix</span> = static</span><br><span class="line"><span class="attr">plugin_http_user</span> = abc</span><br><span class="line"><span class="attr">plugin_http_passwd</span> = abc</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>通过浏览器访问 <code>http://x.x.x.x:6000/static/</code> 来查看位于 <code>/tmp/file</code> 目录下的文件，会要求输入已设置好的用户名和密码。</li></ol><h5 id="安全地暴露内网服务"><a href="#安全地暴露内网服务" class="headerlink" title="安全地暴露内网服务"></a>安全地暴露内网服务</h5><ul><li><p>对于某些服务来说如果直接暴露于公网上将会存在安全隐患。</p></li><li><p>使用 <strong>stcp(secret tcp)</strong> 类型的代理可以避免让任何人都能访问到要穿透的服务，但是访问者也需要运行另外一个 frpc。</p></li><li><p>以下示例将会创建一个只有自己能访问到的 ssh 服务代理。</p><ul><li><a href="#%E9%80%9A%E8%BF%87ssh%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">frps 的部署步骤同上。</a></li></ul><ol><li><p>启动 frpc，转发内网的 ssh 服务，配置如下，不需要指定远程端口：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[secret_ssh]</span></span><br><span class="line"><span class="attr">type</span> = stcp</span><br><span class="line"><span class="comment"># 只有 sk 一致的用户才能访问到此服务</span></span><br><span class="line"><span class="attr">sk</span> = abcdefg</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br></pre></td></tr></table></figure></li><li><p>在要访问这个服务的机器上启动另外一个 frpc，配置如下：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[secret_ssh_visitor]</span></span><br><span class="line"><span class="attr">type</span> = stcp</span><br><span class="line"><span class="comment"># stcp 的访问者</span></span><br><span class="line"><span class="attr">role</span> = visitor</span><br><span class="line"><span class="comment"># 要访问的 stcp 代理的名字</span></span><br><span class="line"><span class="attr">server_name</span> = secret_ssh</span><br><span class="line"><span class="attr">sk</span> = abcdefg</span><br><span class="line"><span class="comment"># 绑定本地端口用于访问 ssh 服务</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure></li><li><p>通过 ssh 访问内网机器，假设用户名为 test：</p><p> <code>ssh -oPort=6000 test@127.0.0.1</code></p></li></ol></li></ul><h5 id="点对点内网穿透"><a href="#点对点内网穿透" class="headerlink" title="点对点内网穿透"></a>点对点内网穿透</h5><ul><li><p>frp 提供了一种新的代理类型 <strong>xtcp</strong> 用于应对在希望传输大量数据且流量不经过服务器的场景。</p></li><li><p>使用方式同 <strong>stcp</strong> 类似，需要在两边都部署上 frpc 用于建立直接的连接。</p></li><li><p>目前处于开发的初级阶段，并不能穿透所有类型的 NAT 设备，所以穿透成功率较低。穿透失败时可以尝试 <strong>stcp</strong> 的方式。</p><ol><li><p>frps 除正常配置外需要额外配置一个 udp 端口用于支持该类型的客户端:</p>   <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frps.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">bind_udp_port</span> = <span class="number">7001</span></span><br></pre></td></tr></table></figure></li><li><p>启动 frpc，转发内网的 ssh 服务，配置如下，不需要指定远程端口:</p>   <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[p2p_ssh]</span></span><br><span class="line"><span class="attr">type</span> = xtcp</span><br><span class="line"><span class="comment"># 只有 sk 一致的用户才能访问到此服务</span></span><br><span class="line"><span class="attr">sk</span> = abcdefg</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br></pre></td></tr></table></figure></li><li><p>在要访问这个服务的机器上启动另外一个 frpc，配置如下:</p>   <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frpc.ini</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = x.x.x.x</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[p2p_ssh_visitor]</span></span><br><span class="line"><span class="attr">type</span> = xtcp</span><br><span class="line"><span class="comment"># xtcp 的访问者</span></span><br><span class="line"><span class="attr">role</span> = visitor</span><br><span class="line"><span class="comment"># 要访问的 xtcp 代理的名字</span></span><br><span class="line"><span class="attr">server_name</span> = p2p_ssh</span><br><span class="line"><span class="attr">sk</span> = abcdefg</span><br><span class="line"><span class="comment"># 绑定本地端口用于访问 ssh 服务</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">6000</span></span><br></pre></td></tr></table></figure></li><li><p>通过 ssh 访问内网机器，假设用户名为 test:</p><p>   <code>ssh -oPort=6000 test@127.0.0.1</code></p></li></ol></li></ul><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><ol><li><p>如果我们想要frp承载TCP类型的流量，可以参考 <a href="#%E9%80%9A%E8%BF%87ssh%E8%AE%BF%E9%97%AE%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8">通过ssh访问内网机器</a>，只需要将<code>frpc</code>配置文件里面的端口修改为需要进行代理的端口就行了。再将第6行修改一下就行了，中括号里面内容虽然可以随意填，但是为了鲜明，最好<strong>认真命名</strong>。</p></li><li><p>UDP可以参考 <a href="#%E8%BD%AC%E5%8F%91DNS%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82">转发DNS查询请求</a></p></li></ol><hr><blockquote><p>frp 配置文件支持使用系统环境变量进行模版渲染，模版格式采用 Go 的标准格式。<br>由于 frp 目前支持的功能和配置项较多，未在文档中列出的功能可以从完整的示例配置文件中发现。  </p></blockquote><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9ibG9iL21hc3Rlci9jb25mL2ZycHNfZnVsbC5pbmk=">frps 完整配置文件<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9ibG9iL21hc3Rlci9jb25mL2ZycGNfZnVsbC5pbmk=">frpc 完整配置文件<i class="fa fa-external-link-alt"></i></span>  </li></ul><hr><h3 id="参见"><a href="#参见" class="headerlink" title="参见"></a>参见</h3><ol><li>frp README: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9ibG9iL21hc3Rlci9SRUFETUVfemgubWQ=">https://github.com/fatedier/frp/blob/master/README.md<i class="fa fa-external-link-alt"></i></span></li><li>goproxy README: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NuYWlsMDA3L2dvcHJveHkvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k">https://github.com/snail007/goproxy/blob/master/README.md<i class="fa fa-external-link-alt"></i></span></li></ol><blockquote class="blockquote-center">            <i class="fa fa-quote-left"></i>            <img alt="2019年情人节" height="33" src="/images/valentines-day-2019-4848332248711168-s.png" title="2019年情人节" width="92" border="0" onload="window.lol&amp;&amp;lol()" data-atf="3">            <i class="fa fa-quote-right"></i>          </blockquote>]]></content>
      
      
      <categories>
          
          <category> proxy </category>
          
          <category> network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> proxy </tag>
            
            <tag> goproxy </tag>
            
            <tag> frp </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于本博客的搭建</title>
      <link href="/2019/02/04/1/"/>
      <url>/2019/02/04/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>劝退三连，不推荐新手尝试，新手请用<span class="exturl" data-url="aHR0cHM6Ly9jbi53b3JkcHJlc3Mub3JnLw==">WordPress<i class="fa fa-external-link-alt"></i></span>，<span class="exturl" data-url="aHR0cDovL3R5cGVjaG8ub3JnLw==">Typecho<i class="fa fa-external-link-alt"></i></span>等动态博客建站，不想折腾的可以使用国内现成平台，如： <del>CSDN（广告比名气多，个人看法）</del>，<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20v">简书<i class="fa fa-external-link-alt"></i></span> </p></blockquote><hr><h3 id="1-现成的轮子"><a href="#1-现成的轮子" class="headerlink" title="1. 现成的轮子"></a>1. 现成的轮子</h3><h4 id="1-Hexo官方文档"><a href="#1-Hexo官方文档" class="headerlink" title="1. Hexo官方文档"></a>1. <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL3poLWNuL2RvY3Mv">Hexo官方文档<i class="fa fa-external-link-alt"></i></span></h4><h4 id="2-NexT主题文档"><a href="#2-NexT主题文档" class="headerlink" title="2. NexT主题文档"></a>2. <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lmlpc3NuYW4uY29tL3RoZW1lLXNldHRpbmdzLmh0bWw=">NexT主题文档<i class="fa fa-external-link-alt"></i></span></h4><h4 id="3-Hexo搭建博客教程-lt-–-Hexo博客搭建教程里面这个可以说是非常详细了"><a href="#3-Hexo搭建博客教程-lt-–-Hexo博客搭建教程里面这个可以说是非常详细了" class="headerlink" title="3. Hexo搭建博客教程 &lt;– Hexo博客搭建教程里面这个可以说是非常详细了"></a>3. <span class="exturl" data-url="aHR0cHM6Ly90aGllZi5vbmUvMjAxNy8wMy8wMy9IZXhvJUU2JTkwJUFEJUU1JUJCJUJBJUU1JThEJTlBJUU1JUFFJUEyJUU2JTk1JTk5JUU3JUE4JThCLw==">Hexo搭建博客教程<i class="fa fa-external-link-alt"></i></span> &lt;– Hexo博客搭建教程里面这个可以说是非常详细了</h4><h4 id="4-Hexo-Next搭建个人博客（添加统计访客量以及文章阅读量）"><a href="#4-Hexo-Next搭建个人博客（添加统计访客量以及文章阅读量）" class="headerlink" title="4. Hexo-Next搭建个人博客（添加统计访客量以及文章阅读量）"></a>4. <span class="exturl" data-url="aHR0cHM6Ly95Znpob3UuY29kaW5nLm1lLzIwMTgvMDgvMDgvSGV4by1OZXh0JUU2JTkwJUFEJUU1JUJCJUJBJUU0JUI4JUFBJUU0JUJBJUJBJUU1JThEJTlBJUU1JUFFJUEyJUVGJUJDJTg4JUU2JUI3JUJCJUU1JThBJUEwJUU3JUJCJTlGJUU4JUFFJUExJUU4JUFFJUJGJUU1JUFFJUEyJUU5JTg3JThGJUU0JUJCJUE1JUU1JThGJThBJUU2JTk2JTg3JUU3JUFCJUEwJUU5JTk4JTg1JUU4JUFGJUJCJUU5JTg3JThGJUVGJUJDJTg5Lw==">Hexo-Next搭建个人博客（添加统计访客量以及文章阅读量）<i class="fa fa-external-link-alt"></i></span></h4><h4 id="4-图标下载-easyicon"><a href="#4-图标下载-easyicon" class="headerlink" title="4. 图标下载 easyicon"></a>4. <span class="exturl" data-url="aHR0cHM6Ly93d3cuZWFzeWljb24ubmV0Lw==">图标下载 easyicon<i class="fa fa-external-link-alt"></i></span></h4><h4 id="6-Leancloud访客统计插件重大安全漏洞修复指南"><a href="#6-Leancloud访客统计插件重大安全漏洞修复指南" class="headerlink" title="6. Leancloud访客统计插件重大安全漏洞修复指南"></a>6. <del><span class="exturl" data-url="aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8yMDE4LzAyLzExL2xjLXNlY3VyaXR5LyM1YWNjN2IzMjlmNTQ1NDJiYjIzODRhN2U=">Leancloud访客统计插件重大安全漏洞修复指南<i class="fa fa-external-link-alt"></i></span></del></h4><blockquote><p>其实如果只是想保证<strong>访客数量不被随意篡改</strong>的话，设置一下安全域名就OK了。这篇博文可以不看 –&gt; <span class="exturl" data-url="aHR0cHM6Ly9sZWFmZXJ4Lm9ubGluZS8yMDE4LzAyLzExL2xjLXNlY3VyaXR5LyM1YWNjN2IzMjlmNTQ1NDJiYjIzODRhN2U=">Leancloud访客统计插件重大安全漏洞修复指南<i class="fa fa-external-link-alt"></i></span></p></blockquote><hr><h3 id="2-关于搭建中的一些问题"><a href="#2-关于搭建中的一些问题" class="headerlink" title="2. 关于搭建中的一些问题"></a>2. 关于搭建中的一些问题</h3><h4 id="1-Leancloud官网"><a href="#1-Leancloud官网" class="headerlink" title="1. Leancloud官网"></a>1. <del><span class="exturl" data-url="aHR0cHM6Ly9sZWFuY2xvdWQuY24v">Leancloud官网<i class="fa fa-external-link-alt"></i></span></del></h4><h4 id="2-GitHub仓库名称"><a href="#2-GitHub仓库名称" class="headerlink" title="2. GitHub仓库名称"></a>2. GitHub仓库名称</h4><ul><li>如果想使用自己的域名而不是GitHub提供的 <strong>GitHub_username.github.io</strong> 域名的话，博客仓库的名称可以不为<strong>GitHub_username.github.io</strong><h4 id="3-操作环境及push分支"><a href="#3-操作环境及push分支" class="headerlink" title="3. 操作环境及push分支"></a>3. 操作环境及push分支</h4></li><li>推荐所有操作皆在<strong>git bash</strong>下进行，可以免去很多坑</li><li>push分支，填<strong>master</strong>就行，其他的如：gh-pages <del>本人未测试,自行斟酌</del></li><li><strong>git clone</strong>下来的<em>next</em>主题可能会影响博客的生成，<strong>推荐删除</strong> next主题下面的<code>.git</code>,<code>.gitignore</code>和<code>ReadME</code>文件，或者你也可以将next作为一个子模块添加到仓库中</li></ul><h4 id="4-关于SEO优化"><a href="#4-关于SEO优化" class="headerlink" title="4. 关于SEO优化"></a>4. 关于SEO优化</h4><ul><li>网站链接提交，传送门：<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS93ZWJtYXN0ZXJzLyM/bW9kYWxfYWN0aXZlPW5vbmU=">Google网站站长<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL3NpZ25pbi92Mi9pZGVudGlmaWVyP3NlcnZpY2U9c2l0ZW1hcHMmcGFzc2l2ZT0xMjA5NjAwJm9zaWQ9MSZjb250aW51ZT1odHRwczovL3NlYXJjaC5nb29nbGUuY29tL3NlYXJjaC1jb25zb2xlL3NpdGVtYXBzP3Jlc291cmNlX2lkPWh0dHBzOi8vaWl0aWkuZ2l0aHViLmlvLyZmb2xsb3d1cD1odHRwczovL3NlYXJjaC5nb29nbGUuY29tL3NlYXJjaC1jb25zb2xlL3NpdGVtYXBzP3Jlc291cmNlX2lkPWh0dHBzOi8vaWl0aWkuZ2l0aHViLmlvLyZmbG93TmFtZT1HbGlmV2ViU2lnbkluJmZsb3dFbnRyeT1TZXJ2aWNlTG9naW4=">Google Search Console<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly96aXl1YW4uYmFpZHUuY29tLz9jYXN0az1MVEU9">百度搜索资源平台<i class="fa fa-external-link-alt"></i></span></li></ul></li><li>Google大法好</li><li>网站所有者验证<ul><li>在<span class="exturl" data-url="aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS93ZWJtYXN0ZXJzLyM/bW9kYWxfYWN0aXZlPW5vbmU=">Google网站站长<i class="fa fa-external-link-alt"></i></span>登陆或注册你的Google账号，添加要验证的网站域名</li><li>验证方式（这里只说明网页添加<code>&lt;meta&gt;</code>标签的方法） 添加<code>&lt;meta&gt;</code>标签进行验证网站所有者身份，可以将Google生成的<code>&lt;meta&gt;</code>标签插入到<strong>themes\next\layout_partials\head\head.swig</strong>前面的那一堆<code>&lt;meta&gt;</code>标签后面，然后<code>hexo clean; hexo d -g</code></li><li>验证所有者身份以后，打开<span class="exturl" data-url="aHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL3NpZ25pbi92Mi9pZGVudGlmaWVyP3NlcnZpY2U9c2l0ZW1hcHMmcGFzc2l2ZT0xMjA5NjAwJm9zaWQ9MSZjb250aW51ZT1odHRwczovL3NlYXJjaC5nb29nbGUuY29tL3NlYXJjaC1jb25zb2xlL3NpdGVtYXBzP3Jlc291cmNlX2lkPWh0dHBzOi8vaWl0aWkuZ2l0aHViLmlvLyZmb2xsb3d1cD1odHRwczovL3NlYXJjaC5nb29nbGUuY29tL3NlYXJjaC1jb25zb2xlL3NpdGVtYXBzP3Jlc291cmNlX2lkPWh0dHBzOi8vaWl0aWkuZ2l0aHViLmlvLyZmbG93TmFtZT1HbGlmV2ViU2lnbkluJmZsb3dFbnRyeT1TZXJ2aWNlTG9naW4=">Google Search Console<i class="fa fa-external-link-alt"></i></span>，添加资源，点击添加的域名，在左边找到站点地图，进行站点地图的手动提交</li></ul></li><li>百度，请自行尝试<br><img src="/images/lajibaidu.jpg" alt="百度"></li></ul><h4 id="5-关于permalink"><a href="#5-关于permalink" class="headerlink" title="5. 关于permalink:"></a>5. 关于<code>permalink</code>:</h4><ul><li><p>为了SEO在一定程度上的优化可以将<code>permalink</code>修改为</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#permalink:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:title.html</span></span><br></pre></td></tr></table></figure></li><li><p>但是这样有个问题就是所有的博客文件<code>title.html</code>都会产生在，站点根目录下，感觉起来没有条理性，博文越多越无条理性</p></li><li><p>自定义404页面，可以将404页面的<strong>permalink</strong>修改为/404</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="number">404</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-02-02 21:43:19</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">/404</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h4 id="6-关闭某个页面的评论，可以在title下面加上：comments-false"><a href="#6-关闭某个页面的评论，可以在title下面加上：comments-false" class="headerlink" title="6. 关闭某个页面的评论，可以在title下面加上：comments: false"></a>6. 关闭某个页面的评论，可以在<strong>title</strong>下面加上：<code>comments: false</code></h4></li></ul><h4 id="7-Deploy问题"><a href="#7-Deploy问题" class="headerlink" title="7. Deploy问题"></a>7. Deploy问题</h4><ul><li><p>如果显示fail，那应该就是你仓库名称填错了；如果显示fatal，那应该是权限问题。请检查自己是否有访问仓库的权限。检查一遍无问题以后，那应该是你电脑上存在旧的登陆状态（具体就是以前在电脑上登陆过其他账号）。</p><h5 id="清除方法："><a href="#清除方法：" class="headerlink" title="清除方法："></a>清除方法：</h5><ul><li><p>把关于GitHub关键字的凭据全部删除再重新登陆</p><p><img src="/images/hexobuild1.jpg" alt="Loading"></p><p><img src="/images/hexobuild2.png" alt="Loading"></p></li></ul></li></ul><h4 id="8-一些模板"><a href="#8-一些模板" class="headerlink" title="8. 一些模板"></a>8. 一些模板</h4><ol><li><p>邮箱验证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>您需要验证应用 &#123;&#123;appname&#125;&#125; 里的帐号邮箱地址 &#123;&#123;email&#125;&#125;，请点击下列链接进行确认：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;link&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; padding: 10px 20px; border-radius: 4px; background-color: #3090e4; color: #fff; text-decoration: none;&quot;</span>&gt;</span>验证邮箱<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>评论回复</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">你在 &#123;&#123;appname&#125;&#125; 的评论收到了新的回复，请点击查看：</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://iitii.github.io&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: inline-block; padding: 10px 20px; border-radius: 4px; background-color: #3090e4; color: #fff; text-decoration: none;&quot;</span>&gt;</span>马上查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure> <center> <svg viewBox="0 0 74 37" width="74" height="37" preserveAspectRatio="xMinYMin" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g id="qaEJec"><path fill="#ea4335" d="M67.954 16.303c-1.33 0-2.278-.608-2.886-1.804l7.967-3.3-.27-.68c-.495-1.33-2.008-3.79-5.102-3.79-3.068 0-5.622 2.41-5.622 5.96 0 3.34 2.53 5.96 5.92 5.96 2.73 0 4.31-1.67 4.97-2.64l-2.03-1.35c-.673.98-1.6 1.64-2.93 1.64zm-.203-7.27c1.04 0 1.92.52 2.21 1.264l-5.32 2.21c-.06-2.3 1.79-3.474 3.12-3.474z"></path></g><g id="YGlOvc"><path fill="#34a853" d="M58.193.67h2.564v17.44h-2.564z"></path></g><g id="BWfIk"><path fill="#4285f4" d="M54.152 8.066h-.088c-.588-.697-1.716-1.33-3.136-1.33-2.98 0-5.71 2.614-5.71 5.98 0 3.338 2.73 5.933 5.71 5.933 1.42 0 2.548-.64 3.136-1.36h.088v.86c0 2.28-1.217 3.5-3.183 3.5-1.61 0-2.6-1.15-3-2.12l-2.28.94c.65 1.58 2.39 3.52 5.28 3.52 3.06 0 5.66-1.807 5.66-6.206V7.21h-2.48v.858zm-3.006 8.237c-1.804 0-3.318-1.513-3.318-3.588 0-2.1 1.514-3.635 3.318-3.635 1.784 0 3.183 1.534 3.183 3.635 0 2.075-1.4 3.588-3.19 3.588z"></path></g><g id="e6m3fd"><path fill="#fbbc05" d="M38.17 6.735c-3.28 0-5.953 2.506-5.953 5.96 0 3.432 2.673 5.96 5.954 5.96 3.29 0 5.96-2.528 5.96-5.96 0-3.46-2.67-5.96-5.95-5.96zm0 9.568c-1.798 0-3.348-1.487-3.348-3.61 0-2.14 1.55-3.608 3.35-3.608s3.348 1.467 3.348 3.61c0 2.116-1.55 3.608-3.35 3.608z"></path></g><g id="vbkDmc"><path fill="#ea4335" d="M25.17 6.71c-3.28 0-5.954 2.505-5.954 5.958 0 3.433 2.673 5.96 5.954 5.96 3.282 0 5.955-2.527 5.955-5.96 0-3.453-2.673-5.96-5.955-5.96zm0 9.567c-1.8 0-3.35-1.487-3.35-3.61 0-2.14 1.55-3.608 3.35-3.608s3.35 1.46 3.35 3.6c0 2.12-1.55 3.61-3.35 3.61z"></path></g><g id="idEJde"><path fill="#4285f4" d="M14.11 14.182c.722-.723 1.205-1.78 1.387-3.334H9.423V8.373h8.518c.09.452.16 1.07.16 1.664 0 1.903-.52 4.26-2.19 5.934-1.63 1.7-3.71 2.61-6.48 2.61-5.12 0-9.42-4.17-9.42-9.29C0 4.17 4.31 0 9.43 0c2.83 0 4.843 1.108 6.362 2.56L14 4.347c-1.087-1.02-2.56-1.81-4.577-1.81-3.74 0-6.662 3.01-6.662 6.75s2.93 6.75 6.67 6.75c2.43 0 3.81-.972 4.69-1.856z"></path></g> </svg> </center> <center>大法保平安</center></li></ol><!--  npm install -g hexo  npm install hexo-wordcount --save  npm install hexo-deployer-git -–save  npm install hexo-generator-searchdb --save  npm install hexo-generator-feed  npm install hexo-generator-feed --save  npm install hexo-generator-sitemap --save  npm install hexo-generator-baidu-sitemap --save  npm install hexo-symbols-count-time --save-->]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FFmpeg的简单使用</title>
      <link href="//2019/02/01/FFmpeg%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>//2019/02/01/FFmpeg%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><ul><li>在FFmpeg的下载页面下载需要的版本，目前有Linux、Windows、MacOS版本 &amp; Source code</li><li>下载传送门：<ul><li>官网：<span class="exturl" data-url="aHR0cHM6Ly9mZm1wZWcub3JnL2Rvd25sb2FkLmh0bWw=">https://ffmpeg.org/download.html<i class="fa fa-external-link-alt"></i></span> </li><li>Github: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZGbXBlZy9GRm1wZWc=">https://github.com/FFmpeg/FFmpeg<i class="fa fa-external-link-alt"></i></span></li></ul></li></ul><hr><div class="note warning">            <ul><li>编译安装后，如果发现没有 <em><strong>ffplay</strong></em> ，一般是缺少 <em><strong>sdk</strong></em> 共享库  </li><li>通过这条命令安装：<code>sudo apt-get install libsdk1.2-dev libsdk2-dev</code></li></ul>          </div><h4 id="Simple-Use"><a href="#Simple-Use" class="headerlink" title="Simple Use"></a>Simple Use</h4><ul><li>从源代码进行构建：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install yasm</span><br><span class="line"><span class="comment">#***下载最新版release，假设下载后的release名称为：n4.0.1***</span></span><br><span class="line">name=n4.0.1</span><br><span class="line">tar -xvf <span class="variable">$name</span></span><br><span class="line"><span class="built_in">cd</span> ffmpeg</span><br><span class="line">./configure --enable-x264</span><br><span class="line"><span class="comment">#如果有问题，直接 ./configure</span></span><br><span class="line">core=`<span class="built_in">cat</span> /proc/cpuinfo| grep <span class="string">&quot;processor&quot;</span>| <span class="built_in">wc</span> -l`</span><br><span class="line">sudo make -j <span class="variable">$core</span> &amp;&amp; sudo make install </span><br></pre></td></tr></table></figure></li></ul><h4 id="Deep-Customization"><a href="#Deep-Customization" class="headerlink" title="Deep Customization"></a>Deep Customization</h4><div class="note danger">            <ol><li>进入源代码根目录，使用 <code>./configure --help</code> 查看所有参数和信息</li><li>选择开启格外的功能 <code>--enable-***</code>, 开启之前一般需要安装对应的 *<strong>lib</strong> 库</li><li>如启用 <em>hevc (H265)</em> 支持, 我们可以这样 <code>sudo apt search x265</code>, 然后根据返回的结果自行判断。一般需要安装的共享库的名称规范是：<code>lib***-dev</code> 或 <code>***-dev</code> 。如 <code>x265</code> 就是 <code>libx265-dev</code> , 通过 <code>sudo apt-get install libx265-dev</code> 进行安装</li><li>对于想要开启 <code>NVIDIA</code> 硬解支持的话，按照 <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9mZm1wZWc=">以下方法<i class="fa fa-external-link-alt"></i></span><ol><li>确保自己有 <strong>NVIDIA显卡</strong> ，而且 <strong>支持硬解码</strong></li><li>安装 <em>cuda</em> （推荐最新版）, 选完对应版本后在 <strong>Download</strong> 那边有安装说明。 <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLXRvb2xraXQ=">传送门…<i class="fa fa-external-link-alt"></i></span></li><li>安装 <em>Video Codec SDK</em><ol><li>git clone <span class="exturl" data-url="aHR0cHM6Ly9naXQudmlkZW9sYW4ub3JnL2dpdC9mZm1wZWcvbnYtY29kZWMtaGVhZGVycy5naXQ=">https://git.videolan.org/git/ffmpeg/nv-codec-headers.git<i class="fa fa-external-link-alt"></i></span></li><li>cd nv-codec-headers &amp;&amp; sudo make install &amp;&amp; cd –</li></ol></li><li>将 <em><strong>nvcc</strong></em> 添加到 <code>PATH</code></li><li>可以在 <code>./configure</code> 后面添加 <code>--prefix={dir}</code> 来指定安装目录</li><li><code>./configure --enable-cuda-nvcc --enable-cuvid --enable-nvenc --enable-nonfree --enable-libnpp --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64</code></li></ol></li></ol>          </div><ul><li>通过 APT 源进行安装的 ffmpeg 默认参数</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># ffmpeg</span></span><br><span class="line">ffmpeg version 3.4.6-0ubuntu0.18.04.1 Copyright (c) 2000-2019 the FFmpeg developers</span><br><span class="line">  built with gcc 7 (Ubuntu 7.3.0-16ubuntu3)</span><br><span class="line">  configuration: --prefix=/usr --extra-version=0ubuntu0.18.04.1 --toolchain=hardened --libdir=/usr/lib/x86_64-linux-gnu --incdir=/usr/include/x86_64-linux-gnu --enable-gpl --disable-stripping --enable-avresample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librubberband --enable-librsvg --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libopencv --enable-libx264 --enable-shared</span><br><span class="line">  libavutil      55. 78.100 / 55. 78.100</span><br><span class="line">  libavcodec     57.107.100 / 57.107.100</span><br><span class="line">  libavformat    57. 83.100 / 57. 83.100</span><br><span class="line">  libavdevice    57. 10.100 / 57. 10.100</span><br><span class="line">  libavfilter     6.107.100 /  6.107.100</span><br><span class="line">  libavresample   3.  7.  0 /  3.  7.  0</span><br><span class="line">  libswscale      4.  8.100 /  4.  8.100</span><br><span class="line">  libswresample   2.  9.100 /  2.  9.100</span><br><span class="line">  libpostproc    54.  7.100 / 54.  7.100</span><br><span class="line">Hyper fast Audio and Video encoder</span><br><span class="line">usage: ffmpeg [options] [[infile options] -i infile]... &#123;[outfile options] outfile&#125;...</span><br><span class="line"></span><br><span class="line">Use -h to get full <span class="built_in">help</span> or, even better, run <span class="string">&#x27;man ffmpeg&#x27;</span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><!--获取最新版 Github release 的一项可选的方法--><!--wget --no-check-certificate -qO- https://api.github.com/repos/FFmpeg/FFmpeg/releases | grep -o '"tag_name": ".*"' |head -n 1| sed 's/"//g;s/v//g' | sed 's/tag_name: //g'--><!--格式为：wget --no-check-certificate -qO- https://api.github.com/repos/$USER-NAME/$REPO-NAME/releases | grep -o '"tag_name": ".*"' |head -n 1| sed 's/"//g;s/v//g' | sed 's/tag_name: //g'--><hr><h3 id="2-介绍"><a href="#2-介绍" class="headerlink" title="2. 介绍"></a>2. 介绍</h3><blockquote><p>从源代码编译后，会安装 <em>ffmpeg</em>、<em>ffprobe</em>、<em>ffplay</em></p></blockquote><ul><li><em>ffmpeg</em> 主要用于转码</li><li><em>ffprobe</em> 主要用于查看媒体文件信息</li><li><em>ffplay</em> 不仅仅是播放器，同时也是测试 <em>ffmpeg</em> 的 <em>codec</em> 引擎、<em>format</em> 引擎、<em>filter</em> 引擎的工具，并且还可以进行可视化的媒体参数分析</li></ul><hr><h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h3><h4 id="1-初级部分"><a href="#1-初级部分" class="headerlink" title="1. 初级部分"></a>1. 初级部分</h4><h5 id="1-音视频文件转-MP4-ffmpeg-i-input-flv-c-copy-f-mp4-output-mp4"><a href="#1-音视频文件转-MP4-ffmpeg-i-input-flv-c-copy-f-mp4-output-mp4" class="headerlink" title="1. 音视频文件转 MP4: ffmpeg -i input.flv -c copy -f mp4 output.mp4"></a>1. 音视频文件转 MP4: <code>ffmpeg -i input.flv -c copy -f mp4 output.mp4</code></h5><h5 id="2-音视频文件转-FLV-ffmpeg-i-input-mp4-c-copy-f-flv-output-flv"><a href="#2-音视频文件转-FLV-ffmpeg-i-input-mp4-c-copy-f-flv-output-flv" class="headerlink" title="2. 音视频文件转 FLV: ffmpeg -i input.mp4 -c copy -f flv output.flv"></a>2. 音视频文件转 FLV: <code>ffmpeg -i input.mp4 -c copy -f flv output.flv</code></h5><blockquote><p>若音频有问题或者封装出错，尝试：<code>ffmpeg -i input.mp4 -vcodec copy -acodec aac -f flv output.flv</code></p></blockquote><h5 id="3-提取音视频文件里面的AAC音频流-ffmpeg-i-input-mp4-vn-acodec-copy-output-aac"><a href="#3-提取音视频文件里面的AAC音频流-ffmpeg-i-input-mp4-vn-acodec-copy-output-aac" class="headerlink" title="3. 提取音视频文件里面的AAC音频流: ffmpeg  -i input.mp4 -vn -acodec copy output.aac"></a>3. 提取音视频文件里面的<strong>AAC</strong>音频流: <code>ffmpeg  -i input.mp4 -vn -acodec copy output.aac</code></h5><h5 id="4-FFmpeg-输出MP3-ffmpeg-i-INPUT-acodec-libmp3lame-b-a-320k-output-mp3"><a href="#4-FFmpeg-输出MP3-ffmpeg-i-INPUT-acodec-libmp3lame-b-a-320k-output-mp3" class="headerlink" title="4. FFmpeg 输出MP3: ffmpeg -i INPUT -acodec libmp3lame -b:a 320k output.mp3"></a>4. FFmpeg 输出<strong>MP3</strong>: <code>ffmpeg -i INPUT -acodec libmp3lame -b:a 320k output.mp3</code></h5><h5 id="5-提取音视频文件里面的H-264视频流-ffmpeg-i-output-mp4-an-vcodec-copy-bsf-v-h264-mp4toannexb-output-h264"><a href="#5-提取音视频文件里面的H-264视频流-ffmpeg-i-output-mp4-an-vcodec-copy-bsf-v-h264-mp4toannexb-output-h264" class="headerlink" title="5. 提取音视频文件里面的H.264视频流: ffmpeg -i output.mp4 -an -vcodec copy -bsf:v h264_mp4toannexb output.h264"></a>5. 提取音视频文件里面的<strong>H.264</strong>视频流: <code>ffmpeg -i output.mp4 -an -vcodec copy -bsf:v h264_mp4toannexb output.h264</code></h5><h5 id="6-使用AAC和H-264文件生成mp4文件-ffmpeg-i-input-aac-i-input-h264-acodec-copy-bsf-a-aac-adtstoasc-vcodec-copy-f-mp4-output-mp4"><a href="#6-使用AAC和H-264文件生成mp4文件-ffmpeg-i-input-aac-i-input-h264-acodec-copy-bsf-a-aac-adtstoasc-vcodec-copy-f-mp4-output-mp4" class="headerlink" title="6. 使用AAC和H.264文件生成mp4文件: ffmpeg -i input.aac -i input.h264 -acodec copy -bsf:a aac_adtstoasc -vcodec copy -f mp4 output.mp4"></a>6. 使用<strong>AAC</strong>和<strong>H.264</strong>文件生成<strong>mp4</strong>文件: <code>ffmpeg -i input.aac -i input.h264 -acodec copy -bsf:a aac_adtstoasc -vcodec copy -f mp4 output.mp4</code></h5><h5 id="7-对音频文件的编码做转换-ffmpeg-i-input-wav-acodec-libfdk-aac-output-aac"><a href="#7-对音频文件的编码做转换-ffmpeg-i-input-wav-acodec-libfdk-aac-output-aac" class="headerlink" title="7. 对音频文件的编码做转换: ffmpeg -i input.wav -acodec libfdk_aac output.aac"></a>7. 对音频文件的编码做转换: <code>ffmpeg -i input.wav -acodec libfdk_aac output.aac</code></h5><h5 id="8-添加srt格式的字幕-ffmpeg-i-video-avi-vf-subtitles-subtitle-srt-out-avi"><a href="#8-添加srt格式的字幕-ffmpeg-i-video-avi-vf-subtitles-subtitle-srt-out-avi" class="headerlink" title="8. 添加srt格式的字幕: ffmpeg -i video.avi -vf subtitles=subtitle.srt out.avi"></a>8. 添加srt格式的字幕: <code>ffmpeg -i video.avi -vf subtitles=subtitle.srt out.avi</code></h5><h5 id="9-从现有视频文件中抽离字幕并且烧录进新的视频中：ffmpeg-i-video-mkv-vf-subtitles-video-mkv-out-avi"><a href="#9-从现有视频文件中抽离字幕并且烧录进新的视频中：ffmpeg-i-video-mkv-vf-subtitles-video-mkv-out-avi" class="headerlink" title="9. 从现有视频文件中抽离字幕并且烧录进新的视频中：ffmpeg -i video.mkv -vf subtitles=video.mkv out.avi"></a>9. 从现有视频文件中抽离字幕并且烧录进新的视频中：<code>ffmpeg -i video.mkv -vf subtitles=video.mkv out.avi</code></h5><h5 id="10-添加ass格式的字幕：ffmpeg-i-video-avi-vf-quot-ass-subtitle-ass-quot-out-avi-或者你可以先将srt转换成ass格式：ffmpeg-i-subtitle-srt-subtitle-ass"><a href="#10-添加ass格式的字幕：ffmpeg-i-video-avi-vf-quot-ass-subtitle-ass-quot-out-avi-或者你可以先将srt转换成ass格式：ffmpeg-i-subtitle-srt-subtitle-ass" class="headerlink" title="10. 添加ass格式的字幕：ffmpeg -i video.avi -vf &quot;ass=subtitle.ass&quot; out.avi 或者你可以先将srt转换成ass格式：ffmpeg -i subtitle.srt subtitle.ass"></a>10. 添加ass格式的字幕：<code>ffmpeg -i video.avi -vf &quot;ass=subtitle.ass&quot; out.avi</code> 或者你可以先将srt转换成ass格式：<code>ffmpeg -i subtitle.srt subtitle.ass</code></h5><h5 id="11-添加idx-sub格式的字幕：-ffmpeg-i-1-mp4-i-1-sub-i-1-idx-filter-complex-quot-0-v-2-s-overlay-0-H-h-quot-c-v-libx264-out-mp4"><a href="#11-添加idx-sub格式的字幕：-ffmpeg-i-1-mp4-i-1-sub-i-1-idx-filter-complex-quot-0-v-2-s-overlay-0-H-h-quot-c-v-libx264-out-mp4" class="headerlink" title="11. 添加idx/sub格式的字幕： ffmpeg -i 1.mp4 -i 1.sub -i 1.idx -filter_complex &quot;[0:v][2:s]overlay=0:H-h&quot; -c:v libx264 out.mp4"></a>11. 添加idx/sub格式的字幕： <code>ffmpeg -i 1.mp4 -i 1.sub -i 1.idx -filter_complex &quot;[0:v][2:s]overlay=0:H-h&quot; -c:v libx264 out.mp4</code></h5><blockquote><p>这个会将图片类型的sub/idx格式字幕烧录进视频文件中。</p></blockquote><h4 id="2-高级部分"><a href="#2-高级部分" class="headerlink" title="2. 高级部分"></a>2. 高级部分</h4><hr><blockquote><p>Advance: FFmpeg 流媒体<br>-re: 实时推送</p></blockquote><hr><h5 id="8-录制-amp-发布-RTMP-流"><a href="#8-录制-amp-发布-RTMP-流" class="headerlink" title="8. 录制 &amp; 发布 RTMP 流"></a>8. 录制 &amp; 发布 <strong>RTMP</strong> 流</h5><ol><li>发布RTMP流: <code>ffmpeg -i input.mp4 -c copy -f flv rtmp://localhost/live/class</code>  <blockquote><p>live 为发布点，class 为流名称<br>自定义发布点为 live1、流名称为 class1，并且实时推流<br><code>ffmpeg -re -i input.mp4 -c copy -f flv -rtmp_app live1 -rtmp_playpath class1 rtmp://localhost</code>    1. 录制RTMP流: <code>ffmpeg -i rtmp://localhost/live/class -c copy -f flv output.flv</code> </p></blockquote></li></ol><h5 id="9-录制-HTTP-流"><a href="#9-录制-HTTP-流" class="headerlink" title="9.  录制 HTTP 流"></a>9.  录制 <strong>HTTP</strong> 流</h5><ol><li>FLV直播流: <code>ffmpeg -i http://localhost/live.flv -c copy -f flv output.flv</code></li><li> TS直播流: <code>ffmpeg -i http://localhost/live.ts -c copy -f flv output.flv</code></li><li> HLS直播流: <code>ffmpeg -i http://localhost/live.m3u8 -c copy -f flv output.flv</code></li><li> 设置 <em>http headers</em> &amp; <em>user_agent</em> &amp; <em>seekable</em> 等参数 : <code>ffmpeg -ss 300 -seekable 1 -user_agent &quot;CC&#39;s Player&quot; -headers &quot;referer: http://localhost/index.html&quot; -i http://localhost/live/class.flv -c copy -f flv -y ouput.flv</code>  </li></ol><h5 id="10-录制-amp-发布-TCP-UDP-流"><a href="#10-录制-amp-发布-TCP-UDP-流" class="headerlink" title="10. 录制 &amp; 发布 TCP/UDP 流"></a>10. 录制 &amp; 发布 <strong>TCP/UDP</strong> 流</h5><ol><li><p>发布TCP流: <code>ffmpeg -re -i input.mp4 -c copy -f flv tcp://127.0.0.1:123/live/stream</code></p><blockquote><p>设置缓冲区为 4096 bit：<code>ffmpeg -re -i input.mp4 -c copy -send_buffer_size 4096 -f flv tcp://127.0.0.1:123/live/stream</code></p></blockquote></li><li><p>录制TCP流: <code>ffmpeg -listen 1 -f flv -i tcp://127.0.0.1/live/stream -c copy -f flv output.flv</code></p><blockquote><p>设置监听端口超时 listen_timeout (5秒): <code>ffmpeg -listen_timeout 5000 -listen 1 -f flv -i tcp://127.0.0.1/live/stream -c copy -f flv output.flv</code><br>设置TCP流拉取超时参数 timeout （200秒）：<code>ffmpeg -timeout 20000000 -listen 1 -f flv -i tcp://127.0.0.1/live/stream -c copy -f flv output.flv</code></p></blockquote></li><li><p>发布UDP流：<code>ffmpeg -re -i input.mp4 -c copy -localport 23456 -f flv udp://127.0.0.1:123/live/stream</code></p><blockquote><p>使用FFmpeg的UDP传输数据时，默认会由系统分配本地端口，使用localport可以设置监听本地端口，抓包可以看到有一个 23456 -&gt; 123 的端口转发</p></blockquote><hr><blockquote><p>Advance: FFmpeg 桌面录制</p></blockquote><hr></li></ol><h5 id="11-Windows桌面-录制"><a href="#11-Windows桌面-录制" class="headerlink" title="11. Windows桌面 录制"></a>11. Windows桌面 录制</h5><table><thead><tr><th align="right">参数</th><th align="right">作用</th></tr></thead><tbody><tr><td align="right">draw_mouse</td><td align="right">是否采集鼠标指针</td></tr><tr><td align="right">show_region</td><td align="right">是否绘制采集边界</td></tr><tr><td align="right">framerate</td><td align="right">设置视频帧率，默认25帧，两个标准值为pal、ntsc</td></tr><tr><td align="right">video_size</td><td align="right">设置视频分辨率</td></tr><tr><td align="right">offset_x</td><td align="right">采集区域偏移x个像素</td></tr><tr><td align="right">offset_y</td><td align="right">采集区域偏移x个像素</td></tr></tbody></table><ul><li>整个桌面(设定帧率为60)：<code>./ffmpeg.exe -f gdigrab -framerate 60 -i desktop output.mp4</code></li><li>某个窗口（假设窗口名为ffmpeg）：<code>./ffmpeg.exe -f gdigrab -framerate 60 -i title=ffmpeg output.mp4</code></li><li> 录制带偏移量的视频：<code>./ffmpeg.exe -f gdigrab -framerate 60 -offset_x 50 -offset_y 50 -video_size 400x400 -i title=ffmpeg output.mp4</code>  </li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> FFmpeg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ffmpeg cuda支持 </tag>
            
            <tag> ffmpeg 安装 </tag>
            
            <tag> 影视 </tag>
            
            <tag> ffmpeg的使用 </tag>
            
            <tag> ffplay </tag>
            
            <tag> cuda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH Config</title>
      <link href="/2019/01/30/1/"/>
      <url>/2019/01/30/1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在对任何配置文件进行修改之前，最好都做好备份</p></blockquote><h3 id="1-安装openssh-server：sudo-apt-get-install-openssh-server"><a href="#1-安装openssh-server：sudo-apt-get-install-openssh-server" class="headerlink" title="1. 安装openssh-server：sudo apt-get install openssh-server"></a>1. 安装openssh-server：<code>sudo apt-get install openssh-server</code></h3><h3 id="2-是否启用密码认证："><a href="#2-是否启用密码认证：" class="headerlink" title="2. 是否启用密码认证："></a>2. 是否启用密码认证：</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#YES</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment">#NO</span></span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure><h3 id="3-是否允许转发"><a href="#3-是否允许转发" class="headerlink" title="3. 是否允许转发"></a>3. 是否允许转发</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#YES</span></span><br><span class="line">AllowTcpForwarding <span class="built_in">yes</span></span><br><span class="line">X11Forwarding <span class="built_in">yes</span></span><br><span class="line"><span class="comment">#NO</span></span><br><span class="line">AllowTcpForwarding no</span><br><span class="line">X11Forwarding no</span><br></pre></td></tr></table></figure><h3 id="4-禁止或允许通过SSH进行连接的用户"><a href="#4-禁止或允许通过SSH进行连接的用户" class="headerlink" title="4. 禁止或允许通过SSH进行连接的用户"></a>4. 禁止或允许通过SSH进行连接的用户</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许用户Fred 和 Wilma进行连接</span></span><br><span class="line">AllowUsers Fred Wilma</span><br><span class="line"><span class="comment">#禁止用户Fred 和 Wilma进行连接</span></span><br><span class="line">DenyUsers Fred Wilma</span><br></pre></td></tr></table></figure><h3 id="5-限制连接数量，可以简单的在UFW里面配置：sudo-ufw-limit-ssh-or"><a href="#5-限制连接数量，可以简单的在UFW里面配置：sudo-ufw-limit-ssh-or" class="headerlink" title="5. 限制连接数量，可以简单的在UFW里面配置：sudo ufw limit ssh or"></a>5. 限制连接数量，可以简单的在UFW里面配置：<code>sudo ufw limit ssh</code> <strong>or</strong></h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改最大连接数量</span></span><br><span class="line">MaxStartups 2:30:10</span><br><span class="line"><span class="comment">#修改因用户不活跃而断开的等待时间</span></span><br><span class="line">LoginGraceTime 30</span><br></pre></td></tr></table></figure><h3 id="6-记录更多关于SSH登陆的消息"><a href="#6-记录更多关于SSH登陆的消息" class="headerlink" title="6. 记录更多关于SSH登陆的消息"></a>6. 记录更多关于SSH登陆的消息</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可以通过修改登陆日志的级别来实现</span></span><br><span class="line"><span class="comment">#详细（日志文件在 /var/log/auth.log）</span></span><br><span class="line">LogLevel VERBOSE</span><br><span class="line"><span class="comment">#粗略</span></span><br><span class="line">LogLevel INFO</span><br></pre></td></tr></table></figure><h3 id="7-是否在登陆时打印警示信息"><a href="#7-是否在登陆时打印警示信息" class="headerlink" title="7. 是否在登陆时打印警示信息"></a>7. 是否在登陆时打印警示信息</h3><ol><li>大部分的发行版（如：CentOS）登陆和欢迎信息控制在：<code>/etc/motd</code></li><li>Ubuntu的登陆和欢迎信息控制在：<code>/etc/issue</code> 和 <code>/etc/update-motd.d</code>。  </li><li><code>/etc/issue</code> 与 <code>/etc/update-motd.d</code> 区别在于：当一个网络用户或通过串口登录系统 上时, <code>/etc/issue</code> 的文件内容显示在<strong>login</strong>提示符之前,而 <code>/etc/update-motd.d</code> 里面的内容显示在用户成功登录系统之后。  </li><li><code>/etc/update-motd.d</code>里面存放着一些可执行脚本，您可以直接执行看看脚本的效果，也可以通过 <code>chmod -x 脚本名称</code>来达到禁用脚本的效果  </li><li>执行 <code>/usr/bin/landscape-sysinfo</code>可以查看系统资源使用信息，可以将这一条加入自己谢的脚本里面然后添加到 <code>/etc/update-motd.d</code>，然后再登陆的时候就可以看到系统资源的使用信息  </li><li><strong>修改后用：sudo run-parts /etc/update-motd.d 去执行就会立即见到效果，而不用反复注销登录。</strong></li><li>我们也可以在/etc/issue.net（telnet登陆时显示的信息） or /etc/issue（ssh登陆时输出的信息） 里面修改警告信息<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#issue 内各代码意义：</span></span><br><span class="line">\d 本地端时间日期；</span><br><span class="line">\l 显示第几个终端机接口；</span><br><span class="line">\m 显示硬件等级 (i386/i486/i586/i686…)；</span><br><span class="line">\n 显示主机网络名称；</span><br><span class="line">\o 显示 domain name；</span><br><span class="line">\r 操作系统版本 (相当于 <span class="built_in">uname</span> -r)</span><br><span class="line">\t 显示本地端时间；</span><br><span class="line">\s 操作系统名称；</span><br><span class="line">\v 操作系统版本。</span><br></pre></td></tr></table></figure></li></ol><h3 id="8-修改完ssh-config，需要手动重启一下ssh服务来加载配置文件使之生效：sudo-systemctl-restart-ssh"><a href="#8-修改完ssh-config，需要手动重启一下ssh服务来加载配置文件使之生效：sudo-systemctl-restart-ssh" class="headerlink" title="8. 修改完ssh_config，需要手动重启一下ssh服务来加载配置文件使之生效：sudo systemctl restart ssh"></a>8. 修改完ssh_config，需要手动重启一下ssh服务来加载配置文件使之生效：<code>sudo systemctl restart ssh</code></h3><hr><h3 id="9-参考链接："><a href="#9-参考链接：" class="headerlink" title="9. 参考链接："></a>9. 参考链接：</h3><ul><li><span class="exturl" data-url="aHR0cHM6Ly9oZWxwLnVidW50dS5jb20vY29tbXVuaXR5L1NTSC9PcGVuU1NIL0NvbmZpZ3VyaW5nI0ZvcndhcmRpbmc=">https://help.ubuntu.com/community/SSH/OpenSSH/Configuring#Forwarding<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> config </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建个人订阅</title>
      <link href="//2019/01/22/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E8%AE%A2%E9%98%85/"/>
      <url>//2019/01/22/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E8%AE%A2%E9%98%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>一般情况下 ss, ssr, v2ray 之类的分享链接去掉前缀以后都是一个 base64 的字符串<br>而且一般我们常见的订阅链接，里面的内容虽然咋一看都是乱码。但是它其实也是一条或多条分享链接再进行一次 base64 编码后字符串，比如 ss, ssr, v2ray, clash, qv2ray<br>因为处理方式和处理过程我们已经清楚了，所以搭建一个订阅服务器就变得很简单了  </p></blockquote><ol><li><p>假设分享链接为:</p><blockquote><p>链接来源网络，仅供参考  </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmess://eyJob3N0IjoiamlrZS1henNnMDIuZGRucy1vbmx5Lnh5eiIsInBhdGgiOiIvamlrZSIsInRscyI6IiIsInZlcmlmeV9jZXJ0Ijp0cnVlLCJhZGQiOiJqaWtlLWF6c2cwMi5kZG5zLW9ubHkueHl6IiwicG9ydCI6MzA1MDMsImFpZCI6MiwibmV0Ijoid3MiLCJoZWFkZXJUeXBlIjoibm9uZSIsInYiOiIyIiwidHlwZSI6InZtZXNzIiwicHMiOiJWNC3mlrDliqDlnaHlvq7ova/kupEwMXx2MnJheSIsInJlbWFyayI6IlY0LeaWsOWKoOWdoeW+rui9r+S6kTAxfHYycmF5IiwiaWQiOiJlZDYyMDE2ZS1lM2NhLTM0N2YtOGY0Ni1iYzczMzRmYjliYmYiLCJjbGFzcyI6MX0=</span><br></pre></td></tr></table></figure></li><li><p>通过使用 <code>base64 -d</code> 对链接进行解密，我们可以获得如下信息</p><blockquote><p>其中 <code>-d</code> 代表<strong>解密</strong>  </p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jike-azsg02.ddns-only.xyz&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/jike&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;verify_cert&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jike-azsg02.ddns-only.xyz&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">30503</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aid&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;net&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;headerType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;v&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ps&quot;</span><span class="punctuation">:</span> <span class="string">&quot;V4-新加坡微软云01|v2ray&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;V4-新加坡微软云01|v2ray&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ed62016e-e3ca-347f-8f46-bc7334fb9bbf&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;class&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>通过使用 <code>base64 -w 0</code> 对链接加密我们可以获得如下订阅内容</p><blockquote><p>其中 <code>-w 0</code> 代表<strong>不换行</strong>  </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dm1lc3M6Ly9leUpvYjNOMElqb2lhbWxyWlMxaGVuTm5NREl1WkdSdWN5MXZibXg1TG5oNWVpSXNJbkJoZEdnaU9pSXZhbWxyWlNJc0luUnNjeUk2SWlJc0luWmxjbWxtZVY5alpYSjBJanAwY25WbExDSmhaR1FpT2lKcWFXdGxMV0Y2YzJjd01pNWtaRzV6TFc5dWJIa3VlSGw2SWl3aWNHOXlkQ0k2TXpBMU1ETXNJbUZwWkNJNk1pd2libVYwSWpvaWQzTWlMQ0pvWldGa1pYSlVlWEJsSWpvaWJtOXVaU0lzSW5ZaU9pSXlJaXdpZEhsd1pTSTZJblp0WlhOeklpd2ljSE1pT2lKV05DM21sckRsaXFEbG5hSGx2cTdvdmEva3VwRXdNWHgyTW5KaGVTSXNJbkpsYldGeWF5STZJbFkwTGVhV3NPV0tvT1dkb2VXK3J1aTlyK1M2a1RBeGZIWXljbUY1SWl3aWFXUWlPaUpsWkRZeU1ERTJaUzFsTTJOaExUTTBOMll0T0dZME5pMWlZemN6TXpSbVlqbGlZbVlpTENKamJHRnpjeUk2TVgwPQo=</span><br></pre></td></tr></table></figure></li><li><p>将上面的订阅内容复制黏贴到文本文件, <code>tee</code> 之类的命令也可以</p></li><li><p>将该文本文件放到 web 服务器上</p></li><li><p>打开软件，手动填写对应文本文件的 URL</p></li><li><p>保存之后即可订阅成功</p></li></ol><blockquote><p>ps: 也可以将加密后的内容导入到Github之类的平台上<br>文件后缀名并不是必须的，为了隐蔽性可以考虑去除文件后缀名  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> proxy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
            <tag> proxy </tag>
            
            <tag> 搭建 ss 订阅服务器 </tag>
            
            <tag> 搭建 ssr 订阅服务器 </tag>
            
            <tag> 搭建 v2ray 订阅服务器 </tag>
            
            <tag> 搭建梯子订阅服务器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在Ubuntu18.04 上通过PPTP VPN 远程桌面连接Windows</title>
      <link href="//2019/01/11/%E5%9C%A8Ubuntu18.04%20%E4%B8%8A%E9%80%9A%E8%BF%87PPTP%20VPN%20%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5Windows/"/>
      <url>//2019/01/11/%E5%9C%A8Ubuntu18.04%20%E4%B8%8A%E9%80%9A%E8%BF%87PPTP%20VPN%20%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5Windows/</url>
      
        <content type="html"><![CDATA[<h3 id="配置VPN并连接"><a href="#配置VPN并连接" class="headerlink" title="配置VPN并连接"></a>配置VPN并连接</h3><h4 id="配置VPN"><a href="#配置VPN" class="headerlink" title="配置VPN"></a>配置VPN</h4><ul><li><p>Setting -&gt; Network -&gt; VPN -&gt; 点击“+” -&gt; Add VPN -&gt; PPTP -&gt; (添加必要的信息，其中Gateway为远程VPN地址)</p><ul><li>修改<strong>Advanced</strong>选项（下面的我自己的方案）</li></ul><p>  <img src="/images/pptp1.jpg" alt="Loading"></p></li><li><p>连接VPN</p></li></ul><h3 id="连接VPN时可能出现的问题"><a href="#连接VPN时可能出现的问题" class="headerlink" title="连接VPN时可能出现的问题"></a>连接VPN时可能出现的问题</h3><h4 id="问题描述：-在用户名等完全正确的情况下无法连接VPN，点击连接，没多久就断了"><a href="#问题描述：-在用户名等完全正确的情况下无法连接VPN，点击连接，没多久就断了" class="headerlink" title="问题描述： 在用户名等完全正确的情况下无法连接VPN，点击连接，没多久就断了"></a>问题描述： 在用户名等完全正确的情况下无法连接VPN，点击连接，没多久就断了</h4><h4 id="解决方案：-查看日志文件-amp-google"><a href="#解决方案：-查看日志文件-amp-google" class="headerlink" title="解决方案： 查看日志文件 &amp; google"></a>解决方案： 查看日志文件 &amp; google</h4><ol><li>网卡的日志文件是<code>/var/log/syslog</code>，可以使用 <code>tail -f /var/log/syslog</code>命令来查看</li></ol><ul><li>关键字段：<strong>LCP: timeout sending Config-Requests</strong>  </li></ul><ol><li>原因：  <ol><li>在引导期间未加载2个必需的netfilter内核模块</li><li>多半是有一方的GRE协议未开启，检查服务器防火墙设置。</li><li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pnZ3pjZ3kvYXJ0aWNsZS9kZXRhaWxzLzUzMzY2ODAz">还可能的原因<i class="fa fa-external-link-alt"></i></span></li></ol></li><li>解决方案： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#原因1</span></span><br><span class="line">sudo modprobe nf_conntrack_proto_gre nf_conntrack_pptp</span><br><span class="line"><span class="comment">#原因2</span></span><br><span class="line">sudo iptables -A INPUT -p gre -j ACCEPT</span><br><span class="line">sudo iptables -A OUTPUT -p gre -j ACCEPT </span><br><span class="line">sudo /etc/init.d/iptables save //保存</span><br><span class="line"><span class="comment">#我是两个问题都有。。。。</span></span><br></pre></td></tr></table></figure></li><li>重新连接并测试（OK）</li></ol><hr><h3 id="使用FreeRDP进行远程桌面连接"><a href="#使用FreeRDP进行远程桌面连接" class="headerlink" title="使用FreeRDP进行远程桌面连接"></a>使用FreeRDP进行远程桌面连接</h3><hr><blockquote><p>Q &amp; A   </p></blockquote><blockquote><p>Q1: 为什么不使用<code>rdesktop</code>进行桌面连接？  </p><p>A1: rdesktop已经过时，不支持Windows全新的身份认证协议  </p></blockquote><blockquote><p>Q2： Windows全新的身份认证协议是什么？  </p><p>A2： 所有Windows客户端都有一个凭据缓存，用于对名为NTLM或Windows NT LAN Manager的网络中的服务进行身份验证。RDP支持SSO（单点登录）身份验证，使用户能够使用单个ID和密码登录，以访问已连接的系统。但是，Linux客户端不支持此类型的身份验证，并且它们要求在启动远程会话时通过Rdesktop命令行或通过登录窗口提供凭据。Linux具有Kerberos，这是一种基于初始登录请求访问服务的身份验证机制。Windows Active Directory提供Kerberos基础结构，可以配置Linux以便对AD进行身份验证。这意味着在登录Linux时，您将通过Kerberos TGT（票证授予票证）进行身份验证，该票证用于访问其他服务，例如RDP。运行Rdesktop时，CredSSP将检查您是否拥有Kerberos TGT来访问远程服务，并将其用于远程RDS服务器的SSO身份验证。如果没有Kerberos TGT，则Rdesktop将回退到较低的，不安全的网络连接级别，而不需要网络级别的身份验证。</p></blockquote><blockquote><p>Q3: 如果我一定要使用它呢？  </p><p>A3: <span class="exturl" data-url="aHR0cDovL2Jsb2cuNTFjdG8uY29tL2ZpcmVsb25nLzE5NzYwMTk=">参考这篇文章<i class="fa fa-external-link-alt"></i></span></p></blockquote><hr><h4 id="安装FreeRDP"><a href="#安装FreeRDP" class="headerlink" title="安装FreeRDP"></a>安装FreeRDP</h4><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#两个必须都安装</span></span><br><span class="line">sudo apt install freerdp2-x11</span><br><span class="line">sudo apt install freerdp-x11</span><br></pre></td></tr></table></figure></code></pre><h4 id="使用FreeRDP"><a href="#使用FreeRDP" class="headerlink" title="使用FreeRDP"></a>使用FreeRDP</h4><ol><li><p>用法：<code>xfreerdp [file] [options] [/v:&lt;server&gt;[:port]]</code></p></li><li><p>示例： <code>xfreerdp -f -v RemoteIP:PORT -u UserName -p Password</code></p></li><li><p>常用选项</p><pre><code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-f：表示全屏（切换全屏的快捷键为：Ctrl + Alt + Enter）</span><br><span class="line">-v：远程服务器IP地址加端口号，windows默认远程连接端口号为3389</span><br><span class="line">-u：用户名</span><br><span class="line">-p：密码</span><br></pre></td></tr></table></figure></code></pre></li><li><p>解释<br> <code>xfreerdp -f -v 192.168.1.5:3389 -u  Admin -p 12345</code>  </p><blockquote><p>可能会有是否信任证书之类的，直接选择<code>Y</code>或者<code>T</code><br><del>表示使用用户名为Admin，密码为12345 的身份登录到远程服务器</del></p></blockquote></li></ol><hr><h3 id="附：Windows-NTSTATUS-Values"><a href="#附：Windows-NTSTATUS-Values" class="headerlink" title="附：Windows NTSTATUS Values"></a>附：<span class="exturl" data-url="aHR0cHM6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9jYzcwNDU4OC5hc3B4">Windows NTSTATUS Values<i class="fa fa-external-link-alt"></i></span></h3><blockquote><p>其中0xC000006D表示：尝试登录无效。这可能是由于用户名或身份验证信息不正确造成的。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Ubuntu18.04 </category>
          
          <category> VPN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> proxy </tag>
            
            <tag> Ubuntu18.04 </tag>
            
            <tag> VPN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为IIS10配置PHP开发环境</title>
      <link href="/2019/01/10/1/"/>
      <url>/2019/01/10/1/</url>
      
        <content type="html"><![CDATA[<h3 id="1-准备工作："><a href="#1-准备工作：" class="headerlink" title="1. 准备工作："></a>1. 准备工作：</h3><h4 id="1-控制面板-gt-开启或关闭Windows功能-gt-IIS-gt-CGI"><a href="#1-控制面板-gt-开启或关闭Windows功能-gt-IIS-gt-CGI" class="headerlink" title="1. 控制面板 -&gt; 开启或关闭Windows功能 -&gt; IIS -&gt; CGI"></a>1. 控制面板 -&gt; 开启或关闭Windows功能 -&gt; IIS -&gt; CGI</h4><p> <img src="/images/php1.jpg" alt="Loading"></p><h4 id="2-下载相应版本的PHP：官网"><a href="#2-下载相应版本的PHP：官网" class="headerlink" title="2. 下载相应版本的PHP：官网"></a>2. 下载相应版本的PHP：<span class="exturl" data-url="aHR0cHM6Ly93aW5kb3dzLnBocC5uZXQvZG93bmxvYWQv">官网<i class="fa fa-external-link-alt"></i></span></h4><ol><li>None-Thread Safe：非线程安全，在执行 时不进行线程是否安全的检查</li><li>Thread Safe: 线程安全，在执行时进行线程是否安全的检查，更安全 </li><li>FastCGI： 执行方式是以单一线程来执行操作，所以不需要进行线程的安全性检查，除去线程安全检查的防护反而可以提高执行效率。</li><li>其实个人的话都随便，就算有性能损失，有能有多少呢？这都9102年了。</li></ol><h4 id="3-安裝-Visual-Studio-2015-的-Visual-C-可再发行套件（安装过MicroSoft-SQL可以无视这一步，安装过VS2017应该也可以无视，未测试）"><a href="#3-安裝-Visual-Studio-2015-的-Visual-C-可再发行套件（安装过MicroSoft-SQL可以无视这一步，安装过VS2017应该也可以无视，未测试）" class="headerlink" title="3. 安裝 Visual Studio 2015 的 Visual C++ 可再发行套件（安装过MicroSoft SQL可以无视这一步，安装过VS2017应该也可以无视，未测试）"></a>3. 安裝 Visual Studio 2015 的 Visual C++ 可再发行套件（安装过MicroSoft SQL可以无视这一步，安装过VS2017应该也可以无视，未测试）</h4><blockquote><p>其实MicroSoft SQL用的就算VS2015的东西，修修改改又不是不能用<br>VC11 版本对应 VS2012<br>VC14 版本对应 VS2015</p></blockquote><hr><h3 id="2-配置："><a href="#2-配置：" class="headerlink" title="2. 配置："></a>2. 配置：</h3><blockquote><p>下面以<code>php-7.1.26-Win32-VC14-x64.zip</code>解压到<code>C:\PHP\</code>文件夹例子</p></blockquote><h4 id="1-修改配置文件php-ini"><a href="#1-修改配置文件php-ini" class="headerlink" title="1. 修改配置文件php.ini"></a>1. 修改配置文件<code>php.ini</code></h4><blockquote><p>首先创建<code>C:\PHP\php.ini-production</code>的副本并重命名为<code>php.ini</code>  </p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#Ctrl + F，然后去掉前面的<span class="string">&quot;;&quot;</span>注释</span><br><span class="line">#必须修改</span><br><span class="line">extension_dir =<span class="string">&quot;C:\PHP\ext&quot;</span> </span><br><span class="line">#推荐修改</span><br><span class="line">fastcgi.impersonate = <span class="number">1</span></span><br><span class="line">fastcgi.logging = <span class="number">0</span></span><br><span class="line">cgi.fix_pathinfo=<span class="number">1</span></span><br><span class="line">cgi.force_redirect = <span class="number">0</span></span><br><span class="line">date.timezone = <span class="string">&quot;Asia/Taipei&quot;</span></span><br><span class="line">doc_root = <span class="string">&quot;C:\inetpub\wwwroot&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2-配置IIS"><a href="#2-配置IIS" class="headerlink" title="2. 配置IIS"></a>2. 配置IIS</h4><p> <img src="/images/php2.jpg" alt="Loading"><br> <img src="/images/php3.jpg" alt="Loading"><br> <em><strong>这里有个坑，记得点一下</strong>.dll</em><br> <img src="/images/php4.jpg" alt="Loading"></p><h3 id="3-测试："><a href="#3-测试：" class="headerlink" title="3. 测试："></a>3. 测试：</h3><p> 在<code>C:\inetpub\wwwroot</code>（或者自己的一个网站文件夹）下新建一个文件<code>hello.php</code>。输入内容：<br> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; </span><br><span class="line">  &lt;head&gt; </span><br><span class="line">    &lt;title&gt;World&lt;/title&gt; </span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt; </span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Hello world&quot;</span> <span class="meta">?&gt;</span> </span><br><span class="line">  &lt;/body&gt; </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>保存后，打开浏览器，输入地址：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdC9oZWxsby5waHA=">http://localhost/hello.php<i class="fa fa-external-link-alt"></i></span> 。如果网页中显示Hello world则说明安装正确。</p><blockquote><p>我们也可以在网页中通过查看hello.php的源代码，如果源代码中没有php代码，也说明安装是正确的。</p></blockquote><hr><h3 id="4-可能遇到的问题-转自：http-www-mamicode-com-info-detail-2452509-html"><a href="#4-可能遇到的问题-转自：http-www-mamicode-com-info-detail-2452509-html" class="headerlink" title="4. 可能遇到的问题(转自：http://www.mamicode.com/info-detail-2452509.html)"></a>4. 可能遇到的问题(转自：<span class="exturl" data-url="aHR0cDovL3d3dy5tYW1pY29kZS5jb20vaW5mby1kZXRhaWwtMjQ1MjUwOS5odG1s">http://www.mamicode.com/info-detail-2452509.html<i class="fa fa-external-link-alt"></i></span>)</h3><ol><li><p>服务器报505错误，原因是缺少<code>visual c++2011</code></p></li><li><p>页面显示No input file specified，原因：如果使用ide自带的web服务器，需要把<code>php.ini</code>的<code>doc_root = &quot;C:\inetpub\wwwroot&quot;</code>注释掉</p></li><li><p>设置php时区，<code>php.ini</code>中修改<code>date.timezone = &quot;Asia/Shanghai&quot;</code></p></li><li><p>IIS的<code>wwwroot</code>目录在C盘所以需要手动开启写入权限，参考：<span class="exturl" data-url="aHR0cDovL2ppbmd5YW4uYmFpZHUuY29tL2FydGljbGUvMjE1ODE3ZjdmYTFiZDQxZWRhMTQyMzliLmh0bWw=">http://jingyan.baidu.com/article/215817f7fa1bd41eda14239b.html<i class="fa fa-external-link-alt"></i></span></p></li><li><p>开启php服务器系统日志，<code>php.ini</code>中设置<code>log_errors = On</code>，并设置<code>error_log = C:/php/error.log</code>。程序中的<code>error_log(&quot;test&quot;)</code>就会把<code>test</code>输出到日志文件中，同时也可以设置<code>display_errors = Off</code> <strong>关闭错误回显</strong>，以免因为这些错误所透露的路径、数据库连接、数据表等信息而遭到黑客攻击。转自：<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veWFvaHVuemhhbnl1ZS9wLzc0NDA1NzQuaHRtbA==">https://www.cnblogs.com/yaohunzhanyue/p/7440574.html<i class="fa fa-external-link-alt"></i></span></p></li></ol><hr><h3 id="使用IIS自带的安装平台进行安装和管理PHP"><a href="#使用IIS自带的安装平台进行安装和管理PHP" class="headerlink" title="使用IIS自带的安装平台进行安装和管理PHP"></a>使用IIS自带的安装平台进行安装和管理PHP</h3><ul><li>安装<strong>PHP</strong> ： 打开IIS -&gt; Web平台安装程序 -&gt; 搜索PHP -&gt; 安装对应版本的PHP</li></ul><p> <img src="/images/php6.jpg" alt="alt"></p><center><small>（点击绿色圈里面的会新建一个窗口，红色圈里面的会在本页面打开）</small></center><ul><li><p>安装<strong>PHP Manager</strong>：</p><ol><li><p>打开IIS -&gt; Web平台安装程序 -&gt; 搜索PHP Manager -&gt; 安装PHP Manager</p></li><li><p>通过安装<code>.msi</code>包来安装PHP Manager: <span class="exturl" data-url="aHR0cHM6Ly93d3cuaWlzLm5ldC9kb3dubG9hZHMvY29tbXVuaXR5LzIwMTgvMDUvcGhwLW1hbmFnZXItMTUwLWZvci1paXMtMTA=">下载地址<i class="fa fa-external-link-alt"></i></span></p></li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
          <category> IIS10 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> config </tag>
            
            <tag> IIS </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开源文件分享软件</title>
      <link href="//2019/01/06/%E5%BC%80%E6%BA%90%E6%96%87%E4%BB%B6%E5%88%86%E4%BA%AB%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BD%91%E7%9B%98/"/>
      <url>//2019/01/06/%E5%BC%80%E6%BA%90%E6%96%87%E4%BB%B6%E5%88%86%E4%BA%AB%E8%BD%AF%E4%BB%B6%E5%92%8C%E7%BD%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h3 id="Nextcloud-amp-Owncloud"><a href="#Nextcloud-amp-Owncloud" class="headerlink" title="Nextcloud &amp; Owncloud"></a><span class="exturl" data-url="aHR0cHM6Ly9uZXh0Y2xvdWQuY29tLw==">Nextcloud &amp; Owncloud<i class="fa fa-external-link-alt"></i></span></h3><h4 id="安装方式："><a href="#安装方式：" class="headerlink" title="安装方式："></a>安装方式：</h4><ol><li>snap安装方式：   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install snap</span><br><span class="line">sudo snap install nextcloud</span><br></pre></td></tr></table></figure>    1. [网络在线安装：](https://nextcloud.com/install/#instructions-server)<ol><li>Right-click <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5uZXh0Y2xvdWQuY29tL3NlcnZlci9pbnN0YWxsZXIvc2V0dXAtbmV4dGNsb3VkLnBocA==">here<i class="fa fa-external-link-alt"></i></span> and save the file to your computer</li><li>Upload <code>setup-nextcloud.php</code> to your web space</li><li>Point your web browser to <code>setup-nextcloud.php</code> on your webspace</li><li>Follow the instructions and configure Nextcloud</li><li>Login to your newly created Nextcloud instance!    2. 全手动安装，<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5uZXh0Y2xvdWQuY29tL3NlcnZlci9yZWxlYXNlcy9uZXh0Y2xvdWQtMTUuMC4wLnppcA==">下载zip文件<i class="fa fa-external-link-alt"></i></span>  </li></ol></li></ol><pre><code>3. docker安装</code></pre><h4 id="界面介绍：官方示例，在线查看实时生成"><a href="#界面介绍：官方示例，在线查看实时生成" class="headerlink" title="界面介绍：官方示例，在线查看实时生成"></a>界面介绍：<span class="exturl" data-url="aHR0cHM6Ly9kZW1vLm5leHRjbG91ZC5jb20v">官方示例，在线查看实时生成<i class="fa fa-external-link-alt"></i></span></h4><h4 id="功能介绍："><a href="#功能介绍：" class="headerlink" title="功能介绍："></a>功能介绍：</h4><ol><li>可以在线播放MP4视频，MP3文件<ol start="2"><li>可以挂载外部储存</li><li>在线office</li><li>有很多在线插件，即点即用</li><li>对中文支持挺好</li><li>多说无益，自己去官方示例中体验吧</li></ol></li></ol><h3 id="Pydio"><a href="#Pydio" class="headerlink" title="Pydio"></a><span class="exturl" data-url="aHR0cHM6Ly9weWRpby5jb20v">Pydio<i class="fa fa-external-link-alt"></i></span></h3><ol><li><p>安装方式：支持全手动和docker安装</p></li><li><p>界面介绍：<span class="exturl" data-url="aHR0cHM6Ly9weWRpby50eXBlZm9ybS5jb20vdG8vQVV2bENq">官方示例，在线查看实时生成<i class="fa fa-external-link-alt"></i></span> </p></li><li><p>功能介绍：</p><ol><li>可以在线播放MP4视频，MP3文件</li><li>对中文支持不怎么好</li><li><strong>界面非常好看</strong>（最大的特点）</li></ol></li></ol><h3 id="kiftd"><a href="#kiftd" class="headerlink" title="kiftd"></a><span class="exturl" data-url="aHR0cHM6Ly9rb2hneWx3LmdpdGVlLmlvLw==">kiftd<i class="fa fa-external-link-alt"></i></span></h3><ol><li><p>安装方式：无需安装，解压文件夹后直接执行解压文件夹一级目录下的<code>*.jar</code>文件（需先安装<code>Java</code>）</p></li><li><p>界面介绍： <img src="https://github.com/KOHGYLW/kiftd-showPicture/blob/master/kiftd-mainpage.png?raw=true" alt="Loading" title="自由、民主"></p></li><li><p>功能介绍：</p><ol><li>全中文文档，上手快</li><li>使用非常方便、简单、即点即用</li><li>界面简洁，就是一个简单的文件分享平台</li></ol></li><li><p>配置文件介绍：具体查看下载文件夹里面的说明文档的第27页和30页</p></li></ol><h3 id="DictionaryList"><a href="#DictionaryList" class="headerlink" title="DictionaryList"></a>DictionaryList</h3><ol><li>功能介绍：简单、好看的文件分享网站</li></ol><h3 id="seafile"><a href="#seafile" class="headerlink" title="seafile"></a>seafile</h3><blockquote><p>界面不怎么好看</p></blockquote><h3 id="dzzoffice"><a href="#dzzoffice" class="headerlink" title="dzzoffice"></a>dzzoffice</h3><blockquote><p>不怎么样，一般般，主要面对与使用office的企业用户和学生用户</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Share </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Open Source </tag>
            
            <tag> Share </tag>
            
            <tag> nextcloud </tag>
            
            <tag> pydio </tag>
            
            <tag> kiftd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改Grub启动主题以及默认启动项</title>
      <link href="//2018/12/27/%E4%BF%AE%E6%94%B9Grub%E5%90%AF%E5%8A%A8%E4%B8%BB%E9%A2%98%E4%BB%A5%E5%8F%8A%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E9%A1%B9/"/>
      <url>//2018/12/27/%E4%BF%AE%E6%94%B9Grub%E5%90%AF%E5%8A%A8%E4%B8%BB%E9%A2%98%E4%BB%A5%E5%8F%8A%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<blockquote><blockquote><p>在此之前还可以参考 <em><a href="https://iitii.github.io/2018/11/27/Ubuntu18.04%E9%85%8D%E7%BD%AEflat-remiax%E4%B8%BB%E9%A2%98/">Ubuntu18.04配置flat-remiax主题</a></em> 进行 <em>Ubuntu</em>主题的更改</p></blockquote></blockquote><h3 id="1-修改Grub主题"><a href="#1-修改Grub主题" class="headerlink" title="1. 修改Grub主题"></a>1. 修改Grub主题</h3><ol><li><p>打开 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZ25vbWUtbG9vay5vcmcvYnJvd3NlL2NhdC8xMDkv">Grub theme<i class="fa fa-external-link-alt"></i></span> 选择你需要的主题并下载，推荐主题: <span class="exturl" data-url="aHR0cHM6Ly93d3cuZ25vbWUtbG9vay5vcmcvcC8xMTc2NDEzLw==">Poly light<i class="fa fa-external-link-alt"></i></span>  主题项目: <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NodmNoay9wb2x5LWxpZ2h0">Github<i class="fa fa-external-link-alt"></i></span>  </p><ul><li>预览：<img src="https://cn.opendesktop.org/img/d/6/4/7/467857c37ada80e2c57f37fac45ea93efe03.gif" alt="Loading..." title="自由、民主"></li></ul></li><li><p>下拉网页，在 <em>Product</em> 那里一般会有 <em>Description</em> 里面有作者的说明，具体包括<strong>安装</strong> 与 <strong>嘤</strong> 用。（一般的话就是直接解压，打开解压文件夹，运行 <code>./install.sh</code>,具体可能有所不同，自行选择）</p></li><li><p>名称及路径</p></li></ol><table><thead><tr><th align="right">名称</th><th align="right">路径</th></tr></thead><tbody><tr><td align="right">主题文件夹</td><td align="right"><code>/boot/grub/theme/*</code></td></tr><tr><td align="right">主题的配置文件</td><td align="right"><code>/boot/grub/theme/*/theme.txt</code></td></tr><tr><td align="right">主题的背景图片</td><td align="right"><code>/boot/grub/theme/*/background.png</code></td></tr><tr><td align="right"><em>Grub</em> 文件</td><td align="right"><code>/etc/default/grub/</code></td></tr></tbody></table><hr><blockquote><ol><li>主题的背景图片支持 <code>*.png</code> <code>*.jpg</code> <code>*.jpeg</code> 等格式  </li><li>更换图片时请务必注意图片的分辨率，必须小于屏幕的分辨率,否则会崩掉，使用默认主题。推荐 <a href="www.iloveimg.com">iLoveImg</a> 在线修图</li><li>修改完以上路径下的任意一个文件后， 最好使用 <code>sudo update-grub</code>命令更新一下Grub</li></ol></blockquote><hr><h3 id="2-修改Grub默认启动项"><a href="#2-修改Grub默认启动项" class="headerlink" title="2. 修改Grub默认启动项"></a>2. 修改<em>Grub</em>默认启动项</h3><hr><ol><li>执行 <code>sudo vim /etc/default/grub</code> 找到以下代码块: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GRUB_DEFAULT=0</span><br><span class="line"><span class="comment">#GRUB_HIDDEN_TIMEOUT=0</span></span><br><span class="line">GRUB_HIDDEN_TIMEOUT_QUIET=<span class="literal">true</span></span><br><span class="line">GRUB_TIMEOUT=2</span><br><span class="line">GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || <span class="built_in">echo</span> Debian`</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><em><code>GRUB_DEFAULT=0</code></em> 代表默认启动项为第一项。就我个人电脑而言启动顺序如下 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu</span><br><span class="line">Advanced Operation <span class="keyword">for</span> Ubuntu</span><br><span class="line">Windows boot Manage</span><br><span class="line">System setup</span><br></pre></td></tr></table></figure><ul><li>其中从上而下顺序为0，1，2，3。所以应修改 <code>GRUB_DEFAULT=2</code>, 以此类推。</li><li>如果想修改Grub，启动默认等待时间的话可以修改 <code>GRUB_TIMEOUT=2</code> 的值，现在默认等待时间为2秒。</li></ul></li><li><code>sudo update-grub &amp;&amp; reboot</code></li></ol><hr><h3 id="3-数据有风险？-想皮需谨慎。"><a href="#3-数据有风险？-想皮需谨慎。" class="headerlink" title="3. 数据有风险？ 想皮需谨慎。"></a>3. 数据有风险？ 想皮需谨慎。</h3><!--![alt](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/%E7%9A%AE-order.gif/150px-%E7%9A%AE-order.gif)![alt](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/%E7%9A%AE-order.gif/150px-%E7%9A%AE-order.gif)![alt](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/%E7%9A%AE-order.gif/150px-%E7%9A%AE-order.gif)![alt](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/%E7%9A%AE-order.gif/150px-%E7%9A%AE-order.gif)<center><small>（本文所有图片来源网络，侵删）</small></center>-->]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
            <tag> grub </tag>
            
            <tag> linux grub </tag>
            
            <tag> linux grub2 </tag>
            
            <tag> 修改 grub 启动顺序 </tag>
            
            <tag> 修改 grub 主题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令行代理方式</title>
      <link href="//2018/12/19/%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86/"/>
      <url>//2018/12/19/%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="Windows命令行代理"><a href="#Windows命令行代理" class="headerlink" title="Windows命令行代理"></a>Windows命令行代理</h3><blockquote><p>因为在Win10上测试时 <code>powershell</code> 和 <code>cmd</code> 进行代理使用的命令是相同的，就不再赘述</p></blockquote><h4 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> http_proxy=http://user:password@IP:port </span><br><span class="line"><span class="built_in">set</span> https_proxy=https://user:password@IP:port</span><br></pre></td></tr></table></figure><h4 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> http_proxy=http://localhost:<span class="number">1080</span></span><br><span class="line"><span class="built_in">set</span> https_proxy=https://localhost:<span class="number">1080</span></span><br></pre></td></tr></table></figure><h4 id="清除代理"><a href="#清除代理" class="headerlink" title="清除代理"></a>清除代理</h4><blockquote><p>对于临时代理，目前没有什么好的办法，只能关掉重开 powershell。<br>有人说下面这种方法能用  </p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不带参数</span></span><br><span class="line"><span class="built_in">set</span> http_proxy=</span><br><span class="line"><span class="built_in">set</span> https_proxy=</span><br></pre></td></tr></table></figure><blockquote><p> 对于系统代理(永久代理)，直接清除环境变量就好了<br>同理，如果想设置为系统代理(永久代理)，直接添加环境变量就好了  </p></blockquote><p><img src="/images/terminal-proxy/system.png" alt="alt" title="系统属性-&gt;高级"><br><img src="/images/terminal-proxy/evn.png" alt="alt" title="环境变量-&gt;用户变量"></p><hr><h3 id="Linux-amp-Git-命令行代理"><a href="#Linux-amp-Git-命令行代理" class="headerlink" title="Linux &amp; Git 命令行代理"></a>Linux &amp; Git 命令行代理</h3><h4 id="标准-1"><a href="#标准-1" class="headerlink" title="标准"></a>标准</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=user:password@IP:port</span><br><span class="line"><span class="built_in">export</span> https_proxy=user:password@IP:port</span><br></pre></td></tr></table></figure><h4 id="范例-1"><a href="#范例-1" class="headerlink" title="范例"></a>范例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=localhost:1080</span><br><span class="line"><span class="built_in">export</span> https_proxy=localhost:1080</span><br></pre></td></tr></table></figure><h4 id="清除代理-1"><a href="#清除代理-1" class="headerlink" title="清除代理"></a>清除代理</h4><blockquote><p>对于临时代理，可以关掉重开 Terminal<br>也可以用以下方法  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不带参数</span></span><br><span class="line"><span class="built_in">export</span> http_proxy=</span><br><span class="line"><span class="built_in">export</span> https_proxy=</span><br></pre></td></tr></table></figure><blockquote><p> 对于系统代理(永久代理)，直接清除环境变量就好了<br>同理，如果想设置为系统代理(永久代理)，直接添加环境变量就好了<br>推荐在 <em>~/.bashrc</em> 里面设置  </p></blockquote><ul><li>设置代理 (<strong>bash</strong>)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;export http_proxy=localhost:1080\nexport https_proxy=localhost:1080&quot;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure><ul><li>清除代理 (<strong>bash</strong>)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;export http_proxy=\nexport https_proxy=&quot;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure><hr><h3 id="验证是否配置成功-："><a href="#验证是否配置成功-：" class="headerlink" title="验证是否配置成功 ："></a>验证是否配置成功 ：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl google.com</span><br></pre></td></tr></table></figure><blockquote><p>如果返回的消息中含有 <em>200</em>，<em>301</em> 状态码，皆表示已连通<br>如果等待一段时间后无响应或返回 <em>404</em>，则代表已断开  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Windows </category>
          
          <category> proxy </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux终端字体上色与常用命令</title>
      <link href="//2018/12/16/Linux%E7%BB%88%E7%AB%AF%E5%AD%97%E4%BD%93%E4%B8%8A%E8%89%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>//2018/12/16/Linux%E7%BB%88%E7%AB%AF%E5%AD%97%E4%BD%93%E4%B8%8A%E8%89%B2%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="1-Linux终端字体加上颜色"><a href="#1-Linux终端字体加上颜色" class="headerlink" title="1. Linux终端字体加上颜色"></a>1. Linux终端字体加上颜色</h3><ul><li><p><code>echo -e &quot;\033[32;49;1m [DONE] \033[39;49;0m&quot;</code></p></li><li><p>输出结果：<font color=#00ff00>[DONE]</font></p></li></ul><hr><p>文本终端的颜色可以使用“ANSI非常规字符序列”来生成。举例：</p><ul><li><code>echo -e &quot;\033[44;37;5m ME \033[0m COOL&quot;</code></li></ul><blockquote><p>以上命令设置背景成为蓝色，前景白色，闪烁光标，输出字符“ME”，然后重新设置屏幕到&gt; 缺省设置，输出字符 “COOL”。“e”是命令 echo 的一个可选项，它用于激活特殊字符的&gt; 解析器。“\033”引导非常规字符序列。“m”意味着设置属性然后结束非常规字符序列，这&gt; 个例子里真正有效的字符是 “44;37;5” 和“0”。<br>修改“44;37;5”可以生成不同颜色的组合，数值和编码的前后顺序没有关系。可以选择的编码如下所示：</p></blockquote><table><thead><tr><th>编码</th><th>颜色/动作</th><th>编码</th><th>颜色/动作</th></tr></thead><tbody><tr><td>0</td><td>重新设置属性到缺省设置</td><td>34</td><td>设置蓝色前景</td></tr><tr><td>1</td><td>设置粗体</td><td>35</td><td>设置紫色前景</td></tr><tr><td>2</td><td>设置一半亮度（模拟彩色显示器的颜色）</td><td>36</td><td>设置青色前景</td></tr><tr><td>4</td><td>设置下划线（模拟彩色显示器的颜色）</td><td>37</td><td>设置白色前景</td></tr><tr><td>5</td><td>设置闪烁</td><td>38</td><td>在缺省的前景颜色上设置下划线</td></tr><tr><td>7</td><td>设置反向图象</td><td>39</td><td>在缺省的前景颜色上关闭下划线</td></tr><tr><td>22</td><td>设置一般密度</td><td>40</td><td>设置黑色背景</td></tr><tr><td>24</td><td>关闭下划线</td><td>41</td><td>设置红色背景</td></tr><tr><td>25</td><td>关闭闪烁</td><td>42</td><td>设置绿色背景</td></tr><tr><td>27</td><td>关闭反向图象</td><td>43</td><td>设置棕色背景</td></tr><tr><td>30</td><td>设置黑色前景</td><td>44</td><td>设置蓝色背景</td></tr><tr><td>31</td><td>设置红色前景</td><td>45</td><td>设置紫色背景</td></tr><tr><td>32</td><td>设置绿色前景</td><td>46</td><td>设置青色背景</td></tr><tr><td>33</td><td>设置棕色前景</td><td>47</td><td>设置白色背景</td></tr><tr><td>49</td><td>设置缺省黑色背景</td><td>\033[2J</td><td>清除屏幕</td></tr><tr><td>\033[0q</td><td>关闭所有的键盘指示灯</td><td>\033[1q</td><td>设置“滚动锁定”指示灯 (<em>Scroll Lock</em>)</td></tr><tr><td>\033[2q</td><td>设置“数值锁定”指示灯 (Num Lock)</td><td>\033[3q</td><td>设置“大写锁定”指示灯 (Caps Lock)</td></tr><tr><td>\033[15:40H</td><td>把关闭移动到第15行，40列</td><td>\007</td><td>发蜂鸣生beep</td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><hr><h3 id="2-RedHat的字体和背景颜色的改变方法："><a href="#2-RedHat的字体和背景颜色的改变方法：" class="headerlink" title="2. RedHat的字体和背景颜色的改变方法："></a>2. RedHat的字体和背景颜色的改变方法：</h3><ul><li><p>命令：<code>PS1=&quot;[\e[32;1m\u@\h \W]\\$&quot; </code><br>  或<br>  <code>export PS1=&quot;[\e[32;1m\u@\h \W]\\$&quot; </code>两者的区别请查看环境变量的相关资料<br>  解释：<br>  <code>\e[32;1m</code>：这就是控制字体和背景颜色的转义字符，<strong>30~37</strong>是字体颜色、<strong>40~47</strong>是背景颜色<br>  例子中的<code>32;1m</code>数字的位置是可以对调的如<code>\e[1;32m</code>，如果是在X环境下可以更换一下1的范围<strong>0~10</strong>，可能有的没用处<code>：0</code>或者不写（<code>\e [0;32m或\e[;32m</code>）显示浅颜色，1：显示高亮 4：加下划线…..如果改后的效果不好，但是又还原不了，那就不写m前面的数字，如<code>\e[32;m</code>，或者直接注销再登陆  </p><p>  <code>\u \h \W</code>：这是一些转义字符，下面详细解释:  </p><p>  \d ：代表日期，格式为weekday month date，例如：”Mon Aug 1”</p><p>  \H ：完整的主机名称。例如：我的机器名称为：l，则这个名称就是 l</p><p>  \h ：仅取主机的第一个名字，如上例，则为 l 则被省略</p><p>  \t ：显示时间为24小时格式，如：HH：MM：SS</p><p>  \T ：显示时间为12小时格式</p><p>  \A ：显示时间为24小时格式：HH：MM</p><p>  \u ：当前用户的账号名称</p><p>  \v ：BASH的版本信息</p><p>  \w ：完整的工作目录名称。家目录会以 ~代替</p><p>  \W ：利用basename取得工作目录名称，所以只会列出最后一个目录</p><p>  \# ：下达的第几个命令</p><p>  \$ ：提示字符，如果是root时，提示符为：# ，普通用户则为：$</p><p>  \n ：新建一行</p><p>  字体并不局限于一个颜色，可以有多个颜色：</p><p>  PS1=”[\e[32;1m\u@\e[35;1m\h \e[31;1m\W]\$”</p><p>  以上两个命令在注销后再登陆就失效了，用下面方法使其永久生效：</p><p>  vim /etc/profile</p><p>  在“export PATH …..”下面添加一行：<code>export PS1=&quot;[\e[32;1m\u@\h \W]\\\$&quot;</code></p><p>  注销再登陆，就成功了，如果没生效，使用source /etc/profile 命令试试，或者直接重启机器。</p></li></ul><h3 id="3-常见Command"><a href="#3-常见Command" class="headerlink" title="3. 常见Command"></a>3. 常见<em>Command</em></h3><table><thead><tr><th><em>Command</em></th><th align="right">主要用途</th><th><em>Command</em></th><th align="right">主要用途</th></tr></thead><tbody><tr><td>basename</td><td align="right">去掉文件名的目录和后缀</td><td>dirname</td><td align="right">截取给定路径的目录部分</td></tr><tr><td>swap on</td><td align="right">开启交换分区</td><td>swap off</td><td align="right">关闭交换分区</td></tr><tr><td>ezfsck</td><td align="right">检查ext分区系统</td><td>resizezfs</td><td align="right">调整ext分区大小</td></tr><tr><td>fsck</td><td align="right">检查、修复 linux 文件系统</td><td>dmesg</td><td align="right">显示开机信息</td></tr><tr><td>partprobe</td><td align="right">更新内核分区表信息</td><td>mpstat</td><td align="right">各个CPU的状态统计</td></tr><tr><td>chkconfig</td><td align="right">管理<em>Linux</em>开机启动项</td><td>vmstat</td><td align="right">虚拟内存统计</td></tr><tr><td>iostat</td><td align="right">系统<strong>IO</strong>信息</td><td>sar</td><td align="right">全面获取cpu、内存等<strong>历史</strong>活动信息(<a href="https://www.cnblogs.com/imzye/p/5184277.html"><em>安装出错?</em></a>)</td></tr><tr><td>ipcs</td><td align="right">用于报告Linux中进程间通信设施的状态，显示的信息包括消息列表、共享内存和信号量的信息</td><td>ipcrm</td><td align="right">删除消息队列、共享内存、信号灯</td></tr><tr><td>ltrace</td><td align="right">跟踪进程的库函数调用,显现出哪个库函数被程序调用</td><td>strace</td><td align="right">跟踪程序的每个系统调用</td></tr><tr><td>ansible</td><td align="right">基于ssh的自动化部署</td><td>pstree</td><td align="right">像<span class="exturl" data-url="aHR0cDovL21hbi5saW51eGRlLm5ldC90cmVl">tree<i class="fa fa-external-link-alt"></i></span>一样打印进程树</td></tr></tbody></table><hr><h3 id="4-说明："><a href="#4-说明：" class="headerlink" title="4. 说明："></a>4. 说明：</h3><h4 id="1-basename"><a href="#1-basename" class="headerlink" title="1. basename"></a>1. basename</h4><blockquote><p>Usage: basename NAME [SUFFIX]<br>or:  basename OPTION… NAME…</p></blockquote><table><thead><tr><th><strong>PATH</strong></th><th><strong>basename</strong></th><th align="right"><strong>dirname</strong></th></tr></thead><tbody><tr><td>“/usr/lib”</td><td>“/usr”</td><td align="right">“lib”</td></tr><tr><td>“/usr/“</td><td>“/“</td><td align="right">“usr”</td></tr><tr><td>“usr”</td><td>“.”</td><td align="right">“usr”</td></tr><tr><td>“/“</td><td>“/“</td><td align="right">“/“</td></tr><tr><td>“.”</td><td>“.”</td><td align="right">“.”</td></tr><tr><td>“..”</td><td>“.”</td><td align="right">“..”</td></tr></tbody></table><h4 id="2-dirname："><a href="#2-dirname：" class="headerlink" title="2. dirname："></a>2. dirname：</h4><blockquote><p>Usage: dirname [OPTION] NAME…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh  </span></span><br><span class="line"><span class="comment"># 跳转到脚本所在目录  </span></span><br><span class="line"><span class="built_in">cd</span> $(<span class="built_in">dirname</span> <span class="string">&quot;<span class="variable">$0</span>&quot;</span>) || <span class="built_in">exit</span> 1  </span><br><span class="line"><span class="comment"># 剩下的部分 </span></span><br><span class="line"><span class="comment"># 可以跳转到脚本所在目录</span></span><br></pre></td></tr></table></figure><blockquote><p>root@l：~$ dirname /usr/bin/sort </p></blockquote><blockquote><p> /usr/bin</p></blockquote><blockquote><p>root@l：~$ dirname stdio.h </p></blockquote><blockquote><p>.</p></blockquote><blockquote><p>root@l：~$ dirname /usr/bin </p></blockquote><blockquote><p>/usr</p></blockquote><blockquote><p>root@l：~$ dirname /usr/bin/ </p></blockquote><blockquote><p>/usr</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@l：~$ pathname=/usr/bin/sort; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">/usr/bin /usr/bin</span><br><span class="line">root@l：~$ pathname=/usr/bin/; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span></span><br><span class="line">/usr /usr/bin</span><br><span class="line"><span class="comment">#与上一个路径名相比少了一个斜杠</span></span><br><span class="line">root@l：~$ pathname=/usr/bin; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">/usr /usr</span><br><span class="line">root@l：~$ pathname=/usr/; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">/ /usr</span><br><span class="line">root@l：~$ pathname=/usr; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">/</span><br><span class="line">root@l：~$ pathname=/; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">/</span><br><span class="line">root@l：~$ pathname=stdio.h; <span class="built_in">echo</span> $(<span class="built_in">dirname</span> <span class="variable">$pathname</span>) <span class="variable">$&#123;pathname%/*&#125;</span> </span><br><span class="line">. stdio.h</span><br></pre></td></tr></table></figure><h4 id="3-ipcs"><a href="#3-ipcs" class="headerlink" title="3. ipcs"></a>3. ipcs</h4><blockquote><p>Usage: ipcs [ -m] [ -q] [ -s] [ -S] [ -P] [ -1] [ -a | -b -c -o -p -r -t] [ -T] [ -C CoreFile] [ -N Kernel ] [ -X ] [ -@ [ WparName ] ]</p></blockquote><blockquote><p>ipcs 命令往标准输出写入一些关于活动进程间通信工具的信息。如果没有指定标志，ipcs 命令用简短格式写入一些关于当前活动消息队列、共享内存段、信号量、远程队列和本地队列标题。</p></blockquote><table><thead><tr><th><strong>File</strong></th><th align="right">描述</th></tr></thead><tbody><tr><td><em>/usr/lib/boot/unix</em></td><td align="right">指定系统内核映像</td></tr><tr><td><em>/dev/mem</em></td><td align="right">指定内存</td></tr><tr><td><em>/etc/passwd</em></td><td align="right">指定用户名</td></tr><tr><td><em>/etc/group</em></td><td align="right">指定组名</td></tr><tr><td><em>/usr/include/sys/ipc.h</em></td><td align="right">包含头文件</td></tr></tbody></table><h4 id="4-ipcrm"><a href="#4-ipcrm" class="headerlink" title="4. ipcrm"></a>4. ipcrm</h4><blockquote><p>Usage: ipcrm [ -M key | -m id | -Q key | -q id | -S key | -s id ] …</p></blockquote><blockquote><p>参数:</p></blockquote><blockquote><p>-M   以shmkey删除共享内存  </p></blockquote><blockquote><p>-m   以shmid删除共享内存</p></blockquote><blockquote><p>-Q   以msgkey删除消息队列</p></blockquote><blockquote><p>-q    以msgid删除消息队列</p></blockquote><blockquote><p>-S    以semkey删除信号灯</p></blockquote><blockquote><p>-s    以semid删除信号灯</p></blockquote><h4 id="5-ltrace-amp-strace"><a href="#5-ltrace-amp-strace" class="headerlink" title="5. ltrace &amp; strace"></a>5. ltrace &amp; strace</h4><p>相同点：</p><ul><li>ltrace与strace都可以指定PID,即对运行中的程序进行跟踪.  <em><code>ltrace -p PID与strace -p PID</code></em></li><li>ltrace与strace都可以跟踪程序fork或clone子进程.ltrace是用-f参数,而strace是用-f(fork/clone)和-F(vfork).</li></ul><p>不同点:</p><ul><li>strace在跟踪系统调用的时候不需要动态库,而ltrace是根据动态库来分析程序运行的。所以ltrace也只能跟踪动态库,不能跟踪静态库。事实上我们用ltrace和strace都可以发现程序在哪个系统调用时发生了性能瓶径。ltrace用-T,而strace也用-T.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux 终端字体 颜色 </tag>
            
            <tag> Linux 终端字体 自定义颜色 </tag>
            
            <tag> Linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在VPS上挂载digitalocean space空间</title>
      <link href="/2018/12/15/1/"/>
      <url>/2018/12/15/1/</url>
      
        <content type="html"><![CDATA[<h3 id="Digitalocean-Space"><a href="#Digitalocean-Space" class="headerlink" title="Digitalocean Space"></a>Digitalocean Space</h3><ul><li>最低每月 5$（250G储存空间，1T流量），可以随时增加容量大小，支持Amazon S3块储存协议</li><li>而且现在注册的话，新用户会自动赠送100$ , 有效期2个月，如果是学生的话还可以再增加50$，有效期12个月<h4 id="使用s3fs-fuse将space挂载为一个相当于本地硬盘的云盘"><a href="#使用s3fs-fuse将space挂载为一个相当于本地硬盘的云盘" class="headerlink" title="使用s3fs-fuse将space挂载为一个相当于本地硬盘的云盘"></a>使用<code>s3fs-fuse</code>将space挂载为一个相当于本地硬盘的云盘</h4></li><li>同样也可以挂载在VPS之类上进行扩容<h4 id="挂载："><a href="#挂载：" class="headerlink" title="挂载："></a>挂载：</h4></li></ul><ol><li><p><code>apt install s3fs</code></p></li><li><p>新建一个space，获取access key &amp; secret key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SPACES_KEY=access_key</span><br><span class="line">SPACES_SECRET=secret_key</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SPACES_KEY</span>:<span class="variable">$SPACES_SECRET</span> &gt; ~/.passwd-s3fs</span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.passwd-s3fs</span><br><span class="line"><span class="built_in">mkdir</span> -p /path/to/local/directory</span><br><span class="line">s3fs your-space /path/to/local/directory -o url=https://nyc3.digitaloceanspaces.com -o use_cache=/tmp</span><br></pre></td></tr></table></figure></li></ol><h4 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h4><ul><li>曾经挂载出错的目录不能直接进行二次挂载(先<code>umount</code>，再<code>mount</code>或者直接<code>remount</code>)</li></ul><ul><li><p>成功的命令 (<del>仅供参考</del>)：<code>s3fs ./wen /root/space -o url=https://sfo2.digitaloceanspaces.com -o use_cache=/tmp</code></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly9hd3MuYW1hem9uLmNvbS9jbi9ibG9ncy9jaGluYS9zM2ZzLWFtYXpvbi1lYzItbGludXgv">https://aws.amazon.com/cn/blogs/china/s3fs-amazon-ec2-linux/<i class="fa fa-external-link-alt"></i></span></p></li></ul><h4 id="感想：一点也不香，直接cp的话放不进大文件可以放小文件，其他的未做测试"><a href="#感想：一点也不香，直接cp的话放不进大文件可以放小文件，其他的未做测试" class="headerlink" title="感想：一点也不香，直接cp的话放不进大文件可以放小文件，其他的未做测试"></a>感想：一点也不香，直接cp的话放不进大文件可以放小文件，其他的未做测试</h4><h3 id="参见-：官方QA"><a href="#参见-：官方QA" class="headerlink" title="参见 ：官方QA"></a>参见 ：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvcXVlc3Rpb25zL21vdW50LXBvaW50LXdpdGgtc3BhY2Vz">官方QA<i class="fa fa-external-link-alt"></i></span></h3><hr>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> space </category>
          
      </categories>
      
      
        <tags>
            
            <tag> config </tag>
            
            <tag> space </tag>
            
            <tag> VPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04配置Flat-remiax主题</title>
      <link href="//2018/09/27/Ubuntu18.04%E9%85%8D%E7%BD%AEflat-remiax%E4%B8%BB%E9%A2%98/"/>
      <url>//2018/09/27/Ubuntu18.04%E9%85%8D%E7%BD%AEflat-remiax%E4%B8%BB%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<hr><blockquote><p><em>Update at Mon Mar 16 12:27:59 CST 2020</em>  </p></blockquote><ul><li>对于 <code>dash to dock</code> 的透明框可以采取如下方法消去：<ul><li><code>vim ~/.local/share/gnome-shell/extensions/dash-to-dock@micxgx.gmail.com/stylesheet.css</code></li><li>将第4行的 <code>border:1px;</code> 改成 <code>border:0px;</code></li><li>重新禁用和开启一遍 <code>dash to dock</code> 即可</li></ul></li><li><del>没图说个jb</del>, 我还是放几张预览图在这吧，提前看看效果</li></ul><p><img src="/images/Linux/flat-theme/1.png" alt="alt"><br><img src="/images/Linux/flat-theme/4.png" alt="alt"><br><img src="/images/Linux/flat-theme/3.jpg" alt="alt"><br><img src="/images/Linux/flat-theme/2.png" alt="alt"></p><hr><blockquote><p><em>Update at Thu Jul  4 15:14:43 CST 2019</em></p></blockquote><ul><li>关于 <code>dash to dock</code> 配置设置自动隐藏后会有一个很难看的黑框，可以在 <code>Tweaks</code> 里面关闭再打开一遍 <code>dash to dock</code> 就ok了。  </li><li>关于 <code>dash to dock</code> 在安装调整位置到屏幕的底部后，点击 <code>Show Applications</code> 后会显示俩个 <strong>dash</strong> 的问题，可以在 <code>dash to dock</code> 设置里面先把 <strong>dash</strong> 移回去，然后再改回来就没有两个 <strong>dash</strong> 了。</li></ul><hr><blockquote><p><em>Update at Fri May 24 23:13:42 CST 2019</em></p></blockquote><ul><li>2019/05/15 <code>electron-ssr</code>的作者格式化了仓库，因此本博客关于代理部分不再考虑更新。<blockquote><p><em>Update at 2019年 04月 30日 星期二 19:42:39 CST</em></p></blockquote></li><li>解决笔记本触摸板 <strong>右键点击无效</strong> 问题： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad click-method areas</span><br></pre></td></tr></table></figure></li></ul><hr><blockquote><p><em>Update at 2019年 04月 21日 星期日 12:29:05 CST</em></p></blockquote><ul><li><strong>Ubuntu18.04</strong> 打开 <span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy8=">https://extensions.gnome.org/<i class="fa fa-external-link-alt"></i></span> 时提示 <em>Gnome shell</em> 版本无法识别的 <strong>红色提示信息</strong>时，可以通过<code>sudo apt install chrome-gnome-shell</code> 来安装配置软件来解决这个问题，其他发行版的具体操作看红色提示信息里面的 <strong>documents</strong>。然后就可以直接点击网页上面的 <strong>ON/OFF</strong> 按钮来快捷安装和启用拓展了。</li><li><strong>Ubuntu18.04</strong> 现在不需要第11步了，即隐藏 <em>dash to dock</em> 。应该是修 <em>BUG</em> 了。（透明色：#00FFFFFF）</li></ul><hr><blockquote><p><em>Update at Thu Feb 14 20:16:36 CST 2019</em>  </p></blockquote><ul><li>关于Ubuntu18.04 和 Ubuntu16.04：  <ol><li>Ubuntu18.04 默认的桌面环境为Gnome，Ubuntu16.04为Unity  </li><li>此教程目前只适用于Gnome桌面（Ubuntu16.04可以通过更换默认桌面为Gnome来实现）  </li><li>应该是Ubuntu18.04自带的Gnome桌面精简了一些东西，从而导致主题安装不完全（要不然也不要微调了 <strong>:-)</strong> ）</li><li><del>Ubuntu18.04不想折腾的话，安装主题可以现在网站上挑然后再通过系统自带的软件商店搜索安装，修改过默认桌面的Ubuntu16.04可以直接在网站上点击安装，没有必要去软件商店搜索（再说了，你也搜索不到 **:-)**）</del></li></ol></li></ul><hr><blockquote><p><em>Update at Mon Jan 28 00:30:22 CST 2019</em><br>刚刚发现就算是修改为使用集显(<code>Power Saving Mode</code>)，进行开关机也不会卡，甚至感觉比仅用独显更好，更流畅; 而且现在修改<strong>Nvidia X Setting</strong>里面的模式 只需要重新登录就好了，并不需要像以前那样重启电脑</p></blockquote><hr><h3 id="1-校对BIOS时间"><a href="#1-校对BIOS时间" class="headerlink" title="1. 校对BIOS时间:"></a>1. 校对BIOS时间:</h3><blockquote><p>如果是Win10 和 Ubuntu 双系统的话，建议先执行这一条<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-local-rtc 1 --adjust-system-clock</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="2-以下操作翻墙体验更好-下载electron-ssr"><a href="#2-以下操作翻墙体验更好-下载electron-ssr" class="headerlink" title="2. 以下操作翻墙体验更好, 下载electron-ssr"></a>2. <del>以下操作翻墙体验更好, 下载electron-ssr</del></h3><ul><li><p>推荐参考：</p><ul><li><p><a href="https://iitii.github.io/2019/03/17/1/">自建简易代理</a></p></li><li><p><a href="https://iitii.github.io/2018/12/19/%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%A3%E7%90%86/">命令行代理方式</a></p></li><li><p>如果下载下面的软件和更新的时侯，速度很慢的话，可以考虑终端代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装electron-ssr依赖项</span></span><br><span class="line">sudo apt install -y gconf2 gconf-service libappindicator1 </span><br></pre></td></tr></table></figure></li><li><p>首先安装<code>electron-ssr</code>并且配置好节点，点击图标，找到导出http代理设置，点击并且复制到终端并执行，再继续之前的工作，应该会快一点。</p><p> 如果没有找到选项的话，手动设置一下：</p></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=localhost:12333 </span><br><span class="line"><span class="built_in">export</span> http_proxy=localhost:12333</span><br></pre></td></tr></table></figure><blockquote><p>这个是<code>electorn-ssr</code>默认的<code>http</code>代理方式，<strong>12333</strong> 是默认的http代理端口，可以自己修改<br>Ps：<del>话说用了这么久最后发现在Windows下用electron-ssr体验并不好，Linux下体验很好</del>  </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Github （或不是最新版本）</span></span><br><span class="line">wget https://github.com/erguotou520/electron-ssr/releases/download/v0.2.6/electron-ssr-0.2.6.deb</span><br></pre></td></tr></table></figure><ul><li><del>自建镜像点（速度快，也许并不是 Github 上最新版release，但保持每日更新，自行斟酢）:<br> <span class="exturl" data-url="aHR0cHM6Ly9saXN0LmNjYXRrLnR3Lz9kaXI9RG93bmxvYWQ=">https://list.ccatk.tw/?dir=Download<i class="fa fa-external-link-alt"></i></span></del></li></ul><h3 id="3-安装chrome"><a href="#3-安装chrome" class="headerlink" title="3. 安装chrome:"></a>3. 安装chrome:</h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb &amp;&amp; sudo dpkg -i *.deb</span><br></pre></td></tr></table></figure><h3 id="4-卸载firefox以及其他无用的链接方式"><a href="#4-卸载firefox以及其他无用的链接方式" class="headerlink" title="4. 卸载firefox以及其他无用的链接方式:"></a>4. 卸载firefox以及其他无用的链接方式:</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove unity-webapps-common</span><br><span class="line">sudo apt-get remove firefox*</span><br><span class="line">sudo apt-get remove onboard deja-dup</span><br><span class="line">sudo apt-get remove gnome-mines cheese transmission-common gnome-orca webbrowser-app gnome-sudoku landscape-client-ui-install</span><br><span class="line">sudo apt-get remove thunderbird totem rhythmbox empathy brasero simple-scan gnome-mahjongg aisleriot</span><br></pre></td></tr></table></figure><h3 id="5-安装git等："><a href="#5-安装git等：" class="headerlink" title="5. 安装git等："></a>5. 安装git等：</h3><blockquote><p>可选安装，看个人喜好<br>各个软件包具体功能建议百度  </p></blockquote>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git vim curl tree glances ncdu mc openssh-server ranger jq vnstat -y</span><br></pre></td></tr></table></figure><h3 id="6-安装gnome-tweak-tool："><a href="#6-安装gnome-tweak-tool：" class="headerlink" title="6. 安装gnome-tweak-tool："></a>6. 安装gnome-tweak-tool：</h3>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gnome-tweak-tool</span><br></pre></td></tr></table></figure><h3 id="7-安装-Gnome-拓展"><a href="#7-安装-Gnome-拓展" class="headerlink" title="7. 安装 Gnome 拓展"></a>7. 安装 Gnome 拓展</h3><blockquote><p>Ps: 在此之前需要先打开这个<span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy8=">网站 https://extensions.gnome.org/<i class="fa fa-external-link-alt"></i></span>去安装chrome插件和仓库源, 然后sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade -y . <del>如果直接search插件就有的话，当我没说。<code>sudo apt install chrome-gnome-shell</code></del><br>在安装 <em>system-monitor</em> 时请先安装依赖项：<code>sudo apt-get install gir1.2-gtop-2.0 gir1.2-networkmanager-1.0  gir1.2-clutter-1.0</code></p></blockquote><ol><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTkvdXNlci10aGVtZXMv">user themes<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMzA3L2Rhc2gtdG8tZG9jay8=">Dash to Dock<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vNTQ1L2hpZGUtdG9wLWJhci8=">Hide Top Bar<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vOTcvY292ZXJmbG93LWFsdC10YWIv">Coverflow Alt-Tab<i class="fa fa-external-link-alt"></i></span>（可能会导致桌面卡死）</li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTAyOC9nbm9tZS1zaGVsbC1hdWRpby1vdXRwdXQtc3dpdGNoZXIv">gnome-shell-audio-output-switcher<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMjc3L2ltcGF0aWVuY2Uv">impatience<i class="fa fa-external-link-alt"></i></span>（加快过渡动画的播放，看起来更快了）</li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTI3Ni9uaWdodC1saWdodC1zbGlkZXIv">night-light-slider<i class="fa fa-external-link-alt"></i></span>（类似于windows 上的 f.lux）</li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vOTA1L3JlZnJlc2gtd2lmaS1jb25uZWN0aW9ucy8=">refresh-wifi-connections<i class="fa fa-external-link-alt"></i></span></li><li> <span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTIwL3N5c3RlbS1tb25pdG9yLw==">system-monitor<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTI2Mi9iaW5nLXdhbGxwYXBlci1jaGFuZ2VyLw==">Bing Wallpaper Changer<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTE2Ni9leHRlbnNpb24tdXBkYXRlLW5vdGlmaWVyLw==">Extension Update Notifier<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTExMi9zY3JlZW5zaG90LXRvb2wv">Screenshot Tool<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vOTA2L3NvdW5kLW91dHB1dC1kZXZpY2UtY2hvb3Nlci8=">Sound Input &amp; Output Device Chooser<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9leHRlbnNpb25zLmdub21lLm9yZy9leHRlbnNpb24vMTY1My90d2Vha3MtaW4tc3lzdGVtLW1lbnUv">Tweaks in System Menu<i class="fa fa-external-link-alt"></i></span></li></ol><h3 id="8-安装guake："><a href="#8-安装guake：" class="headerlink" title="8. 安装guake："></a>8. <del>安装guake：</del></h3><blockquote><p>时代变了，自带的终端已经够了  </p></blockquote><ul><li><code>sudo apt-get install guake -y</code></li></ul><h3 id="9-安装配置oh-my-zsh："><a href="#9-安装配置oh-my-zsh：" class="headerlink" title="9. 安装配置oh-my-zsh："></a>9. 安装配置oh-my-zsh：</h3>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zsh </span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><ol><li><p>推荐<code>zsh theme</code>：<code>agnoster</code>, <code>powerlevel10k</code></p><blockquote><p>一键脚本运行两次即可：<code>bash &lt;(curl -fsSL https://raw.githubusercontent.com/IITII/Useless/master/custom_zsh/zsh-p10k.sh)</code></p></blockquote></li><li><p>修复<code>oh-my-zsh</code>在某些环境下显示不完整：<code>sudo apt install -y fonts-powerline</code> 或者自行安装 <code>MesloLGS NF</code> 字体</p></li><li><p>更改默认<code>shell</code>为<code>zsh</code>：<code>chsh -s /bin/zsh</code></p></li></ol><h3 id="10-安装flat-remix主题："><a href="#10-安装flat-remix主题：" class="headerlink" title="10. 安装flat-remix主题："></a>10. 安装flat-remix主题：</h3><blockquote><p> apt方式（推荐）</p></blockquote>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:daniruiz/flat-remix</span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment">#sudo apt install flat-remaix-*</span></span><br><span class="line">sudo apt-get install flat-remix</span><br><span class="line">sudo apt install flat-remix-gnome</span><br><span class="line">sudo apt install flat-remix-gtk</span><br></pre></td></tr></table></figure><blockquote><p><del>手撸方式（hehe）</del></p></blockquote> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp </span><br><span class="line"><span class="built_in">rm</span> -rf flat-remix-gnome-theme </span><br><span class="line">git <span class="built_in">clone</span> https://github.com/daniruiz/flat-remix-gnome </span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.themes </span><br><span class="line"><span class="built_in">cp</span> -r /tmp/flat-remix-gnome/Flat-Remix* ~/.themes </span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.shell.extensions.user-theme name <span class="string">&quot;Flat-Remix&quot;</span></span><br></pre></td></tr></table></figure><h3 id="11-微调：Ubuntu18-04锁屏后隐藏dask-to-dock："><a href="#11-微调：Ubuntu18-04锁屏后隐藏dask-to-dock：" class="headerlink" title="11. 微调：Ubuntu18.04锁屏后隐藏dask to dock："></a>11. 微调：Ubuntu18.04锁屏后隐藏<code>dask to dock</code>：</h3><ol><li><p>将扩展迁移到当前用户目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> /usr/share/gnome-shell/extensions/ubuntu-dock@ubuntu.com .<span class="built_in">local</span>/share/gnome-shell/extensions</span><br></pre></td></tr></table></figure></li><li><p>变更权限：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R <span class="variable">$USER</span>:<span class="variable">$USER</span> ~/.local/share/gnome-shell/extensions/ubuntu-dock@ubuntu.com</span><br></pre></td></tr></table></figure></li></ol><h3 id="12-更换ubuntu输入密码时的紫色界面"><a href="#12-更换ubuntu输入密码时的紫色界面" class="headerlink" title="12. 更换ubuntu输入密码时的紫色界面:"></a>12. 更换ubuntu输入密码时的紫色界面:</h3><ol><li><p>编辑以下这个 CSS 文件: <code>sudo vim /etc/alternatives/gdm3.css</code></p></li><li><p>找到 #lockDialogGroup 这一项，原始的应该是这样的:</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#lockDialogGroup&#123;</span><br><span class="line">background: #2c001e url(resource:///org/gnome/shell/theme/noise-texture.png);</span><br><span class="line">background-repeat: repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>修改配置文件为：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#lockDialogGroup &#123;</span><br><span class="line">background: url(/*自己喜欢的图片的路径*/);</span><br><span class="line">background-repeat: no-repeat;</span><br><span class="line">background-size: cover;</span><br><span class="line">background-position: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li> 最后重启: <code>reboot</code></li></ul><h3 id="13-安装spacevim："><a href="#13-安装spacevim：" class="headerlink" title="13. 安装spacevim："></a>13. 安装spacevim：</h3><blockquote><p>不一样的vim</p><p><code>curl -sLf https://spacevim.org/install.sh | bash &amp;&amp; vim</code></p></blockquote><h3 id="14-安装Google-fcitx输入法"><a href="#14-安装Google-fcitx输入法" class="headerlink" title="14. 安装Google fcitx输入法"></a>14. 安装Google fcitx输入法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install fcitx fcitx-googlepinyin im-config &amp;&amp; sudo im-config</span><br></pre></td></tr></table></figure><h3 id="15-For-Nvidia-desktop-User"><a href="#15-For-Nvidia-desktop-User" class="headerlink" title="15. For Nvidia desktop User:"></a>15. For Nvidia desktop User:</h3><blockquote><p>因为大部分笔记本一般会带有独显之类的，所以对于双卡用户来说使用Nvidia独显作为唯一输出显卡，关机重启不会卡，集显会卡一分钟再进行关机重启之类的。<del>这个卡的时间长短看机型吧</del></p></blockquote><ol><li><p><strong>Software&amp;Updates -&gt; Additional Drivers -&gt; Using recommended driver (tested) -&gt; Apply changes -&gt; Setting “Nvidia X Server Setting” -&gt; reboot</strong></p></li><li><p><strong>You can see changs in “System Settings -&gt; Details -&gt; About -&gt; Graphics”</strong></p></li><li><p>但是独显也有弊端：能耗高，发热大。<del>哎，真香！(especially in machine learning &amp; deep learning)</del></p></li></ol><blockquote><p>Ps:如果想安装其他的主题，操作差不多</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu调教 </tag>
            
            <tag> dash to dock </tag>
            
            <tag> gnome exten </tag>
            
            <tag> ubuntu flat 主题 </tag>
            
            <tag> Ubuntu18.04 </tag>
            
            <tag> theme </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
